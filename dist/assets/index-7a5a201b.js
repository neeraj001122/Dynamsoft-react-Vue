(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function r(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(c){if(c.ep)return;c.ep=!0;const p=r(c);fetch(c.href,p)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Fa(t){const e=Object.create(null);for(const r of t.split(","))e[r]=1;return r=>r in e}const qe={},$r=[],Jt=()=>{},du=()=>!1,po=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Pa=t=>t.startsWith("onUpdate:"),dt=Object.assign,ka=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},gu=Object.prototype.hasOwnProperty,He=(t,e)=>gu.call(t,e),Re=Array.isArray,Bn=t=>mo(t)==="[object Map]",pu=t=>mo(t)==="[object Set]",Ae=t=>typeof t=="function",gt=t=>typeof t=="string",Qr=t=>typeof t=="symbol",st=t=>t!==null&&typeof t=="object",Lh=t=>(st(t)||Ae(t))&&Ae(t.then)&&Ae(t.catch),mu=Object.prototype.toString,mo=t=>mu.call(t),_u=t=>mo(t).slice(8,-1),vu=t=>mo(t)==="[object Object]",Ba=t=>gt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Nn=Fa(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),_o=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},yu=/-(\w)/g,er=_o(t=>t.replace(yu,(e,r)=>r?r.toUpperCase():"")),wu=/\B([A-Z])/g,Sr=_o(t=>t.replace(wu,"-$1").toLowerCase()),Mh=_o(t=>t.charAt(0).toUpperCase()+t.slice(1)),To=_o(t=>t?`on${Mh(t)}`:""),Zi=(t,e)=>!Object.is(t,e),Io=(t,...e)=>{for(let r=0;r<t.length;r++)t[r](...e)},Fh=(t,e,r,o=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:o,value:r})},Cu=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let pl;const vo=()=>pl||(pl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function $n(t){if(Re(t)){const e={};for(let r=0;r<t.length;r++){const o=t[r],c=gt(o)?Tu(o):$n(o);if(c)for(const p in c)e[p]=c[p]}return e}else if(gt(t)||st(t))return t}const Eu=/;(?![^(]*\))/g,bu=/:([^]+)/,Su=/\/\*[^]*?\*\//g;function Tu(t){const e={};return t.replace(Su,"").split(Eu).forEach(r=>{if(r){const o=r.split(bu);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function Na(t){let e="";if(gt(t))e=t;else if(Re(t))for(let r=0;r<t.length;r++){const o=Na(t[r]);o&&(e+=o+" ")}else if(st(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}const Iu="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",xu=Fa(Iu);function Ph(t){return!!t||t===""}/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Nt;class Ou{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Nt,!e&&Nt&&(this.index=(Nt.scopes||(Nt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,r;if(this.scopes)for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].pause();for(e=0,r=this.effects.length;e<r;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,r;if(this.scopes)for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].resume();for(e=0,r=this.effects.length;e<r;e++)this.effects[e].resume()}}run(e){if(this._active){const r=Nt;try{return Nt=this,e()}finally{Nt=r}}}on(){Nt=this}off(){Nt=this.parent}stop(e){if(this._active){this._active=!1;let r,o;for(r=0,o=this.effects.length;r<o;r++)this.effects[r].stop();for(this.effects.length=0,r=0,o=this.cleanups.length;r<o;r++)this.cleanups[r]();if(this.cleanups.length=0,this.scopes){for(r=0,o=this.scopes.length;r<o;r++)this.scopes[r].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.parent=void 0}}}function Au(){return Nt}let Ze;const xo=new WeakSet;class kh{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Nt&&Nt.active&&Nt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,xo.has(this)&&(xo.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Nh(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,ml(this),jh(this);const e=Ze,r=Qt;Ze=this,Qt=!0;try{return this.fn()}finally{Uh(this),Ze=e,Qt=r,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Va(e);this.deps=this.depsTail=void 0,ml(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?xo.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Qo(this)&&this.run()}get dirty(){return Qo(this)}}let Bh=0,jn,Un;function Nh(t,e=!1){if(t.flags|=8,e){t.next=Un,Un=t;return}t.next=jn,jn=t}function ja(){Bh++}function Ua(){if(--Bh>0)return;if(Un){let e=Un;for(Un=void 0;e;){const r=e.next;e.next=void 0,e.flags&=-9,e=r}}let t;for(;jn;){let e=jn;for(jn=void 0;e;){const r=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){t||(t=o)}e=r}}if(t)throw t}function jh(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Uh(t){let e,r=t.depsTail,o=r;for(;o;){const c=o.prevDep;o.version===-1?(o===r&&(r=c),Va(o),Ru(o)):e=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=c}t.deps=e,t.depsTail=r}function Qo(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Vh(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function Vh(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===Kn))return;t.globalVersion=Kn;const e=t.dep;if(t.flags|=2,e.version>0&&!t.isSSR&&t.deps&&!Qo(t)){t.flags&=-3;return}const r=Ze,o=Qt;Ze=t,Qt=!0;try{jh(t);const c=t.fn(t._value);(e.version===0||Zi(c,t._value))&&(t._value=c,e.version++)}catch(c){throw e.version++,c}finally{Ze=r,Qt=o,Uh(t),t.flags&=-3}}function Va(t,e=!1){const{dep:r,prevSub:o,nextSub:c}=t;if(o&&(o.nextSub=c,t.prevSub=void 0),c&&(c.prevSub=o,t.nextSub=void 0),r.subs===t&&(r.subs=o,!o&&r.computed)){r.computed.flags&=-5;for(let p=r.computed.deps;p;p=p.nextDep)Va(p,!0)}!e&&!--r.sc&&r.map&&r.map.delete(r.key)}function Ru(t){const{prevDep:e,nextDep:r}=t;e&&(e.nextDep=r,t.prevDep=void 0),r&&(r.prevDep=e,t.nextDep=void 0)}let Qt=!0;const Gh=[];function ir(){Gh.push(Qt),Qt=!1}function rr(){const t=Gh.pop();Qt=t===void 0?!0:t}function ml(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const r=Ze;Ze=void 0;try{e()}finally{Ze=r}}}let Kn=0;class Du{constructor(e,r){this.sub=e,this.dep=r,this.version=r.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ga{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!Ze||!Qt||Ze===this.computed)return;let r=this.activeLink;if(r===void 0||r.sub!==Ze)r=this.activeLink=new Du(Ze,this),Ze.deps?(r.prevDep=Ze.depsTail,Ze.depsTail.nextDep=r,Ze.depsTail=r):Ze.deps=Ze.depsTail=r,Wh(r);else if(r.version===-1&&(r.version=this.version,r.nextDep)){const o=r.nextDep;o.prevDep=r.prevDep,r.prevDep&&(r.prevDep.nextDep=o),r.prevDep=Ze.depsTail,r.nextDep=void 0,Ze.depsTail.nextDep=r,Ze.depsTail=r,Ze.deps===r&&(Ze.deps=o)}return r}trigger(e){this.version++,Kn++,this.notify(e)}notify(e){ja();try{for(let r=this.subs;r;r=r.prevSub)r.sub.notify()&&r.sub.dep.notify()}finally{Ua()}}}function Wh(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let o=e.deps;o;o=o.nextDep)Wh(o)}const r=t.dep.subs;r!==t&&(t.prevSub=r,r&&(r.nextSub=t)),t.dep.subs=t}}const ea=new WeakMap,wr=Symbol(""),ta=Symbol(""),Zn=Symbol("");function yt(t,e,r){if(Qt&&Ze){let o=ea.get(t);o||ea.set(t,o=new Map);let c=o.get(r);c||(o.set(r,c=new Ga),c.map=o,c.key=r),c.track()}}function Ai(t,e,r,o,c,p){const m=ea.get(t);if(!m){Kn++;return}const y=C=>{C&&C.trigger()};if(ja(),e==="clear")m.forEach(y);else{const C=Re(t),b=C&&Ba(r);if(C&&r==="length"){const I=Number(o);m.forEach((A,L)=>{(L==="length"||L===Zn||!Qr(L)&&L>=I)&&y(A)})}else switch((r!==void 0||m.has(void 0))&&y(m.get(r)),b&&y(m.get(Zn)),e){case"add":C?b&&y(m.get("length")):(y(m.get(wr)),Bn(t)&&y(m.get(ta)));break;case"delete":C||(y(m.get(wr)),Bn(t)&&y(m.get(ta)));break;case"set":Bn(t)&&y(m.get(wr));break}}Ua()}function Or(t){const e=We(t);return e===t?e:(yt(e,"iterate",Zn),ei(t)?e:e.map(Tt))}function Wa(t){return yt(t=We(t),"iterate",Zn),t}const Lu={__proto__:null,[Symbol.iterator](){return Oo(this,Symbol.iterator,Tt)},concat(...t){return Or(this).concat(...t.map(e=>Re(e)?Or(e):e))},entries(){return Oo(this,"entries",t=>(t[1]=Tt(t[1]),t))},every(t,e){return di(this,"every",t,e,void 0,arguments)},filter(t,e){return di(this,"filter",t,e,r=>r.map(Tt),arguments)},find(t,e){return di(this,"find",t,e,Tt,arguments)},findIndex(t,e){return di(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return di(this,"findLast",t,e,Tt,arguments)},findLastIndex(t,e){return di(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return di(this,"forEach",t,e,void 0,arguments)},includes(...t){return Ao(this,"includes",t)},indexOf(...t){return Ao(this,"indexOf",t)},join(t){return Or(this).join(t)},lastIndexOf(...t){return Ao(this,"lastIndexOf",t)},map(t,e){return di(this,"map",t,e,void 0,arguments)},pop(){return nn(this,"pop")},push(...t){return nn(this,"push",t)},reduce(t,...e){return _l(this,"reduce",t,e)},reduceRight(t,...e){return _l(this,"reduceRight",t,e)},shift(){return nn(this,"shift")},some(t,e){return di(this,"some",t,e,void 0,arguments)},splice(...t){return nn(this,"splice",t)},toReversed(){return Or(this).toReversed()},toSorted(t){return Or(this).toSorted(t)},toSpliced(...t){return Or(this).toSpliced(...t)},unshift(...t){return nn(this,"unshift",t)},values(){return Oo(this,"values",Tt)}};function Oo(t,e,r){const o=Wa(t),c=o[e]();return o!==t&&!ei(t)&&(c._next=c.next,c.next=()=>{const p=c._next();return p.value&&(p.value=r(p.value)),p}),c}const Mu=Array.prototype;function di(t,e,r,o,c,p){const m=Wa(t),y=m!==t&&!ei(t),C=m[e];if(C!==Mu[e]){const A=C.apply(t,p);return y?Tt(A):A}let b=r;m!==t&&(y?b=function(A,L){return r.call(this,Tt(A),L,t)}:r.length>2&&(b=function(A,L){return r.call(this,A,L,t)}));const I=C.call(m,b,o);return y&&c?c(I):I}function _l(t,e,r,o){const c=Wa(t);let p=r;return c!==t&&(ei(t)?r.length>3&&(p=function(m,y,C){return r.call(this,m,y,C,t)}):p=function(m,y,C){return r.call(this,m,Tt(y),C,t)}),c[e](p,...o)}function Ao(t,e,r){const o=We(t);yt(o,"iterate",Zn);const c=o[e](...r);return(c===-1||c===!1)&&za(r[0])?(r[0]=We(r[0]),o[e](...r)):c}function nn(t,e,r=[]){ir(),ja();const o=We(t)[e].apply(t,r);return Ua(),rr(),o}const Fu=Fa("__proto__,__v_isRef,__isVue"),Hh=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Qr));function Pu(t){Qr(t)||(t=String(t));const e=We(this);return yt(e,"has",t),e.hasOwnProperty(t)}class Yh{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,o){if(r==="__v_skip")return e.__v_skip;const c=this._isReadonly,p=this._isShallow;if(r==="__v_isReactive")return!c;if(r==="__v_isReadonly")return c;if(r==="__v_isShallow")return p;if(r==="__v_raw")return o===(c?p?Yu:Kh:p?$h:zh).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const m=Re(e);if(!c){let C;if(m&&(C=Lu[r]))return C;if(r==="hasOwnProperty")return Pu}const y=Reflect.get(e,r,wt(e)?e:o);return(Qr(r)?Hh.has(r):Fu(r))||(c||yt(e,"get",r),p)?y:wt(y)?m&&Ba(r)?y:y.value:st(y)?c?Zh(y):Ya(y):y}}class Xh extends Yh{constructor(e=!1){super(!1,e)}set(e,r,o,c){let p=e[r];if(!this._isShallow){const C=Er(p);if(!ei(o)&&!Er(o)&&(p=We(p),o=We(o)),!Re(e)&&wt(p)&&!wt(o))return C?!1:(p.value=o,!0)}const m=Re(e)&&Ba(r)?Number(r)<e.length:He(e,r),y=Reflect.set(e,r,o,wt(e)?e:c);return e===We(c)&&(m?Zi(o,p)&&Ai(e,"set",r,o):Ai(e,"add",r,o)),y}deleteProperty(e,r){const o=He(e,r);e[r];const c=Reflect.deleteProperty(e,r);return c&&o&&Ai(e,"delete",r,void 0),c}has(e,r){const o=Reflect.has(e,r);return(!Qr(r)||!Hh.has(r))&&yt(e,"has",r),o}ownKeys(e){return yt(e,"iterate",Re(e)?"length":wr),Reflect.ownKeys(e)}}class ku extends Yh{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const Bu=new Xh,Nu=new ku,ju=new Xh(!0);const ia=t=>t,ss=t=>Reflect.getPrototypeOf(t);function Uu(t,e,r){return function(...o){const c=this.__v_raw,p=We(c),m=Bn(p),y=t==="entries"||t===Symbol.iterator&&m,C=t==="keys"&&m,b=c[t](...o),I=r?ia:e?ra:Tt;return!e&&yt(p,"iterate",C?ta:wr),{next(){const{value:A,done:L}=b.next();return L?{value:A,done:L}:{value:y?[I(A[0]),I(A[1])]:I(A),done:L}},[Symbol.iterator](){return this}}}}function os(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Vu(t,e){const r={get(c){const p=this.__v_raw,m=We(p),y=We(c);t||(Zi(c,y)&&yt(m,"get",c),yt(m,"get",y));const{has:C}=ss(m),b=e?ia:t?ra:Tt;if(C.call(m,c))return b(p.get(c));if(C.call(m,y))return b(p.get(y));p!==m&&p.get(c)},get size(){const c=this.__v_raw;return!t&&yt(We(c),"iterate",wr),Reflect.get(c,"size",c)},has(c){const p=this.__v_raw,m=We(p),y=We(c);return t||(Zi(c,y)&&yt(m,"has",c),yt(m,"has",y)),c===y?p.has(c):p.has(c)||p.has(y)},forEach(c,p){const m=this,y=m.__v_raw,C=We(y),b=e?ia:t?ra:Tt;return!t&&yt(C,"iterate",wr),y.forEach((I,A)=>c.call(p,b(I),b(A),m))}};return dt(r,t?{add:os("add"),set:os("set"),delete:os("delete"),clear:os("clear")}:{add(c){!e&&!ei(c)&&!Er(c)&&(c=We(c));const p=We(this);return ss(p).has.call(p,c)||(p.add(c),Ai(p,"add",c,c)),this},set(c,p){!e&&!ei(p)&&!Er(p)&&(p=We(p));const m=We(this),{has:y,get:C}=ss(m);let b=y.call(m,c);b||(c=We(c),b=y.call(m,c));const I=C.call(m,c);return m.set(c,p),b?Zi(p,I)&&Ai(m,"set",c,p):Ai(m,"add",c,p),this},delete(c){const p=We(this),{has:m,get:y}=ss(p);let C=m.call(p,c);C||(c=We(c),C=m.call(p,c)),y&&y.call(p,c);const b=p.delete(c);return C&&Ai(p,"delete",c,void 0),b},clear(){const c=We(this),p=c.size!==0,m=c.clear();return p&&Ai(c,"clear",void 0,void 0),m}}),["keys","values","entries",Symbol.iterator].forEach(c=>{r[c]=Uu(c,t,e)}),r}function Ha(t,e){const r=Vu(t,e);return(o,c,p)=>c==="__v_isReactive"?!t:c==="__v_isReadonly"?t:c==="__v_raw"?o:Reflect.get(He(r,c)&&c in o?r:o,c,p)}const Gu={get:Ha(!1,!1)},Wu={get:Ha(!1,!0)},Hu={get:Ha(!0,!1)};const zh=new WeakMap,$h=new WeakMap,Kh=new WeakMap,Yu=new WeakMap;function Xu(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function zu(t){return t.__v_skip||!Object.isExtensible(t)?0:Xu(_u(t))}function Ya(t){return Er(t)?t:Xa(t,!1,Bu,Gu,zh)}function $u(t){return Xa(t,!1,ju,Wu,$h)}function Zh(t){return Xa(t,!0,Nu,Hu,Kh)}function Xa(t,e,r,o,c){if(!st(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const p=c.get(t);if(p)return p;const m=zu(t);if(m===0)return t;const y=new Proxy(t,m===2?o:r);return c.set(t,y),y}function Vn(t){return Er(t)?Vn(t.__v_raw):!!(t&&t.__v_isReactive)}function Er(t){return!!(t&&t.__v_isReadonly)}function ei(t){return!!(t&&t.__v_isShallow)}function za(t){return t?!!t.__v_raw:!1}function We(t){const e=t&&t.__v_raw;return e?We(e):t}function Ku(t){return!He(t,"__v_skip")&&Object.isExtensible(t)&&Fh(t,"__v_skip",!0),t}const Tt=t=>st(t)?Ya(t):t,ra=t=>st(t)?Zh(t):t;function wt(t){return t?t.__v_isRef===!0:!1}function Zs(t){return Zu(t,!1)}function Zu(t,e){return wt(t)?t:new qu(t,e)}class qu{constructor(e,r){this.dep=new Ga,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=r?e:We(e),this._value=r?e:Tt(e),this.__v_isShallow=r}get value(){return this.dep.track(),this._value}set value(e){const r=this._rawValue,o=this.__v_isShallow||ei(e)||Er(e);e=o?e:We(e),Zi(e,r)&&(this._rawValue=e,this._value=o?e:Tt(e),this.dep.trigger())}}function qh(t){return wt(t)?t.value:t}const Ju={get:(t,e,r)=>e==="__v_raw"?t:qh(Reflect.get(t,e,r)),set:(t,e,r,o)=>{const c=t[e];return wt(c)&&!wt(r)?(c.value=r,!0):Reflect.set(t,e,r,o)}};function Jh(t){return Vn(t)?t:new Proxy(t,Ju)}class Qu{constructor(e,r,o){this.fn=e,this.setter=r,this._value=void 0,this.dep=new Ga(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Kn-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!r,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&Ze!==this)return Nh(this,!0),!0}get value(){const e=this.dep.track();return Vh(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function ef(t,e,r=!1){let o,c;return Ae(t)?o=t:(o=t.get,c=t.set),new Qu(o,c,r)}const as={},qs=new WeakMap;let hr;function tf(t,e=!1,r=hr){if(r){let o=qs.get(r);o||qs.set(r,o=[]),o.push(t)}}function rf(t,e,r=qe){const{immediate:o,deep:c,once:p,scheduler:m,augmentJob:y,call:C}=r,b=ie=>c?ie:ei(ie)||c===!1||c===0?Ki(ie,1):Ki(ie);let I,A,L,P,j=!1,H=!1;if(wt(t)?(A=()=>t.value,j=ei(t)):Vn(t)?(A=()=>b(t),j=!0):Re(t)?(H=!0,j=t.some(ie=>Vn(ie)||ei(ie)),A=()=>t.map(ie=>{if(wt(ie))return ie.value;if(Vn(ie))return b(ie);if(Ae(ie))return C?C(ie,2):ie()})):Ae(t)?e?A=C?()=>C(t,2):t:A=()=>{if(L){ir();try{L()}finally{rr()}}const ie=hr;hr=I;try{return C?C(t,3,[P]):t(P)}finally{hr=ie}}:A=Jt,e&&c){const ie=A,ne=c===!0?1/0:c;A=()=>Ki(ie(),ne)}const $=Au(),Z=()=>{I.stop(),$&&$.active&&ka($.effects,I)};if(p&&e){const ie=e;e=(...ne)=>{ie(...ne),Z()}}let q=H?new Array(t.length).fill(as):as;const J=ie=>{if(!(!(I.flags&1)||!I.dirty&&!ie))if(e){const ne=I.run();if(c||j||(H?ne.some((he,fe)=>Zi(he,q[fe])):Zi(ne,q))){L&&L();const he=hr;hr=I;try{const fe=[ne,q===as?void 0:H&&q[0]===as?[]:q,P];C?C(e,3,fe):e(...fe),q=ne}finally{hr=he}}}else I.run()};return y&&y(J),I=new kh(A),I.scheduler=m?()=>m(J,!1):J,P=ie=>tf(ie,!1,I),L=I.onStop=()=>{const ie=qs.get(I);if(ie){if(C)C(ie,4);else for(const ne of ie)ne();qs.delete(I)}},e?o?J(!0):q=I.run():m?m(J.bind(null,!0),!0):I.run(),Z.pause=I.pause.bind(I),Z.resume=I.resume.bind(I),Z.stop=Z,Z}function Ki(t,e=1/0,r){if(e<=0||!st(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),e--,wt(t))Ki(t.value,e,r);else if(Re(t))for(let o=0;o<t.length;o++)Ki(t[o],e,r);else if(pu(t)||Bn(t))t.forEach(o=>{Ki(o,e,r)});else if(vu(t)){for(const o in t)Ki(t[o],e,r);for(const o of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,o)&&Ki(t[o],e,r)}return t}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function is(t,e,r,o){try{return o?t(...o):t()}catch(c){yo(c,e,r)}}function fi(t,e,r,o){if(Ae(t)){const c=is(t,e,r,o);return c&&Lh(c)&&c.catch(p=>{yo(p,e,r)}),c}if(Re(t)){const c=[];for(let p=0;p<t.length;p++)c.push(fi(t[p],e,r,o));return c}}function yo(t,e,r,o=!0){const c=e?e.vnode:null,{errorHandler:p,throwUnhandledErrorInProduction:m}=e&&e.appContext.config||qe;if(e){let y=e.parent;const C=e.proxy,b=`https://vuejs.org/error-reference/#runtime-${r}`;for(;y;){const I=y.ec;if(I){for(let A=0;A<I.length;A++)if(I[A](t,C,b)===!1)return}y=y.parent}if(p){ir(),is(p,null,10,[t,C,b]),rr();return}}nf(t,r,c,o,m)}function nf(t,e,r,o=!0,c=!1){if(c)throw t;console.error(t)}const It=[];let oi=-1;const Kr=[];let Xi=null,Lr=0;const Qh=Promise.resolve();let Js=null;function sf(t){const e=Js||Qh;return t?e.then(this?t.bind(this):t):e}function of(t){let e=oi+1,r=It.length;for(;e<r;){const o=e+r>>>1,c=It[o],p=qn(c);p<t||p===t&&c.flags&2?e=o+1:r=o}return e}function $a(t){if(!(t.flags&1)){const e=qn(t),r=It[It.length-1];!r||!(t.flags&2)&&e>=qn(r)?It.push(t):It.splice(of(e),0,t),t.flags|=1,ec()}}function ec(){Js||(Js=Qh.then(ic))}function af(t){Re(t)?Kr.push(...t):Xi&&t.id===-1?Xi.splice(Lr+1,0,t):t.flags&1||(Kr.push(t),t.flags|=1),ec()}function vl(t,e,r=oi+1){for(;r<It.length;r++){const o=It[r];if(o&&o.flags&2){if(t&&o.id!==t.uid)continue;It.splice(r,1),r--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function tc(t){if(Kr.length){const e=[...new Set(Kr)].sort((r,o)=>qn(r)-qn(o));if(Kr.length=0,Xi){Xi.push(...e);return}for(Xi=e,Lr=0;Lr<Xi.length;Lr++){const r=Xi[Lr];r.flags&4&&(r.flags&=-2),r.flags&8||r(),r.flags&=-2}Xi=null,Lr=0}}const qn=t=>t.id==null?t.flags&2?-1:1/0:t.id;function ic(t){const e=Jt;try{for(oi=0;oi<It.length;oi++){const r=It[oi];r&&!(r.flags&8)&&(r.flags&4&&(r.flags&=-2),is(r,r.i,r.i?15:14),r.flags&4||(r.flags&=-2))}}finally{for(;oi<It.length;oi++){const r=It[oi];r&&(r.flags&=-2)}oi=-1,It.length=0,tc(),Js=null,(It.length||Kr.length)&&ic()}}let ci=null,rc=null;function Qs(t){const e=ci;return ci=t,rc=t&&t.type.__scopeId||null,e}function lf(t,e=ci,r){if(!e||t._n)return t;const o=(...c)=>{o._d&&Il(-1);const p=Qs(e);let m;try{m=t(...c)}finally{Qs(p),o._d&&Il(1)}return m};return o._n=!0,o._c=!0,o._d=!0,o}function or(t,e,r,o){const c=t.dirs,p=e&&e.dirs;for(let m=0;m<c.length;m++){const y=c[m];p&&(y.oldValue=p[m].value);let C=y.dir[o];C&&(ir(),fi(C,r,8,[t.el,y,t,e]),rr())}}const hf=Symbol("_vte"),cf=t=>t.__isTeleport;function Ka(t,e){t.shapeFlag&6&&t.component?(t.transition=e,Ka(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}/*! #__NO_SIDE_EFFECTS__ */function Za(t,e){return Ae(t)?(()=>dt({name:t.name},e,{setup:t}))():t}function nc(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function eo(t,e,r,o,c=!1){if(Re(t)){t.forEach((j,H)=>eo(j,e&&(Re(e)?e[H]:e),r,o,c));return}if(Gn(o)&&!c){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&eo(t,e,r,o.component.subTree);return}const p=o.shapeFlag&4?il(o.component):o.el,m=c?null:p,{i:y,r:C}=t,b=e&&e.r,I=y.refs===qe?y.refs={}:y.refs,A=y.setupState,L=We(A),P=A===qe?()=>!1:j=>He(L,j);if(b!=null&&b!==C&&(gt(b)?(I[b]=null,P(b)&&(A[b]=null)):wt(b)&&(b.value=null)),Ae(C))is(C,y,12,[m,I]);else{const j=gt(C),H=wt(C);if(j||H){const $=()=>{if(t.f){const Z=j?P(C)?A[C]:I[C]:C.value;c?Re(Z)&&ka(Z,p):Re(Z)?Z.includes(p)||Z.push(p):j?(I[C]=[p],P(C)&&(A[C]=I[C])):(C.value=[p],t.k&&(I[t.k]=C.value))}else j?(I[C]=m,P(C)&&(A[C]=m)):H&&(C.value=m,t.k&&(I[t.k]=m))};m?($.id=-1,kt($,r)):$()}}}vo().requestIdleCallback;vo().cancelIdleCallback;const Gn=t=>!!t.type.__asyncLoader,sc=t=>t.type.__isKeepAlive;function uf(t,e){oc(t,"a",e)}function ff(t,e){oc(t,"da",e)}function oc(t,e,r=xt){const o=t.__wdc||(t.__wdc=()=>{let c=r;for(;c;){if(c.isDeactivated)return;c=c.parent}return t()});if(wo(e,o,r),r){let c=r.parent;for(;c&&c.parent;)sc(c.parent.vnode)&&df(o,e,r,c),c=c.parent}}function df(t,e,r,o){const c=wo(e,t,o,!0);lc(()=>{ka(o[e],c)},r)}function wo(t,e,r=xt,o=!1){if(r){const c=r[t]||(r[t]=[]),p=e.__weh||(e.__weh=(...m)=>{ir();const y=rs(r),C=fi(e,r,t,m);return y(),rr(),C});return o?c.unshift(p):c.push(p),p}}const Pi=t=>(e,r=xt)=>{(!es||t==="sp")&&wo(t,(...o)=>e(...o),r)},gf=Pi("bm"),ac=Pi("m"),pf=Pi("bu"),mf=Pi("u"),qa=Pi("bum"),lc=Pi("um"),_f=Pi("sp"),vf=Pi("rtg"),yf=Pi("rtc");function wf(t,e=xt){wo("ec",t,e)}const Cf=Symbol.for("v-ndc"),na=t=>t?Rc(t)?il(t):na(t.parent):null,Wn=dt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>na(t.parent),$root:t=>na(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>Ja(t),$forceUpdate:t=>t.f||(t.f=()=>{$a(t.update)}),$nextTick:t=>t.n||(t.n=sf.bind(t.proxy)),$watch:t=>Wf.bind(t)}),Ro=(t,e)=>t!==qe&&!t.__isScriptSetup&&He(t,e),Ef={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:r,setupState:o,data:c,props:p,accessCache:m,type:y,appContext:C}=t;let b;if(e[0]!=="$"){const P=m[e];if(P!==void 0)switch(P){case 1:return o[e];case 2:return c[e];case 4:return r[e];case 3:return p[e]}else{if(Ro(o,e))return m[e]=1,o[e];if(c!==qe&&He(c,e))return m[e]=2,c[e];if((b=t.propsOptions[0])&&He(b,e))return m[e]=3,p[e];if(r!==qe&&He(r,e))return m[e]=4,r[e];sa&&(m[e]=0)}}const I=Wn[e];let A,L;if(I)return e==="$attrs"&&yt(t.attrs,"get",""),I(t);if((A=y.__cssModules)&&(A=A[e]))return A;if(r!==qe&&He(r,e))return m[e]=4,r[e];if(L=C.config.globalProperties,He(L,e))return L[e]},set({_:t},e,r){const{data:o,setupState:c,ctx:p}=t;return Ro(c,e)?(c[e]=r,!0):o!==qe&&He(o,e)?(o[e]=r,!0):He(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(p[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:o,appContext:c,propsOptions:p}},m){let y;return!!r[m]||t!==qe&&He(t,m)||Ro(e,m)||(y=p[0])&&He(y,m)||He(o,m)||He(Wn,m)||He(c.config.globalProperties,m)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:He(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}};function yl(t){return Re(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}let sa=!0;function bf(t){const e=Ja(t),r=t.proxy,o=t.ctx;sa=!1,e.beforeCreate&&wl(e.beforeCreate,t,"bc");const{data:c,computed:p,methods:m,watch:y,provide:C,inject:b,created:I,beforeMount:A,mounted:L,beforeUpdate:P,updated:j,activated:H,deactivated:$,beforeDestroy:Z,beforeUnmount:q,destroyed:J,unmounted:ie,render:ne,renderTracked:he,renderTriggered:fe,errorCaptured:v,serverPrefetch:ae,expose:me,inheritAttrs:de,components:a,directives:s,filters:l}=e;if(b&&Sf(b,o,null),m)for(const n in m){const h=m[n];Ae(h)&&(o[n]=h.bind(r))}if(c){const n=c.call(r,r);st(n)&&(t.data=Ya(n))}if(sa=!0,p)for(const n in p){const h=p[n],g=Ae(h)?h.bind(r,r):Ae(h.get)?h.get.bind(r,r):Jt,f=!Ae(h)&&Ae(h.set)?h.set.bind(r):Jt,d=hd({get:g,set:f});Object.defineProperty(o,n,{enumerable:!0,configurable:!0,get:()=>d.value,set:_=>d.value=_})}if(y)for(const n in y)hc(y[n],o,r,n);if(C){const n=Ae(C)?C.call(r):C;Reflect.ownKeys(n).forEach(h=>{Rf(h,n[h])})}I&&wl(I,t,"c");function i(n,h){Re(h)?h.forEach(g=>n(g.bind(r))):h&&n(h.bind(r))}if(i(gf,A),i(ac,L),i(pf,P),i(mf,j),i(uf,H),i(ff,$),i(wf,v),i(yf,he),i(vf,fe),i(qa,q),i(lc,ie),i(_f,ae),Re(me))if(me.length){const n=t.exposed||(t.exposed={});me.forEach(h=>{Object.defineProperty(n,h,{get:()=>r[h],set:g=>r[h]=g})})}else t.exposed||(t.exposed={});ne&&t.render===Jt&&(t.render=ne),de!=null&&(t.inheritAttrs=de),a&&(t.components=a),s&&(t.directives=s),ae&&nc(t)}function Sf(t,e,r=Jt){Re(t)&&(t=oa(t));for(const o in t){const c=t[o];let p;st(c)?"default"in c?p=vs(c.from||o,c.default,!0):p=vs(c.from||o):p=vs(c),wt(p)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>p.value,set:m=>p.value=m}):e[o]=p}}function wl(t,e,r){fi(Re(t)?t.map(o=>o.bind(e.proxy)):t.bind(e.proxy),e,r)}function hc(t,e,r,o){let c=o.includes(".")?bc(r,o):()=>r[o];if(gt(t)){const p=e[t];Ae(p)&&Lo(c,p)}else if(Ae(t))Lo(c,t.bind(r));else if(st(t))if(Re(t))t.forEach(p=>hc(p,e,r,o));else{const p=Ae(t.handler)?t.handler.bind(r):e[t.handler];Ae(p)&&Lo(c,p,t)}}function Ja(t){const e=t.type,{mixins:r,extends:o}=e,{mixins:c,optionsCache:p,config:{optionMergeStrategies:m}}=t.appContext,y=p.get(e);let C;return y?C=y:!c.length&&!r&&!o?C=e:(C={},c.length&&c.forEach(b=>to(C,b,m,!0)),to(C,e,m)),st(e)&&p.set(e,C),C}function to(t,e,r,o=!1){const{mixins:c,extends:p}=e;p&&to(t,p,r,!0),c&&c.forEach(m=>to(t,m,r,!0));for(const m in e)if(!(o&&m==="expose")){const y=Tf[m]||r&&r[m];t[m]=y?y(t[m],e[m]):e[m]}return t}const Tf={data:Cl,props:El,emits:El,methods:gn,computed:gn,beforeCreate:bt,created:bt,beforeMount:bt,mounted:bt,beforeUpdate:bt,updated:bt,beforeDestroy:bt,beforeUnmount:bt,destroyed:bt,unmounted:bt,activated:bt,deactivated:bt,errorCaptured:bt,serverPrefetch:bt,components:gn,directives:gn,watch:xf,provide:Cl,inject:If};function Cl(t,e){return e?t?function(){return dt(Ae(t)?t.call(this,this):t,Ae(e)?e.call(this,this):e)}:e:t}function If(t,e){return gn(oa(t),oa(e))}function oa(t){if(Re(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function bt(t,e){return t?[...new Set([].concat(t,e))]:e}function gn(t,e){return t?dt(Object.create(null),t,e):e}function El(t,e){return t?Re(t)&&Re(e)?[...new Set([...t,...e])]:dt(Object.create(null),yl(t),yl(e??{})):e}function xf(t,e){if(!t)return e;if(!e)return t;const r=dt(Object.create(null),t);for(const o in e)r[o]=bt(t[o],e[o]);return r}function cc(){return{app:null,config:{isNativeTag:du,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Of=0;function Af(t,e){return function(o,c=null){Ae(o)||(o=dt({},o)),c!=null&&!st(c)&&(c=null);const p=cc(),m=new WeakSet,y=[];let C=!1;const b=p.app={_uid:Of++,_component:o,_props:c,_container:null,_context:p,_instance:null,version:cd,get config(){return p.config},set config(I){},use(I,...A){return m.has(I)||(I&&Ae(I.install)?(m.add(I),I.install(b,...A)):Ae(I)&&(m.add(I),I(b,...A))),b},mixin(I){return p.mixins.includes(I)||p.mixins.push(I),b},component(I,A){return A?(p.components[I]=A,b):p.components[I]},directive(I,A){return A?(p.directives[I]=A,b):p.directives[I]},mount(I,A,L){if(!C){const P=b._ceVNode||qi(o,c);return P.appContext=p,L===!0?L="svg":L===!1&&(L=void 0),A&&e?e(P,I):t(P,I,L),C=!0,b._container=I,I.__vue_app__=b,il(P.component)}},onUnmount(I){y.push(I)},unmount(){C&&(fi(y,b._instance,16),t(null,b._container),delete b._container.__vue_app__)},provide(I,A){return p.provides[I]=A,b},runWithContext(I){const A=Zr;Zr=b;try{return I()}finally{Zr=A}}};return b}}let Zr=null;function Rf(t,e){if(xt){let r=xt.provides;const o=xt.parent&&xt.parent.provides;o===r&&(r=xt.provides=Object.create(o)),r[t]=e}}function vs(t,e,r=!1){const o=xt||ci;if(o||Zr){const c=Zr?Zr._context.provides:o?o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(c&&t in c)return c[t];if(arguments.length>1)return r&&Ae(e)?e.call(o&&o.proxy):e}}const uc={},fc=()=>Object.create(uc),dc=t=>Object.getPrototypeOf(t)===uc;function Df(t,e,r,o=!1){const c={},p=fc();t.propsDefaults=Object.create(null),gc(t,e,c,p);for(const m in t.propsOptions[0])m in c||(c[m]=void 0);r?t.props=o?c:$u(c):t.type.props?t.props=c:t.props=p,t.attrs=p}function Lf(t,e,r,o){const{props:c,attrs:p,vnode:{patchFlag:m}}=t,y=We(c),[C]=t.propsOptions;let b=!1;if((o||m>0)&&!(m&16)){if(m&8){const I=t.vnode.dynamicProps;for(let A=0;A<I.length;A++){let L=I[A];if(Co(t.emitsOptions,L))continue;const P=e[L];if(C)if(He(p,L))P!==p[L]&&(p[L]=P,b=!0);else{const j=er(L);c[j]=aa(C,y,j,P,t,!1)}else P!==p[L]&&(p[L]=P,b=!0)}}}else{gc(t,e,c,p)&&(b=!0);let I;for(const A in y)(!e||!He(e,A)&&((I=Sr(A))===A||!He(e,I)))&&(C?r&&(r[A]!==void 0||r[I]!==void 0)&&(c[A]=aa(C,y,A,void 0,t,!0)):delete c[A]);if(p!==y)for(const A in p)(!e||!He(e,A))&&(delete p[A],b=!0)}b&&Ai(t.attrs,"set","")}function gc(t,e,r,o){const[c,p]=t.propsOptions;let m=!1,y;if(e)for(let C in e){if(Nn(C))continue;const b=e[C];let I;c&&He(c,I=er(C))?!p||!p.includes(I)?r[I]=b:(y||(y={}))[I]=b:Co(t.emitsOptions,C)||(!(C in o)||b!==o[C])&&(o[C]=b,m=!0)}if(p){const C=We(r),b=y||qe;for(let I=0;I<p.length;I++){const A=p[I];r[A]=aa(c,C,A,b[A],t,!He(b,A))}}return m}function aa(t,e,r,o,c,p){const m=t[r];if(m!=null){const y=He(m,"default");if(y&&o===void 0){const C=m.default;if(m.type!==Function&&!m.skipFactory&&Ae(C)){const{propsDefaults:b}=c;if(r in b)o=b[r];else{const I=rs(c);o=b[r]=C.call(null,e),I()}}else o=C;c.ce&&c.ce._setProp(r,o)}m[0]&&(p&&!y?o=!1:m[1]&&(o===""||o===Sr(r))&&(o=!0))}return o}const Mf=new WeakMap;function pc(t,e,r=!1){const o=r?Mf:e.propsCache,c=o.get(t);if(c)return c;const p=t.props,m={},y=[];let C=!1;if(!Ae(t)){const I=A=>{C=!0;const[L,P]=pc(A,e,!0);dt(m,L),P&&y.push(...P)};!r&&e.mixins.length&&e.mixins.forEach(I),t.extends&&I(t.extends),t.mixins&&t.mixins.forEach(I)}if(!p&&!C)return st(t)&&o.set(t,$r),$r;if(Re(p))for(let I=0;I<p.length;I++){const A=er(p[I]);bl(A)&&(m[A]=qe)}else if(p)for(const I in p){const A=er(I);if(bl(A)){const L=p[I],P=m[A]=Re(L)||Ae(L)?{type:L}:dt({},L),j=P.type;let H=!1,$=!0;if(Re(j))for(let Z=0;Z<j.length;++Z){const q=j[Z],J=Ae(q)&&q.name;if(J==="Boolean"){H=!0;break}else J==="String"&&($=!1)}else H=Ae(j)&&j.name==="Boolean";P[0]=H,P[1]=$,(H||He(P,"default"))&&y.push(A)}}const b=[m,y];return st(t)&&o.set(t,b),b}function bl(t){return t[0]!=="$"&&!Nn(t)}const mc=t=>t[0]==="_"||t==="$stable",Qa=t=>Re(t)?t.map(li):[li(t)],Ff=(t,e,r)=>{if(e._n)return e;const o=lf((...c)=>Qa(e(...c)),r);return o._c=!1,o},_c=(t,e,r)=>{const o=t._ctx;for(const c in t){if(mc(c))continue;const p=t[c];if(Ae(p))e[c]=Ff(c,p,o);else if(p!=null){const m=Qa(p);e[c]=()=>m}}},vc=(t,e)=>{const r=Qa(e);t.slots.default=()=>r},yc=(t,e,r)=>{for(const o in e)(r||o!=="_")&&(t[o]=e[o])},Pf=(t,e,r)=>{const o=t.slots=fc();if(t.vnode.shapeFlag&32){const c=e._;c?(yc(o,e,r),r&&Fh(o,"_",c,!0)):_c(e,o)}else e&&vc(t,e)},kf=(t,e,r)=>{const{vnode:o,slots:c}=t;let p=!0,m=qe;if(o.shapeFlag&32){const y=e._;y?r&&y===1?p=!1:yc(c,e,r):(p=!e.$stable,_c(e,c)),m=e}else e&&(vc(t,e),m={default:1});if(p)for(const y in c)!mc(y)&&m[y]==null&&delete c[y]},kt=Zf;function Bf(t){return Nf(t)}function Nf(t,e){const r=vo();r.__VUE__=!0;const{insert:o,remove:c,patchProp:p,createElement:m,createText:y,createComment:C,setText:b,setElementText:I,parentNode:A,nextSibling:L,setScopeId:P=Jt,insertStaticContent:j}=t,H=(O,x,R,N=null,G=null,W=null,k=void 0,F=null,U=!!x.dynamicChildren)=>{if(O===x)return;O&&!sn(O,x)&&(N=D(O),_(O,G,W,!0),O=null),x.patchFlag===-2&&(U=!1,x.dynamicChildren=null);const{type:Y,ref:K,shapeFlag:Q}=x;switch(Y){case Eo:$(O,x,R,N);break;case Jn:Z(O,x,R,N);break;case Fo:O==null&&q(x,R,N,k);break;case Si:a(O,x,R,N,G,W,k,F,U);break;default:Q&1?ne(O,x,R,N,G,W,k,F,U):Q&6?s(O,x,R,N,G,W,k,F,U):(Q&64||Q&128)&&Y.process(O,x,R,N,G,W,k,F,U,z)}K!=null&&G&&eo(K,O&&O.ref,W,x||O,!x)},$=(O,x,R,N)=>{if(O==null)o(x.el=y(x.children),R,N);else{const G=x.el=O.el;x.children!==O.children&&b(G,x.children)}},Z=(O,x,R,N)=>{O==null?o(x.el=C(x.children||""),R,N):x.el=O.el},q=(O,x,R,N)=>{[O.el,O.anchor]=j(O.children,x,R,N,O.el,O.anchor)},J=({el:O,anchor:x},R,N)=>{let G;for(;O&&O!==x;)G=L(O),o(O,R,N),O=G;o(x,R,N)},ie=({el:O,anchor:x})=>{let R;for(;O&&O!==x;)R=L(O),c(O),O=R;c(x)},ne=(O,x,R,N,G,W,k,F,U)=>{x.type==="svg"?k="svg":x.type==="math"&&(k="mathml"),O==null?he(x,R,N,G,W,k,F,U):ae(O,x,G,W,k,F,U)},he=(O,x,R,N,G,W,k,F)=>{let U,Y;const{props:K,shapeFlag:Q,transition:re,dirs:se}=O;if(U=O.el=m(O.type,W,K&&K.is,K),Q&8?I(U,O.children):Q&16&&v(O.children,U,null,N,G,Do(O,W),k,F),se&&or(O,null,N,"created"),fe(U,O,O.scopeId,k,N),K){for(const ce in K)ce!=="value"&&!Nn(ce)&&p(U,ce,null,K[ce],W,N);"value"in K&&p(U,"value",null,K.value,W),(Y=K.onVnodeBeforeMount)&&ti(Y,N,O)}se&&or(O,null,N,"beforeMount");const oe=jf(G,re);oe&&re.beforeEnter(U),o(U,x,R),((Y=K&&K.onVnodeMounted)||oe||se)&&kt(()=>{Y&&ti(Y,N,O),oe&&re.enter(U),se&&or(O,null,N,"mounted")},G)},fe=(O,x,R,N,G)=>{if(R&&P(O,R),N)for(let W=0;W<N.length;W++)P(O,N[W]);if(G){let W=G.subTree;if(x===W||Tc(W.type)&&(W.ssContent===x||W.ssFallback===x)){const k=G.vnode;fe(O,k,k.scopeId,k.slotScopeIds,G.parent)}}},v=(O,x,R,N,G,W,k,F,U=0)=>{for(let Y=U;Y<O.length;Y++){const K=O[Y]=F?zi(O[Y]):li(O[Y]);H(null,K,x,R,N,G,W,k,F)}},ae=(O,x,R,N,G,W,k)=>{const F=x.el=O.el;let{patchFlag:U,dynamicChildren:Y,dirs:K}=x;U|=O.patchFlag&16;const Q=O.props||qe,re=x.props||qe;let se;if(R&&ar(R,!1),(se=re.onVnodeBeforeUpdate)&&ti(se,R,x,O),K&&or(x,O,R,"beforeUpdate"),R&&ar(R,!0),(Q.innerHTML&&re.innerHTML==null||Q.textContent&&re.textContent==null)&&I(F,""),Y?me(O.dynamicChildren,Y,F,R,N,Do(x,G),W):k||h(O,x,F,null,R,N,Do(x,G),W,!1),U>0){if(U&16)de(F,Q,re,R,G);else if(U&2&&Q.class!==re.class&&p(F,"class",null,re.class,G),U&4&&p(F,"style",Q.style,re.style,G),U&8){const oe=x.dynamicProps;for(let ce=0;ce<oe.length;ce++){const le=oe[ce],ge=Q[le],ve=re[le];(ve!==ge||le==="value")&&p(F,le,ge,ve,G,R)}}U&1&&O.children!==x.children&&I(F,x.children)}else!k&&Y==null&&de(F,Q,re,R,G);((se=re.onVnodeUpdated)||K)&&kt(()=>{se&&ti(se,R,x,O),K&&or(x,O,R,"updated")},N)},me=(O,x,R,N,G,W,k)=>{for(let F=0;F<x.length;F++){const U=O[F],Y=x[F],K=U.el&&(U.type===Si||!sn(U,Y)||U.shapeFlag&70)?A(U.el):R;H(U,Y,K,null,N,G,W,k,!0)}},de=(O,x,R,N,G)=>{if(x!==R){if(x!==qe)for(const W in x)!Nn(W)&&!(W in R)&&p(O,W,x[W],null,G,N);for(const W in R){if(Nn(W))continue;const k=R[W],F=x[W];k!==F&&W!=="value"&&p(O,W,F,k,G,N)}"value"in R&&p(O,"value",x.value,R.value,G)}},a=(O,x,R,N,G,W,k,F,U)=>{const Y=x.el=O?O.el:y(""),K=x.anchor=O?O.anchor:y("");let{patchFlag:Q,dynamicChildren:re,slotScopeIds:se}=x;se&&(F=F?F.concat(se):se),O==null?(o(Y,R,N),o(K,R,N),v(x.children||[],R,K,G,W,k,F,U)):Q>0&&Q&64&&re&&O.dynamicChildren?(me(O.dynamicChildren,re,R,G,W,k,F),(x.key!=null||G&&x===G.subTree)&&wc(O,x,!0)):h(O,x,R,K,G,W,k,F,U)},s=(O,x,R,N,G,W,k,F,U)=>{x.slotScopeIds=F,O==null?x.shapeFlag&512?G.ctx.activate(x,R,N,k,U):l(x,R,N,G,W,k,U):u(O,x,U)},l=(O,x,R,N,G,W,k)=>{const F=O.component=rd(O,N,G);if(sc(O)&&(F.ctx.renderer=z),nd(F,!1,k),F.asyncDep){if(G&&G.registerDep(F,i,k),!O.el){const U=F.subTree=qi(Jn);Z(null,U,x,R)}}else i(F,O,x,R,G,W,k)},u=(O,x,R)=>{const N=x.component=O.component;if($f(O,x,R))if(N.asyncDep&&!N.asyncResolved){n(N,x,R);return}else N.next=x,N.update();else x.el=O.el,N.vnode=x},i=(O,x,R,N,G,W,k)=>{const F=()=>{if(O.isMounted){let{next:Q,bu:re,u:se,parent:oe,vnode:ce}=O;{const Ee=Cc(O);if(Ee){Q&&(Q.el=ce.el,n(O,Q,k)),Ee.asyncDep.then(()=>{O.isUnmounted||F()});return}}let le=Q,ge;ar(O,!1),Q?(Q.el=ce.el,n(O,Q,k)):Q=ce,re&&Io(re),(ge=Q.props&&Q.props.onVnodeBeforeUpdate)&&ti(ge,oe,Q,ce),ar(O,!0);const ve=Mo(O),_e=O.subTree;O.subTree=ve,H(_e,ve,A(_e.el),D(_e),O,G,W),Q.el=ve.el,le===null&&Kf(O,ve.el),se&&kt(se,G),(ge=Q.props&&Q.props.onVnodeUpdated)&&kt(()=>ti(ge,oe,Q,ce),G)}else{let Q;const{el:re,props:se}=x,{bm:oe,m:ce,parent:le,root:ge,type:ve}=O,_e=Gn(x);if(ar(O,!1),oe&&Io(oe),!_e&&(Q=se&&se.onVnodeBeforeMount)&&ti(Q,le,x),ar(O,!0),re&&ee){const Ee=()=>{O.subTree=Mo(O),ee(re,O.subTree,O,G,null)};_e&&ve.__asyncHydrate?ve.__asyncHydrate(re,O,Ee):Ee()}else{ge.ce&&ge.ce._injectChildStyle(ve);const Ee=O.subTree=Mo(O);H(null,Ee,R,N,O,G,W),x.el=Ee.el}if(ce&&kt(ce,G),!_e&&(Q=se&&se.onVnodeMounted)){const Ee=x;kt(()=>ti(Q,le,Ee),G)}(x.shapeFlag&256||le&&Gn(le.vnode)&&le.vnode.shapeFlag&256)&&O.a&&kt(O.a,G),O.isMounted=!0,x=R=N=null}};O.scope.on();const U=O.effect=new kh(F);O.scope.off();const Y=O.update=U.run.bind(U),K=O.job=U.runIfDirty.bind(U);K.i=O,K.id=O.uid,U.scheduler=()=>$a(K),ar(O,!0),Y()},n=(O,x,R)=>{x.component=O;const N=O.vnode.props;O.vnode=x,O.next=null,Lf(O,x.props,N,R),kf(O,x.children,R),ir(),vl(O),rr()},h=(O,x,R,N,G,W,k,F,U=!1)=>{const Y=O&&O.children,K=O?O.shapeFlag:0,Q=x.children,{patchFlag:re,shapeFlag:se}=x;if(re>0){if(re&128){f(Y,Q,R,N,G,W,k,F,U);return}else if(re&256){g(Y,Q,R,N,G,W,k,F,U);return}}se&8?(K&16&&S(Y,G,W),Q!==Y&&I(R,Q)):K&16?se&16?f(Y,Q,R,N,G,W,k,F,U):S(Y,G,W,!0):(K&8&&I(R,""),se&16&&v(Q,R,N,G,W,k,F,U))},g=(O,x,R,N,G,W,k,F,U)=>{O=O||$r,x=x||$r;const Y=O.length,K=x.length,Q=Math.min(Y,K);let re;for(re=0;re<Q;re++){const se=x[re]=U?zi(x[re]):li(x[re]);H(O[re],se,R,null,G,W,k,F,U)}Y>K?S(O,G,W,!0,!1,Q):v(x,R,N,G,W,k,F,U,Q)},f=(O,x,R,N,G,W,k,F,U)=>{let Y=0;const K=x.length;let Q=O.length-1,re=K-1;for(;Y<=Q&&Y<=re;){const se=O[Y],oe=x[Y]=U?zi(x[Y]):li(x[Y]);if(sn(se,oe))H(se,oe,R,null,G,W,k,F,U);else break;Y++}for(;Y<=Q&&Y<=re;){const se=O[Q],oe=x[re]=U?zi(x[re]):li(x[re]);if(sn(se,oe))H(se,oe,R,null,G,W,k,F,U);else break;Q--,re--}if(Y>Q){if(Y<=re){const se=re+1,oe=se<K?x[se].el:N;for(;Y<=re;)H(null,x[Y]=U?zi(x[Y]):li(x[Y]),R,oe,G,W,k,F,U),Y++}}else if(Y>re)for(;Y<=Q;)_(O[Y],G,W,!0),Y++;else{const se=Y,oe=Y,ce=new Map;for(Y=oe;Y<=re;Y++){const tt=x[Y]=U?zi(x[Y]):li(x[Y]);tt.key!=null&&ce.set(tt.key,Y)}let le,ge=0;const ve=re-oe+1;let _e=!1,Ee=0;const ke=new Array(ve);for(Y=0;Y<ve;Y++)ke[Y]=0;for(Y=se;Y<=Q;Y++){const tt=O[Y];if(ge>=ve){_(tt,G,W,!0);continue}let pt;if(tt.key!=null)pt=ce.get(tt.key);else for(le=oe;le<=re;le++)if(ke[le-oe]===0&&sn(tt,x[le])){pt=le;break}pt===void 0?_(tt,G,W,!0):(ke[pt-oe]=Y+1,pt>=Ee?Ee=pt:_e=!0,H(tt,x[pt],R,null,G,W,k,F,U),ge++)}const Ct=_e?Uf(ke):$r;for(le=Ct.length-1,Y=ve-1;Y>=0;Y--){const tt=oe+Y,pt=x[tt],$e=tt+1<K?x[tt+1].el:N;ke[Y]===0?H(null,pt,R,$e,G,W,k,F,U):_e&&(le<0||Y!==Ct[le]?d(pt,R,$e,2):le--)}}},d=(O,x,R,N,G=null)=>{const{el:W,type:k,transition:F,children:U,shapeFlag:Y}=O;if(Y&6){d(O.component.subTree,x,R,N);return}if(Y&128){O.suspense.move(x,R,N);return}if(Y&64){k.move(O,x,R,z);return}if(k===Si){o(W,x,R);for(let Q=0;Q<U.length;Q++)d(U[Q],x,R,N);o(O.anchor,x,R);return}if(k===Fo){J(O,x,R);return}if(N!==2&&Y&1&&F)if(N===0)F.beforeEnter(W),o(W,x,R),kt(()=>F.enter(W),G);else{const{leave:Q,delayLeave:re,afterLeave:se}=F,oe=()=>o(W,x,R),ce=()=>{Q(W,()=>{oe(),se&&se()})};re?re(W,oe,ce):ce()}else o(W,x,R)},_=(O,x,R,N=!1,G=!1)=>{const{type:W,props:k,ref:F,children:U,dynamicChildren:Y,shapeFlag:K,patchFlag:Q,dirs:re,cacheIndex:se}=O;if(Q===-2&&(G=!1),F!=null&&eo(F,null,R,O,!0),se!=null&&(x.renderCache[se]=void 0),K&256){x.ctx.deactivate(O);return}const oe=K&1&&re,ce=!Gn(O);let le;if(ce&&(le=k&&k.onVnodeBeforeUnmount)&&ti(le,x,O),K&6)T(O.component,R,N);else{if(K&128){O.suspense.unmount(R,N);return}oe&&or(O,null,x,"beforeUnmount"),K&64?O.type.remove(O,x,R,z,N):Y&&!Y.hasOnce&&(W!==Si||Q>0&&Q&64)?S(Y,x,R,!1,!0):(W===Si&&Q&384||!G&&K&16)&&S(U,x,R),N&&w(O)}(ce&&(le=k&&k.onVnodeUnmounted)||oe)&&kt(()=>{le&&ti(le,x,O),oe&&or(O,null,x,"unmounted")},R)},w=O=>{const{type:x,el:R,anchor:N,transition:G}=O;if(x===Si){E(R,N);return}if(x===Fo){ie(O);return}const W=()=>{c(R),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(O.shapeFlag&1&&G&&!G.persisted){const{leave:k,delayLeave:F}=G,U=()=>k(R,W);F?F(O.el,W,U):U()}else W()},E=(O,x)=>{let R;for(;O!==x;)R=L(O),c(O),O=R;c(x)},T=(O,x,R)=>{const{bum:N,scope:G,job:W,subTree:k,um:F,m:U,a:Y}=O;Sl(U),Sl(Y),N&&Io(N),G.stop(),W&&(W.flags|=8,_(k,O,x,R)),F&&kt(F,x),kt(()=>{O.isUnmounted=!0},x),x&&x.pendingBranch&&!x.isUnmounted&&O.asyncDep&&!O.asyncResolved&&O.suspenseId===x.pendingId&&(x.deps--,x.deps===0&&x.resolve())},S=(O,x,R,N=!1,G=!1,W=0)=>{for(let k=W;k<O.length;k++)_(O[k],x,R,N,G)},D=O=>{if(O.shapeFlag&6)return D(O.component.subTree);if(O.shapeFlag&128)return O.suspense.next();const x=L(O.anchor||O.el),R=x&&x[hf];return R?L(R):x};let B=!1;const X=(O,x,R)=>{O==null?x._vnode&&_(x._vnode,null,null,!0):H(x._vnode||null,O,x,null,null,null,R),x._vnode=O,B||(B=!0,vl(),tc(),B=!1)},z={p:H,um:_,m:d,r:w,mt:l,mc:v,pc:h,pbc:me,n:D,o:t};let te,ee;return e&&([te,ee]=e(z)),{render:X,hydrate:te,createApp:Af(X,te)}}function Do({type:t,props:e},r){return r==="svg"&&t==="foreignObject"||r==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:r}function ar({effect:t,job:e},r){r?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function jf(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function wc(t,e,r=!1){const o=t.children,c=e.children;if(Re(o)&&Re(c))for(let p=0;p<o.length;p++){const m=o[p];let y=c[p];y.shapeFlag&1&&!y.dynamicChildren&&((y.patchFlag<=0||y.patchFlag===32)&&(y=c[p]=zi(c[p]),y.el=m.el),!r&&y.patchFlag!==-2&&wc(m,y)),y.type===Eo&&(y.el=m.el)}}function Uf(t){const e=t.slice(),r=[0];let o,c,p,m,y;const C=t.length;for(o=0;o<C;o++){const b=t[o];if(b!==0){if(c=r[r.length-1],t[c]<b){e[o]=c,r.push(o);continue}for(p=0,m=r.length-1;p<m;)y=p+m>>1,t[r[y]]<b?p=y+1:m=y;b<t[r[p]]&&(p>0&&(e[o]=r[p-1]),r[p]=o)}}for(p=r.length,m=r[p-1];p-- >0;)r[p]=m,m=e[m];return r}function Cc(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Cc(e)}function Sl(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Vf=Symbol.for("v-scx"),Gf=()=>vs(Vf);function Lo(t,e,r){return Ec(t,e,r)}function Ec(t,e,r=qe){const{immediate:o,deep:c,flush:p,once:m}=r,y=dt({},r),C=e&&o||!e&&p!=="post";let b;if(es){if(p==="sync"){const P=Gf();b=P.__watcherHandles||(P.__watcherHandles=[])}else if(!C){const P=()=>{};return P.stop=Jt,P.resume=Jt,P.pause=Jt,P}}const I=xt;y.call=(P,j,H)=>fi(P,I,j,H);let A=!1;p==="post"?y.scheduler=P=>{kt(P,I&&I.suspense)}:p!=="sync"&&(A=!0,y.scheduler=(P,j)=>{j?P():$a(P)}),y.augmentJob=P=>{e&&(P.flags|=4),A&&(P.flags|=2,I&&(P.id=I.uid,P.i=I))};const L=rf(t,e,y);return es&&(b?b.push(L):C&&L()),L}function Wf(t,e,r){const o=this.proxy,c=gt(t)?t.includes(".")?bc(o,t):()=>o[t]:t.bind(o,o);let p;Ae(e)?p=e:(p=e.handler,r=e);const m=rs(this),y=Ec(c,p.bind(o),r);return m(),y}function bc(t,e){const r=e.split(".");return()=>{let o=t;for(let c=0;c<r.length&&o;c++)o=o[r[c]];return o}}const Hf=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${er(e)}Modifiers`]||t[`${Sr(e)}Modifiers`];function Yf(t,e,...r){if(t.isUnmounted)return;const o=t.vnode.props||qe;let c=r;const p=e.startsWith("update:"),m=p&&Hf(o,e.slice(7));m&&(m.trim&&(c=r.map(I=>gt(I)?I.trim():I)),m.number&&(c=r.map(Cu)));let y,C=o[y=To(e)]||o[y=To(er(e))];!C&&p&&(C=o[y=To(Sr(e))]),C&&fi(C,t,6,c);const b=o[y+"Once"];if(b){if(!t.emitted)t.emitted={};else if(t.emitted[y])return;t.emitted[y]=!0,fi(b,t,6,c)}}function Sc(t,e,r=!1){const o=e.emitsCache,c=o.get(t);if(c!==void 0)return c;const p=t.emits;let m={},y=!1;if(!Ae(t)){const C=b=>{const I=Sc(b,e,!0);I&&(y=!0,dt(m,I))};!r&&e.mixins.length&&e.mixins.forEach(C),t.extends&&C(t.extends),t.mixins&&t.mixins.forEach(C)}return!p&&!y?(st(t)&&o.set(t,null),null):(Re(p)?p.forEach(C=>m[C]=null):dt(m,p),st(t)&&o.set(t,m),m)}function Co(t,e){return!t||!po(e)?!1:(e=e.slice(2).replace(/Once$/,""),He(t,e[0].toLowerCase()+e.slice(1))||He(t,Sr(e))||He(t,e))}function Mo(t){const{type:e,vnode:r,proxy:o,withProxy:c,propsOptions:[p],slots:m,attrs:y,emit:C,render:b,renderCache:I,props:A,data:L,setupState:P,ctx:j,inheritAttrs:H}=t,$=Qs(t);let Z,q;try{if(r.shapeFlag&4){const ie=c||o,ne=ie;Z=li(b.call(ne,ie,I,A,P,L,j)),q=y}else{const ie=e;Z=li(ie.length>1?ie(A,{attrs:y,slots:m,emit:C}):ie(A,null)),q=e.props?y:Xf(y)}}catch(ie){Hn.length=0,yo(ie,t,1),Z=qi(Jn)}let J=Z;if(q&&H!==!1){const ie=Object.keys(q),{shapeFlag:ne}=J;ie.length&&ne&7&&(p&&ie.some(Pa)&&(q=zf(q,p)),J=Jr(J,q,!1,!0))}return r.dirs&&(J=Jr(J,null,!1,!0),J.dirs=J.dirs?J.dirs.concat(r.dirs):r.dirs),r.transition&&Ka(J,r.transition),Z=J,Qs($),Z}const Xf=t=>{let e;for(const r in t)(r==="class"||r==="style"||po(r))&&((e||(e={}))[r]=t[r]);return e},zf=(t,e)=>{const r={};for(const o in t)(!Pa(o)||!(o.slice(9)in e))&&(r[o]=t[o]);return r};function $f(t,e,r){const{props:o,children:c,component:p}=t,{props:m,children:y,patchFlag:C}=e,b=p.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&C>=0){if(C&1024)return!0;if(C&16)return o?Tl(o,m,b):!!m;if(C&8){const I=e.dynamicProps;for(let A=0;A<I.length;A++){const L=I[A];if(m[L]!==o[L]&&!Co(b,L))return!0}}}else return(c||y)&&(!y||!y.$stable)?!0:o===m?!1:o?m?Tl(o,m,b):!0:!!m;return!1}function Tl(t,e,r){const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!0;for(let c=0;c<o.length;c++){const p=o[c];if(e[p]!==t[p]&&!Co(r,p))return!0}return!1}function Kf({vnode:t,parent:e},r){for(;e;){const o=e.subTree;if(o.suspense&&o.suspense.activeBranch===t&&(o.el=t.el),o===t)(t=e.vnode).el=r,e=e.parent;else break}}const Tc=t=>t.__isSuspense;function Zf(t,e){e&&e.pendingBranch?Re(t)?e.effects.push(...t):e.effects.push(t):af(t)}const Si=Symbol.for("v-fgt"),Eo=Symbol.for("v-txt"),Jn=Symbol.for("v-cmt"),Fo=Symbol.for("v-stc"),Hn=[];let Gt=null;function Yn(t=!1){Hn.push(Gt=t?null:[])}function qf(){Hn.pop(),Gt=Hn[Hn.length-1]||null}let Qn=1;function Il(t,e=!1){Qn+=t,t<0&&Gt&&e&&(Gt.hasOnce=!0)}function Ic(t){return t.dynamicChildren=Qn>0?Gt||$r:null,qf(),Qn>0&&Gt&&Gt.push(t),t}function el(t,e,r,o,c,p){return Ic(Rt(t,e,r,o,c,p,!0))}function xl(t,e,r,o,c){return Ic(qi(t,e,r,o,c,!0))}function xc(t){return t?t.__v_isVNode===!0:!1}function sn(t,e){return t.type===e.type&&t.key===e.key}const Oc=({key:t})=>t??null,ys=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?gt(t)||wt(t)||Ae(t)?{i:ci,r:t,k:e,f:!!r}:t:null);function Rt(t,e=null,r=null,o=0,c=null,p=t===Si?0:1,m=!1,y=!1){const C={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Oc(e),ref:e&&ys(e),scopeId:rc,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:o,dynamicProps:c,dynamicChildren:null,appContext:null,ctx:ci};return y?(tl(C,r),p&128&&t.normalize(C)):r&&(C.shapeFlag|=gt(r)?8:16),Qn>0&&!m&&Gt&&(C.patchFlag>0||p&6)&&C.patchFlag!==32&&Gt.push(C),C}const qi=Jf;function Jf(t,e=null,r=null,o=0,c=null,p=!1){if((!t||t===Cf)&&(t=Jn),xc(t)){const y=Jr(t,e,!0);return r&&tl(y,r),Qn>0&&!p&&Gt&&(y.shapeFlag&6?Gt[Gt.indexOf(t)]=y:Gt.push(y)),y.patchFlag=-2,y}if(ld(t)&&(t=t.__vccOpts),e){e=Qf(e);let{class:y,style:C}=e;y&&!gt(y)&&(e.class=Na(y)),st(C)&&(za(C)&&!Re(C)&&(C=dt({},C)),e.style=$n(C))}const m=gt(t)?1:Tc(t)?128:cf(t)?64:st(t)?4:Ae(t)?2:0;return Rt(t,e,r,o,c,m,p,!0)}function Qf(t){return t?za(t)||dc(t)?dt({},t):t:null}function Jr(t,e,r=!1,o=!1){const{props:c,ref:p,patchFlag:m,children:y,transition:C}=t,b=e?ed(c||{},e):c,I={__v_isVNode:!0,__v_skip:!0,type:t.type,props:b,key:b&&Oc(b),ref:e&&e.ref?r&&p?Re(p)?p.concat(ys(e)):[p,ys(e)]:ys(e):p,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:y,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Si?m===-1?16:m|16:m,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:C,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Jr(t.ssContent),ssFallback:t.ssFallback&&Jr(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return C&&o&&Ka(I,C.clone(I)),I}function Ac(t=" ",e=0){return qi(Eo,null,t,e)}function li(t){return t==null||typeof t=="boolean"?qi(Jn):Re(t)?qi(Si,null,t.slice()):xc(t)?zi(t):qi(Eo,null,String(t))}function zi(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Jr(t)}function tl(t,e){let r=0;const{shapeFlag:o}=t;if(e==null)e=null;else if(Re(e))r=16;else if(typeof e=="object")if(o&65){const c=e.default;c&&(c._c&&(c._d=!1),tl(t,c()),c._c&&(c._d=!0));return}else{r=32;const c=e._;!c&&!dc(e)?e._ctx=ci:c===3&&ci&&(ci.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ae(e)?(e={default:e,_ctx:ci},r=32):(e=String(e),o&64?(r=16,e=[Ac(e)]):r=8);t.children=e,t.shapeFlag|=r}function ed(...t){const e={};for(let r=0;r<t.length;r++){const o=t[r];for(const c in o)if(c==="class")e.class!==o.class&&(e.class=Na([e.class,o.class]));else if(c==="style")e.style=$n([e.style,o.style]);else if(po(c)){const p=e[c],m=o[c];m&&p!==m&&!(Re(p)&&p.includes(m))&&(e[c]=p?[].concat(p,m):m)}else c!==""&&(e[c]=o[c])}return e}function ti(t,e,r,o=null){fi(t,e,7,[r,o])}const td=cc();let id=0;function rd(t,e,r){const o=t.type,c=(e?e.appContext:t.appContext)||td,p={uid:id++,vnode:t,type:o,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ou(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pc(o,c),emitsOptions:Sc(o,c),emit:null,emitted:null,propsDefaults:qe,inheritAttrs:o.inheritAttrs,ctx:qe,data:qe,props:qe,attrs:qe,slots:qe,refs:qe,setupState:qe,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=e?e.root:p,p.emit=Yf.bind(null,p),t.ce&&t.ce(p),p}let xt=null,io,la;{const t=vo(),e=(r,o)=>{let c;return(c=t[r])||(c=t[r]=[]),c.push(o),p=>{c.length>1?c.forEach(m=>m(p)):c[0](p)}};io=e("__VUE_INSTANCE_SETTERS__",r=>xt=r),la=e("__VUE_SSR_SETTERS__",r=>es=r)}const rs=t=>{const e=xt;return io(t),t.scope.on(),()=>{t.scope.off(),io(e)}},Ol=()=>{xt&&xt.scope.off(),io(null)};function Rc(t){return t.vnode.shapeFlag&4}let es=!1;function nd(t,e=!1,r=!1){e&&la(e);const{props:o,children:c}=t.vnode,p=Rc(t);Df(t,o,p,e),Pf(t,c,r);const m=p?sd(t,e):void 0;return e&&la(!1),m}function sd(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Ef);const{setup:o}=r;if(o){ir();const c=t.setupContext=o.length>1?ad(t):null,p=rs(t),m=is(o,t,0,[t.props,c]),y=Lh(m);if(rr(),p(),(y||t.sp)&&!Gn(t)&&nc(t),y){if(m.then(Ol,Ol),e)return m.then(C=>{Al(t,C,e)}).catch(C=>{yo(C,t,0)});t.asyncDep=m}else Al(t,m,e)}else Dc(t,e)}function Al(t,e,r){Ae(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:st(e)&&(t.setupState=Jh(e)),Dc(t,r)}let Rl;function Dc(t,e,r){const o=t.type;if(!t.render){if(!e&&Rl&&!o.render){const c=o.template||Ja(t).template;if(c){const{isCustomElement:p,compilerOptions:m}=t.appContext.config,{delimiters:y,compilerOptions:C}=o,b=dt(dt({isCustomElement:p,delimiters:y},m),C);o.render=Rl(c,b)}}t.render=o.render||Jt}{const c=rs(t);ir();try{bf(t)}finally{rr(),c()}}}const od={get(t,e){return yt(t,"get",""),t[e]}};function ad(t){const e=r=>{t.exposed=r||{}};return{attrs:new Proxy(t.attrs,od),slots:t.slots,emit:t.emit,expose:e}}function il(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Jh(Ku(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in Wn)return Wn[r](t)},has(e,r){return r in e||r in Wn}})):t.proxy}function ld(t){return Ae(t)&&"__vccOpts"in t}const hd=(t,e)=>ef(t,e,es),cd="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ha;const Dl=typeof window<"u"&&window.trustedTypes;if(Dl)try{ha=Dl.createPolicy("vue",{createHTML:t=>t})}catch{}const Lc=ha?t=>ha.createHTML(t):t=>t,ud="http://www.w3.org/2000/svg",fd="http://www.w3.org/1998/Math/MathML",Ci=typeof document<"u"?document:null,Ll=Ci&&Ci.createElement("template"),dd={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,o)=>{const c=e==="svg"?Ci.createElementNS(ud,t):e==="mathml"?Ci.createElementNS(fd,t):r?Ci.createElement(t,{is:r}):Ci.createElement(t);return t==="select"&&o&&o.multiple!=null&&c.setAttribute("multiple",o.multiple),c},createText:t=>Ci.createTextNode(t),createComment:t=>Ci.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ci.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,o,c,p){const m=r?r.previousSibling:e.lastChild;if(c&&(c===p||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),r),!(c===p||!(c=c.nextSibling)););else{Ll.innerHTML=Lc(o==="svg"?`<svg>${t}</svg>`:o==="mathml"?`<math>${t}</math>`:t);const y=Ll.content;if(o==="svg"||o==="mathml"){const C=y.firstChild;for(;C.firstChild;)y.appendChild(C.firstChild);y.removeChild(C)}e.insertBefore(y,r)}return[m?m.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},gd=Symbol("_vtc");function pd(t,e,r){const o=t[gd];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}const Ml=Symbol("_vod"),md=Symbol("_vsh"),_d=Symbol(""),vd=/(^|;)\s*display\s*:/;function yd(t,e,r){const o=t.style,c=gt(r);let p=!1;if(r&&!c){if(e)if(gt(e))for(const m of e.split(";")){const y=m.slice(0,m.indexOf(":")).trim();r[y]==null&&ws(o,y,"")}else for(const m in e)r[m]==null&&ws(o,m,"");for(const m in r)m==="display"&&(p=!0),ws(o,m,r[m])}else if(c){if(e!==r){const m=o[_d];m&&(r+=";"+m),o.cssText=r,p=vd.test(r)}}else e&&t.removeAttribute("style");Ml in t&&(t[Ml]=p?o.display:"",t[md]&&(o.display="none"))}const Fl=/\s*!important$/;function ws(t,e,r){if(Re(r))r.forEach(o=>ws(t,e,o));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const o=wd(t,e);Fl.test(r)?t.setProperty(Sr(o),r.replace(Fl,""),"important"):t[o]=r}}const Pl=["Webkit","Moz","ms"],Po={};function wd(t,e){const r=Po[e];if(r)return r;let o=er(e);if(o!=="filter"&&o in t)return Po[e]=o;o=Mh(o);for(let c=0;c<Pl.length;c++){const p=Pl[c]+o;if(p in t)return Po[e]=p}return e}const kl="http://www.w3.org/1999/xlink";function Bl(t,e,r,o,c,p=xu(e)){o&&e.startsWith("xlink:")?r==null?t.removeAttributeNS(kl,e.slice(6,e.length)):t.setAttributeNS(kl,e,r):r==null||p&&!Ph(r)?t.removeAttribute(e):t.setAttribute(e,p?"":Qr(r)?String(r):r)}function Nl(t,e,r,o,c){if(e==="innerHTML"||e==="textContent"){r!=null&&(t[e]=e==="innerHTML"?Lc(r):r);return}const p=t.tagName;if(e==="value"&&p!=="PROGRESS"&&!p.includes("-")){const y=p==="OPTION"?t.getAttribute("value")||"":t.value,C=r==null?t.type==="checkbox"?"on":"":String(r);(y!==C||!("_value"in t))&&(t.value=C),r==null&&t.removeAttribute(e),t._value=r;return}let m=!1;if(r===""||r==null){const y=typeof t[e];y==="boolean"?r=Ph(r):r==null&&y==="string"?(r="",m=!0):y==="number"&&(r=0,m=!0)}try{t[e]=r}catch{}m&&t.removeAttribute(c||e)}function Cd(t,e,r,o){t.addEventListener(e,r,o)}function Ed(t,e,r,o){t.removeEventListener(e,r,o)}const jl=Symbol("_vei");function bd(t,e,r,o,c=null){const p=t[jl]||(t[jl]={}),m=p[e];if(o&&m)m.value=o;else{const[y,C]=Sd(e);if(o){const b=p[e]=xd(o,c);Cd(t,y,b,C)}else m&&(Ed(t,y,m,C),p[e]=void 0)}}const Ul=/(?:Once|Passive|Capture)$/;function Sd(t){let e;if(Ul.test(t)){e={};let o;for(;o=t.match(Ul);)t=t.slice(0,t.length-o[0].length),e[o[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Sr(t.slice(2)),e]}let ko=0;const Td=Promise.resolve(),Id=()=>ko||(Td.then(()=>ko=0),ko=Date.now());function xd(t,e){const r=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=r.attached)return;fi(Od(o,r.value),e,5,[o])};return r.value=t,r.attached=Id(),r}function Od(t,e){if(Re(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(o=>c=>!c._stopped&&o&&o(c))}else return e}const Vl=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Ad=(t,e,r,o,c,p)=>{const m=c==="svg";e==="class"?pd(t,o,m):e==="style"?yd(t,r,o):po(e)?Pa(e)||bd(t,e,r,o,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Rd(t,e,o,m))?(Nl(t,e,o),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Bl(t,e,o,m,p,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!gt(o))?Nl(t,er(e),o,p,e):(e==="true-value"?t._trueValue=o:e==="false-value"&&(t._falseValue=o),Bl(t,e,o,m))};function Rd(t,e,r,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in t&&Vl(e)&&Ae(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const c=t.tagName;if(c==="IMG"||c==="VIDEO"||c==="CANVAS"||c==="SOURCE")return!1}return Vl(e)&&gt(r)?!1:e in t}const Dd=dt({patchProp:Ad},dd);let Gl;function Ld(){return Gl||(Gl=Bf(Dd))}const Md=(...t)=>{const e=Ld().createApp(...t),{mount:r}=e;return e.mount=o=>{const c=Pd(o);if(!c)return;const p=e._component;!Ae(p)&&!p.render&&!p.template&&(p.template=c.innerHTML),c.nodeType===1&&(c.textContent="");const m=r(c,!1,Fd(c));return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),m},e};function Fd(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Pd(t){return gt(t)?document.querySelector(t):t}const kd="/assets/logo-da9b9095.svg";/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */function De(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}function lr(t,e,r,o,c){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?c.call(t,r):c?c.value=r:e.set(t,r),r}var Cr,ui,be;typeof SuppressedError=="function"&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(Cr||(Cr={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(ui||(ui={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12",t[t.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(be||(be={}));const ro=typeof self>"u",Wl=(()=>{if(!ro&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Mc=t=>{if(t==null&&(t="./"),!ro){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},Fc=t=>Object.prototype.toString.call(t),Pc=t=>Array.isArray?Array.isArray(t):Fc(t)==="[object Array]",rl=t=>Fc(t)==="[object Boolean]",_t=t=>typeof t=="number"&&!Number.isNaN(t),nr=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),kc=t=>!!nr(t)&&t.bytes instanceof Uint8Array&&!!_t(t.width)&&!(t.width<=0)&&!!_t(t.height)&&!(t.height<=0)&&!!_t(t.stride)&&!(t.stride<=0)&&"format"in t&&!("tag"in t&&!Nd(t.tag)),Bd=t=>!!nr(t)&&!!_t(t.left)&&!(t.left<0)&&!!_t(t.top)&&!(t.top<0)&&!!_t(t.right)&&!(t.right<0)&&!!_t(t.bottom)&&!(t.bottom<0)&&!(t.left>=t.right)&&!(t.top>=t.bottom)&&!!rl(t.isMeasuredInPercentage),Nd=t=>!!nr(t)&&!!_t(t.imageId)&&"type"in t,nl=t=>!!nr(t)&&!!_t(t.x)&&!!_t(t.y),jd=t=>!!nr(t)&&!!Pc(t.points)&&t.points.length!=0&&!t.points.some(e=>!nl(e)),Ud=t=>!!nr(t)&&!!Pc(t.points)&&t.points.length!=0&&t.points.length==4&&!t.points.some(e=>!nl(e)),Vd=t=>!!nr(t)&&!!_t(t.x)&&!!_t(t.y)&&!!_t(t.width)&&!(t.width<0)&&!!_t(t.height)&&!(t.height<0)&&!("isMeasuredInPercentage"in t&&!rl(t.isMeasuredInPercentage));async function Hl(t,e){return await new Promise((r,o)=>{let c=new XMLHttpRequest;c.open("GET",t,!0),c.responseType=e,c.send(),c.onloadend=async()=>{c.status<200||c.status>=300?o(t+" "+c.status):r(c.response)},c.onerror=()=>{o(new Error("Network Error: "+c.statusText))}})}const Tr=(t,e)=>{let r=t.split("."),o=e.split(".");for(let c=0;c<r.length&&c<o.length;++c){let p=r[c],m=o[c];if(p===m)continue;let y=parseInt(r[c]),C=parseInt(o[c]);return y===C||Number.isNaN(y)&&Number.isNaN(C)?p<m?-1:1:y<C||Number.isNaN(y)&&Number.isInteger(C)?-1:1}return r.length===o.length?0:r.length<o.length?-1:1},ts=(t,e)=>{const r={};for(let o in e){const c=o;let p=t[c];p&&typeof p!="string"&&p.path&&(p=p.path),t.rootDirectory&&!t.rootDirectory.endsWith("/")&&(t.rootDirectory=t.rootDirectory+"/"),p===void 0?t.rootDirectory?p=`${t.rootDirectory}${Gd[c]}@${e[c].version}/dist/`:(p=e[c].path,p||(p=e[c])):p.startsWith("@engineRootDirectory/")&&(p=p.replace("@engineRootDirectory/",t.rootDirectory)),r[c]=Mc(p)}return r},Gd={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer"};var Cs,rt,cr,pn,mn,Yt,ur,ca;let ua=class pi{get _isFetchingStarted(){return De(this,mn,"f")}constructor(){Cs.add(this),rt.set(this,[]),cr.set(this,1),pn.set(this,Cr.BOPM_BLOCK),mn.set(this,!1),Yt.set(this,void 0),ur.set(this,ui.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var r;if(!kc(e))throw new TypeError("Invalid 'image'.");if(!((r=e.tag)===null||r===void 0)&&r.hasOwnProperty("imageId")&&typeof e.tag.imageId=="number"&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(De(this,rt,"f").length>=De(this,cr,"f"))switch(De(this,pn,"f")){case Cr.BOPM_BLOCK:break;case Cr.BOPM_UPDATE:if(De(this,rt,"f").push(e),nr(De(this,Yt,"f"))&&_t(De(this,Yt,"f").imageId)&&De(this,Yt,"f").keepInBuffer==1)for(;De(this,rt,"f").length>De(this,cr,"f");){const o=De(this,rt,"f").findIndex(c=>{var p;return((p=c.tag)===null||p===void 0?void 0:p.imageId)!==De(this,Yt,"f").imageId});De(this,rt,"f").splice(o,1)}else De(this,rt,"f").splice(0,De(this,rt,"f").length-De(this,cr,"f"))}else De(this,rt,"f").push(e)}getImage(){if(De(this,rt,"f").length===0)return null;let e;if(De(this,Yt,"f")&&_t(De(this,Yt,"f").imageId)){const r=De(this,Cs,"m",ca).call(this,De(this,Yt,"f").imageId);if(r<0)throw new Error(`Image with id ${De(this,Yt,"f").imageId} doesn't exist.`);e=De(this,rt,"f").slice(r,r+1)[0]}else e=De(this,rt,"f").pop();if([be.IPF_RGB_565,be.IPF_RGB_555,be.IPF_RGB_888,be.IPF_ARGB_8888,be.IPF_RGB_161616,be.IPF_ARGB_16161616,be.IPF_ABGR_8888,be.IPF_ABGR_16161616,be.IPF_BGR_888].includes(e.format)){if(De(this,ur,"f")===ui.CCUT_RGB_R_CHANNEL_ONLY){pi._onLog&&pi._onLog("only get R channel data.");const r=new Uint8Array(e.width*e.height);for(let o=0;o<r.length;o++)switch(e.format){case be.IPF_RGB_565:case be.IPF_RGB_555:case be.IPF_RGB_888:case be.IPF_RGB_161616:r[o]=e.bytes[3*o+2];break;case be.IPF_ARGB_8888:case be.IPF_ARGB_16161616:r[o]=e.bytes[4*o+2];break;case be.IPF_BGR_888:r[o]=e.bytes[3*o];break;case be.IPF_ABGR_8888:case be.IPF_ABGR_16161616:r[o]=e.bytes[4*o]}e.bytes=r,e.stride=e.width,e.format=be.IPF_GRAYSCALED}else if(De(this,ur,"f")===ui.CCUT_RGB_G_CHANNEL_ONLY){pi._onLog&&pi._onLog("only get G channel data.");const r=new Uint8Array(e.width*e.height);for(let o=0;o<r.length;o++)switch(e.format){case be.IPF_RGB_565:case be.IPF_RGB_555:case be.IPF_RGB_888:case be.IPF_RGB_161616:case be.IPF_BGR_888:r[o]=e.bytes[3*o+1];break;case be.IPF_ARGB_8888:case be.IPF_ARGB_16161616:case be.IPF_ABGR_8888:case be.IPF_ABGR_16161616:r[o]=e.bytes[4*o+1]}e.bytes=r,e.stride=e.width,e.format=be.IPF_GRAYSCALED}else if(De(this,ur,"f")===ui.CCUT_RGB_B_CHANNEL_ONLY){pi._onLog&&pi._onLog("only get B channel data.");const r=new Uint8Array(e.width*e.height);for(let o=0;o<r.length;o++)switch(e.format){case be.IPF_RGB_565:case be.IPF_RGB_555:case be.IPF_RGB_888:case be.IPF_RGB_161616:r[o]=e.bytes[3*o];break;case be.IPF_ARGB_8888:case be.IPF_ARGB_16161616:r[o]=e.bytes[4*o];break;case be.IPF_BGR_888:r[o]=e.bytes[3*o+2];break;case be.IPF_ABGR_8888:case be.IPF_ABGR_16161616:r[o]=e.bytes[4*o+2]}e.bytes=r,e.stride=e.width,e.format=be.IPF_GRAYSCALED}}else[be.IPF_NV21,be.IPF_NV12].includes(e.format)&&pi._onLog&&pi._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,r){if(!((...o)=>o.length!==0&&o.every(c=>_t(c)))(e))throw new TypeError("Invalid 'imageId'.");if(r!==void 0&&!rl(r))throw new TypeError("Invalid 'keepInBuffer'.");lr(this,Yt,{imageId:e,keepInBuffer:r},"f")}_resetNextReturnedImage(){lr(this,Yt,null,"f")}hasImage(e){return De(this,Cs,"m",ca).call(this,e)>=0}startFetching(){lr(this,mn,!0,"f")}stopFetching(){lr(this,mn,!1,"f")}setMaxImageCount(e){if(typeof e!="number")throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(lr(this,cr,e,"f");De(this,rt,"f")&&De(this,rt,"f").length>e;)De(this,rt,"f").shift()}getMaxImageCount(){return De(this,cr,"f")}getImageCount(){return De(this,rt,"f").length}clearBuffer(){De(this,rt,"f").length=0}isBufferEmpty(){return De(this,rt,"f").length===0}setBufferOverflowProtectionMode(e){lr(this,pn,e,"f")}getBufferOverflowProtectionMode(){return De(this,pn,"f")}setColourChannelUsageType(e){lr(this,ur,e,"f")}getColourChannelUsageType(){return De(this,ur,"f")}};rt=new WeakMap,cr=new WeakMap,pn=new WeakMap,mn=new WeakMap,Yt=new WeakMap,ur=new WeakMap,Cs=new WeakSet,ca=function(t){if(typeof t!="number")throw new TypeError("Invalid 'imageId'.");return De(this,rt,"f").findIndex(e=>{var r;return((r=e.tag)===null||r===void 0?void 0:r.imageId)===t})};const Yl=t=>t&&typeof t=="object"&&typeof t.then=="function";let sl=class extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,Yl(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const o=await r;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}constructor(e){let r,o;super((c,p)=>{r=c,o=p}),this._s="pending",this.resolve=c=>{this.isPending&&(Yl(c)?this.task=c:(this._s="fulfilled",r(c)))},this.reject=c=>{this.isPending&&(this._s="rejected",o(c))},this.task=e}},on,Ri,ls,no,At;typeof navigator<"u"&&(on=navigator,Ri=on.userAgent,ls=on.platform,no=on.mediaDevices),function(){if(!ro){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:on.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ls,search:"Win"},Mac:{str:ls},Linux:{str:ls}};let r="unknownBrowser",o=0,c="unknownOS";for(let p in t){const m=t[p]||{};let y=m.str||Ri,C=m.search||p,b=m.verStr||Ri,I=m.verSearch||p;if(I instanceof Array||(I=[I]),y.indexOf(C)!=-1){r=p;for(let A of I){let L=b.indexOf(A);if(L!=-1){o=parseFloat(b.substring(L+A.length+1));break}}break}}for(let p in e){const m=e[p]||{};let y=m.str||Ri,C=m.search||p;if(y.indexOf(C)!=-1){c=p;break}}c=="Linux"&&Ri.indexOf("Windows NT")!=-1&&(c="HarmonyOS"),At={browser:r,version:o,OS:c}}ro&&(At={browser:"ssr",version:0,OS:"ssr"})}();const Wd=typeof WebAssembly<"u"&&Ri&&!(/Safari/.test(Ri)&&!/Chrome/.test(Ri)&&/\(.+\s11_2_([2-6]).*\)/.test(Ri)),Hd=!(typeof Worker>"u"),Bc=!(!no||!no.getUserMedia),Yd=async()=>{let t=!1;if(Bc)try{(await no.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};At.browser==="Chrome"&&At.version>66||At.browser==="Safari"&&At.version>13||At.browser==="OPR"&&At.version>43||At.browser==="Edge"&&At.version;const Fi={},fa=async t=>{let e=typeof t=="string"?[t]:t,r=[];for(let o of e)r.push(Fi[o]=Fi[o]||new sl);await Promise.all(r)},ol=async(t,e)=>{let r,o=typeof t=="string"?[t]:t,c=[];for(let p of o){let m;c.push(m=Fi[p]=Fi[p]||new sl(r=r||e())),m.isEmpty&&(m.task=r=r||e())}await Promise.all(c)};let Ne,Nc=0;const Ke=()=>Nc++,Ge={};let Ji;const Xd=t=>{Ji=t,Ne&&Ne.postMessage({type:"setBLog",body:{value:!!t}})};let al=!1;const zd=t=>{al=t,Ne&&Ne.postMessage({type:"setBDebug",body:{value:!!t}})},_r={},lt={},Ue={std:{version:"1.4.10",path:Mc(Wl+"../../dynamsoft-capture-vision-std@1.4.10/dist/")},core:{version:"3.4.21",path:Wl}},Qi={dip:{wasm:!0}},da={},Ti=async t=>{let e;t instanceof Array||(t=t?[t]:[]);let r=Fi.core;e=!r||r.isEmpty;let o=new Map;const c=y=>{if((y=y.toLowerCase())=="std"||y=="core")return;if(!Qi[y])throw Error("The '"+y+"' module cannot be found.");let C=Qi[y].deps;if(C!=null&&C.length)for(let I of C)c(I);let b=Fi[y];o.has(y)||o.set(y,!b||b.isEmpty)};for(let y of t)c(y);let p=[];e&&p.push("core"),p.push(...o.keys());const m=[...o.entries()].filter(y=>!y[1]).map(y=>y[0]);await ol(p,async()=>{const y=[...o.entries()].filter(P=>P[1]).map(P=>P[0]);await fa(m);const C=ts(da,Ue),b={};for(let P of y)b[P]=Qi[P];const I={engineResourcePaths:C,autoResources:b,names:y};let A=new sl;if(e){I.needLoadCore=!0;let P=C.core+et._workerName;P.startsWith(location.origin)||(P=await fetch(P).then(j=>j.blob()).then(j=>URL.createObjectURL(j))),Ne=new Worker(P),Ne.onerror=j=>{let H=new Error(j.message);A.reject(H)},Ne.addEventListener("message",j=>{let H=j.data?j.data:j,$=H.type,Z=H.id,q=H.body;switch($){case"log":Ji&&Ji(H.message);break;case"task":try{Ge[Z](q),delete Ge[Z]}catch(J){throw delete Ge[Z],J}break;case"event":try{Ge[Z](q)}catch(J){throw J}break;default:console.log(j)}}),I.bLog=!!Ji,I.bd=al,I.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await fa("core");let L=Nc++;Ge[L]=P=>{if(P.success)Object.assign(_r,P.versions),JSON.stringify(P.versions)!=="{}"&&(et._versions=P.versions),A.resolve(void 0);else{const j=Error(P.message);P.stack&&(j.stack=P.stack),A.reject(j)}},Ne.postMessage({type:"loadWasm",body:I,id:L}),await A})};class et{static get engineResourcePaths(){return da}static set engineResourcePaths(e){Object.assign(da,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Ji}static set _onLog(e){Xd(e)}static get _bDebug(){return al}static set _bDebug(e){zd(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!Fi[e]&&Fi[e].isFulfilled}static async loadWasm(e){return await Ti(e)}static async detectEnvironment(){return await(async()=>({wasm:Wd,worker:Hd,getUserMedia:Bc,camera:await Yd(),browser:At.browser,version:At.version,OS:At.OS}))()}static async getModuleVersion(){return await new Promise((e,r)=>{let o=Ke();Ge[o]=async c=>{if(c.success)return e(c.versions);{let p=new Error(c.message);return p.stack=c.stack+`
`+p.stack,r(p)}},Ne.postMessage({type:"getModuleVersion",id:o})})}static getVersion(){const e=_r.core&&_r.core.worker,r=_r.core&&_r.core.wasm;return`3.4.21(Worker: ${e||"Not Loaded"}, Wasm: ${r||"Not Loaded"})`}static enableLogging(){ua._onLog=console.log,et._onLog=console.log}static disableLogging(){ua._onLog=null,et._onLog=null}static async cfd(e){return await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r();{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cfd",id:c,body:{count:e}})})}}var Ce,Xl,ga,zl,$l,so,Kl,Zl;et._bSupportDce4Module=-1,et._bSupportIRTModule=-1,et._versions=null,et._workerName="core.worker.js",et.browserInfo=At,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Ce||(Ce={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(Xl||(Xl={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",t[t.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",t[t.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",t[t.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",t[t.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",t[t.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",t[t.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",t[t.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",t[t.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",t[t.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",t[t.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",t[t.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",t[t.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(ga||(ga={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(zl||(zl={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}($l||($l={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(so||(so={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(Kl||(Kl={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(Zl||(Zl={}));const hs={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_DOWN_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_UP_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_NORMALIZED_IMAGES:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var ql,Jl;(function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"})(ql||(ql={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Jl||(Jl={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.21
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const tr=typeof self>"u",Ql=tr?{}:self,jc=(()=>{if(!tr&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),$d=t=>{if(t==null&&(t="./"),!tr){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},eh=t=>t&&typeof t=="object"&&typeof t.then=="function";let ll=class extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,eh(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const o=await r;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}constructor(e){let r,o;super((c,p)=>{r=c,o=p}),this._s="pending",this.resolve=c=>{this.isPending&&(eh(c)?this.task=c:(this._s="fulfilled",r(c)))},this.reject=c=>{this.isPending&&(this._s="rejected",o(c))},this.task=e}};const bo=" is not allowed to change after `createInstance` or `loadWasm` is called.",Kd=!tr&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",th=(t,e)=>{const r=t;if(r._license!==e){if(!r._pLoad.isEmpty)throw new Error("`license`"+bo);r._license=e}};!tr&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Uc=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!tr){let r=document.createElement("a");r.href=t[e],t[e]=r.href}t[e].endsWith("/")||(t[e]+="/")}}return t},ih=(t,e)=>{e=Uc(e);const r=t;if(r._licenseServer!==e){if(!r._pLoad.isEmpty)throw new Error("`licenseServer`"+bo);r._licenseServer=e}},rh=(t,e)=>{e=e||"";const r=t;if(r._deviceFriendlyName!==e){if(!r._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+bo);r._deviceFriendlyName=e}};let an,ln,cs,Bo,Zt;typeof navigator<"u"&&(an=navigator,ln=an.userAgent,cs=an.platform,Bo=an.mediaDevices),function(){if(!tr){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:an.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:cs,search:"Win"},Mac:{str:cs},Linux:{str:cs}};let r="unknownBrowser",o=0,c="unknownOS";for(let p in t){const m=t[p]||{};let y=m.str||ln,C=m.search||p,b=m.verStr||ln,I=m.verSearch||p;if(I instanceof Array||(I=[I]),y.indexOf(C)!=-1){r=p;for(let A of I){let L=b.indexOf(A);if(L!=-1){o=parseFloat(b.substring(L+A.length+1));break}}break}}for(let p in e){const m=e[p]||{};let y=m.str||ln,C=m.search||p;if(y.indexOf(C)!=-1){c=p;break}}c=="Linux"&&ln.indexOf("Windows NT")!=-1&&(c="HarmonyOS"),Zt={browser:r,version:o,OS:c}}tr&&(Zt={browser:"ssr",version:0,OS:"ssr"})}(),Bo&&Bo.getUserMedia,Zt.browser==="Chrome"&&Zt.version>66||Zt.browser==="Safari"&&Zt.version>13||Zt.browser==="OPR"&&Zt.version>43||Zt.browser==="Edge"&&Zt.version;const Vc=()=>(Ti("license"),ol("dynamsoft_inited",async()=>{let{lt:t,l:e,ls:r,sp:o,rmk:c,cv:p}=((C,b=!1)=>{const I=C;if(I._pLoad.isEmpty){let A,L,P,j=I._license||"",H=JSON.parse(JSON.stringify(I._licenseServer)),$=I._sessionPassword,Z=0;if(j.startsWith("t")||j.startsWith("f"))Z=0;else if(j.length===0||j.startsWith("P")||j.startsWith("L")||j.startsWith("Y")||j.startsWith("A"))Z=1;else{Z=2;const q=j.indexOf(":");q!=-1&&(j=j.substring(q+1));const J=j.indexOf("?");if(J!=-1&&(L=j.substring(J+1),j=j.substring(0,J)),j.startsWith("DLC2"))Z=0;else{if(j.startsWith("DLS2")){let ie;try{let ne=j.substring(4);ne=atob(ne),ie=JSON.parse(ne)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(j=ie.handshakeCode?ie.handshakeCode:ie.organizationID?ie.organizationID:"",typeof j=="number"&&(j=JSON.stringify(j)),H.length===0){let ne=[];ie.mainServerURL&&(ne[0]=ie.mainServerURL),ie.standbyServerURL&&(ne[1]=ie.standbyServerURL),H=Uc(ne)}!$&&ie.sessionPassword&&($=ie.sessionPassword),A=ie.remark}j&&j!=="200001"&&!j.startsWith("200001-")||(Z=1)}}if(Z&&(b||(Ql.crypto||(P="Please upgrade your browser to support online key."),Ql.crypto.subtle||(P="Require https to use online key in this browser."))),P){if(Z!==1)throw new Error(P);Z=0,console.warn(P),I._lastErrorCode=-1,I._lastErrorString=P}return Z===1&&(j="",console.warn("Applying for a public trial license ...")),{lt:Z,l:j,ls:H,sp:$,rmk:A,cv:L}}throw new Error("Can't preprocess license again"+bo)})(ft),m=new ll;ft._pLoad.task=m,(async()=>{try{await ft._pLoad}catch{}})();let y=Ke();Ge[y]=C=>{if(C.message&&ft._onAuthMessage){let A=ft._onAuthMessage(C.message);A!=null&&(C.message=A)}let b,I=!1;if(t===1&&(I=!0),C.success?(Ji&&Ji("init license success"),C.message&&console.warn(C.message),et._bSupportIRTModule=C.bSupportIRTModule,et._bSupportDce4Module=C.bSupportDce4Module,ft.bPassValidation=!0,[0,-10076].includes(C.initLicenseInfo.errorCode)?[-10076].includes(C.initLicenseInfo.errorCode)&&console.warn(C.initLicenseInfo.errorString):m.reject(new Error(C.initLicenseInfo.errorString))):(b=Error(C.message),C.stack&&(b.stack=C.stack),C.ltsErrorCode&&(b.ltsErrorCode=C.ltsErrorCode),I||C.ltsErrorCode==111&&C.message.toLowerCase().indexOf("trial license")!=-1&&(I=!0)),I){const A=ts(et.engineResourcePaths,Ue);(async(L,P,j)=>{if(!L._bNeverShowDialog)try{let H=await fetch(L.engineResourcePath+"dls.license.dialog.html");if(!H.ok)throw Error("Get license dialog fail. Network Error: "+H.statusText);let $=await H.text();if(!$.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let Z=document.createElement("div");Z.innerHTML=$;let q=[];for(let de=0;de<Z.childElementCount;++de){let a=Z.children[de];a instanceof HTMLStyleElement&&(q.push(a),document.head.append(a))}let J=Z.childElementCount==1?Z.children[0]:Z;J.remove();let ie,ne,he,fe,v,ae=[J],me=J.children;for(let de of me)ae.push(de);for(let de=0;de<ae.length;++de)for(let a of ae[de].children)ae.push(a);for(let de of ae)if(!ie&&de.classList.contains("dls-license-mask"))ie=de,de.addEventListener("click",a=>{if(de==a.target){J.remove();for(let s of q)s.remove()}});else if(!ne&&de.classList.contains("dls-license-icon-close"))ne=de,de.addEventListener("click",()=>{J.remove();for(let a of q)a.remove()});else if(!he&&de.classList.contains("dls-license-icon-error"))he=de,P!="error"&&de.remove();else if(!fe&&de.classList.contains("dls-license-icon-warn"))fe=de,P!="warn"&&de.remove();else if(!v&&de.classList.contains("dls-license-msg-content")){v=de;let a=j;for(;a;){let s=a.indexOf("["),l=a.indexOf("]",s),u=a.indexOf("(",l),i=a.indexOf(")",u);if(s==-1||l==-1||u==-1||i==-1){de.appendChild(new Text(a));break}s>0&&de.appendChild(new Text(a.substring(0,s)));let n=document.createElement("a"),h=a.substring(s+1,l);n.innerText=h;let g=a.substring(u+1,i);n.setAttribute("href",g),n.setAttribute("target","_blank"),de.appendChild(n),a=a.substring(i+1)}}document.body.appendChild(J)}catch(H){L._onLog&&L._onLog(H.message||H)}})({_bNeverShowDialog:ft._bNeverShowDialog,engineResourcePath:A.license,_onLog:Ji},C.success?"warn":"error",C.message)}C.success?m.resolve(void 0):m.reject(b)},await fa("core"),Ne.postMessage({type:"license_dynamsoft",body:{v:"3.4.21",brtk:!!t,bptk:t===1,l:e,os:Zt,fn:ft.deviceFriendlyName,ls:r,sp:o,rmk:c,cv:p},id:y}),ft.bCallInitLicense=!0,await m}));let nh;lt.license={},lt.license.dynamsoft=Vc,lt.license.getAR=async()=>{{let t=Fi.dynamsoft_inited;t&&t.isRejected&&await t}return Ne?new Promise((t,e)=>{let r=Ke();Ge[r]=async o=>{if(o.success){delete o.success;{let c=ft.license;c&&(c.startsWith("t")||c.startsWith("f"))&&(o.pk=c)}if(Object.keys(o).length){if(o.lem){let c=Error(o.lem);c.ltsErrorCode=o.lec,delete o.lem,delete o.lec,o.ae=c}t(o)}else t(null)}else{let c=Error(o.message);o.stack&&(c.stack=o.stack),e(c)}},Ne.postMessage({type:"license_getAR",id:r})}):null};let ft=class mi{static setLicenseServer(e){ih(mi,e)}static get license(){return this._license}static set license(e){th(mi,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){ih(mi,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){rh(mi,e)}static initLicense(e,r){if(th(mi,e),mi.bCallInitLicense=!0,typeof r=="boolean"&&r||typeof r=="object"&&r.executeNow)return Vc()}static setDeviceFriendlyName(e){rh(mi,e)}static getDeviceFriendlyName(){return mi._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await ol("dynamsoft_uuid",async()=>{await Ti();let e=new ll,r=Ke();Ge[r]=o=>{if(o.success)e.resolve(o.uuid);else{const c=Error(o.message);o.stack&&(c.stack=o.stack),e.reject(c)}},Ne.postMessage({type:"license_getDeviceUUID",id:r}),nh=await e}),nh))()}};ft._pLoad=new ll,ft.bPassValidation=!1,ft.bCallInitLicense=!1,ft._license=Kd,ft._licenseServer=[],ft._deviceFriendlyName="",Ue.license={version:"3.4.21",path:jc},Qi.license={wasm:!0,js:!0},lt.license.LicenseManager=ft;const No="1.4.10";typeof Ue.std!="string"&&Tr(Ue.std.version,No)<0&&(Ue.std={version:No,path:$d(jc+`../../dynamsoft-capture-vision-std@${No}/dist/`)});/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.4.20
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const Gc=typeof self>"u",hl=(()=>{if(!Gc&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Wc=t=>{if(t==null&&(t="./"),!Gc){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};Ue.dbr={version:"10.4.20",path:hl},Qi.dbr={js:!1,wasm:!0,deps:["license","dip"]},lt.dbr={};const jo="1.4.10";typeof Ue.std!="string"&&Tr(Ue.std.version,jo)<0&&(Ue.std={version:jo,path:Wc(hl+`../../dynamsoft-capture-vision-std@${jo}/dist/`)});const Uo="2.4.20";(!Ue.dip||typeof Ue.dip!="string"&&Tr(Ue.dip.version,Uo)<0)&&(Ue.dip={version:Uo,path:Wc(hl+`../../dynamsoft-image-processing@${Uo}/dist/`)});BigInt(0),BigInt("0xFFFFFFFEFFFFFFFF"),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552);var sh,oh,ah,lh;(function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(sh||(sh={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(oh||(oh={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(ah||(ah={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(lh||(lh={}));et.engineResourcePaths.rootDirectory="https://cdn.jsdelivr.net/npm/";et.engineResourcePaths.dbr="https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader-iv@10.4.20-iv-202411280000/dist/";ft.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAxODM2MjY5LVRYbFhaV0pRY205cSIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21sdHMuZHluYW1zb2Z0LmNvbSIsIm9yZ2FuaXphdGlvbklEIjoiMTAxODM2MjY5Iiwic3RhbmRieVNlcnZlclVSTCI6Imh0dHBzOi8vc2x0cy5keW5hbXNvZnQuY29tIiwiY2hlY2tDb2RlIjotOTk1MTAxNjR9",{executeNow:!0});et.loadWasm(["DBR"]);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 4.1.0
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const pa=typeof self>"u",Zd=(()=>{if(!pa&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();Ue.dce={version:"4.1.0",path:Zd},Qi.dce={wasm:!1,js:!1},lt.dce={};function M(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}function Se(t,e,r,o,c){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?c.call(t,r):c?c.value=r:e.set(t,r),r}let hn,Di,us,oo,ht;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(hn=navigator,Di=hn.userAgent,us=hn.platform,oo=hn.mediaDevices),function(){if(!pa){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:hn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:us,search:"Win"},Mac:{str:us},Linux:{str:us}};let r="unknownBrowser",o=0,c="unknownOS";for(let p in t){const m=t[p]||{};let y=m.str||Di,C=m.search||p,b=m.verStr||Di,I=m.verSearch||p;if(I instanceof Array||(I=[I]),y.indexOf(C)!=-1){r=p;for(let A of I){let L=b.indexOf(A);if(L!=-1){o=parseFloat(b.substring(L+A.length+1));break}}break}}for(let p in e){const m=e[p]||{};let y=m.str||Di,C=m.search||p;if(y.indexOf(C)!=-1){c=p;break}}c=="Linux"&&Di.indexOf("Windows NT")!=-1&&(c="HarmonyOS"),ht={browser:r,version:o,OS:c}}pa&&(ht={browser:"ssr",version:0,OS:"ssr"})}();const qd=typeof WebAssembly<"u"&&Di&&!(/Safari/.test(Di)&&!/Chrome/.test(Di)&&/\(.+\s11_2_([2-6]).*\)/.test(Di)),Jd=!(typeof Worker>"u"),Hc=!(!oo||!oo.getUserMedia),Qd=async()=>{let t=!1;if(Hc)try{(await oo.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};ht.browser==="Chrome"&&ht.version>66||ht.browser==="Safari"&&ht.version>13||ht.browser==="OPR"&&ht.version>43||ht.browser==="Edge"&&ht.version;var eg={653:(t,e,r)=>{var o,c,p,m,y,C,b,I,A,L,P,j,H,$,Z,q,J,ie,ne,he,fe,v=v||{version:"5.2.1"};if(e.fabric=v,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?v.document=document:v.document=document.implementation.createHTMLDocument(""),v.window=window;else{var ae=new(r(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;v.document=ae.document,v.jsdomImplForWrapper=r(898).implForWrapper,v.nodeCanvas=r(245).Canvas,v.window=ae,DOMParser=v.window.DOMParser}function me(a,s){var l=a.canvas,u=s.targetCanvas,i=u.getContext("2d");i.translate(0,u.height),i.scale(1,-1);var n=l.height-u.height;i.drawImage(l,0,n,u.width,u.height,0,0,u.width,u.height)}function de(a,s){var l=s.targetCanvas.getContext("2d"),u=s.destinationWidth,i=s.destinationHeight,n=u*i*4,h=new Uint8Array(this.imageBuffer,0,n),g=new Uint8ClampedArray(this.imageBuffer,0,n);a.readPixels(0,0,u,i,a.RGBA,a.UNSIGNED_BYTE,h);var f=new ImageData(g,u,i);l.putImageData(f,0,0)}v.isTouchSupported="ontouchstart"in v.window||"ontouchstart"in v.document||v.window&&v.window.navigator&&v.window.navigator.maxTouchPoints>0,v.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",v.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],v.DPI=96,v.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",v.commaWsp="(?:\\s+,?\\s*|,\\s*)",v.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,v.reNonWord=/[ \n\.,;!\?\-]/,v.fontPaths={},v.iMatrix=[1,0,0,1,0,0],v.svgNS="http://www.w3.org/2000/svg",v.perfLimitSizeTotal=2097152,v.maxCacheSideLimit=4096,v.minCacheSideLimit=256,v.charWidthsCache={},v.textureSize=2048,v.disableStyleCopyPaste=!1,v.enableGLFiltering=!0,v.devicePixelRatio=v.window.devicePixelRatio||v.window.webkitDevicePixelRatio||v.window.mozDevicePixelRatio||1,v.browserShadowBlurConstant=1,v.arcToSegmentsCache={},v.boundsOfCurveCache={},v.cachesBoundsOfCurve=!0,v.forceGLPutImageData=!1,v.initFilterBackend=function(){return v.enableGLFiltering&&v.isWebglSupported&&v.isWebglSupported(v.textureSize)?(console.log("max texture size: "+v.maxTextureSize),new v.WebglFilterBackend({tileSize:v.textureSize})):v.Canvas2dFilterBackend?new v.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=v),function(){function a(l,u){if(this.__eventListeners[l]){var i=this.__eventListeners[l];u?i[i.indexOf(u)]=!1:v.util.array.fill(i,!1)}}function s(l,u){var i=(function(){u.apply(this,arguments),this.off(l,i)}).bind(this);this.on(l,i)}v.Observable={fire:function(l,u){if(!this.__eventListeners)return this;var i=this.__eventListeners[l];if(!i)return this;for(var n=0,h=i.length;n<h;n++)i[n]&&i[n].call(this,u||{});return this.__eventListeners[l]=i.filter(function(g){return g!==!1}),this},on:function(l,u){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in l)this.on(i,l[i]);else this.__eventListeners[l]||(this.__eventListeners[l]=[]),this.__eventListeners[l].push(u);return this},once:function(l,u){if(arguments.length===1)for(var i in l)s.call(this,i,l[i]);else s.call(this,l,u);return this},off:function(l,u){if(!this.__eventListeners)return this;if(arguments.length===0)for(l in this.__eventListeners)a.call(this,l);else if(arguments.length===1&&typeof arguments[0]=="object")for(var i in l)a.call(this,i,l[i]);else a.call(this,l,u);return this}}}(),v.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,s=arguments.length;a<s;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,s,l){var u=this._objects;return l?u[s]=a:u.splice(s,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a,s=this._objects,l=!1,u=0,i=arguments.length;u<i;u++)(a=s.indexOf(arguments[u]))!==-1&&(l=!0,s.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(a,s){for(var l=this.getObjects(),u=0,i=l.length;u<i;u++)a.call(s,l[u],u,l);return this},getObjects:function(a){return a===void 0?this._objects.concat():this._objects.filter(function(s){return s.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a,s){return this._objects.indexOf(a)>-1||!!s&&this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(a,!0)})},complexity:function(){return this._objects.reduce(function(a,s){return a+(s.complexity?s.complexity():0)},0)}},v.CommonMethods={_setOptions:function(a){for(var s in a)this.set(s,a[s])},_initGradient:function(a,s){!a||!a.colorStops||a instanceof v.Gradient||this.set(s,new v.Gradient(a))},_initPattern:function(a,s,l){!a||!a.source||a instanceof v.Pattern?l&&l():this.set(s,new v.Pattern(a,l))},_setObject:function(a){for(var s in a)this._set(s,a[s])},set:function(a,s){return typeof a=="object"?this._setObject(a):this._set(a,s),this},_set:function(a,s){this[a]=s},toggle:function(a){var s=this.get(a);return typeof s=="boolean"&&this.set(a,!s),this},get:function(a){return this[a]}},o=e,c=Math.sqrt,p=Math.atan2,m=Math.pow,y=Math.PI/180,C=Math.PI/2,v.util={cos:function(a){if(a===0)return 1;switch(a<0&&(a=-a),a/C){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(a===0)return 0;var s=1;switch(a<0&&(s=-1),a/C){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(a)},removeFromArray:function(a,s){var l=a.indexOf(s);return l!==-1&&a.splice(l,1),a},getRandomInt:function(a,s){return Math.floor(Math.random()*(s-a+1))+a},degreesToRadians:function(a){return a*y},radiansToDegrees:function(a){return a/y},rotatePoint:function(a,s,l){var u=new v.Point(a.x-s.x,a.y-s.y),i=v.util.rotateVector(u,l);return new v.Point(i.x,i.y).addEquals(s)},rotateVector:function(a,s){var l=v.util.sin(s),u=v.util.cos(s);return{x:a.x*u-a.y*l,y:a.x*l+a.y*u}},createVector:function(a,s){return new v.Point(s.x-a.x,s.y-a.y)},calcAngleBetweenVectors:function(a,s){return Math.acos((a.x*s.x+a.y*s.y)/(Math.hypot(a.x,a.y)*Math.hypot(s.x,s.y)))},getHatVector:function(a){return new v.Point(a.x,a.y).multiply(1/Math.hypot(a.x,a.y))},getBisector:function(a,s,l){var u=v.util.createVector(a,s),i=v.util.createVector(a,l),n=v.util.calcAngleBetweenVectors(u,i),h=n*(v.util.calcAngleBetweenVectors(v.util.rotateVector(u,n),i)===0?1:-1)/2;return{vector:v.util.getHatVector(v.util.rotateVector(u,h)),angle:n}},projectStrokeOnPoints:function(a,s,l){var u=[],i=s.strokeWidth/2,n=s.strokeUniform?new v.Point(1/s.scaleX,1/s.scaleY):new v.Point(1,1),h=function(g){var f=i/Math.hypot(g.x,g.y);return new v.Point(g.x*f*n.x,g.y*f*n.y)};return a.length<=1||a.forEach(function(g,f){var d,_,w=new v.Point(g.x,g.y);f===0?(_=a[f+1],d=l?h(v.util.createVector(_,w)).addEquals(w):a[a.length-1]):f===a.length-1?(d=a[f-1],_=l?h(v.util.createVector(d,w)).addEquals(w):a[0]):(d=a[f-1],_=a[f+1]);var E,T,S=v.util.getBisector(w,d,_),D=S.vector,B=S.angle;if(s.strokeLineJoin==="miter"&&(E=-i/Math.sin(B/2),T=new v.Point(D.x*E*n.x,D.y*E*n.y),Math.hypot(T.x,T.y)/i<=s.strokeMiterLimit))return u.push(w.add(T)),void u.push(w.subtract(T));E=-i*Math.SQRT2,T=new v.Point(D.x*E*n.x,D.y*E*n.y),u.push(w.add(T)),u.push(w.subtract(T))}),u},transformPoint:function(a,s,l){return l?new v.Point(s[0]*a.x+s[2]*a.y,s[1]*a.x+s[3]*a.y):new v.Point(s[0]*a.x+s[2]*a.y+s[4],s[1]*a.x+s[3]*a.y+s[5])},makeBoundingBoxFromPoints:function(a,s){if(s)for(var l=0;l<a.length;l++)a[l]=v.util.transformPoint(a[l],s);var u=[a[0].x,a[1].x,a[2].x,a[3].x],i=v.util.array.min(u),n=v.util.array.max(u)-i,h=[a[0].y,a[1].y,a[2].y,a[3].y],g=v.util.array.min(h);return{left:i,top:g,width:n,height:v.util.array.max(h)-g}},invertTransform:function(a){var s=1/(a[0]*a[3]-a[1]*a[2]),l=[s*a[3],-s*a[1],-s*a[2],s*a[0]],u=v.util.transformPoint({x:a[4],y:a[5]},l,!0);return l[4]=-u.x,l[5]=-u.y,l},toFixed:function(a,s){return parseFloat(Number(a).toFixed(s))},parseUnit:function(a,s){var l=/\D{0,2}$/.exec(a),u=parseFloat(a);switch(s||(s=v.Text.DEFAULT_SVG_FONT_SIZE),l[0]){case"mm":return u*v.DPI/25.4;case"cm":return u*v.DPI/2.54;case"in":return u*v.DPI;case"pt":return u*v.DPI/72;case"pc":return u*v.DPI/72*12;case"em":return u*s;default:return u}},falseFunction:function(){return!1},getKlass:function(a,s){return a=v.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),v.util.resolveNamespace(s)[a]},getSvgAttributes:function(a){var s=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":s=s.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":s=s.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":s=s.concat(["offset","stop-color","stop-opacity"])}return s},resolveNamespace:function(a){if(!a)return v;var s,l=a.split("."),u=l.length,i=o||v.window;for(s=0;s<u;++s)i=i[l[s]];return i},loadImage:function(a,s,l,u){if(a){var i=v.util.createImage(),n=function(){s&&s.call(l,i,!1),i=i.onload=i.onerror=null};i.onload=n,i.onerror=function(){v.log("Error loading "+i.src),s&&s.call(l,null,!0),i=i.onload=i.onerror=null},a.indexOf("data")!==0&&u!=null&&(i.crossOrigin=u),a.substring(0,14)==="data:image/svg"&&(i.onload=null,v.util.loadImageInDom(i,n)),i.src=a}else s&&s.call(l,a)},loadImageInDom:function(a,s){var l=v.document.createElement("div");l.style.width=l.style.height="1px",l.style.left=l.style.top="-100%",l.style.position="absolute",l.appendChild(a),v.document.querySelector("body").appendChild(l),a.onload=function(){s(),l.parentNode.removeChild(l),l=null}},enlivenObjects:function(a,s,l,u){var i=[],n=0,h=(a=a||[]).length;function g(){++n===h&&s&&s(i.filter(function(f){return f}))}h?a.forEach(function(f,d){f&&f.type?v.util.getKlass(f.type,l).fromObject(f,function(_,w){w||(i[d]=_),u&&u(f,_,w),g()}):g()}):s&&s(i)},enlivenObjectEnlivables:function(a,s,l){var u=v.Object.ENLIVEN_PROPS.filter(function(i){return!!a[i]});v.util.enlivenObjects(u.map(function(i){return a[i]}),function(i){var n={};u.forEach(function(h,g){n[h]=i[g],s&&(s[h]=i[g])}),l&&l(n)})},enlivenPatterns:function(a,s){function l(){++i===n&&s&&s(u)}var u=[],i=0,n=(a=a||[]).length;n?a.forEach(function(h,g){h&&h.source?new v.Pattern(h,function(f){u[g]=f,l()}):(u[g]=h,l())}):s&&s(u)},groupSVGElements:function(a,s,l){var u;return a&&a.length===1?a[0]:(s&&(s.width&&s.height?s.centerPoint={x:s.width/2,y:s.height/2}:(delete s.width,delete s.height)),u=new v.Group(a,s),l!==void 0&&(u.sourcePath=l),u)},populateWithProperties:function(a,s,l){if(l&&Array.isArray(l))for(var u=0,i=l.length;u<i;u++)l[u]in a&&(s[l[u]]=a[l[u]])},createCanvasElement:function(){return v.document.createElement("canvas")},copyCanvasElement:function(a){var s=v.util.createCanvasElement();return s.width=a.width,s.height=a.height,s.getContext("2d").drawImage(a,0,0),s},toDataURL:function(a,s,l){return a.toDataURL("image/"+s,l)},createImage:function(){return v.document.createElement("img")},multiplyTransformMatrices:function(a,s,l){return[a[0]*s[0]+a[2]*s[1],a[1]*s[0]+a[3]*s[1],a[0]*s[2]+a[2]*s[3],a[1]*s[2]+a[3]*s[3],l?0:a[0]*s[4]+a[2]*s[5]+a[4],l?0:a[1]*s[4]+a[3]*s[5]+a[5]]},qrDecompose:function(a){var s=p(a[1],a[0]),l=m(a[0],2)+m(a[1],2),u=c(l),i=(a[0]*a[3]-a[2]*a[1])/u,n=p(a[0]*a[2]+a[1]*a[3],l);return{angle:s/y,scaleX:u,scaleY:i,skewX:n/y,skewY:0,translateX:a[4],translateY:a[5]}},calcRotateMatrix:function(a){if(!a.angle)return v.iMatrix.concat();var s=v.util.degreesToRadians(a.angle),l=v.util.cos(s),u=v.util.sin(s);return[l,u,-u,l,0,0]},calcDimensionsMatrix:function(a){var s=a.scaleX===void 0?1:a.scaleX,l=a.scaleY===void 0?1:a.scaleY,u=[a.flipX?-s:s,0,0,a.flipY?-l:l,0,0],i=v.util.multiplyTransformMatrices,n=v.util.degreesToRadians;return a.skewX&&(u=i(u,[1,0,Math.tan(n(a.skewX)),1],!0)),a.skewY&&(u=i(u,[1,Math.tan(n(a.skewY)),0,1],!0)),u},composeMatrix:function(a){var s=[1,0,0,1,a.translateX||0,a.translateY||0],l=v.util.multiplyTransformMatrices;return a.angle&&(s=l(s,v.util.calcRotateMatrix(a))),(a.scaleX!==1||a.scaleY!==1||a.skewX||a.skewY||a.flipX||a.flipY)&&(s=l(s,v.util.calcDimensionsMatrix(a))),s},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},isTransparent:function(a,s,l,u){u>0&&(s>u?s-=u:s=0,l>u?l-=u:l=0);var i,n=!0,h=a.getImageData(s,l,2*u||1,2*u||1),g=h.data.length;for(i=3;i<g&&(n=h.data[i]<=0)!=0;i+=4);return h=null,n},parsePreserveAspectRatioAttribute:function(a){var s,l="meet",u=a.split(" ");return u&&u.length&&((l=u.pop())!=="meet"&&l!=="slice"?(s=l,l="meet"):u.length&&(s=u.pop())),{meetOrSlice:l,alignX:s!=="none"?s.slice(1,4):"none",alignY:s!=="none"?s.slice(5,8):"none"}},clearFabricFontCache:function(a){(a=(a||"").toLowerCase())?v.charWidthsCache[a]&&delete v.charWidthsCache[a]:v.charWidthsCache={}},limitDimsByArea:function(a,s){var l=Math.sqrt(s*a),u=Math.floor(s/l);return{x:Math.floor(l),y:u}},capValue:function(a,s,l){return Math.max(a,Math.min(s,l))},findScaleToFit:function(a,s){return Math.min(s.width/a.width,s.height/a.height)},findScaleToCover:function(a,s){return Math.max(s.width/a.width,s.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(s){return v.util.toFixed(s,v.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(a,s){var l=v.util.invertTransform(s),u=v.util.multiplyTransformMatrices(l,a.calcOwnMatrix());v.util.applyTransformToObject(a,u)},addTransformToObject:function(a,s){v.util.applyTransformToObject(a,v.util.multiplyTransformMatrices(s,a.calcOwnMatrix()))},applyTransformToObject:function(a,s){var l=v.util.qrDecompose(s),u=new v.Point(l.translateX,l.translateY);a.flipX=!1,a.flipY=!1,a.set("scaleX",l.scaleX),a.set("scaleY",l.scaleY),a.skewX=l.skewX,a.skewY=l.skewY,a.angle=l.angle,a.setPositionByOrigin(u,"center","center")},sizeAfterTransform:function(a,s,l){var u=a/2,i=s/2,n=[{x:-u,y:-i},{x:u,y:-i},{x:-u,y:i},{x:u,y:i}],h=v.util.calcDimensionsMatrix(l),g=v.util.makeBoundingBoxFromPoints(n,h);return{x:g.width,y:g.height}},mergeClipPaths:function(a,s){var l=a,u=s;l.inverted&&!u.inverted&&(l=s,u=a),v.util.applyTransformToObject(u,v.util.multiplyTransformMatrices(v.util.invertTransform(l.calcTransformMatrix()),u.calcTransformMatrix()));var i=l.inverted&&u.inverted;return i&&(l.inverted=u.inverted=!1),new v.Group([l],{clipPath:u,inverted:i})}},function(){var a=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(T,S,D,B,X,z,te,ee,O,x,R){var N=v.util.cos(T),G=v.util.sin(T),W=v.util.cos(S),k=v.util.sin(S),F=D*X*W-B*z*k+te,U=B*X*W+D*z*k+ee;return["C",x+O*(-D*X*G-B*z*N),R+O*(-B*X*G+D*z*N),F+O*(D*X*k+B*z*W),U+O*(B*X*k-D*z*W),F,U]}function i(T,S,D,B){var X=Math.atan2(S,T),z=Math.atan2(B,D);return z>=X?z-X:2*Math.PI-(X-z)}function n(T,S,D){for(var B=D[1],X=D[2],z=D[3],te=D[4],ee=D[5],O=function(N,G,W,k,F,U,Y){var K=Math.PI,Q=Y*K/180,re=v.util.sin(Q),se=v.util.cos(Q),oe=0,ce=0,le=-se*N*.5-re*G*.5,ge=-se*G*.5+re*N*.5,ve=(W=Math.abs(W))*W,_e=(k=Math.abs(k))*k,Ee=ge*ge,ke=le*le,Ct=ve*_e-ve*Ee-_e*ke,tt=0;if(Ct<0){var pt=Math.sqrt(1-Ct/(ve*_e));W*=pt,k*=pt}else tt=(F===U?-1:1)*Math.sqrt(Ct/(ve*Ee+_e*ke));var $e=tt*W*ge/k,Wt=-tt*k*le/W,en=se*$e-re*Wt+.5*N,Ir=re*$e+se*Wt+.5*G,sr=i(1,0,(le-$e)/W,(ge-Wt)/k),xr=i((le-$e)/W,(ge-Wt)/k,(-le-$e)/W,(-ge-Wt)/k);U===0&&xr>0?xr-=2*K:U===1&&xr<0&&(xr+=2*K);for(var gl=Math.ceil(Math.abs(xr/K*2)),ns=[],tn=xr/gl,fu=8/3*Math.sin(tn/4)*Math.sin(tn/4)/Math.sin(tn/2),So=sr+tn,rn=0;rn<gl;rn++)ns[rn]=u(sr,So,se,re,W,k,en,Ir,fu,oe,ce),oe=ns[rn][5],ce=ns[rn][6],sr=So,So+=tn;return ns}(D[6]-T,D[7]-S,B,X,te,ee,z),x=0,R=O.length;x<R;x++)O[x][1]+=T,O[x][2]+=S,O[x][3]+=T,O[x][4]+=S,O[x][5]+=T,O[x][6]+=S;return O}function h(T,S,D,B){return Math.sqrt((D-T)*(D-T)+(B-S)*(B-S))}function g(T,S,D,B,X,z,te,ee){return function(O){var x,R=(x=O)*x*x,N=function(k){return 3*k*k*(1-k)}(O),G=function(k){return 3*k*(1-k)*(1-k)}(O),W=function(k){return(1-k)*(1-k)*(1-k)}(O);return{x:te*R+X*N+D*G+T*W,y:ee*R+z*N+B*G+S*W}}}function f(T,S,D,B,X,z,te,ee){return function(O){var x=1-O,R=3*x*x*(D-T)+6*x*O*(X-D)+3*O*O*(te-X),N=3*x*x*(B-S)+6*x*O*(z-B)+3*O*O*(ee-z);return Math.atan2(N,R)}}function d(T,S,D,B,X,z){return function(te){var ee,O=(ee=te)*ee,x=function(N){return 2*N*(1-N)}(te),R=function(N){return(1-N)*(1-N)}(te);return{x:X*O+D*x+T*R,y:z*O+B*x+S*R}}}function _(T,S,D,B,X,z){return function(te){var ee=1-te,O=2*ee*(D-T)+2*te*(X-D),x=2*ee*(B-S)+2*te*(z-B);return Math.atan2(x,O)}}function w(T,S,D){var B,X,z={x:S,y:D},te=0;for(X=1;X<=100;X+=1)B=T(X/100),te+=h(z.x,z.y,B.x,B.y),z=B;return te}function E(T){for(var S,D,B,X,z=0,te=T.length,ee=0,O=0,x=0,R=0,N=[],G=0;G<te;G++){switch(B={x:ee,y:O,command:(S=T[G])[0]},S[0]){case"M":B.length=0,x=ee=S[1],R=O=S[2];break;case"L":B.length=h(ee,O,S[1],S[2]),ee=S[1],O=S[2];break;case"C":D=g(ee,O,S[1],S[2],S[3],S[4],S[5],S[6]),X=f(ee,O,S[1],S[2],S[3],S[4],S[5],S[6]),B.iterator=D,B.angleFinder=X,B.length=w(D,ee,O),ee=S[5],O=S[6];break;case"Q":D=d(ee,O,S[1],S[2],S[3],S[4]),X=_(ee,O,S[1],S[2],S[3],S[4]),B.iterator=D,B.angleFinder=X,B.length=w(D,ee,O),ee=S[3],O=S[4];break;case"Z":case"z":B.destX=x,B.destY=R,B.length=h(ee,O,x,R),ee=x,O=R}z+=B.length,N.push(B)}return N.push({length:z,x:ee,y:O}),N}v.util.joinPath=function(T){return T.map(function(S){return S.join(" ")}).join(" ")},v.util.parsePath=function(T){var S,D,B,X,z,te=[],ee=[],O=v.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",R="("+x+")"+v.commaWsp,N="([01])"+v.commaWsp+"?",G=new RegExp(R+"?"+R+"?"+R+N+N+R+"?("+x+")","g");if(!T||!T.match)return te;for(var W,k=0,F=(z=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;k<F;k++){X=(S=z[k]).slice(1).trim(),ee.length=0;var U=S.charAt(0);if(W=[U],U.toLowerCase()==="a")for(var Y;Y=G.exec(X);)for(var K=1;K<Y.length;K++)ee.push(Y[K]);else for(;B=O.exec(X);)ee.push(B[0]);K=0;for(var Q=ee.length;K<Q;K++)D=parseFloat(ee[K]),isNaN(D)||W.push(D);var re=s[U.toLowerCase()],se=l[U]||U;if(W.length-1>re)for(var oe=1,ce=W.length;oe<ce;oe+=re)te.push([U].concat(W.slice(oe,oe+re))),U=se;else te.push(W)}return te},v.util.makePathSimpler=function(T){var S,D,B,X,z,te,ee=0,O=0,x=T.length,R=0,N=0,G=[];for(D=0;D<x;++D){switch(B=!1,(S=T[D].slice(0))[0]){case"l":S[0]="L",S[1]+=ee,S[2]+=O;case"L":ee=S[1],O=S[2];break;case"h":S[1]+=ee;case"H":S[0]="L",S[2]=O,ee=S[1];break;case"v":S[1]+=O;case"V":S[0]="L",O=S[1],S[1]=ee,S[2]=O;break;case"m":S[0]="M",S[1]+=ee,S[2]+=O;case"M":ee=S[1],O=S[2],R=S[1],N=S[2];break;case"c":S[0]="C",S[1]+=ee,S[2]+=O,S[3]+=ee,S[4]+=O,S[5]+=ee,S[6]+=O;case"C":z=S[3],te=S[4],ee=S[5],O=S[6];break;case"s":S[0]="S",S[1]+=ee,S[2]+=O,S[3]+=ee,S[4]+=O;case"S":X==="C"?(z=2*ee-z,te=2*O-te):(z=ee,te=O),ee=S[3],O=S[4],S[0]="C",S[5]=S[3],S[6]=S[4],S[3]=S[1],S[4]=S[2],S[1]=z,S[2]=te,z=S[3],te=S[4];break;case"q":S[0]="Q",S[1]+=ee,S[2]+=O,S[3]+=ee,S[4]+=O;case"Q":z=S[1],te=S[2],ee=S[3],O=S[4];break;case"t":S[0]="T",S[1]+=ee,S[2]+=O;case"T":X==="Q"?(z=2*ee-z,te=2*O-te):(z=ee,te=O),S[0]="Q",ee=S[1],O=S[2],S[1]=z,S[2]=te,S[3]=ee,S[4]=O;break;case"a":S[0]="A",S[6]+=ee,S[7]+=O;case"A":B=!0,G=G.concat(n(ee,O,S)),ee=S[6],O=S[7];break;case"z":case"Z":ee=R,O=N}B||G.push(S),X=S[0]}return G},v.util.getSmoothPathFromPoints=function(T,S){var D,B=[],X=new v.Point(T[0].x,T[0].y),z=new v.Point(T[1].x,T[1].y),te=T.length,ee=1,O=0,x=te>2;for(S=S||0,x&&(ee=T[2].x<z.x?-1:T[2].x===z.x?0:1,O=T[2].y<z.y?-1:T[2].y===z.y?0:1),B.push(["M",X.x-ee*S,X.y-O*S]),D=1;D<te;D++){if(!X.eq(z)){var R=X.midPointFrom(z);B.push(["Q",X.x,X.y,R.x,R.y])}X=T[D],D+1<T.length&&(z=T[D+1])}return x&&(ee=X.x>T[D-2].x?1:X.x===T[D-2].x?0:-1,O=X.y>T[D-2].y?1:X.y===T[D-2].y?0:-1),B.push(["L",X.x+ee*S,X.y+O*S]),B},v.util.getPathSegmentsInfo=E,v.util.getBoundsOfCurve=function(T,S,D,B,X,z,te,ee){var O;if(v.cachesBoundsOfCurve&&(O=a.call(arguments),v.boundsOfCurveCache[O]))return v.boundsOfCurveCache[O];var x,R,N,G,W,k,F,U,Y=Math.sqrt,K=Math.min,Q=Math.max,re=Math.abs,se=[],oe=[[],[]];R=6*T-12*D+6*X,x=-3*T+9*D-9*X+3*te,N=3*D-3*T;for(var ce=0;ce<2;++ce)if(ce>0&&(R=6*S-12*B+6*z,x=-3*S+9*B-9*z+3*ee,N=3*B-3*S),re(x)<1e-12){if(re(R)<1e-12)continue;0<(G=-N/R)&&G<1&&se.push(G)}else(F=R*R-4*N*x)<0||(0<(W=(-R+(U=Y(F)))/(2*x))&&W<1&&se.push(W),0<(k=(-R-U)/(2*x))&&k<1&&se.push(k));for(var le,ge,ve,_e=se.length,Ee=_e;_e--;)le=(ve=1-(G=se[_e]))*ve*ve*T+3*ve*ve*G*D+3*ve*G*G*X+G*G*G*te,oe[0][_e]=le,ge=ve*ve*ve*S+3*ve*ve*G*B+3*ve*G*G*z+G*G*G*ee,oe[1][_e]=ge;oe[0][Ee]=T,oe[1][Ee]=S,oe[0][Ee+1]=te,oe[1][Ee+1]=ee;var ke=[{x:K.apply(null,oe[0]),y:K.apply(null,oe[1])},{x:Q.apply(null,oe[0]),y:Q.apply(null,oe[1])}];return v.cachesBoundsOfCurve&&(v.boundsOfCurveCache[O]=ke),ke},v.util.getPointOnPath=function(T,S,D){D||(D=E(T));for(var B=0;S-D[B].length>0&&B<D.length-2;)S-=D[B].length,B++;var X,z=D[B],te=S/z.length,ee=z.command,O=T[B];switch(ee){case"M":return{x:z.x,y:z.y,angle:0};case"Z":case"z":return(X=new v.Point(z.x,z.y).lerp(new v.Point(z.destX,z.destY),te)).angle=Math.atan2(z.destY-z.y,z.destX-z.x),X;case"L":return(X=new v.Point(z.x,z.y).lerp(new v.Point(O[1],O[2]),te)).angle=Math.atan2(O[2]-z.y,O[1]-z.x),X;case"C":case"Q":return function(x,R){for(var N,G,W,k=0,F=0,U=x.iterator,Y={x:x.x,y:x.y},K=.01,Q=x.angleFinder;F<R&&K>1e-4;)N=U(k),W=k,(G=h(Y.x,Y.y,N.x,N.y))+F>R?(k-=K,K/=2):(Y=N,k+=K,F+=G);return N.angle=Q(W),N}(z,S)}},v.util.transformPath=function(T,S,D){return D&&(S=v.util.multiplyTransformMatrices(S,[1,0,0,1,-D.x,-D.y])),T.map(function(B){for(var X=B.slice(0),z={},te=1;te<B.length-1;te+=2)z.x=B[te],z.y=B[te+1],z=v.util.transformPoint(z,S),X[te]=z.x,X[te+1]=z.y;return X})}}(),function(){var a=Array.prototype.slice;function s(l,u,i){if(l&&l.length!==0){var n=l.length-1,h=u?l[n][u]:l[n];if(u)for(;n--;)i(l[n][u],h)&&(h=l[n][u]);else for(;n--;)i(l[n],h)&&(h=l[n]);return h}}v.util.array={fill:function(l,u){for(var i=l.length;i--;)l[i]=u;return l},invoke:function(l,u){for(var i=a.call(arguments,2),n=[],h=0,g=l.length;h<g;h++)n[h]=i.length?l[h][u].apply(l[h],i):l[h][u].call(l[h]);return n},min:function(l,u){return s(l,u,function(i,n){return i<n})},max:function(l,u){return s(l,u,function(i,n){return i>=n})}}}(),function(){function a(s,l,u){if(u)if(!v.isLikelyNode&&l instanceof Element)s=l;else if(l instanceof Array){s=[];for(var i=0,n=l.length;i<n;i++)s[i]=a({},l[i],u)}else if(l&&typeof l=="object")for(var h in l)h==="canvas"||h==="group"?s[h]=null:l.hasOwnProperty(h)&&(s[h]=a({},l[h],u));else s=l;else for(var h in l)s[h]=l[h];return s}v.util.object={extend:a,clone:function(s,l){return a({},s,l)}},v.util.object.extend(v.util,v.Observable)}(),function(){function a(s,l){var u=s.charCodeAt(l);if(isNaN(u))return"";if(u<55296||u>57343)return s.charAt(l);if(55296<=u&&u<=56319){if(s.length<=l+1)throw"High surrogate without following low surrogate";var i=s.charCodeAt(l+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return s.charAt(l)+s.charAt(l+1)}if(l===0)throw"Low surrogate without preceding high surrogate";var n=s.charCodeAt(l-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}v.util.string={camelize:function(s){return s.replace(/-+(.)?/g,function(l,u){return u?u.toUpperCase():""})},capitalize:function(s,l){return s.charAt(0).toUpperCase()+(l?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(s){var l,u=0,i=[];for(u=0;u<s.length;u++)(l=a(s,u))!==!1&&i.push(l);return i}}}(),function(){var a=Array.prototype.slice,s=function(){},l=function(){for(var h in{toString:1})if(h==="toString")return!1;return!0}(),u=function(h,g,f){for(var d in g)d in h.prototype&&typeof h.prototype[d]=="function"&&(g[d]+"").indexOf("callSuper")>-1?h.prototype[d]=function(_){return function(){var w=this.constructor.superclass;this.constructor.superclass=f;var E=g[_].apply(this,arguments);if(this.constructor.superclass=w,_!=="initialize")return E}}(d):h.prototype[d]=g[d],l&&(g.toString!==Object.prototype.toString&&(h.prototype.toString=g.toString),g.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=g.valueOf))};function i(){}function n(h){for(var g=null,f=this;f.constructor.superclass;){var d=f.constructor.superclass.prototype[h];if(f[h]!==d){g=d;break}f=f.constructor.superclass.prototype}return g?arguments.length>1?g.apply(this,a.call(arguments,1)):g.call(this):console.log("tried to callSuper "+h+", method not found in prototype chain",this)}v.util.createClass=function(){var h=null,g=a.call(arguments,0);function f(){this.initialize.apply(this,arguments)}typeof g[0]=="function"&&(h=g.shift()),f.superclass=h,f.subclasses=[],h&&(i.prototype=h.prototype,f.prototype=new i,h.subclasses.push(f));for(var d=0,_=g.length;d<_;d++)u(f,g[d],h);return f.prototype.initialize||(f.prototype.initialize=s),f.prototype.constructor=f,f.prototype.callSuper=n,f}}(),b=!!v.document.createElement("div").attachEvent,I=["touchstart","touchmove","touchend"],v.util.addListener=function(a,s,l,u){a&&a.addEventListener(s,l,!b&&u)},v.util.removeListener=function(a,s,l,u){a&&a.removeEventListener(s,l,!b&&u)},v.util.getPointer=function(a){var s=a.target,l=v.util.getScrollLeftTop(s),u=function(i){var n=i.changedTouches;return n&&n[0]?n[0]:i}(a);return{x:u.clientX+l.left,y:u.clientY+l.top}},v.util.isTouchEvent=function(a){return I.indexOf(a.type)>-1||a.pointerType==="touch"},L=typeof(A=v.document.createElement("div")).style.opacity=="string",P=typeof A.style.filter=="string",j=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,H=function(a){return a},L?H=function(a,s){return a.style.opacity=s,a}:P&&(H=function(a,s){var l=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(l.zoom=1),j.test(l.filter)?(s=s>=.9999?"":"alpha(opacity="+100*s+")",l.filter=l.filter.replace(j,s)):l.filter+=" alpha(opacity="+100*s+")",a}),v.util.setStyle=function(a,s){var l=a.style;if(!l)return a;if(typeof s=="string")return a.style.cssText+=";"+s,s.indexOf("opacity")>-1?H(a,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var u in s)u==="opacity"?H(a,s[u]):l[u==="float"||u==="cssFloat"?l.styleFloat===void 0?"cssFloat":"styleFloat":u]=s[u];return a},function(){var a,s,l,u,i=Array.prototype.slice,n=function(f){return i.call(f,0)};try{a=n(v.document.childNodes)instanceof Array}catch{}function h(f,d){var _=v.document.createElement(f);for(var w in d)w==="class"?_.className=d[w]:w==="for"?_.htmlFor=d[w]:_.setAttribute(w,d[w]);return _}function g(f){for(var d=0,_=0,w=v.document.documentElement,E=v.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&((f=f.parentNode||f.host)===v.document?(d=E.scrollLeft||w.scrollLeft||0,_=E.scrollTop||w.scrollTop||0):(d+=f.scrollLeft||0,_+=f.scrollTop||0),f.nodeType!==1||f.style.position!=="fixed"););return{left:d,top:_}}a||(n=function(f){for(var d=new Array(f.length),_=f.length;_--;)d[_]=f[_];return d}),s=v.document.defaultView&&v.document.defaultView.getComputedStyle?function(f,d){var _=v.document.defaultView.getComputedStyle(f,null);return _?_[d]:void 0}:function(f,d){var _=f.style[d];return!_&&f.currentStyle&&(_=f.currentStyle[d]),_},l=v.document.documentElement.style,u="userSelect"in l?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"",v.util.makeElementUnselectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=v.util.falseFunction),u?f.style[u]="none":typeof f.unselectable=="string"&&(f.unselectable="on"),f},v.util.makeElementSelectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=null),u?f.style[u]="":typeof f.unselectable=="string"&&(f.unselectable=""),f},v.util.setImageSmoothing=function(f,d){f.imageSmoothingEnabled=f.imageSmoothingEnabled||f.webkitImageSmoothingEnabled||f.mozImageSmoothingEnabled||f.msImageSmoothingEnabled||f.oImageSmoothingEnabled,f.imageSmoothingEnabled=d},v.util.getById=function(f){return typeof f=="string"?v.document.getElementById(f):f},v.util.toArray=n,v.util.addClass=function(f,d){f&&(" "+f.className+" ").indexOf(" "+d+" ")===-1&&(f.className+=(f.className?" ":"")+d)},v.util.makeElement=h,v.util.wrapElement=function(f,d,_){return typeof d=="string"&&(d=h(d,_)),f.parentNode&&f.parentNode.replaceChild(d,f),d.appendChild(f),d},v.util.getScrollLeftTop=g,v.util.getElementOffset=function(f){var d,_,w=f&&f.ownerDocument,E={left:0,top:0},T={left:0,top:0},S={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return T;for(var D in S)T[S[D]]+=parseInt(s(f,D),10)||0;return d=w.documentElement,f.getBoundingClientRect!==void 0&&(E=f.getBoundingClientRect()),_=g(f),{left:E.left+_.left-(d.clientLeft||0)+T.left,top:E.top+_.top-(d.clientTop||0)+T.top}},v.util.getNodeCanvas=function(f){var d=v.jsdomImplForWrapper(f);return d._canvas||d._image},v.util.cleanUpJsdomNode=function(f){if(v.isLikelyNode){var d=v.jsdomImplForWrapper(f);d&&(d._image=null,d._canvas=null,d._currentSrc=null,d._attributes=null,d._classList=null)}}}(),function(){function a(){}v.util.request=function(s,l){l||(l={});var u=l.method?l.method.toUpperCase():"GET",i=l.onComplete||function(){},n=new v.window.XMLHttpRequest,h=l.body||l.parameters;return n.onreadystatechange=function(){n.readyState===4&&(i(n),n.onreadystatechange=a)},u==="GET"&&(h=null,typeof l.parameters=="string"&&(s=function(g,f){return g+(/\?/.test(g)?"&":"?")+f}(s,l.parameters))),n.open(u,s,!0),u!=="POST"&&u!=="PUT"||n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(h),n}}(),v.log=console.log,v.warn=console.warn,function(){var a=v.util.object.extend,s=v.util.object.clone,l=[];function u(){return!1}function i(f,d,_,w){return-_*Math.cos(f/w*(Math.PI/2))+_+d}v.util.object.extend(l,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(d){d.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var d=this.filter(function(_){return typeof _.target=="object"&&_.target.canvas===f});return d.forEach(function(_){_.cancel()}),d},cancelByTarget:function(f){var d=this.findAnimationsByTarget(f);return d.forEach(function(_){_.cancel()}),d},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(d){return d.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(d){return d.target===f}):[]}});var n=v.window.requestAnimationFrame||v.window.webkitRequestAnimationFrame||v.window.mozRequestAnimationFrame||v.window.oRequestAnimationFrame||v.window.msRequestAnimationFrame||function(f){return v.window.setTimeout(f,1e3/60)},h=v.window.cancelAnimationFrame||v.window.clearTimeout;function g(){return n.apply(v.window,arguments)}v.util.animate=function(f){f||(f={});var d,_=!1,w=function(){var E=v.runningAnimations.indexOf(d);return E>-1&&v.runningAnimations.splice(E,1)[0]};return d=a(s(f),{cancel:function(){return _=!0,w()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),v.runningAnimations.push(d),g(function(E){var T,S=E||+new Date,D=f.duration||500,B=S+D,X=f.onChange||u,z=f.abort||u,te=f.onComplete||u,ee=f.easing||i,O="startValue"in f&&f.startValue.length>0,x="startValue"in f?f.startValue:0,R="endValue"in f?f.endValue:100,N=f.byValue||(O?x.map(function(G,W){return R[W]-x[W]}):R-x);f.onStart&&f.onStart(),function G(W){var k=(T=W||+new Date)>B?D:T-S,F=k/D,U=O?x.map(function(K,Q){return ee(k,x[Q],N[Q],D)}):ee(k,x,N,D),Y=Math.abs(O?(U[0]-x[0])/N[0]:(U-x)/N);if(d.currentValue=O?U.slice():U,d.completionRate=Y,d.durationRate=F,!_){if(!z(U,Y,F))return T>B?(d.currentValue=O?R.slice():R,d.completionRate=1,d.durationRate=1,X(O?R.slice():R,1,1),te(R,1,1),void w()):(X(U,Y,F),void g(G));w()}}(S)}),d.cancel},v.util.requestAnimFrame=g,v.util.cancelAnimFrame=function(){return h.apply(v.window,arguments)},v.runningAnimations=l}(),function(){function a(s,l,u){var i="rgba("+parseInt(s[0]+u*(l[0]-s[0]),10)+","+parseInt(s[1]+u*(l[1]-s[1]),10)+","+parseInt(s[2]+u*(l[2]-s[2]),10);return(i+=","+(s&&l?parseFloat(s[3]+u*(l[3]-s[3])):1))+")"}v.util.animateColor=function(s,l,u,i){var n=new v.Color(s).getSource(),h=new v.Color(l).getSource(),g=i.onComplete,f=i.onChange;return i=i||{},v.util.animate(v.util.object.extend(i,{duration:u||500,startValue:n,endValue:h,byValue:h,easing:function(d,_,w,E){return a(_,w,i.colorEasing?i.colorEasing(d,E):1-Math.cos(d/E*(Math.PI/2)))},onComplete:function(d,_,w){if(g)return g(a(h,h,0),_,w)},onChange:function(d,_,w){if(f){if(Array.isArray(d))return f(a(d,d,0),_,w);f(d,_,w)}}}))}}(),function(){function a(i,n,h,g){return i<Math.abs(n)?(i=n,g=h/4):g=n===0&&i===0?h/(2*Math.PI)*Math.asin(1):h/(2*Math.PI)*Math.asin(n/i),{a:i,c:n,p:h,s:g}}function s(i,n,h){return i.a*Math.pow(2,10*(n-=1))*Math.sin((n*h-i.s)*(2*Math.PI)/i.p)}function l(i,n,h,g){return h-u(g-i,0,h,g)+n}function u(i,n,h,g){return(i/=g)<1/2.75?h*(7.5625*i*i)+n:i<2/2.75?h*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?h*(7.5625*(i-=2.25/2.75)*i+.9375)+n:h*(7.5625*(i-=2.625/2.75)*i+.984375)+n}v.util.ease={easeInQuad:function(i,n,h,g){return h*(i/=g)*i+n},easeOutQuad:function(i,n,h,g){return-h*(i/=g)*(i-2)+n},easeInOutQuad:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i+n:-h/2*(--i*(i-2)-1)+n},easeInCubic:function(i,n,h,g){return h*(i/=g)*i*i+n},easeOutCubic:function(i,n,h,g){return h*((i=i/g-1)*i*i+1)+n},easeInOutCubic:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i+n:h/2*((i-=2)*i*i+2)+n},easeInQuart:function(i,n,h,g){return h*(i/=g)*i*i*i+n},easeOutQuart:function(i,n,h,g){return-h*((i=i/g-1)*i*i*i-1)+n},easeInOutQuart:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i*i+n:-h/2*((i-=2)*i*i*i-2)+n},easeInQuint:function(i,n,h,g){return h*(i/=g)*i*i*i*i+n},easeOutQuint:function(i,n,h,g){return h*((i=i/g-1)*i*i*i*i+1)+n},easeInOutQuint:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i*i*i+n:h/2*((i-=2)*i*i*i*i+2)+n},easeInSine:function(i,n,h,g){return-h*Math.cos(i/g*(Math.PI/2))+h+n},easeOutSine:function(i,n,h,g){return h*Math.sin(i/g*(Math.PI/2))+n},easeInOutSine:function(i,n,h,g){return-h/2*(Math.cos(Math.PI*i/g)-1)+n},easeInExpo:function(i,n,h,g){return i===0?n:h*Math.pow(2,10*(i/g-1))+n},easeOutExpo:function(i,n,h,g){return i===g?n+h:h*(1-Math.pow(2,-10*i/g))+n},easeInOutExpo:function(i,n,h,g){return i===0?n:i===g?n+h:(i/=g/2)<1?h/2*Math.pow(2,10*(i-1))+n:h/2*(2-Math.pow(2,-10*--i))+n},easeInCirc:function(i,n,h,g){return-h*(Math.sqrt(1-(i/=g)*i)-1)+n},easeOutCirc:function(i,n,h,g){return h*Math.sqrt(1-(i=i/g-1)*i)+n},easeInOutCirc:function(i,n,h,g){return(i/=g/2)<1?-h/2*(Math.sqrt(1-i*i)-1)+n:h/2*(Math.sqrt(1-(i-=2)*i)+1)+n},easeInElastic:function(i,n,h,g){var f=0;return i===0?n:(i/=g)==1?n+h:(f||(f=.3*g),-s(a(h,h,f,1.70158),i,g)+n)},easeOutElastic:function(i,n,h,g){var f=0;if(i===0)return n;if((i/=g)==1)return n+h;f||(f=.3*g);var d=a(h,h,f,1.70158);return d.a*Math.pow(2,-10*i)*Math.sin((i*g-d.s)*(2*Math.PI)/d.p)+d.c+n},easeInOutElastic:function(i,n,h,g){var f=0;if(i===0)return n;if((i/=g/2)==2)return n+h;f||(f=g*(.3*1.5));var d=a(h,h,f,1.70158);return i<1?-.5*s(d,i,g)+n:d.a*Math.pow(2,-10*(i-=1))*Math.sin((i*g-d.s)*(2*Math.PI)/d.p)*.5+d.c+n},easeInBack:function(i,n,h,g,f){return f===void 0&&(f=1.70158),h*(i/=g)*i*((f+1)*i-f)+n},easeOutBack:function(i,n,h,g,f){return f===void 0&&(f=1.70158),h*((i=i/g-1)*i*((f+1)*i+f)+1)+n},easeInOutBack:function(i,n,h,g,f){return f===void 0&&(f=1.70158),(i/=g/2)<1?h/2*(i*i*((1+(f*=1.525))*i-f))+n:h/2*((i-=2)*i*((1+(f*=1.525))*i+f)+2)+n},easeInBounce:l,easeOutBounce:u,easeInOutBounce:function(i,n,h,g){return i<g/2?.5*l(2*i,0,h,g)+n:.5*u(2*i-g,0,h,g)+.5*h+n}}}(),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,n=s.util.parseUnit,h=s.util.multiplyTransformMatrices,g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},d="font-size",_="clip-path";function w(x){return x in g?g[x]:x}function E(x,R,N,G){var W,k=Array.isArray(R);if(x!=="fill"&&x!=="stroke"||R!=="none"){if(x==="strokeUniform")return R==="non-scaling-stroke";if(x==="strokeDashArray")R=R==="none"?null:R.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(x==="transformMatrix")R=N&&N.transformMatrix?h(N.transformMatrix,s.parseTransformAttribute(R)):s.parseTransformAttribute(R);else if(x==="visible")R=R!=="none"&&R!=="hidden",N&&N.visible===!1&&(R=!1);else if(x==="opacity")R=parseFloat(R),N&&N.opacity!==void 0&&(R*=N.opacity);else if(x==="textAnchor")R=R==="start"?"left":R==="end"?"right":"center";else if(x==="charSpacing")W=n(R,G)/G*1e3;else if(x==="paintFirst"){var F=R.indexOf("fill"),U=R.indexOf("stroke");R="fill",(F>-1&&U>-1&&U<F||F===-1&&U>-1)&&(R="stroke")}else{if(x==="href"||x==="xlink:href"||x==="font")return R;if(x==="imageSmoothing")return R==="optimizeQuality";W=k?R.map(n):n(R,G)}}else R="";return!k&&isNaN(W)?R:W}function T(x){return new RegExp("^("+x.join("|")+")\\b","i")}function S(x,R){var N,G,W,k,F=[];for(W=0,k=R.length;W<k;W++)N=R[W],G=x.getElementsByTagName(N),F=F.concat(Array.prototype.slice.call(G));return F}function D(x,R){var N,G=!0;return(N=B(x,R.pop()))&&R.length&&(G=function(W,k){for(var F,U=!0;W.parentNode&&W.parentNode.nodeType===1&&k.length;)U&&(F=k.pop()),U=B(W=W.parentNode,F);return k.length===0}(x,R)),N&&G&&R.length===0}function B(x,R){var N,G,W=x.nodeName,k=x.getAttribute("class"),F=x.getAttribute("id");if(N=new RegExp("^"+W,"i"),R=R.replace(N,""),F&&R.length&&(N=new RegExp("#"+F+"(?![a-zA-Z\\-]+)","i"),R=R.replace(N,"")),k&&R.length)for(G=(k=k.split(" ")).length;G--;)N=new RegExp("\\."+k[G]+"(?![a-zA-Z\\-]+)","i"),R=R.replace(N,"");return R.length===0}function X(x,R){var N;if(x.getElementById&&(N=x.getElementById(R)),N)return N;var G,W,k,F=x.getElementsByTagName("*");for(W=0,k=F.length;W<k;W++)if(R===(G=F[W]).getAttribute("id"))return G}s.svgValidTagNamesRegEx=T(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),s.svgViewBoxElementsRegEx=T(["symbol","image","marker","pattern","view","svg"]),s.svgInvalidAncestorsRegEx=T(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),s.svgValidParentsRegEx=T(["symbol","g","a","svg","clipPath","defs"]),s.cssRules={},s.gradientDefs={},s.clipPaths={},s.parseTransformAttribute=function(){function x(U,Y,K){U[K]=Math.tan(s.util.degreesToRadians(Y[0]))}var R=s.iMatrix,N=s.reNum,G=s.commaWsp,W="(?:(?:(matrix)\\s*\\(\\s*("+N+")"+G+"("+N+")"+G+"("+N+")"+G+"("+N+")"+G+"("+N+")"+G+"("+N+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+N+")(?:"+G+"("+N+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+N+")(?:"+G+"("+N+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+N+")(?:"+G+"("+N+")"+G+"("+N+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+N+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+N+")\\s*\\)))",k=new RegExp("^\\s*(?:(?:"+W+"(?:"+G+"*"+W+")*)?)\\s*$"),F=new RegExp(W,"g");return function(U){var Y=R.concat(),K=[];if(!U||U&&!k.test(U))return Y;U.replace(F,function(re){var se=new RegExp(W).exec(re).filter(function(le){return!!le}),oe=se[1],ce=se.slice(2).map(parseFloat);switch(oe){case"translate":(function(le,ge){le[4]=ge[0],ge.length===2&&(le[5]=ge[1])})(Y,ce);break;case"rotate":ce[0]=s.util.degreesToRadians(ce[0]),function(le,ge){var ve=s.util.cos(ge[0]),_e=s.util.sin(ge[0]),Ee=0,ke=0;ge.length===3&&(Ee=ge[1],ke=ge[2]),le[0]=ve,le[1]=_e,le[2]=-_e,le[3]=ve,le[4]=Ee-(ve*Ee-_e*ke),le[5]=ke-(_e*Ee+ve*ke)}(Y,ce);break;case"scale":(function(le,ge){var ve=ge[0],_e=ge.length===2?ge[1]:ge[0];le[0]=ve,le[3]=_e})(Y,ce);break;case"skewX":x(Y,ce,2);break;case"skewY":x(Y,ce,1);break;case"matrix":Y=ce}K.push(Y.concat()),Y=R.concat()});for(var Q=K[0];K.length>1;)K.shift(),Q=s.util.multiplyTransformMatrices(Q,K[0]);return Q}}();var z=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function te(x){if(!s.svgViewBoxElementsRegEx.test(x.nodeName))return{};var R,N,G,W,k,F,U=x.getAttribute("viewBox"),Y=1,K=1,Q=x.getAttribute("width"),re=x.getAttribute("height"),se=x.getAttribute("x")||0,oe=x.getAttribute("y")||0,ce=x.getAttribute("preserveAspectRatio")||"",le=!U||!(U=U.match(z)),ge=!Q||!re||Q==="100%"||re==="100%",ve=le&&ge,_e={},Ee="",ke=0,Ct=0;if(_e.width=0,_e.height=0,_e.toBeParsed=ve,le&&(se||oe)&&x.parentNode&&x.parentNode.nodeName!=="#document"&&(Ee=" translate("+n(se)+" "+n(oe)+") ",k=(x.getAttribute("transform")||"")+Ee,x.setAttribute("transform",k),x.removeAttribute("x"),x.removeAttribute("y")),ve)return _e;if(le)return _e.width=n(Q),_e.height=n(re),_e;if(R=-parseFloat(U[1]),N=-parseFloat(U[2]),G=parseFloat(U[3]),W=parseFloat(U[4]),_e.minX=R,_e.minY=N,_e.viewBoxWidth=G,_e.viewBoxHeight=W,ge?(_e.width=G,_e.height=W):(_e.width=n(Q),_e.height=n(re),Y=_e.width/G,K=_e.height/W),(ce=s.util.parsePreserveAspectRatioAttribute(ce)).alignX!=="none"&&(ce.meetOrSlice==="meet"&&(K=Y=Y>K?K:Y),ce.meetOrSlice==="slice"&&(K=Y=Y>K?Y:K),ke=_e.width-G*Y,Ct=_e.height-W*Y,ce.alignX==="Mid"&&(ke/=2),ce.alignY==="Mid"&&(Ct/=2),ce.alignX==="Min"&&(ke=0),ce.alignY==="Min"&&(Ct=0)),Y===1&&K===1&&R===0&&N===0&&se===0&&oe===0)return _e;if((se||oe)&&x.parentNode.nodeName!=="#document"&&(Ee=" translate("+n(se)+" "+n(oe)+") "),k=Ee+" matrix("+Y+" 0 0 "+K+" "+(R*Y+ke)+" "+(N*K+Ct)+") ",x.nodeName==="svg"){for(F=x.ownerDocument.createElementNS(s.svgNS,"g");x.firstChild;)F.appendChild(x.firstChild);x.appendChild(F)}else(F=x).removeAttribute("x"),F.removeAttribute("y"),k=F.getAttribute("transform")+k;return F.setAttribute("transform",k),_e}function ee(x,R){var N="xlink:href",G=X(x,R.getAttribute(N).slice(1));if(G&&G.getAttribute(N)&&ee(x,G),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(k){G&&!R.hasAttribute(k)&&G.hasAttribute(k)&&R.setAttribute(k,G.getAttribute(k))}),!R.children.length)for(var W=G.cloneNode(!0);W.firstChild;)R.appendChild(W.firstChild);R.removeAttribute(N)}s.parseSVGDocument=function(x,R,N,G){if(x){(function(se){for(var oe=S(se,["use","svg:use"]),ce=0;oe.length&&ce<oe.length;){var le=oe[ce],ge=le.getAttribute("xlink:href")||le.getAttribute("href");if(ge===null)return;var ve,_e,Ee,ke,Ct=ge.slice(1),tt=le.getAttribute("x")||0,pt=le.getAttribute("y")||0,$e=X(se,Ct).cloneNode(!0),Wt=($e.getAttribute("transform")||"")+" translate("+tt+", "+pt+")",en=oe.length,Ir=s.svgNS;if(te($e),/^svg$/i.test($e.nodeName)){var sr=$e.ownerDocument.createElementNS(Ir,"g");for(_e=0,ke=(Ee=$e.attributes).length;_e<ke;_e++)ve=Ee.item(_e),sr.setAttributeNS(Ir,ve.nodeName,ve.nodeValue);for(;$e.firstChild;)sr.appendChild($e.firstChild);$e=sr}for(_e=0,ke=(Ee=le.attributes).length;_e<ke;_e++)(ve=Ee.item(_e)).nodeName!=="x"&&ve.nodeName!=="y"&&ve.nodeName!=="xlink:href"&&ve.nodeName!=="href"&&(ve.nodeName==="transform"?Wt=ve.nodeValue+" "+Wt:$e.setAttribute(ve.nodeName,ve.nodeValue));$e.setAttribute("transform",Wt),$e.setAttribute("instantiated_by_use","1"),$e.removeAttribute("id"),le.parentNode.replaceChild($e,le),oe.length===en&&ce++}})(x);var W,k,F=s.Object.__uid++,U=te(x),Y=s.util.toArray(x.getElementsByTagName("*"));if(U.crossOrigin=G&&G.crossOrigin,U.svgUid=F,Y.length===0&&s.isLikelyNode){var K=[];for(W=0,k=(Y=x.selectNodes('//*[name(.)!="svg"]')).length;W<k;W++)K[W]=Y[W];Y=K}var Q=Y.filter(function(se){return te(se),s.svgValidTagNamesRegEx.test(se.nodeName.replace("svg:",""))&&!function(oe,ce){for(;oe&&(oe=oe.parentNode);)if(oe.nodeName&&ce.test(oe.nodeName.replace("svg:",""))&&!oe.getAttribute("instantiated_by_use"))return!0;return!1}(se,s.svgInvalidAncestorsRegEx)});if(!Q||Q&&!Q.length)R&&R([],{});else{var re={};Y.filter(function(se){return se.nodeName.replace("svg:","")==="clipPath"}).forEach(function(se){var oe=se.getAttribute("id");re[oe]=s.util.toArray(se.getElementsByTagName("*")).filter(function(ce){return s.svgValidTagNamesRegEx.test(ce.nodeName.replace("svg:",""))})}),s.gradientDefs[F]=s.getGradientDefs(x),s.cssRules[F]=s.getCSSRules(x),s.clipPaths[F]=re,s.parseElements(Q,function(se,oe){R&&(R(se,U,oe,Y),delete s.gradientDefs[F],delete s.cssRules[F],delete s.clipPaths[F])},u(U),N,G)}}};var O=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");l(s,{parseFontDeclaration:function(x,R){var N=x.match(O);if(N){var G=N[1],W=N[3],k=N[4],F=N[5],U=N[6];G&&(R.fontStyle=G),W&&(R.fontWeight=isNaN(parseFloat(W))?W:parseFloat(W)),k&&(R.fontSize=n(k)),U&&(R.fontFamily=U),F&&(R.lineHeight=F==="normal"?1:F)}},getGradientDefs:function(x){var R,N=S(x,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),G=0,W={};for(G=N.length;G--;)(R=N[G]).getAttribute("xlink:href")&&ee(x,R),W[R.getAttribute("id")]=R;return W},parseAttributes:function(x,R,N){if(x){var G,W,k,F={};N===void 0&&(N=x.getAttribute("svgUid")),x.parentNode&&s.svgValidParentsRegEx.test(x.parentNode.nodeName)&&(F=s.parseAttributes(x.parentNode,R,N));var U=R.reduce(function(ce,le){return(G=x.getAttribute(le))&&(ce[le]=G),ce},{}),Y=l(function(ce,le){var ge={};for(var ve in s.cssRules[le])if(D(ce,ve.split(" ")))for(var _e in s.cssRules[le][ve])ge[_e]=s.cssRules[le][ve][_e];return ge}(x,N),s.parseStyleAttribute(x));U=l(U,Y),Y[_]&&x.setAttribute(_,Y[_]),W=k=F.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,U[d]&&(U[d]=W=n(U[d],k));var K,Q,re={};for(var se in U)Q=E(K=w(se),U[se],F,W),re[K]=Q;re&&re.font&&s.parseFontDeclaration(re.font,re);var oe=l(F,re);return s.svgValidParentsRegEx.test(x.nodeName)?oe:function(ce){for(var le in f)if(ce[f[le]]!==void 0&&ce[le]!==""){if(ce[le]===void 0){if(!s.Object.prototype[le])continue;ce[le]=s.Object.prototype[le]}if(ce[le].indexOf("url(")!==0){var ge=new s.Color(ce[le]);ce[le]=ge.setAlpha(i(ge.getAlpha()*ce[f[le]],2)).toRgba()}}return ce}(oe)}},parseElements:function(x,R,N,G,W){new s.ElementsParser(x,R,N,G,W).parse()},parseStyleAttribute:function(x){var R={},N=x.getAttribute("style");return N&&(typeof N=="string"?function(G,W){var k,F;G.replace(/;\s*$/,"").split(";").forEach(function(U){var Y=U.split(":");k=Y[0].trim().toLowerCase(),F=Y[1].trim(),W[k]=F})}(N,R):function(G,W){var k,F;for(var U in G)G[U]!==void 0&&(k=U.toLowerCase(),F=G[U],W[k]=F)}(N,R)),R},parsePointsAttribute:function(x){if(!x)return null;var R,N,G=[];for(R=0,N=(x=(x=x.replace(/,/g," ").trim()).split(/\s+/)).length;R<N;R+=2)G.push({x:parseFloat(x[R]),y:parseFloat(x[R+1])});return G},getCSSRules:function(x){var R,N,G=x.getElementsByTagName("style"),W={};for(R=0,N=G.length;R<N;R++){var k=G[R].textContent;(k=k.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&k.split("}").filter(function(F){return F.trim()}).forEach(function(F){var U=F.split("{"),Y={},K=U[1].trim().split(";").filter(function(oe){return oe.trim()});for(R=0,N=K.length;R<N;R++){var Q=K[R].split(":"),re=Q[0].trim(),se=Q[1].trim();Y[re]=se}(F=U[0].trim()).split(",").forEach(function(oe){(oe=oe.replace(/^svg/i,"").trim())!==""&&(W[oe]?s.util.object.extend(W[oe],Y):W[oe]=s.util.object.clone(Y))})})}return W},loadSVGFromURL:function(x,R,N,G){x=x.replace(/^\n\s*/,"").trim(),new s.util.request(x,{method:"get",onComplete:function(W){var k=W.responseXML;if(!k||!k.documentElement)return R&&R(null),!1;s.parseSVGDocument(k.documentElement,function(F,U,Y,K){R&&R(F,U,Y,K)},N,G)}})},loadSVGFromString:function(x,R,N,G){var W=new s.window.DOMParser().parseFromString(x.trim(),"text/xml");s.parseSVGDocument(W.documentElement,function(k,F,U,Y){R(k,F,U,Y)},N,G)}})}(e),v.ElementsParser=function(a,s,l,u,i,n){this.elements=a,this.callback=s,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n},($=v.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},$.createObjects=function(){var a=this;this.elements.forEach(function(s,l){s.setAttribute("svgUid",a.svgUid),a.createObject(s,l)})},$.findTag=function(a){return v[v.util.string.capitalize(a.tagName.replace("svg:",""))]},$.createObject=function(a,s){var l=this.findTag(a);if(l&&l.fromElement)try{l.fromElement(a,this.createCallback(s,a),this.options)}catch(u){v.log(u)}else this.checkIfDone()},$.createCallback=function(a,s){var l=this;return function(u){var i;l.resolveGradient(u,s,"fill"),l.resolveGradient(u,s,"stroke"),u instanceof v.Image&&u._originalElement&&(i=u.parsePreserveAspectRatioAttribute(s)),u._removeTransformMatrix(i),l.resolveClipPath(u,s),l.reviver&&l.reviver(s,u),l.instances[a]=u,l.checkIfDone()}},$.extractPropertyDefinition=function(a,s,l){var u=a[s],i=this.regexUrl;if(i.test(u)){i.lastIndex=0;var n=i.exec(u)[1];return i.lastIndex=0,v[l][this.svgUid][n]}},$.resolveGradient=function(a,s,l){var u=this.extractPropertyDefinition(a,l,"gradientDefs");if(u){var i=s.getAttribute(l+"-opacity"),n=v.Gradient.fromElement(u,a,i,this.options);a.set(l,n)}},$.createClipPathCallback=function(a,s){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,s.push(l)}},$.resolveClipPath=function(a,s){var l,u,i,n,h=this.extractPropertyDefinition(a,"clipPath","clipPaths");if(h){i=[],u=v.util.invertTransform(a.calcTransformMatrix());for(var g=h[0].parentNode,f=s;f.parentNode&&f.getAttribute("clip-path")!==a.clipPath;)f=f.parentNode;f.parentNode.appendChild(g);for(var d=0;d<h.length;d++)l=h[d],this.findTag(l).fromElement(l,this.createClipPathCallback(a,i),this.options);h=i.length===1?i[0]:new v.Group(i),n=v.util.multiplyTransformMatrices(u,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,f);var _=v.util.qrDecompose(n);h.flipX=!1,h.flipY=!1,h.set("scaleX",_.scaleX),h.set("scaleY",_.scaleY),h.angle=_.angle,h.skewX=_.skewX,h.skewY=0,h.setPositionByOrigin({x:_.translateX,y:_.translateY},"center","center"),a.clipPath=h}else delete a.clipPath},$.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(a){return a!=null}),this.callback(this.instances,this.elements))},function(a){var s=a.fabric||(a.fabric={});function l(u,i){this.x=u,this.y=i}s.Point?s.warn("fabric.Point is already defined"):(s.Point=l,l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,i){return i===void 0&&(i=.5),i=Math.max(Math.min(1,i),0),new l(this.x+(u.x-this.x)*i,this.y+(u.y-this.y)*i)},distanceFrom:function(u){var i=this.x-u.x,n=this.y-u.y;return Math.sqrt(i*i+n*n)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,i){return this.x=u,this.y=i,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var i=this.x,n=this.y;this.x=u.x,this.y=u.y,u.x=i,u.y=n},clone:function(){return new l(this.x,this.y)}})}(e),function(a){var s=a.fabric||(a.fabric={});function l(u){this.status=u,this.points=[]}s.Intersection?s.warn("fabric.Intersection is already defined"):(s.Intersection=l,s.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},s.Intersection.intersectLineLine=function(u,i,n,h){var g,f=(h.x-n.x)*(u.y-n.y)-(h.y-n.y)*(u.x-n.x),d=(i.x-u.x)*(u.y-n.y)-(i.y-u.y)*(u.x-n.x),_=(h.y-n.y)*(i.x-u.x)-(h.x-n.x)*(i.y-u.y);if(_!==0){var w=f/_,E=d/_;0<=w&&w<=1&&0<=E&&E<=1?(g=new l("Intersection")).appendPoint(new s.Point(u.x+w*(i.x-u.x),u.y+w*(i.y-u.y))):g=new l}else g=new l(f===0||d===0?"Coincident":"Parallel");return g},s.Intersection.intersectLinePolygon=function(u,i,n){var h,g,f,d,_=new l,w=n.length;for(d=0;d<w;d++)h=n[d],g=n[(d+1)%w],f=l.intersectLineLine(u,i,h,g),_.appendPoints(f.points);return _.points.length>0&&(_.status="Intersection"),_},s.Intersection.intersectPolygonPolygon=function(u,i){var n,h=new l,g=u.length;for(n=0;n<g;n++){var f=u[n],d=u[(n+1)%g],_=l.intersectLinePolygon(f,d,i);h.appendPoints(_.points)}return h.points.length>0&&(h.status="Intersection"),h},s.Intersection.intersectPolygonRectangle=function(u,i,n){var h=i.min(n),g=i.max(n),f=new s.Point(g.x,h.y),d=new s.Point(h.x,g.y),_=l.intersectLinePolygon(h,f,u),w=l.intersectLinePolygon(f,g,u),E=l.intersectLinePolygon(g,d,u),T=l.intersectLinePolygon(d,h,u),S=new l;return S.appendPoints(_.points),S.appendPoints(w.points),S.appendPoints(E.points),S.appendPoints(T.points),S.points.length>0&&(S.status="Intersection"),S})}(e),function(a){var s=a.fabric||(a.fabric={});function l(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}function u(i,n,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?i+6*(n-i)*h:h<.5?n:h<2/3?i+(n-i)*(2/3-h)*6:i}s.Color?s.warn("fabric.Color is already defined."):(s.Color=l,s.Color.prototype={_tryParsingColor:function(i){var n;i in l.colorNameMap&&(i=l.colorNameMap[i]),i==="transparent"&&(n=[255,255,255,0]),n||(n=l.sourceFromHex(i)),n||(n=l.sourceFromRgb(i)),n||(n=l.sourceFromHsl(i)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(i,n,h){i/=255,n/=255,h/=255;var g,f,d,_=s.util.array.max([i,n,h]),w=s.util.array.min([i,n,h]);if(d=(_+w)/2,_===w)g=f=0;else{var E=_-w;switch(f=d>.5?E/(2-_-w):E/(_+w),_){case i:g=(n-h)/E+(n<h?6:0);break;case n:g=(h-i)/E+2;break;case h:g=(i-n)/E+4}g/=6}return[Math.round(360*g),Math.round(100*f),Math.round(100*d)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)"},toHsla:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+i[3]+")"},toHex:function(){var i,n,h,g=this.getSource();return i=(i=g[0].toString(16)).length===1?"0"+i:i,n=(n=g[1].toString(16)).length===1?"0"+n:n,h=(h=g[2].toString(16)).length===1?"0"+h:h,i.toUpperCase()+n.toUpperCase()+h.toUpperCase()},toHexa:function(){var i,n=this.getSource();return i=(i=(i=Math.round(255*n[3])).toString(16)).length===1?"0"+i:i,this.toHex()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var n=this.getSource();return n[3]=i,this.setSource(n),this},toGrayscale:function(){var i=this.getSource(),n=parseInt((.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),10),h=i[3];return this.setSource([n,n,n,h]),this},toBlackWhite:function(i){var n=this.getSource(),h=(.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),g=n[3];return i=i||127,h=Number(h)<Number(i)?0:255,this.setSource([h,h,h,g]),this},overlayWith:function(i){i instanceof l||(i=new l(i));var n,h=[],g=this.getAlpha(),f=this.getSource(),d=i.getSource();for(n=0;n<3;n++)h.push(Math.round(.5*f[n]+.5*d[n]));return h[3]=g,this.setSource(h),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},s.Color.fromRgb=function(i){return l.fromSource(l.sourceFromRgb(i))},s.Color.sourceFromRgb=function(i){var n=i.match(l.reRGBa);if(n){var h=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),g=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),f=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(h,10),parseInt(g,10),parseInt(f,10),n[4]?parseFloat(n[4]):1]}},s.Color.fromRgba=l.fromRgb,s.Color.fromHsl=function(i){return l.fromSource(l.sourceFromHsl(i))},s.Color.sourceFromHsl=function(i){var n=i.match(l.reHSLa);if(n){var h,g,f,d=(parseFloat(n[1])%360+360)%360/360,_=parseFloat(n[2])/(/%$/.test(n[2])?100:1),w=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(_===0)h=g=f=w;else{var E=w<=.5?w*(_+1):w+_-w*_,T=2*w-E;h=u(T,E,d+1/3),g=u(T,E,d),f=u(T,E,d-1/3)}return[Math.round(255*h),Math.round(255*g),Math.round(255*f),n[4]?parseFloat(n[4]):1]}},s.Color.fromHsla=l.fromHsl,s.Color.fromHex=function(i){return l.fromSource(l.sourceFromHex(i))},s.Color.sourceFromHex=function(i){if(i.match(l.reHex)){var n=i.slice(i.indexOf("#")+1),h=n.length===3||n.length===4,g=n.length===8||n.length===4,f=h?n.charAt(0)+n.charAt(0):n.substring(0,2),d=h?n.charAt(1)+n.charAt(1):n.substring(2,4),_=h?n.charAt(2)+n.charAt(2):n.substring(4,6),w=g?h?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(f,16),parseInt(d,16),parseInt(_,16),parseFloat((parseInt(w,16)/255).toFixed(2))]}},s.Color.fromSource=function(i){var n=new l;return n.setSource(i),n})}(e),function(a){var s=a.fabric||(a.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],i={},n="left",h="top",g="right",f="bottom",d="center",_={top:f,bottom:h,left:g,right:n,center:d},w=s.util.radiansToDegrees,E=Math.sign||function(k){return(k>0)-(k<0)||+k};function T(k,F){var U=k.angle+w(Math.atan2(F.y,F.x))+360;return Math.round(U%360/45)}function S(k,F){var U=F.transform.target,Y=U.canvas,K=s.util.object.clone(F);K.target=U,Y&&Y.fire("object:"+k,K),U.fire(k,F)}function D(k,F){var U=F.canvas,Y=k[U.uniScaleKey];return U.uniformScaling&&!Y||!U.uniformScaling&&Y}function B(k){return k.originX===d&&k.originY===d}function X(k,F,U){var Y=k.lockScalingX,K=k.lockScalingY;return!((!Y||!K)&&(F||!Y&&!K||!U)&&(!Y||F!=="x")&&(!K||F!=="y"))}function z(k,F,U,Y){return{e:k,transform:F,pointer:{x:U,y:Y}}}function te(k){return function(F,U,Y,K){var Q=U.target,re=Q.getCenterPoint(),se=Q.translateToOriginPoint(re,U.originX,U.originY),oe=k(F,U,Y,K);return Q.setPositionByOrigin(se,U.originX,U.originY),oe}}function ee(k,F){return function(U,Y,K,Q){var re=F(U,Y,K,Q);return re&&S(k,z(U,Y,K,Q)),re}}function O(k,F,U,Y,K){var Q=k.target,re=Q.controls[k.corner],se=Q.canvas.getZoom(),oe=Q.padding/se,ce=Q.toLocalPoint(new s.Point(Y,K),F,U);return ce.x>=oe&&(ce.x-=oe),ce.x<=-oe&&(ce.x+=oe),ce.y>=oe&&(ce.y-=oe),ce.y<=oe&&(ce.y+=oe),ce.x-=re.offsetX,ce.y-=re.offsetY,ce}function x(k){return k.flipX!==k.flipY}function R(k,F,U,Y,K){if(k[F]!==0){var Q=K/k._getTransformedDimensions()[Y]*k[U];k.set(U,Q)}}function N(k,F,U,Y){var K,Q=F.target,re=Q._getTransformedDimensions(0,Q.skewY),se=O(F,F.originX,F.originY,U,Y),oe=Math.abs(2*se.x)-re.x,ce=Q.skewX;oe<2?K=0:(K=w(Math.atan2(oe/Q.scaleX,re.y/Q.scaleY)),F.originX===n&&F.originY===f&&(K=-K),F.originX===g&&F.originY===h&&(K=-K),x(Q)&&(K=-K));var le=ce!==K;if(le){var ge=Q._getTransformedDimensions().y;Q.set("skewX",K),R(Q,"skewY","scaleY","y",ge)}return le}function G(k,F,U,Y){var K,Q=F.target,re=Q._getTransformedDimensions(Q.skewX,0),se=O(F,F.originX,F.originY,U,Y),oe=Math.abs(2*se.y)-re.y,ce=Q.skewY;oe<2?K=0:(K=w(Math.atan2(oe/Q.scaleY,re.x/Q.scaleX)),F.originX===n&&F.originY===f&&(K=-K),F.originX===g&&F.originY===h&&(K=-K),x(Q)&&(K=-K));var le=ce!==K;if(le){var ge=Q._getTransformedDimensions().x;Q.set("skewY",K),R(Q,"skewX","scaleX","x",ge)}return le}function W(k,F,U,Y,K){K=K||{};var Q,re,se,oe,ce,le,ge=F.target,ve=ge.lockScalingX,_e=ge.lockScalingY,Ee=K.by,ke=D(k,ge),Ct=X(ge,Ee,ke),tt=F.gestureScale;if(Ct)return!1;if(tt)re=F.scaleX*tt,se=F.scaleY*tt;else{if(Q=O(F,F.originX,F.originY,U,Y),ce=Ee!=="y"?E(Q.x):1,le=Ee!=="x"?E(Q.y):1,F.signX||(F.signX=ce),F.signY||(F.signY=le),ge.lockScalingFlip&&(F.signX!==ce||F.signY!==le))return!1;if(oe=ge._getTransformedDimensions(),ke&&!Ee){var pt=Math.abs(Q.x)+Math.abs(Q.y),$e=F.original,Wt=pt/(Math.abs(oe.x*$e.scaleX/ge.scaleX)+Math.abs(oe.y*$e.scaleY/ge.scaleY));re=$e.scaleX*Wt,se=$e.scaleY*Wt}else re=Math.abs(Q.x*ge.scaleX/oe.x),se=Math.abs(Q.y*ge.scaleY/oe.y);B(F)&&(re*=2,se*=2),F.signX!==ce&&Ee!=="y"&&(F.originX=_[F.originX],re*=-1,F.signX=ce),F.signY!==le&&Ee!=="x"&&(F.originY=_[F.originY],se*=-1,F.signY=le)}var en=ge.scaleX,Ir=ge.scaleY;return Ee?(Ee==="x"&&ge.set("scaleX",re),Ee==="y"&&ge.set("scaleY",se)):(!ve&&ge.set("scaleX",re),!_e&&ge.set("scaleY",se)),en!==ge.scaleX||Ir!==ge.scaleY}i.scaleCursorStyleHandler=function(k,F,U){var Y=D(k,U),K="";if(F.x!==0&&F.y===0?K="x":F.x===0&&F.y!==0&&(K="y"),X(U,K,Y))return"not-allowed";var Q=T(U,F);return l[Q]+"-resize"},i.skewCursorStyleHandler=function(k,F,U){var Y="not-allowed";if(F.x!==0&&U.lockSkewingY||F.y!==0&&U.lockSkewingX)return Y;var K=T(U,F)%4;return u[K]+"-resize"},i.scaleSkewCursorStyleHandler=function(k,F,U){return k[U.canvas.altActionKey]?i.skewCursorStyleHandler(k,F,U):i.scaleCursorStyleHandler(k,F,U)},i.rotationWithSnapping=ee("rotating",te(function(k,F,U,Y){var K=F,Q=K.target,re=Q.translateToOriginPoint(Q.getCenterPoint(),K.originX,K.originY);if(Q.lockRotation)return!1;var se,oe=Math.atan2(K.ey-re.y,K.ex-re.x),ce=Math.atan2(Y-re.y,U-re.x),le=w(ce-oe+K.theta);if(Q.snapAngle>0){var ge=Q.snapAngle,ve=Q.snapThreshold||ge,_e=Math.ceil(le/ge)*ge,Ee=Math.floor(le/ge)*ge;Math.abs(le-Ee)<ve?le=Ee:Math.abs(le-_e)<ve&&(le=_e)}return le<0&&(le=360+le),le%=360,se=Q.angle!==le,Q.angle=le,se})),i.scalingEqually=ee("scaling",te(function(k,F,U,Y){return W(k,F,U,Y)})),i.scalingX=ee("scaling",te(function(k,F,U,Y){return W(k,F,U,Y,{by:"x"})})),i.scalingY=ee("scaling",te(function(k,F,U,Y){return W(k,F,U,Y,{by:"y"})})),i.scalingYOrSkewingX=function(k,F,U,Y){return k[F.target.canvas.altActionKey]?i.skewHandlerX(k,F,U,Y):i.scalingY(k,F,U,Y)},i.scalingXOrSkewingY=function(k,F,U,Y){return k[F.target.canvas.altActionKey]?i.skewHandlerY(k,F,U,Y):i.scalingX(k,F,U,Y)},i.changeWidth=ee("resizing",te(function(k,F,U,Y){var K=F.target,Q=O(F,F.originX,F.originY,U,Y),re=K.strokeWidth/(K.strokeUniform?K.scaleX:1),se=B(F)?2:1,oe=K.width,ce=Math.abs(Q.x*se/K.scaleX)-re;return K.set("width",Math.max(ce,0)),oe!==ce})),i.skewHandlerX=function(k,F,U,Y){var K,Q=F.target,re=Q.skewX,se=F.originY;return!Q.lockSkewingX&&(re===0?K=O(F,d,d,U,Y).x>0?n:g:(re>0&&(K=se===h?n:g),re<0&&(K=se===h?g:n),x(Q)&&(K=K===n?g:n)),F.originX=K,ee("skewing",te(N))(k,F,U,Y))},i.skewHandlerY=function(k,F,U,Y){var K,Q=F.target,re=Q.skewY,se=F.originX;return!Q.lockSkewingY&&(re===0?K=O(F,d,d,U,Y).y>0?h:f:(re>0&&(K=se===n?h:f),re<0&&(K=se===n?f:h),x(Q)&&(K=K===h?f:h)),F.originY=K,ee("skewing",te(G))(k,F,U,Y))},i.dragHandler=function(k,F,U,Y){var K=F.target,Q=U-F.offsetX,re=Y-F.offsetY,se=!K.get("lockMovementX")&&K.left!==Q,oe=!K.get("lockMovementY")&&K.top!==re;return se&&K.set("left",Q),oe&&K.set("top",re),(se||oe)&&S("moving",z(k,F,U,Y)),se||oe},i.scaleOrSkewActionName=function(k,F,U){var Y=k[U.canvas.altActionKey];return F.x===0?Y?"skewX":"scaleY":F.y===0?Y?"skewY":"scaleX":void 0},i.rotationStyleHandler=function(k,F,U){return U.lockRotation?"not-allowed":F.cursorStyle},i.fireEvent=S,i.wrapWithFixedAnchor=te,i.wrapWithFireEvent=ee,i.getLocalPoint=O,s.controlsUtils=i}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.degreesToRadians,u=s.controlsUtils;u.renderCircleControl=function(i,n,h,g,f){g=g||{};var d,_=this.sizeX||g.cornerSize||f.cornerSize,w=this.sizeY||g.cornerSize||f.cornerSize,E=g.transparentCorners!==void 0?g.transparentCorners:f.transparentCorners,T=E?"stroke":"fill",S=!E&&(g.cornerStrokeColor||f.cornerStrokeColor),D=n,B=h;i.save(),i.fillStyle=g.cornerColor||f.cornerColor,i.strokeStyle=g.cornerStrokeColor||f.cornerStrokeColor,_>w?(d=_,i.scale(1,w/_),B=h*_/w):w>_?(d=w,i.scale(_/w,1),D=n*w/_):d=_,i.lineWidth=1,i.beginPath(),i.arc(D,B,d/2,0,2*Math.PI,!1),i[T](),S&&i.stroke(),i.restore()},u.renderSquareControl=function(i,n,h,g,f){g=g||{};var d=this.sizeX||g.cornerSize||f.cornerSize,_=this.sizeY||g.cornerSize||f.cornerSize,w=g.transparentCorners!==void 0?g.transparentCorners:f.transparentCorners,E=w?"stroke":"fill",T=!w&&(g.cornerStrokeColor||f.cornerStrokeColor),S=d/2,D=_/2;i.save(),i.fillStyle=g.cornerColor||f.cornerColor,i.strokeStyle=g.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(n,h),i.rotate(l(f.angle)),i[E+"Rect"](-S,-D,d,_),T&&i.strokeRect(-S,-D,d,_),i.restore()}}(e),function(a){var s=a.fabric||(a.fabric={});s.Control=function(l){for(var u in l)this[u]=l[u]},s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,u){return u.cursorStyle},getActionName:function(l,u){return u.actionName},getVisibility:function(l,u){var i=l._controlsVisibility;return i&&i[u]!==void 0?i[u]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,u){return s.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},u)},calcCornerCoords:function(l,u,i,n,h){var g,f,d,_,w=h?this.touchSizeX:this.sizeX,E=h?this.touchSizeY:this.sizeY;if(w&&E&&w!==E){var T=Math.atan2(E,w),S=Math.sqrt(w*w+E*E)/2,D=T-s.util.degreesToRadians(l),B=Math.PI/2-T-s.util.degreesToRadians(l);g=S*s.util.cos(D),f=S*s.util.sin(D),d=S*s.util.cos(B),_=S*s.util.sin(B)}else S=.7071067812*(w&&E?w:u),D=s.util.degreesToRadians(45-l),g=d=S*s.util.cos(D),f=_=S*s.util.sin(D);return{tl:{x:i-_,y:n-d},tr:{x:i+g,y:n-f},bl:{x:i-g,y:n+f},br:{x:i+_,y:n+d}}},render:function(l,u,i,n,h){((n=n||{}).cornerStyle||h.cornerStyle)==="circle"?s.controlsUtils.renderCircleControl.call(this,l,u,i,n,h):s.controlsUtils.renderSquareControl.call(this,l,u,i,n,h)}}}(e),function(){function a(l,u){var i,n,h,g,f=l.getAttribute("style"),d=l.getAttribute("offset")||0;if(d=(d=parseFloat(d)/(/%$/.test(d)?100:1))<0?0:d>1?1:d,f){var _=f.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),g=_.length;g--;){var w=_[g].split(/\s*:\s*/),E=w[0].trim(),T=w[1].trim();E==="stop-color"?i=T:E==="stop-opacity"&&(h=T)}}return i||(i=l.getAttribute("stop-color")||"rgb(0,0,0)"),h||(h=l.getAttribute("stop-opacity")),n=(i=new v.Color(i)).getAlpha(),h=isNaN(parseFloat(h))?1:parseFloat(h),h*=n*u,{offset:d,color:i.toRgb(),opacity:h}}var s=v.util.object.clone;v.Gradient=v.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var u,i=this;Object.keys(l).forEach(function(n){i[n]=l[n]}),this.id?this.id+="_"+v.Object.__uid++:this.id=v.Object.__uid++,u={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(u.r1=l.coords.r1||0,u.r2=l.coords.r2||0),this.coords=u,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var u in l){var i=new v.Color(l[u]);this.colorStops.push({offset:parseFloat(u),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(l){var u={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return v.util.populateWithProperties(this,u,l),u},toSVG:function(l,u){var i,n,h,g,f=s(this.coords,!0),d=(u=u||{},s(this.colorStops,!0)),_=f.r1>f.r2,w=this.gradientTransform?this.gradientTransform.concat():v.iMatrix.concat(),E=-this.offsetX,T=-this.offsetY,S=!!u.additionalTransform,D=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(d.sort(function(te,ee){return te.offset-ee.offset}),D==="objectBoundingBox"?(E/=l.width,T/=l.height):(E+=l.width/2,T+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(E-=l.pathOffset.x,T-=l.pathOffset.y),w[4]-=E,w[5]-=T,g='id="SVGID_'+this.id+'" gradientUnits="'+D+'"',g+=' gradientTransform="'+(S?u.additionalTransform+" ":"")+v.util.matrixToSVG(w)+'" ',this.type==="linear"?h=["<linearGradient ",g,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",g,' cx="',_?f.x1:f.x2,'" cy="',_?f.y1:f.y2,'" r="',_?f.r1:f.r2,'" fx="',_?f.x2:f.x1,'" fy="',_?f.y2:f.y1,`">
`]),this.type==="radial"){if(_)for((d=d.concat()).reverse(),i=0,n=d.length;i<n;i++)d[i].offset=1-d[i].offset;var B=Math.min(f.r1,f.r2);if(B>0){var X=B/Math.max(f.r1,f.r2);for(i=0,n=d.length;i<n;i++)d[i].offset+=X*(1-d[i].offset)}}for(i=0,n=d.length;i<n;i++){var z=d[i];h.push("<stop ",'offset="',100*z.offset+"%",'" style="stop-color:',z.color,z.opacity!==void 0?";stop-opacity: "+z.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(l){var u,i,n,h=v.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?u=l.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(u=l.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2)),i=0,n=this.colorStops.length;i<n;i++){var g=this.colorStops[i].color,f=this.colorStops[i].opacity,d=this.colorStops[i].offset;f!==void 0&&(g=new v.Color(g).setAlpha(f).toRgba()),u.addColorStop(d,g)}return u}}}),v.util.object.extend(v.Gradient,{fromElement:function(l,u,i,n){var h=parseFloat(i)/(/%$/.test(i)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var g,f,d,_,w=l.getElementsByTagName("stop"),E=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",T=l.getAttribute("gradientTransform")||"",S=[],D=0,B=0;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(g="linear",f=function(X){return{x1:X.getAttribute("x1")||0,y1:X.getAttribute("y1")||0,x2:X.getAttribute("x2")||"100%",y2:X.getAttribute("y2")||0}}(l)):(g="radial",f=function(X){return{x1:X.getAttribute("fx")||X.getAttribute("cx")||"50%",y1:X.getAttribute("fy")||X.getAttribute("cy")||"50%",r1:0,x2:X.getAttribute("cx")||"50%",y2:X.getAttribute("cy")||"50%",r2:X.getAttribute("r")||"50%"}}(l)),d=w.length;d--;)S.push(a(w[d],h));return _=v.parseTransformAttribute(T),function(X,z,te,ee){var O,x;Object.keys(z).forEach(function(R){(O=z[R])==="Infinity"?x=1:O==="-Infinity"?x=0:(x=parseFloat(z[R],10),typeof O=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(O)&&(x*=.01,ee==="pixels"&&(R!=="x1"&&R!=="x2"&&R!=="r2"||(x*=te.viewBoxWidth||te.width),R!=="y1"&&R!=="y2"||(x*=te.viewBoxHeight||te.height)))),z[R]=x})}(0,f,n,E),E==="pixels"&&(D=-u.left,B=-u.top),new v.Gradient({id:l.getAttribute("id"),type:g,coords:f,colorStops:S,gradientUnits:E,gradientTransform:_,offsetX:D,offsetY:B})}})}(),Z=v.util.toFixed,v.Pattern=v.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(a,s){if(a||(a={}),this.id=v.Object.__uid++,this.setOptions(a),!a.source||a.source&&typeof a.source!="string")s&&s(this);else{var l=this;this.source=v.util.createImage(),v.util.loadImage(a.source,function(u,i){l.source=u,s&&s(l,i)},null,this.crossOrigin)}},toObject:function(a){var s,l,u=v.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?s=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(s=this.source.toDataURL()),l={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:Z(this.offsetX,u),offsetY:Z(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},v.util.populateWithProperties(this,l,a),l},toSVG:function(a){var s=typeof this.source=="function"?this.source():this.source,l=s.width/a.width,u=s.height/a.height,i=this.offsetX/a.width,n=this.offsetY/a.height,h="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(u=1,n&&(u+=Math.abs(n))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(l=1,i&&(l+=Math.abs(i))),s.src?h=s.src:s.toDataURL&&(h=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+n+'" width="'+l+'" height="'+u+`">
<image x="0" y="0" width="`+s.width+'" height="'+s.height+'" xlink:href="'+h+`"></image>
</pattern>
`},setOptions:function(a){for(var s in a)this[s]=a[s]},toLive:function(a){var s=this.source;return!s||s.src!==void 0&&(!s.complete||s.naturalWidth===0||s.naturalHeight===0)?"":a.createPattern(s,this.repeat)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.toFixed;s.Shadow?s.warn("fabric.Shadow is already defined."):(s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){for(var i in typeof u=="string"&&(u=this._parseShadow(u)),u)this[i]=u[i];this.id=s.Object.__uid++},_parseShadow:function(u){var i=u.trim(),n=s.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var i=40,n=40,h=s.Object.NUM_FRACTION_DIGITS,g=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-u.angle)),f=new s.Color(this.color);return u.width&&u.height&&(i=100*l((Math.abs(g.x)+this.blur)/u.width,h)+20,n=100*l((Math.abs(g.y)+this.blur)/u.height,h)+20),u.flipX&&(g.x*=-1),u.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+i+'%" width="'+(100+2*i)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+l(g.x,h)+'" dy="'+l(g.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},i=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(n){this[n]!==i[n]&&(u[n]=this[n])},this),u}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(v.StaticCanvas)v.warn("fabric.StaticCanvas is already defined.");else{var a=v.util.object.extend,s=v.util.getElementOffset,l=v.util.removeFromArray,u=v.util.toFixed,i=v.util.transformPoint,n=v.util.invertTransform,h=v.util.getNodeCanvas,g=v.util.createCanvasElement,f=new Error("Could not initialize `canvas` element");v.StaticCanvas=v.util.createClass(v.CommonMethods,{initialize:function(d,_){_||(_={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(d,_)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:v.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(d,_){var w=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(d),this._initOptions(_),this.interactive||this._initRetinaScaling(),_.overlayImage&&this.setOverlayImage(_.overlayImage,w),_.backgroundImage&&this.setBackgroundImage(_.backgroundImage,w),_.backgroundColor&&this.setBackgroundColor(_.backgroundColor,w),_.overlayColor&&this.setOverlayColor(_.overlayColor,w),this.calcOffset()},_isRetinaScaling:function(){return v.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,v.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var d=v.devicePixelRatio;this.__initRetinaScaling(d,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(d,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(d,_,w){_.setAttribute("width",this.width*d),_.setAttribute("height",this.height*d),w.scale(d,d)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(d,_,w){return this.__setBgOverlayImage("overlayImage",d,_,w)},setBackgroundImage:function(d,_,w){return this.__setBgOverlayImage("backgroundImage",d,_,w)},setOverlayColor:function(d,_){return this.__setBgOverlayColor("overlayColor",d,_)},setBackgroundColor:function(d,_){return this.__setBgOverlayColor("backgroundColor",d,_)},__setBgOverlayImage:function(d,_,w,E){return typeof _=="string"?v.util.loadImage(_,function(T,S){if(T){var D=new v.Image(T,E);this[d]=D,D.canvas=this}w&&w(T,S)},this,E&&E.crossOrigin):(E&&_.setOptions(E),this[d]=_,_&&(_.canvas=this),w&&w(_,!1)),this},__setBgOverlayColor:function(d,_,w){return this[d]=_,this._initGradient(_,d),this._initPattern(_,d,w),this},_createCanvasElement:function(){var d=g();if(!d||(d.style||(d.style={}),d.getContext===void 0))throw f;return d},_initOptions:function(d){var _=this.lowerCanvasEl;this._setOptions(d),this.width=this.width||parseInt(_.width,10)||0,this.height=this.height||parseInt(_.height,10)||0,this.lowerCanvasEl.style&&(_.width=this.width,_.height=this.height,_.style.width=this.width+"px",_.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(d){d&&d.getContext?this.lowerCanvasEl=d:this.lowerCanvasEl=v.util.getById(d)||this._createCanvasElement(),v.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(d,_){return this.setDimensions({width:d},_)},setHeight:function(d,_){return this.setDimensions({height:d},_)},setDimensions:function(d,_){var w;for(var E in _=_||{},d)w=d[E],_.cssOnly||(this._setBackstoreDimension(E,d[E]),w+="px",this.hasLostContext=!0),_.backstoreOnly||this._setCssDimension(E,w);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),_.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(d,_){return this.lowerCanvasEl[d]=_,this.upperCanvasEl&&(this.upperCanvasEl[d]=_),this.cacheCanvasEl&&(this.cacheCanvasEl[d]=_),this[d]=_,this},_setCssDimension:function(d,_){return this.lowerCanvasEl.style[d]=_,this.upperCanvasEl&&(this.upperCanvasEl.style[d]=_),this.wrapperEl&&(this.wrapperEl.style[d]=_),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(d){var _,w,E,T=this._activeObject,S=this.backgroundImage,D=this.overlayImage;for(this.viewportTransform=d,w=0,E=this._objects.length;w<E;w++)(_=this._objects[w]).group||_.setCoords(!0);return T&&T.setCoords(),S&&S.setCoords(!0),D&&D.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(d,_){var w=d,E=this.viewportTransform.slice(0);d=i(d,n(this.viewportTransform)),E[0]=_,E[3]=_;var T=i(d,E);return E[4]+=w.x-T.x,E[5]+=w.y-T.y,this.setViewportTransform(E)},setZoom:function(d){return this.zoomToPoint(new v.Point(0,0),d),this},absolutePan:function(d){var _=this.viewportTransform.slice(0);return _[4]=-d.x,_[5]=-d.y,this.setViewportTransform(_)},relativePan:function(d){return this.absolutePan(new v.Point(-d.x-this.viewportTransform[4],-d.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(d){this.stateful&&d.setupState(),d._set("canvas",this),d.setCoords(),this.fire("object:added",{target:d}),d.fire("added")},_onObjectRemoved:function(d){this.fire("object:removed",{target:d}),d.fire("removed"),delete d.canvas},clearContext:function(d){return d.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var d=this.contextContainer;return this.renderCanvas(d,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=v.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var d={},_=this.width,w=this.height,E=n(this.viewportTransform);return d.tl=i({x:0,y:0},E),d.br=i({x:_,y:w},E),d.tr=new v.Point(d.br.x,d.tl.y),d.bl=new v.Point(d.tl.x,d.br.y),this.vptCoords=d,d},cancelRequestedRender:function(){this.isRendering&&(v.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(d,_){var w=this.viewportTransform,E=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(d),v.util.setImageSmoothing(d,this.imageSmoothingEnabled),this.fire("before:render",{ctx:d}),this._renderBackground(d),d.save(),d.transform(w[0],w[1],w[2],w[3],w[4],w[5]),this._renderObjects(d,_),d.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),E&&(E.canvas=this,E.shouldCache(),E._transformDone=!0,E.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(d)),this._renderOverlay(d),this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),this.fire("after:render",{ctx:d})},drawClipPathOnCanvas:function(d){var _=this.viewportTransform,w=this.clipPath;d.save(),d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),d.globalCompositeOperation="destination-in",w.transform(d),d.scale(1/w.zoomX,1/w.zoomY),d.drawImage(w._cacheCanvas,-w.cacheTranslationX,-w.cacheTranslationY),d.restore()},_renderObjects:function(d,_){var w,E;for(w=0,E=_.length;w<E;++w)_[w]&&_[w].render(d)},_renderBackgroundOrOverlay:function(d,_){var w=this[_+"Color"],E=this[_+"Image"],T=this.viewportTransform,S=this[_+"Vpt"];if(w||E){if(w){d.save(),d.beginPath(),d.moveTo(0,0),d.lineTo(this.width,0),d.lineTo(this.width,this.height),d.lineTo(0,this.height),d.closePath(),d.fillStyle=w.toLive?w.toLive(d,this):w,S&&d.transform(T[0],T[1],T[2],T[3],T[4],T[5]),d.transform(1,0,0,1,w.offsetX||0,w.offsetY||0);var D=w.gradientTransform||w.patternTransform;D&&d.transform(D[0],D[1],D[2],D[3],D[4],D[5]),d.fill(),d.restore()}E&&(d.save(),S&&d.transform(T[0],T[1],T[2],T[3],T[4],T[5]),E.render(d),d.restore())}},_renderBackground:function(d){this._renderBackgroundOrOverlay(d,"background")},_renderOverlay:function(d){this._renderBackgroundOrOverlay(d,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new v.Point(this.width/2,this.height/2)},centerObjectH:function(d){return this._centerObject(d,new v.Point(this.getCenterPoint().x,d.getCenterPoint().y))},centerObjectV:function(d){return this._centerObject(d,new v.Point(d.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(d){var _=this.getCenterPoint();return this._centerObject(d,_)},viewportCenterObject:function(d){var _=this.getVpCenter();return this._centerObject(d,_)},viewportCenterObjectH:function(d){var _=this.getVpCenter();return this._centerObject(d,new v.Point(_.x,d.getCenterPoint().y)),this},viewportCenterObjectV:function(d){var _=this.getVpCenter();return this._centerObject(d,new v.Point(d.getCenterPoint().x,_.y))},getVpCenter:function(){var d=this.getCenterPoint(),_=n(this.viewportTransform);return i(d,_)},_centerObject:function(d,_){return d.setPositionByOrigin(_,"center","center"),d.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(d){return this.toDatalessObject(d)},toObject:function(d){return this._toObjectMethod("toObject",d)},toDatalessObject:function(d){return this._toObjectMethod("toDatalessObject",d)},_toObjectMethod:function(d,_){var w=this.clipPath,E={version:v.version,objects:this._toObjects(d,_)};return w&&!w.excludeFromExport&&(E.clipPath=this._toObject(this.clipPath,d,_)),a(E,this.__serializeBgOverlay(d,_)),v.util.populateWithProperties(this,E,_),E},_toObjects:function(d,_){return this._objects.filter(function(w){return!w.excludeFromExport}).map(function(w){return this._toObject(w,d,_)},this)},_toObject:function(d,_,w){var E;this.includeDefaultValues||(E=d.includeDefaultValues,d.includeDefaultValues=!1);var T=d[_](w);return this.includeDefaultValues||(d.includeDefaultValues=E),T},__serializeBgOverlay:function(d,_){var w={},E=this.backgroundImage,T=this.overlayImage,S=this.backgroundColor,D=this.overlayColor;return S&&S.toObject?S.excludeFromExport||(w.background=S.toObject(_)):S&&(w.background=S),D&&D.toObject?D.excludeFromExport||(w.overlay=D.toObject(_)):D&&(w.overlay=D),E&&!E.excludeFromExport&&(w.backgroundImage=this._toObject(E,d,_)),T&&!T.excludeFromExport&&(w.overlayImage=this._toObject(T,d,_)),w},svgViewportTransformation:!0,toSVG:function(d,_){d||(d={}),d.reviver=_;var w=[];return this._setSVGPreamble(w,d),this._setSVGHeader(w,d),this.clipPath&&w.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(w,"background"),this._setSVGBgOverlayImage(w,"backgroundImage",_),this._setSVGObjects(w,_),this.clipPath&&w.push(`</g>
`),this._setSVGBgOverlayColor(w,"overlay"),this._setSVGBgOverlayImage(w,"overlayImage",_),w.push("</svg>"),w.join("")},_setSVGPreamble:function(d,_){_.suppressPreamble||d.push('<?xml version="1.0" encoding="',_.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(d,_){var w,E=_.width||this.width,T=_.height||this.height,S='viewBox="0 0 '+this.width+" "+this.height+'" ',D=v.Object.NUM_FRACTION_DIGITS;_.viewBox?S='viewBox="'+_.viewBox.x+" "+_.viewBox.y+" "+_.viewBox.width+" "+_.viewBox.height+'" ':this.svgViewportTransformation&&(w=this.viewportTransform,S='viewBox="'+u(-w[4]/w[0],D)+" "+u(-w[5]/w[3],D)+" "+u(this.width/w[0],D)+" "+u(this.height/w[3],D)+'" '),d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',E,'" ','height="',T,'" ',S,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",v.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(_),`</defs>
`)},createSVGClipPathMarkup:function(d){var _=this.clipPath;return _?(_.clipPathId="CLIPPATH_"+v.Object.__uid++,'<clipPath id="'+_.clipPathId+`" >
`+this.clipPath.toClipPathSVG(d.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var d=this;return["background","overlay"].map(function(_){var w=d[_+"Color"];if(w&&w.toLive){var E=d[_+"Vpt"],T=d.viewportTransform,S={width:d.width/(E?T[0]:1),height:d.height/(E?T[3]:1)};return w.toSVG(S,{additionalTransform:E?v.util.matrixToSVG(T):""})}}).join("")},createSVGFontFacesMarkup:function(){var d,_,w,E,T,S,D,B,X="",z={},te=v.fontPaths,ee=[];for(this._objects.forEach(function x(R){ee.push(R),R._objects&&R._objects.forEach(x)}),D=0,B=ee.length;D<B;D++)if(_=(d=ee[D]).fontFamily,d.type.indexOf("text")!==-1&&!z[_]&&te[_]&&(z[_]=!0,d.styles))for(T in w=d.styles)for(S in E=w[T])!z[_=E[S].fontFamily]&&te[_]&&(z[_]=!0);for(var O in z)X+=[`		@font-face {
`,"			font-family: '",O,`';
`,"			src: url('",te[O],`');
`,`		}
`].join("");return X&&(X=['	<style type="text/css">',`<![CDATA[
`,X,"]]>",`</style>
`].join("")),X},_setSVGObjects:function(d,_){var w,E,T,S=this._objects;for(E=0,T=S.length;E<T;E++)(w=S[E]).excludeFromExport||this._setSVGObject(d,w,_)},_setSVGObject:function(d,_,w){d.push(_.toSVG(w))},_setSVGBgOverlayImage:function(d,_,w){this[_]&&!this[_].excludeFromExport&&this[_].toSVG&&d.push(this[_].toSVG(w))},_setSVGBgOverlayColor:function(d,_){var w=this[_+"Color"],E=this.viewportTransform,T=this.width,S=this.height;if(w)if(w.toLive){var D=w.repeat,B=v.util.invertTransform(E),X=this[_+"Vpt"]?v.util.matrixToSVG(B):"";d.push('<rect transform="'+X+" translate(",T/2,",",S/2,')"',' x="',w.offsetX-T/2,'" y="',w.offsetY-S/2,'" ','width="',D==="repeat-y"||D==="no-repeat"?w.source.width:T,'" height="',D==="repeat-x"||D==="no-repeat"?w.source.height:S,'" fill="url(#SVGID_'+w.id+')"',`></rect>
`)}else d.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',w,'"',`></rect>
`)},sendToBack:function(d){if(!d)return this;var _,w,E,T=this._activeObject;if(d===T&&d.type==="activeSelection")for(_=(E=T._objects).length;_--;)w=E[_],l(this._objects,w),this._objects.unshift(w);else l(this._objects,d),this._objects.unshift(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(d){if(!d)return this;var _,w,E,T=this._activeObject;if(d===T&&d.type==="activeSelection")for(E=T._objects,_=0;_<E.length;_++)w=E[_],l(this._objects,w),this._objects.push(w);else l(this._objects,d),this._objects.push(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(d,_){if(!d)return this;var w,E,T,S,D,B=this._activeObject,X=0;if(d===B&&d.type==="activeSelection")for(D=B._objects,w=0;w<D.length;w++)E=D[w],(T=this._objects.indexOf(E))>0+X&&(S=T-1,l(this._objects,E),this._objects.splice(S,0,E)),X++;else(T=this._objects.indexOf(d))!==0&&(S=this._findNewLowerIndex(d,T,_),l(this._objects,d),this._objects.splice(S,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(d,_,w){var E,T;if(w){for(E=_,T=_-1;T>=0;--T)if(d.intersectsWithObject(this._objects[T])||d.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(d)){E=T;break}}else E=_-1;return E},bringForward:function(d,_){if(!d)return this;var w,E,T,S,D,B=this._activeObject,X=0;if(d===B&&d.type==="activeSelection")for(w=(D=B._objects).length;w--;)E=D[w],(T=this._objects.indexOf(E))<this._objects.length-1-X&&(S=T+1,l(this._objects,E),this._objects.splice(S,0,E)),X++;else(T=this._objects.indexOf(d))!==this._objects.length-1&&(S=this._findNewUpperIndex(d,T,_),l(this._objects,d),this._objects.splice(S,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(d,_,w){var E,T,S;if(w){for(E=_,T=_+1,S=this._objects.length;T<S;++T)if(d.intersectsWithObject(this._objects[T])||d.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(d)){E=T;break}}else E=_+1;return E},moveTo:function(d,_){return l(this._objects,d),this._objects.splice(_,0,d),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(v.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(d){d.dispose&&d.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),v.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),v.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(v.StaticCanvas.prototype,v.Observable),a(v.StaticCanvas.prototype,v.Collection),a(v.StaticCanvas.prototype,v.DataURLExporter),a(v.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(d){var _=g();if(!_||!_.getContext)return null;var w=_.getContext("2d");return w&&d==="setLineDash"?w.setLineDash!==void 0:null}}),v.StaticCanvas.prototype.toJSON=v.StaticCanvas.prototype.toObject,v.isLikelyNode&&(v.StaticCanvas.prototype.createPNGStream=function(){var d=h(this.lowerCanvasEl);return d&&d.createPNGStream()},v.StaticCanvas.prototype.createJPEGStream=function(d){var _=h(this.lowerCanvasEl);return _&&_.createJPEGStream(d)})}}(),v.BaseBrush=v.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(a){a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var s=this.canvas.viewportTransform;a.save(),a.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var a=this.canvas,s=this.shadow,l=a.contextTop,u=a.getZoom();a&&a._isRetinaScaling()&&(u*=v.devicePixelRatio),l.shadowColor=s.color,l.shadowBlur=s.blur*u,l.shadowOffsetX=s.offsetX*u,l.shadowOffsetY=s.offsetY*u}},needsFullRender:function(){return new v.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}}),v.PencilBrush=v.util.createClass(v.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(a){this.canvas=a,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(a,s,l){var u=s.midPointFrom(l);return a.quadraticCurveTo(s.x,s.y,u.x,u.y),u},onMouseDown:function(a,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(a),this._captureDrawingPath(a),this._render())},onMouseMove:function(a,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(a))&&this._captureDrawingPath(a)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,l[u-2],l[u-1],!0),i.stroke(),i.restore()}},onMouseUp:function(a){return!this.canvas._isMainEvent(a.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(a){var s=new v.Point(a.x,a.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(a){return!(this._points.length>1&&a.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(a),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(a){var s=new v.Point(a.x,a.y);return this._addPoint(s)},_render:function(a){var s,l,u=this._points[0],i=this._points[1];if(a=a||this.canvas.contextTop,this._saveAndTransform(a),a.beginPath(),this._points.length===2&&u.x===i.x&&u.y===i.y){var n=this.width/1e3;u=new v.Point(u.x,u.y),i=new v.Point(i.x,i.y),u.x-=n,i.x+=n}for(a.moveTo(u.x,u.y),s=1,l=this._points.length;s<l;s++)this._drawSegment(a,u,i),u=this._points[s],i=this._points[s+1];a.lineTo(u.x,u.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var s=this.width/1e3;return v.util.getSmoothPathFromPoints(a,s)},_isEmptySVGPath:function(a){return v.util.joinPath(a)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(a){var s=new v.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new v.Shadow(this.shadow)),s},decimatePoints:function(a,s){if(a.length<=2)return a;var l,u=this.canvas.getZoom(),i=Math.pow(s/u,2),n=a.length-1,h=a[0],g=[h];for(l=1;l<n-1;l++)Math.pow(h.x-a[l].x,2)+Math.pow(h.y-a[l].y,2)>=i&&(h=a[l],g.push(h));return g.push(a[n]),g},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var a=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(a))this.canvas.requestRenderAll();else{var s=this.createPath(a);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.requestRenderAll(),s.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:s})}}}),v.CircleBrush=v.util.createClass(v.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var s=this.addPoint(a),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,s),l.restore()},dot:function(a,s){a.fillStyle=s.fill,a.beginPath(),a.arc(s.x,s.y,s.radius,0,2*Math.PI,!1),a.closePath(),a.fill()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a,s,l=this.canvas.contextTop,u=this.points;for(this._saveAndTransform(l),a=0,s=u.length;a<s;a++)this.dot(l,u[a]);l.restore()},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(a),this._render()):this.drawDot(a))},onMouseUp:function(){var a,s,l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var u=[];for(a=0,s=this.points.length;a<s;a++){var i=this.points[a],n=new v.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(n.shadow=new v.Shadow(this.shadow)),u.push(n)}var h=new v.Group(u);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},addPoint:function(a){var s=new v.Point(a.x,a.y),l=v.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new v.Color(this.color).setAlpha(v.util.getRandomInt(0,100)/100).toRgba();return s.radius=l,s.fill=u,this.points.push(s),s}}),v.SprayBrush=v.util.createClass(v.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.addSprayChunk(a),this.render(this.sprayChunkPoints))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var i=this.sprayChunks[l],n=0,h=i.length;n<h;n++){var g=new v.Rect({width:i[n].width,height:i[n].width,left:i[n].x+1,top:i[n].y+1,originX:"center",originY:"center",fill:this.color});s.push(g)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var f=new v.Group(s);this.shadow&&f.set("shadow",new v.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var s,l,u,i={};for(l=0,u=a.length;l<u;l++)i[s=a[l].left+""+a[l].top]||(i[s]=a[l]);var n=[];for(s in i)n.push(i[s]);return n},render:function(a){var s,l,u=this.canvas.contextTop;for(u.fillStyle=this.color,this._saveAndTransform(u),s=0,l=a.length;s<l;s++){var i=a[s];i.opacity!==void 0&&(u.globalAlpha=i.opacity),u.fillRect(i.x,i.y,i.width,i.width)}u.restore()},_render:function(){var a,s,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),a=0,s=this.sprayChunks.length;a<s;a++)this.render(this.sprayChunks[a]);l.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var s,l,u,i,n=this.width/2;for(i=0;i<this.density;i++){s=v.util.getRandomInt(a.x-n,a.x+n),l=v.util.getRandomInt(a.y-n,a.y+n),u=this.dotWidthVariance?v.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new v.Point(s,l);h.width=u,this.randomOpacity&&(h.opacity=v.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),v.PatternBrush=v.util.createClass(v.PencilBrush,{getPatternSrc:function(){var a=v.util.createCanvasElement(),s=a.getContext("2d");return a.width=a.height=25,s.fillStyle=this.color,s.beginPath(),s.arc(10,10,10,0,2*Math.PI,!1),s.closePath(),s.fill(),a},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(a){return a.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(a){this.callSuper("_setBrushStyles",a),a.strokeStyle=this.getPattern(a)},createPath:function(a){var s=this.callSuper("createPath",a),l=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new v.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),s}}),function(){var a=v.util.getPointer,s=v.util.degreesToRadians,l=v.util.isTouchEvent;for(var u in v.Canvas=v.util.createClass(v.StaticCanvas,{initialize:function(i,n){n||(n={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,n),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=v.PencilBrush&&new v.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i,n,h,g=this.getActiveObjects();if(g.length>0&&!this.preserveObjectStacking){n=[],h=[];for(var f=0,d=this._objects.length;f<d;f++)i=this._objects[f],g.indexOf(i)===-1?n.push(i):h.push(i);g.length>1&&(this._activeObject._objects=h),n.push.apply(n,h)}else n=this._objects;return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var i=this.contextContainer;return this.renderCanvas(i,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,n){var h=i.calcTransformMatrix(),g=v.util.invertTransform(h),f=this.restorePointerVpt(n);return v.util.transformPoint(f,g)},isTargetTransparent:function(i,n,h){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var g=this._normalizePointer(i,{x:n,y:h}),f=Math.max(i.cacheTranslationX+g.x*i.zoomX,0),d=Math.max(i.cacheTranslationY+g.y*i.zoomY,0);return v.util.isTransparent(i._cacheContext,Math.round(f),Math.round(d),this.targetFindTolerance)}var _=this.contextCache,w=i.selectionBackgroundColor,E=this.viewportTransform;return i.selectionBackgroundColor="",this.clearContext(_),_.save(),_.transform(E[0],E[1],E[2],E[3],E[4],E[5]),i.render(_),_.restore(),i.selectionBackgroundColor=w,v.util.isTransparent(_,n,h,this.targetFindTolerance)},_isSelectionKeyPressed:function(i){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(n){return i[n]===!0}):i[this.selectionKey]},_shouldClearSelection:function(i,n){var h=this.getActiveObjects(),g=this._activeObject;return!n||n&&g&&h.length>1&&h.indexOf(n)===-1&&g!==n&&!this._isSelectionKeyPressed(i)||n&&!n.evented||n&&!n.selectable&&g&&g!==n},_shouldCenterTransform:function(i,n,h){var g;if(i)return n==="scale"||n==="scaleX"||n==="scaleY"||n==="resizing"?g=this.centeredScaling||i.centeredScaling:n==="rotate"&&(g=this.centeredRotation||i.centeredRotation),g?!h:h},_getOriginFromCorner:function(i,n){var h={x:i.originX,y:i.originY};return n==="ml"||n==="tl"||n==="bl"?h.x="right":n!=="mr"&&n!=="tr"&&n!=="br"||(h.x="left"),n==="tl"||n==="mt"||n==="tr"?h.y="bottom":n!=="bl"&&n!=="mb"&&n!=="br"||(h.y="top"),h},_getActionFromCorner:function(i,n,h,g){if(!n||!i)return"drag";var f=g.controls[n];return f.getActionName(h,f,g)},_setupCurrentTransform:function(i,n,h){if(n){var g=this.getPointer(i),f=n.__corner,d=n.controls[f],_=h&&f?d.getActionHandler(i,n,d):v.controlsUtils.dragHandler,w=this._getActionFromCorner(h,f,i,n),E=this._getOriginFromCorner(n,f),T=i[this.centeredKey],S={target:n,action:w,actionHandler:_,corner:f,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:g.x-n.left,offsetY:g.y-n.top,originX:E.x,originY:E.y,ex:g.x,ey:g.y,lastX:g.x,lastY:g.y,theta:s(n.angle),width:n.width*n.scaleX,shiftKey:i.shiftKey,altKey:T,original:v.util.saveObjectTransform(n)};this._shouldCenterTransform(n,w,T)&&(S.originX="center",S.originY="center"),S.original.originX=E.x,S.original.originY=E.y,this._currentTransform=S,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var n=this._groupSelector,h=new v.Point(n.ex,n.ey),g=v.util.transformPoint(h,this.viewportTransform),f=new v.Point(n.ex+n.left,n.ey+n.top),d=v.util.transformPoint(f,this.viewportTransform),_=Math.min(g.x,d.x),w=Math.min(g.y,d.y),E=Math.max(g.x,d.x),T=Math.max(g.y,d.y),S=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(_,w,E-_,T-w)),this.selectionLineWidth&&this.selectionBorderColor&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,_+=S,w+=S,E-=S,T-=S,v.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(_,w,E-_,T-w))},findTarget:function(i,n){if(!this.skipTargetFind){var h,g,f=this.getPointer(i,!0),d=this._activeObject,_=this.getActiveObjects(),w=l(i),E=_.length>1&&!n||_.length===1;if(this.targets=[],E&&d._findTargetCorner(f,w)||_.length>1&&!n&&d===this._searchPossibleTargets([d],f))return d;if(_.length===1&&d===this._searchPossibleTargets([d],f)){if(!this.preserveObjectStacking)return d;h=d,g=this.targets,this.targets=[]}var T=this._searchPossibleTargets(this._objects,f);return i[this.altSelectionKey]&&T&&h&&T!==h&&(T=h,this.targets=g),T}},_checkTarget:function(i,n,h){if(n&&n.visible&&n.evented&&n.containsPoint(i)&&(!this.perPixelTargetFind&&!n.perPixelTargetFind||n.isEditing||!this.isTargetTransparent(n,h.x,h.y)))return!0},_searchPossibleTargets:function(i,n){for(var h,g,f=i.length;f--;){var d=i[f],_=d.group?this._normalizePointer(d.group,n):n;if(this._checkTarget(_,d,n)){(h=i[f]).subTargetCheck&&h instanceof v.Group&&(g=this._searchPossibleTargets(h._objects,n))&&this.targets.push(g);break}}return h},restorePointerVpt:function(i){return v.util.transformPoint(i,v.util.invertTransform(this.viewportTransform))},getPointer:function(i,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var h,g=a(i),f=this.upperCanvasEl,d=f.getBoundingClientRect(),_=d.width||0,w=d.height||0;_&&w||("top"in d&&"bottom"in d&&(w=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(_=Math.abs(d.right-d.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,n||(g=this.restorePointerVpt(g));var E=this.getRetinaScaling();return E!==1&&(g.x/=E,g.y/=E),h=_===0||w===0?{width:1,height:1}:{width:f.width/_,height:f.height/w},{x:g.x*h.width,y:g.y*h.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),n=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),v.util.addClass(h,"upper-canvas "+i),this.wrapperEl.appendChild(h),this._copyCanvasStyle(n,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=v.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),v.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),v.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var n=this.width||i.width,h=this.height||i.height;v.util.setStyle(i,{position:"absolute",width:n+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=n,i.height=h,v.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,n){n.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?i.type==="activeSelection"&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,n){var h=!1,g=this.getActiveObjects(),f=[],d=[];i.forEach(function(_){g.indexOf(_)===-1&&(h=!0,_.fire("deselected",{e:n,target:_}),d.push(_))}),g.forEach(function(_){i.indexOf(_)===-1&&(h=!0,_.fire("selected",{e:n,target:_}),f.push(_))}),i.length>0&&g.length>0?h&&this.fire("selection:updated",{e:n,selected:f,deselected:d}):g.length>0?this.fire("selection:created",{e:n,selected:f}):i.length>0&&this.fire("selection:cleared",{e:n,deselected:d})},setActiveObject:function(i,n){var h=this.getActiveObjects();return this._setActiveObject(i,n),this._fireSelectionEvents(h,n),this},_setActiveObject:function(i,n){return this._activeObject!==i&&!!this._discardActiveObject(n,i)&&!i.onSelect({e:n})&&(this._activeObject=i,!0)},_discardActiveObject:function(i,n){var h=this._activeObject;if(h){if(h.onDeselect({e:i,object:n}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var n=this.getActiveObjects(),h=this.getActiveObject();return n.length&&this.fire("before:selection:cleared",{target:h,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(n,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(n){v.util.cleanUpJsdomNode(this[n]),this[n]=void 0}).bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,v.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var n=this._activeObject;n&&n._renderControls(i)},_toObject:function(i,n,h){var g=this._realizeGroupTransformOnObject(i),f=this.callSuper("_toObject",i,n,h);return this._unwindGroupTransformOnObject(i,g),f},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var n={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(h){n[h]=i[h]}),v.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),n}return null},_unwindGroupTransformOnObject:function(i,n){n&&i.set(n)},_setSVGObject:function(i,n,h){var g=this._realizeGroupTransformOnObject(n);this.callSuper("_setSVGObject",i,n,h),this._unwindGroupTransformOnObject(n,g)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),v.StaticCanvas.prototype.setViewportTransform.call(this,i)}}),v.StaticCanvas)u!=="prototype"&&(v.Canvas[u]=v.StaticCanvas[u])}(),function(){var a=v.util.addListener,s=v.util.removeListener,l={passive:!1};function u(i,n){return i.button&&i.button===n-1}v.util.object.extend(v.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(a,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(i,n){var h=this.upperCanvasEl,g=this._getEventPrefix();i(v.window,"resize",this._onResize),i(h,g+"down",this._onMouseDown),i(h,g+"move",this._onMouseMove,l),i(h,g+"out",this._onMouseOut),i(h,g+"enter",this._onMouseEnter),i(h,"wheel",this._onMouseWheel),i(h,"contextmenu",this._onContextMenu),i(h,"dblclick",this._onDoubleClick),i(h,"dragover",this._onDragOver),i(h,"dragenter",this._onDragEnter),i(h,"dragleave",this._onDragLeave),i(h,"drop",this._onDrop),this.enablePointerEvents||i(h,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&n in eventjs&&(eventjs[n](h,"gesture",this._onGesture),eventjs[n](h,"drag",this._onDrag),eventjs[n](h,"orientation",this._onOrientationChange),eventjs[n](h,"shake",this._onShake),eventjs[n](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var i=this._getEventPrefix();s(v.document,i+"up",this._onMouseUp),s(v.document,"touchend",this._onTouchEnd,l),s(v.document,i+"move",this._onMouseMove,l),s(v.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(i,n){this.__onTransformGesture&&this.__onTransformGesture(i,n)},_onDrag:function(i,n){this.__onDrag&&this.__onDrag(i,n)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(i){var n=this._hoveredTarget;this.fire("mouse:out",{target:n,e:i}),this._hoveredTarget=null,n&&n.fire("mouseout",{e:i});var h=this;this._hoveredTargets.forEach(function(g){h.fire("mouse:out",{target:n,e:i}),g&&n.fire("mouseout",{e:i})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(g){g.isEditing&&g.hiddenTextarea.focus()})},_onMouseEnter:function(i){this._currentTransform||this.findTarget(i)||(this.fire("mouse:over",{target:null,e:i}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(i,n){this.__onOrientationChange&&this.__onOrientationChange(i,n)},_onShake:function(i,n){this.__onShake&&this.__onShake(i,n)},_onLongPress:function(i,n){this.__onLongPress&&this.__onLongPress(i,n)},_onDragOver:function(i){i.preventDefault();var n=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(n,i)},_onDrop:function(i){return this._simpleEventHandler("drop:before",i),this._simpleEventHandler("drop",i)},_onContextMenu:function(i){return this.stopContextMenu&&(i.stopPropagation(),i.preventDefault()),!1},_onDoubleClick:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"dblclick"),this._resetTransformEventData(i)},getPointerId:function(i){var n=i.changedTouches;return n?n[0]&&n[0].identifier:this.enablePointerEvents?i.pointerId:-1},_isMainEvent:function(i){return i.isPrimary===!0||i.isPrimary!==!1&&(i.type==="touchend"&&i.touches.length===0||!i.changedTouches||i.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(i){i.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(i)),this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();a(v.document,"touchend",this._onTouchEnd,l),a(v.document,"touchmove",this._onMouseMove,l),s(n,h+"down",this._onMouseDown)},_onMouseDown:function(i){this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();s(n,h+"move",this._onMouseMove,l),a(v.document,h+"up",this._onMouseUp),a(v.document,h+"move",this._onMouseMove,l)},_onTouchEnd:function(i){if(!(i.touches.length>0)){this.__onMouseUp(i),this._resetTransformEventData(),this.mainTouchId=null;var n=this._getEventPrefix();s(v.document,"touchend",this._onTouchEnd,l),s(v.document,"touchmove",this._onMouseMove,l);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){a(h.upperCanvasEl,n+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(i){this.__onMouseUp(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(i)&&(s(v.document,h+"up",this._onMouseUp),s(v.document,h+"move",this._onMouseMove,l),a(n,h+"move",this._onMouseMove,l))},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault(),this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var n=this._activeObject;return!!(!!n!=!!i||n&&i&&n!==i)||(n&&n.isEditing,!1)},__onMouseUp:function(i){var n,h=this._currentTransform,g=this._groupSelector,f=!1,d=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(i),n=this._target,this._handleEvent(i,"up:before"),u(i,3))this.fireRightClick&&this._handleEvent(i,"up",3,d);else{if(u(i,2))return this.fireMiddleClick&&this._handleEvent(i,"up",2,d),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(i);else if(this._isMainEvent(i)){if(h&&(this._finalizeCurrentTransform(i),f=h.actionPerformed),!d){var _=n===this._activeObject;this._maybeGroupObjects(i),f||(f=this._shouldRender(n)||!_&&n===this._activeObject)}var w,E;if(n){if(w=n._findTargetCorner(this.getPointer(i,!0),v.util.isTouchEvent(i)),n.selectable&&n!==this._activeObject&&n.activeOn==="up")this.setActiveObject(n,i),f=!0;else{var T=n.controls[w],S=T&&T.getMouseUpHandler(i,n,T);S&&S(i,h,(E=this.getPointer(i)).x,E.y)}n.isMoving=!1}if(h&&(h.target!==n||h.corner!==w)){var D=h.target&&h.target.controls[h.corner],B=D&&D.getMouseUpHandler(i,n,T);E=E||this.getPointer(i),B&&B(i,h,E.x,E.y)}this._setCursorFromEvent(i,n),this._handleEvent(i,"up",1,d),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=0),f?this.requestRenderAll():d||this.renderTop()}}},_simpleEventHandler:function(i,n){var h=this.findTarget(n),g=this.targets,f={e:n,target:h,subTargets:g};if(this.fire(i,f),h&&h.fire(i,f),!g)return h;for(var d=0;d<g.length;d++)g[d].fire(i,f);return h},_handleEvent:function(i,n,h,g){var f=this._target,d=this.targets||[],_={e:i,target:f,subTargets:d,button:h||1,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};n==="up"&&(_.currentTarget=this.findTarget(i),_.currentSubTargets=this.targets),this.fire("mouse:"+n,_),f&&f.fire("mouse"+n,_);for(var w=0;w<d.length;w++)d[w].fire("mouse"+n,_)},_finalizeCurrentTransform:function(i){var n=this._currentTransform,h=n.target,g={e:i,target:h,transform:n,action:n.action};h._scaling&&(h._scaling=!1),h.setCoords(),(n.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(i).requestRenderAll();var n=this.getPointer(i);this.freeDrawingBrush.onMouseDown(n,{e:i,pointer:n}),this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var n=this.getPointer(i);this.freeDrawingBrush.onMouseMove(n,{e:i,pointer:n})}this.setCursor(this.freeDrawingCursor),this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){var n=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:n}),this._handleEvent(i,"up")},__onMouseDown:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"down:before");var n=this._target;if(u(i,3))this.fireRightClick&&this._handleEvent(i,"down",3);else if(u(i,2))this.fireMiddleClick&&this._handleEvent(i,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(i);else if(this._isMainEvent(i)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var g=this._shouldRender(n),f=this._shouldGroup(i,n);if(this._shouldClearSelection(i,n)?this.discardActiveObject(i):f&&(this._handleGrouping(i,n),n=this._activeObject),!this.selection||n&&(n.selectable||n.isEditing||n===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),n){var d=n===this._activeObject;n.selectable&&n.activeOn==="down"&&this.setActiveObject(n,i);var _=n._findTargetCorner(this.getPointer(i,!0),v.util.isTouchEvent(i));if(n.__corner=_,n===this._activeObject&&(_||!f)){this._setupCurrentTransform(i,n,d);var w=n.controls[_],E=(h=this.getPointer(i),w&&w.getMouseDownHandler(i,n,w));E&&E(i,this._currentTransform,h.x,h.y)}}this._handleEvent(i,"down"),(g||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData(),this._pointer=this.getPointer(i,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(i){var n=this._currentTransform;this.stateful&&n.target.saveState(),this.fire("before:transform",{e:i,transform:n})},__onMouseMove:function(i){var n,h;if(this._handleEvent(i,"move:before"),this._cacheTransformEventData(i),this.isDrawingMode)this._onMouseMoveInDrawingMode(i);else if(this._isMainEvent(i)){var g=this._groupSelector;g?(h=this._absolutePointer,g.left=h.x-g.ex,g.top=h.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(i):(n=this.findTarget(i)||null,this._setCursorFromEvent(i,n),this._fireOverOutEvents(n,i)),this._handleEvent(i,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(i,n){var h=this._hoveredTarget,g=this._hoveredTargets,f=this.targets,d=Math.max(g.length,f.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<d;_++)this.fireSyntheticInOutEvents(f[_],n,{oldTarget:g[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(i,n){var h=this._draggedoverTarget,g=this._hoveredTargets,f=this.targets,d=Math.max(g.length,f.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<d;_++)this.fireSyntheticInOutEvents(f[_],n,{oldTarget:g[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=i},fireSyntheticInOutEvents:function(i,n,h){var g,f,d,_=h.oldTarget,w=_!==i,E=h.canvasEvtIn,T=h.canvasEvtOut;w&&(g={e:n,target:i,previousTarget:_},f={e:n,target:_,nextTarget:i}),d=i&&w,_&&w&&(T&&this.fire(T,f),_.fire(h.evtOut,f)),d&&(E&&this.fire(E,g),i.fire(h.evtIn,g))},__onMouseWheel:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"wheel"),this._resetTransformEventData()},_transformObject:function(i){var n=this.getPointer(i),h=this._currentTransform;h.reset=!1,h.shiftKey=i.shiftKey,h.altKey=i[this.centeredKey],this._performTransformAction(i,h,n),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(i,n,h){var g=h.x,f=h.y,d=n.action,_=!1,w=n.actionHandler;w&&(_=w(i,n,g,f)),d==="drag"&&_&&(n.target.isMoving=!0,this.setCursor(n.target.moveCursor||this.moveCursor)),n.actionPerformed=n.actionPerformed||_},_fire:v.controlsUtils.fireEvent,_setCursorFromEvent:function(i,n){if(!n)return this.setCursor(this.defaultCursor),!1;var h=n.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!g||!g.contains(n))&&n._findTargetCorner(this.getPointer(i,!0));f?this.setCursor(this.getCornerCursor(f,n,i)):(n.subTargetCheck&&this.targets.concat().reverse().map(function(d){h=d.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(i,n,h){var g=n.controls[i];return g.cursorStyleHandler(h,g,n)}})}(),q=Math.min,J=Math.max,v.util.object.extend(v.Canvas.prototype,{_shouldGroup:function(a,s){var l=this._activeObject;return l&&this._isSelectionKeyPressed(a)&&s&&s.selectable&&this.selection&&(l!==s||l.type==="activeSelection")&&!s.onSelect({e:a})},_handleGrouping:function(a,s){var l=this._activeObject;l.__corner||(s!==l||(s=this.findTarget(a,!0))&&s.selectable)&&(l&&l.type==="activeSelection"?this._updateActiveSelection(s,a):this._createActiveSelection(s,a))},_updateActiveSelection:function(a,s){var l=this._activeObject,u=l._objects.slice(0);l.contains(a)?(l.removeWithUpdate(a),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat(),l.size()===1&&this._setActiveObject(l.item(0),s)):(l.addWithUpdate(a),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(u,s)},_createActiveSelection:function(a,s){var l=this.getActiveObjects(),u=this._createGroup(a);this._hoveredTarget=u,this._setActiveObject(u,s),this._fireSelectionEvents(l,s)},_createGroup:function(a){var s=this._objects,l=s.indexOf(this._activeObject)<s.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new v.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(a){var s,l=this._collectObjects(a);l.length===1?this.setActiveObject(l[0],a):l.length>1&&(s=new v.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(s,a))},_collectObjects:function(a){for(var s,l=[],u=this._groupSelector.ex,i=this._groupSelector.ey,n=u+this._groupSelector.left,h=i+this._groupSelector.top,g=new v.Point(q(u,n),q(i,h)),f=new v.Point(J(u,n),J(i,h)),d=!this.selectionFullyContained,_=u===n&&i===h,w=this._objects.length;w--&&!((s=this._objects[w])&&s.selectable&&s.visible&&(d&&s.intersectsWithRect(g,f,!0)||s.isContainedWithinRect(g,f,!0)||d&&s.containsPoint(g,null,!0)||d&&s.containsPoint(f,null,!0))&&(l.push(s),_)););return l.length>1&&(l=l.filter(function(E){return!E.onSelect({e:a})})),l},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null}}),v.util.object.extend(v.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var s=a.format||"png",l=a.quality||1,u=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(u,a);return v.util.toDataURL(i,s,l)},toCanvasElement:function(a,s){a=a||1;var l=((s=s||{}).width||this.width)*a,u=(s.height||this.height)*a,i=this.getZoom(),n=this.width,h=this.height,g=i*a,f=this.viewportTransform,d=(f[4]-(s.left||0))*a,_=(f[5]-(s.top||0))*a,w=this.interactive,E=[g,0,0,g,d,_],T=this.enableRetinaScaling,S=v.util.createCanvasElement(),D=this.contextTop;return S.width=l,S.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=E,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(S.getContext("2d"),this._objects),this.viewportTransform=f,this.width=n,this.height=h,this.calcViewportBoundaries(),this.interactive=w,this.enableRetinaScaling=T,this.contextTop=D,S}}),v.util.object.extend(v.StaticCanvas.prototype,{loadFromJSON:function(a,s,l){if(a){var u=typeof a=="string"?JSON.parse(a):v.util.object.clone(a),i=this,n=u.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(g){i.clear(),i._setBgOverlay(u,function(){n?i._enlivenObjects([n],function(f){i.clipPath=f[0],i.__setupCanvas.call(i,u,g,h,s)}):i.__setupCanvas.call(i,u,g,h,s)})},l),this}},__setupCanvas:function(a,s,l,u){var i=this;s.forEach(function(n,h){i.insertAt(n,h)}),this.renderOnAddRemove=l,delete a.objects,delete a.backgroundImage,delete a.overlayImage,delete a.background,delete a.overlay,this._setOptions(a),this.renderAll(),u&&u()},_setBgOverlay:function(a,s){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(a.backgroundImage||a.overlayImage||a.background||a.overlay){var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",a.backgroundImage,l,u),this.__setBgOverlay("overlayImage",a.overlayImage,l,u),this.__setBgOverlay("backgroundColor",a.background,l,u),this.__setBgOverlay("overlayColor",a.overlay,l,u)}else s&&s()},__setBgOverlay:function(a,s,l,u){var i=this;if(!s)return l[a]=!0,void(u&&u());a==="backgroundImage"||a==="overlayImage"?v.util.enlivenObjects([s],function(n){i[a]=n[0],l[a]=!0,u&&u()}):this["set"+v.util.string.capitalize(a,!0)](s,function(){l[a]=!0,u&&u()})},_enlivenObjects:function(a,s,l){a&&a.length!==0?v.util.enlivenObjects(a,function(u){s&&s(u)},null,l):s&&s([])},_toDataURL:function(a,s){this.clone(function(l){s(l.toDataURL(a))})},_toDataURLWithMultiplier:function(a,s,l){this.clone(function(u){l(u.toDataURLWithMultiplier(a,s))})},clone:function(a,s){var l=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){a&&a(u)})})},cloneWithoutData:function(a){var s=v.util.createCanvasElement();s.width=this.width,s.height=this.height;var l=new v.Canvas(s);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),a&&a(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):a&&a(l)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,n=s.util.string.capitalize,h=s.util.degreesToRadians,g=!s.isLikelyNode;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:g,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var d=s.perfLimitSizeTotal,_=f.width,w=f.height,E=s.maxCacheSideLimit,T=s.minCacheSideLimit;if(_<=E&&w<=E&&_*w<=d)return _<T&&(f.width=T),w<T&&(f.height=T),f;var S=_/w,D=s.util.limitDimsByArea(S,d),B=s.util.capValue,X=B(T,D.x,E),z=B(T,D.y,E);return _>X&&(f.zoomX/=_/X,f.width=X,f.capped=!0),w>z&&(f.zoomY/=w/z,f.height=z,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),d=this._getTransformedDimensions(0,0),_=d.x*f.scaleX/this.scaleX,w=d.y*f.scaleY/this.scaleY;return{width:_+2,height:w+2,zoomX:f.scaleX,zoomY:f.scaleY,x:_,y:w}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var d=f._currentTransform.target,_=f._currentTransform.action;if(this===d&&_.slice&&_.slice(0,5)==="scale")return!1}var w,E,T=this._cacheCanvas,S=this._limitCacheSize(this._getCacheCanvasDimensions()),D=s.minCacheSideLimit,B=S.width,X=S.height,z=S.zoomX,te=S.zoomY,ee=B!==this.cacheWidth||X!==this.cacheHeight,O=this.zoomX!==z||this.zoomY!==te,x=ee||O,R=0,N=0,G=!1;if(ee){var W=this._cacheCanvas.width,k=this._cacheCanvas.height,F=B>W||X>k;G=F||(B<.9*W||X<.9*k)&&W>D&&k>D,F&&!S.capped&&(B>D||X>D)&&(R=.1*B,N=.1*X)}return this instanceof s.Text&&this.path&&(x=!0,G=!0,R+=this.getHeightOfLine(0)*this.zoomX,N+=this.getHeightOfLine(0)*this.zoomY),!!x&&(G?(T.width=Math.ceil(B+R),T.height=Math.ceil(X+N)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,T.width,T.height)),w=S.x/2,E=S.y/2,this.cacheTranslationX=Math.round(T.width/2-w)+w,this.cacheTranslationY=Math.round(T.height/2-E)+E,this.cacheWidth=B,this.cacheHeight=X,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(z,te),this.zoomX=z,this.zoomY=te,!0)},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var d=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,_=this.calcTransformMatrix(!d);f.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(f){var d=s.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:i(this.left,d),top:i(this.top,d),width:i(this.width,d),height:i(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,d),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,d),scaleX:i(this.scaleX,d),scaleY:i(this.scaleY,d),angle:i(this.angle,d),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,d),skewY:i(this.skewY,d)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(f),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,_,f),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var d=s.util.getKlass(f.type).prototype;return d.stateProperties.forEach(function(_){_!=="left"&&_!=="top"&&(f[_]===d[_]&&delete f[_],Array.isArray(f[_])&&Array.isArray(d[_])&&f[_].length===0&&d[_].length===0&&delete f[_])}),f},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),d=f.scaleX,_=f.scaleY;if(this.canvas){var w=this.canvas.getZoom(),E=this.canvas.getRetinaScaling();d*=w*E,_*=w*E}return{scaleX:d,scaleY:_}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,d){var _=f==="scaleX"||f==="scaleY",w=this[f]!==d,E=!1;return _&&(d=this._constrainScale(d)),f==="scaleX"&&d<0?(this.flipX=!this.flipX,d*=-1):f==="scaleY"&&d<0?(this.flipY=!this.flipY,d*=-1):f!=="shadow"||!d||d instanceof s.Shadow?f==="dirty"&&this.group&&this.group.set("dirty",d):d=new s.Shadow(d),this[f]=d,w&&(E=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,E&&this.group.set("dirty",!0)):E&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,d){if(f.save(),d.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",d.absolutePositioned){var _=s.util.invertTransform(this.calcTransformMatrix());f.transform(_[0],_[1],_[2],_[3],_[4],_[5])}d.transform(f),f.scale(1/d.zoomX,1/d.zoomY),f.drawImage(d._cacheCanvas,-d.cacheTranslationX,-d.cacheTranslationY),f.restore()},drawObject:function(f,d){var _=this.fill,w=this.stroke;d?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=_,this.stroke=w},_drawClipPath:function(f,d){d&&(d.canvas=this.canvas,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,d))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var d=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-_/2,d,_)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var d=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-d.x/2,-d.y/2,d.x,d.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,d){var _=d.stroke;_&&(f.lineWidth=d.strokeWidth,f.lineCap=d.strokeLineCap,f.lineDashOffset=d.strokeDashOffset,f.lineJoin=d.strokeLineJoin,f.miterLimit=d.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(f,_):(f.strokeStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,_)):f.strokeStyle=d.stroke)},_setFillStyles:function(f,d){var _=d.fill;_&&(_.toLive?(f.fillStyle=_.toLive(f,this),this._applyPatternGradientTransform(f,d.fill)):f.fillStyle=_)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,d){d&&d.length!==0&&(1&d.length&&d.push.apply(d,d),f.setLineDash(d))},_renderControls:function(f,d){var _,w,E,T=this.getViewportTransform(),S=this.calcTransformMatrix();w=(d=d||{}).hasBorders!==void 0?d.hasBorders:this.hasBorders,E=d.hasControls!==void 0?d.hasControls:this.hasControls,S=s.util.multiplyTransformMatrices(T,S),_=s.util.qrDecompose(S),f.save(),f.translate(_.translateX,_.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),f.rotate(h(this.group?_.angle:this.angle)),d.forActiveSelection||this.group?w&&this.drawBordersInGroup(f,_,d):w&&this.drawBorders(f,d),E&&this.drawControls(f,d),f.restore()},_setShadow:function(f){if(this.shadow){var d,_=this.shadow,w=this.canvas,E=w&&w.viewportTransform[0]||1,T=w&&w.viewportTransform[3]||1;d=_.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),w&&w._isRetinaScaling()&&(E*=s.devicePixelRatio,T*=s.devicePixelRatio),f.shadowColor=_.color,f.shadowBlur=_.blur*s.browserShadowBlurConstant*(E+T)*(d.scaleX+d.scaleY)/4,f.shadowOffsetX=_.offsetX*E*d.scaleX,f.shadowOffsetY=_.offsetY*T*d.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,d){if(!d||!d.toLive)return{offsetX:0,offsetY:0};var _=d.gradientTransform||d.patternTransform,w=-this.width/2+d.offsetX||0,E=-this.height/2+d.offsetY||0;return d.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,w,E):f.transform(1,0,0,1,w,E),_&&f.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:w,offsetY:E}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var d=this.getObjectScaling();f.scale(1/d.scaleX,1/d.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,d){var _,w=this._limitCacheSize(this._getCacheCanvasDimensions()),E=s.util.createCanvasElement(),T=this.canvas.getRetinaScaling(),S=w.x/this.scaleX/T,D=w.y/this.scaleY/T;E.width=S,E.height=D,(_=E.getContext("2d")).beginPath(),_.moveTo(0,0),_.lineTo(S,0),_.lineTo(S,D),_.lineTo(0,D),_.closePath(),_.translate(S/2,D/2),_.scale(w.zoomX/this.scaleX/T,w.zoomY/this.scaleY/T),this._applyPatternGradientTransform(_,d),_.fillStyle=d.toLive(f),_.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(T*this.scaleX/w.zoomX,T*this.scaleY/w.zoomY),f.strokeStyle=_.createPattern(E,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var d=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),d=s.util.transformPoint(d,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,d.x+=f.offsetLeft,d.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(d,"center","center")},clone:function(f,d){var _=this.toObject(d);this.constructor.fromObject?this.constructor.fromObject(_,f):s.Object._fromObject("Object",_,f)},cloneAsImage:function(f,d){var _=this.toCanvasElement(d);return f&&f(new s.Image(_)),this},toCanvasElement:function(f){f||(f={});var d=s.util,_=d.saveObjectTransform(this),w=this.group,E=this.shadow,T=Math.abs,S=(f.multiplier||1)*(f.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,f.withoutTransform&&d.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var D,B,X,z,te=s.util.createCanvasElement(),ee=this.getBoundingRect(!0,!0),O=this.shadow,x={x:0,y:0};O&&(B=O.blur,D=O.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),x.x=2*Math.round(T(O.offsetX)+B)*T(D.scaleX),x.y=2*Math.round(T(O.offsetY)+B)*T(D.scaleY)),X=ee.width+x.x,z=ee.height+x.y,te.width=Math.ceil(X),te.height=Math.ceil(z);var R=new s.StaticCanvas(te,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(R.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(R.width/2,R.height/2),"center","center");var N=this.canvas;R.add(this);var G=R.toCanvasElement(S||1,f);return this.shadow=E,this.set("canvas",N),w&&(this.group=w),this.set(_).setCoords(),R._objects=[],R.dispose(),R=null,G},toDataURL:function(f){return f||(f={}),s.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var d=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return d&&this._setOriginToCenter(),this.set("angle",f),d&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,d){d=d||this.canvas.getPointer(f);var _=new s.Point(d.x,d.y),w=this._getLeftTopCoords();return this.angle&&(_=s.util.rotatePoint(_,w,h(-this.angle))),{x:_.x-w.x,y:_.y-w.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),l(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(f,d,_,w){var E=s[f];d=u(d,!0),s.util.enlivenPatterns([d.fill,d.stroke],function(T){T[0]!==void 0&&(d.fill=T[0]),T[1]!==void 0&&(d.stroke=T[1]),s.util.enlivenObjectEnlivables(d,d,function(){var S=w?new E(d[w],d):new E(d);_&&_(S)})})},s.Object.__uid=0)}(e),ie=v.util.degreesToRadians,ne={left:-.5,center:0,right:.5},he={top:-.5,center:0,bottom:.5},v.util.object.extend(v.Object.prototype,{translateToGivenOrigin:function(a,s,l,u,i){var n,h,g,f=a.x,d=a.y;return typeof s=="string"?s=ne[s]:s-=.5,typeof u=="string"?u=ne[u]:u-=.5,typeof l=="string"?l=he[l]:l-=.5,typeof i=="string"?i=he[i]:i-=.5,h=i-l,((n=u-s)||h)&&(g=this._getTransformedDimensions(),f=a.x+n*g.x,d=a.y+h*g.y),new v.Point(f,d)},translateToCenterPoint:function(a,s,l){var u=this.translateToGivenOrigin(a,s,l,"center","center");return this.angle?v.util.rotatePoint(u,a,ie(this.angle)):u},translateToOriginPoint:function(a,s,l){var u=this.translateToGivenOrigin(a,"center","center",s,l);return this.angle?v.util.rotatePoint(u,a,ie(this.angle)):u},getCenterPoint:function(){var a=new v.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,s){var l=this.getCenterPoint();return this.translateToOriginPoint(l,a,s)},toLocalPoint:function(a,s,l){var u,i,n=this.getCenterPoint();return u=s!==void 0&&l!==void 0?this.translateToGivenOrigin(n,"center","center",s,l):new v.Point(this.left,this.top),i=new v.Point(a.x,a.y),this.angle&&(i=v.util.rotatePoint(i,n,-ie(this.angle))),i.subtractEquals(u)},setPositionByOrigin:function(a,s,l){var u=this.translateToCenterPoint(a,s,l),i=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(a){var s,l,u=ie(this.angle),i=this.getScaledWidth(),n=v.util.cos(u)*i,h=v.util.sin(u)*i;s=typeof this.originX=="string"?ne[this.originX]:this.originX-.5,l=typeof a=="string"?ne[a]:a-.5,this.left+=n*(l-s),this.top+=h*(l-s),this.setCoords(),this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var a=v.util,s=a.degreesToRadians,l=a.multiplyTransformMatrices,u=a.transformPoint;a.object.extend(v.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(i,n){return n?i?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),i?this.aCoords:this.lineCoords)},getCoords:function(i,n){return h=this._getCoords(i,n),[new v.Point(h.tl.x,h.tl.y),new v.Point(h.tr.x,h.tr.y),new v.Point(h.br.x,h.br.y),new v.Point(h.bl.x,h.bl.y)];var h},intersectsWithRect:function(i,n,h,g){var f=this.getCoords(h,g);return v.Intersection.intersectPolygonRectangle(f,i,n).status==="Intersection"},intersectsWithObject:function(i,n,h){return v.Intersection.intersectPolygonPolygon(this.getCoords(n,h),i.getCoords(n,h)).status==="Intersection"||i.isContainedWithinObject(this,n,h)||this.isContainedWithinObject(i,n,h)},isContainedWithinObject:function(i,n,h){for(var g=this.getCoords(n,h),f=n?i.aCoords:i.lineCoords,d=0,_=i._getImageLines(f);d<4;d++)if(!i.containsPoint(g[d],_))return!1;return!0},isContainedWithinRect:function(i,n,h,g){var f=this.getBoundingRect(h,g);return f.left>=i.x&&f.left+f.width<=n.x&&f.top>=i.y&&f.top+f.height<=n.y},containsPoint:function(i,n,h,g){var f=this._getCoords(h,g),d=(n=n||this._getImageLines(f),this._findCrossPoints(i,n));return d!==0&&d%2==1},isOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.getCoords(!0,i).some(function(g){return g.x<=h.x&&g.x>=n.x&&g.y<=h.y&&g.y>=n.y})||!!this.intersectsWithRect(n,h,!0,i)||this._containsCenterOfCanvas(n,h,i)},_containsCenterOfCanvas:function(i,n,h){var g={x:(i.x+n.x)/2,y:(i.y+n.y)/2};return!!this.containsPoint(g,null,!0,h)},isPartiallyOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.intersectsWithRect(n,h,!0,i)||this.getCoords(!0,i).every(function(g){return(g.x>=h.x||g.x<=n.x)&&(g.y>=h.y||g.y<=n.y)})&&this._containsCenterOfCanvas(n,h,i)},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_findCrossPoints:function(i,n){var h,g,f,d=0;for(var _ in n)if(!((f=n[_]).o.y<i.y&&f.d.y<i.y||f.o.y>=i.y&&f.d.y>=i.y||(f.o.x===f.d.x&&f.o.x>=i.x?g=f.o.x:(h=(f.d.y-f.o.y)/(f.d.x-f.o.x),g=-(i.y-0*i.x-(f.o.y-h*f.o.x))/(0-h)),g>=i.x&&(d+=1),d!==2)))break;return d},getBoundingRect:function(i,n){var h=this.getCoords(i,n);return a.makeBoundingBoxFromPoints(h)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(i){return Math.abs(i)<this.minScaleLimit?i<0?-this.minScaleLimit:this.minScaleLimit:i===0?1e-4:i},scale:function(i){return this._set("scaleX",i),this._set("scaleY",i),this.setCoords()},scaleToWidth:function(i,n){var h=this.getBoundingRect(n).width/this.getScaledWidth();return this.scale(i/this.width/h)},scaleToHeight:function(i,n){var h=this.getBoundingRect(n).height/this.getScaledHeight();return this.scale(i/this.height/h)},calcLineCoords:function(){var i=this.getViewportTransform(),n=this.padding,h=s(this.angle),g=a.cos(h)*n,f=a.sin(h)*n,d=g+f,_=g-f,w=this.calcACoords(),E={tl:u(w.tl,i),tr:u(w.tr,i),bl:u(w.bl,i),br:u(w.br,i)};return n&&(E.tl.x-=_,E.tl.y-=d,E.tr.x+=d,E.tr.y-=_,E.bl.x-=d,E.bl.y+=_,E.br.x+=_,E.br.y+=d),E},calcOCoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),h=this.getViewportTransform(),g=l(h,n),f=l(g,i),d=(f=l(f,[1/h[0],0,0,1/h[3],0,0]),this._calculateCurrentDimensions()),_={};return this.forEachControl(function(w,E,T){_[E]=w.positionHandler(d,f,T)}),_},calcACoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),h=l(n,i),g=this._getTransformedDimensions(),f=g.x/2,d=g.y/2;return{tl:u({x:-f,y:-d},h),tr:u({x:f,y:-d},h),bl:u({x:-f,y:d},h),br:u({x:f,y:d},h)}},setCoords:function(i){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),i||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return a.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var i=this.getCenterPoint();return[1,0,0,1,i.x,i.y]},transformMatrixKey:function(i){var n="_",h="";return!i&&this.group&&(h=this.group.transformMatrixKey(i)+n),h+this.top+n+this.left+n+this.scaleX+n+this.scaleY+n+this.skewX+n+this.skewY+n+this.angle+n+this.originX+n+this.originY+n+this.width+n+this.height+n+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var n=this.calcOwnMatrix();if(i||!this.group)return n;var h=this.transformMatrixKey(i),g=this.matrixCache||(this.matrixCache={});return g.key===h?g.value:(this.group&&(n=l(this.group.calcTransformMatrix(!1),n)),g.key=h,g.value=n,n)},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),n=this.ownMatrixCache||(this.ownMatrixCache={});if(n.key===i)return n.value;var h=this._calcTranslateMatrix(),g={angle:this.angle,translateX:h[4],translateY:h[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return n.key=i,n.value=a.composeMatrix(g),n.value},_getNonTransformedDimensions:function(){var i=this.strokeWidth;return{x:this.width+i,y:this.height+i}},_getTransformedDimensions:function(i,n){i===void 0&&(i=this.skewX),n===void 0&&(n=this.skewY);var h,g,f,d=i===0&&n===0;if(this.strokeUniform?(g=this.width,f=this.height):(g=(h=this._getNonTransformedDimensions()).x,f=h.y),d)return this._finalizeDimensions(g*this.scaleX,f*this.scaleY);var _=a.sizeAfterTransform(g,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:n});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(i,n){return this.strokeUniform?{x:i+this.strokeWidth,y:n+this.strokeWidth}:{x:i,y:n}},_calculateCurrentDimensions:function(){var i=this.getViewportTransform(),n=this._getTransformedDimensions();return u(n,i,!0).scalarAdd(2*this.padding)}})}(),v.util.object.extend(v.Object.prototype,{sendToBack:function(){return this.group?v.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?v.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?v.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas&&this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?v.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas&&this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&this.group.type!=="activeSelection"?v.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas&&this.canvas.moveTo(this,a),this}}),function(){function a(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var i=new v.Color(u),n=l+": "+i.toRgb()+"; ",h=i.getAlpha();return h!==1&&(n+=l+"-opacity: "+h.toString()+"; "),n}return l+": none; "}var s=v.util.toFixed;v.util.object.extend(v.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",g=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",d=this.strokeMiterLimit?this.strokeMiterLimit:"4",_=this.opacity!==void 0?this.opacity:"1",w=this.visible?"":" visibility: hidden;",E=l?"":this.getSvgFilter(),T=a("fill",this.fill);return[a("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",g,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",d,"; ",T,"fill-rule: ",u,"; ","opacity: ",_,";",E,w].join("")},getSvgSpanStyles:function(l,u){var i="; ",n=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+i:"",h=l.strokeWidth?"stroke-width: "+l.strokeWidth+i:"",g=l.fontSize?"font-size: "+l.fontSize+"px"+i:"",f=l.fontStyle?"font-style: "+l.fontStyle+i:"",d=l.fontWeight?"font-weight: "+l.fontWeight+i:"",_=l.fill?a("fill",l.fill):"",w=l.stroke?a("stroke",l.stroke):"",E=this.getSvgTextDecoration(l);return E&&(E="text-decoration: "+E+i),[w,h,n,g,f,d,E,_,l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"",u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var i=l?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+v.util.matrixToSVG(i)+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=v.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,u),'" y="',s(-this.height/2,u),'" width="',s(this.width,u),'" height="',s(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){var i=(u=u||{}).reviver,n=u.additionalTransform||"",h=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),g=l.indexOf("COMMON_PARTS");return l[g]=h,i?i(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){var i,n,h=(u=u||{}).noStyle,g=u.reviver,f=h?"":'style="'+this.getSvgStyles()+'" ',d=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",_=this.clipPath,w=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",E=_&&_.absolutePositioned,T=this.stroke,S=this.fill,D=this.shadow,B=[],X=l.indexOf("COMMON_PARTS"),z=u.additionalTransform;return _&&(_.clipPathId="CLIPPATH_"+v.Object.__uid++,n='<clipPath id="'+_.clipPathId+`" >
`+_.toClipPathSVG(g)+`</clipPath>
`),E&&B.push("<g ",d,this.getSvgCommons(),` >
`),B.push("<g ",this.getSvgTransform(!1),E?"":d+this.getSvgCommons(),` >
`),i=[f,w,h?"":this.addPaintOrder()," ",z?'transform="'+z+'" ':""].join(""),l[X]=i,S&&S.toLive&&B.push(S.toSVG(this)),T&&T.toLive&&B.push(T.toSVG(this)),D&&B.push(D.toSVG(this)),_&&B.push(n),B.push(l.join("")),B.push(`</g>
`),E&&B.push(`</g>
`),g?g(B.join("")):B.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var a=v.util.object.extend,s="stateProperties";function l(i,n,h){var g={};h.forEach(function(f){g[f]=i[f]}),a(i[n],g,!0)}function u(i,n,h){if(i===n)return!0;if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(var g=0,f=i.length;g<f;g++)if(!u(i[g],n[g]))return!1;return!0}if(i&&typeof i=="object"){var d,_=Object.keys(i);if(!n||typeof n!="object"||!h&&_.length!==Object.keys(n).length)return!1;for(g=0,f=_.length;g<f;g++)if((d=_[g])!=="canvas"&&d!=="group"&&!u(i[d],n[d]))return!1;return!0}}v.util.object.extend(v.Object.prototype,{hasStateChanged:function(i){var n="_"+(i=i||s);return Object.keys(this[n]).length<this[i].length||!u(this[n],this,!0)},saveState:function(i){var n=i&&i.propertySet||s,h="_"+n;return this[h]?(l(this,h,this[n]),i&&i.stateProperties&&l(this,h,i.stateProperties),this):this.setupState(i)},setupState:function(i){var n=(i=i||{}).propertySet||s;return i.propertySet=n,this["_"+n]={},this.saveState(i),this}})}(),function(){var a=v.util.degreesToRadians;v.util.object.extend(v.Object.prototype,{_findTargetCorner:function(s,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u,i,n,h=s.x,g=s.y,f=Object.keys(this.oCoords),d=f.length-1;for(this.__corner=0;d>=0;d--)if(n=f[d],this.isControlVisible(n)&&(i=this._getImageLines(l?this.oCoords[n].touchCorner:this.oCoords[n].corner),(u=this._findCrossPoints({x:h,y:g},i))!==0&&u%2==1))return this.__corner=n,n;return!1},forEachControl:function(s){for(var l in this.controls)s(this.controls[l],l,this)},_setCornerCoords:function(){var s=this.oCoords;for(var l in s){var u=this.controls[l];s[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,s[l].x,s[l].y,!1),s[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,s[l].x,s[l].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return s.translate(l.x,l.y),s.scale(1/i[0],1/i[3]),s.rotate(a(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),s.restore(),this},drawBorders:function(s,l){l=l||{};var u=this._calculateCurrentDimensions(),i=this.borderScaleFactor,n=u.x+i,h=u.y+i,g=l.hasControls!==void 0?l.hasControls:this.hasControls,f=!1;return s.save(),s.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(s,l.borderDashArray||this.borderDashArray),s.strokeRect(-n/2,-h/2,n,h),g&&(s.beginPath(),this.forEachControl(function(d,_,w){d.withConnection&&d.getVisibility(w,_)&&(f=!0,s.moveTo(d.x*n,d.y*h),s.lineTo(d.x*n+d.offsetX,d.y*h+d.offsetY))}),f&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,l,u){u=u||{};var i=v.util.sizeAfterTransform(this.width,this.height,l),n=this.strokeWidth,h=this.strokeUniform,g=this.borderScaleFactor,f=i.x+n*(h?this.canvas.getZoom():l.scaleX)+g,d=i.y+n*(h?this.canvas.getZoom():l.scaleY)+g;return s.save(),this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeStyle=u.borderColor||this.borderColor,s.strokeRect(-f/2,-d/2,f,d),s.restore(),this},drawControls:function(s,l){l=l||{},s.save();var u,i,n=this.canvas.getRetinaScaling();return s.setTransform(n,0,0,n,0,0),s.strokeStyle=s.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(u=this.group.calcTransformMatrix()),this.forEachControl(function(h,g,f){i=f.oCoords[g],h.getVisibility(f,g)&&(u&&(i=v.util.transformPoint(i,u)),h.render(s,i.x,i.y,l,f))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=l,this},setControlsVisibility:function(s){for(var l in s||(s={}),s)this.setControlVisible(l,s[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),v.util.object.extend(v.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,i=s.onChange||l,n=this;return v.util.animate({target:this,startValue:a.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){a.set("left",h),n.requestRenderAll(),i()},onComplete:function(){a.setCoords(),u()}})},fxCenterObjectV:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,i=s.onChange||l,n=this;return v.util.animate({target:this,startValue:a.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){a.set("top",h),n.requestRenderAll(),i()},onComplete:function(){a.setCoords(),u()}})},fxRemove:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,i=s.onChange||l,n=this;return v.util.animate({target:this,startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){a.set("opacity",h),n.requestRenderAll(),i()},onComplete:function(){n.remove(a),u()}})}}),v.util.object.extend(v.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var a,s,l=[],u=[];for(a in arguments[0])l.push(a);for(var i=0,n=l.length;i<n;i++)a=l[i],s=i!==n-1,u.push(this._animate(a,arguments[0][a],arguments[1],s));return u}return this._animate.apply(this,arguments)},_animate:function(a,s,l,u){var i,n=this;s=s.toString(),l=l?v.util.object.clone(l):{},~a.indexOf(".")&&(i=a.split("."));var h=n.colorProperties.indexOf(a)>-1||i&&n.colorProperties.indexOf(i[1])>-1,g=i?this.get(i[0])[i[1]]:this.get(a);"from"in l||(l.from=g),h||(s=~s.indexOf("=")?g+parseFloat(s.replace("=","")):parseFloat(s));var f={target:this,startValue:l.from,endValue:s,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(d,_,w){return l.abort.call(n,d,_,w)},onChange:function(d,_,w){i?n[i[0]][i[1]]=d:n.set(a,d),u||l.onChange&&l.onChange(d,_,w)},onComplete:function(d,_,w){u||(n.setCoords(),l.onComplete&&l.onComplete(d,_,w))}};return h?v.util.animateColor(f.startValue,f.endValue,f.duration,f):v.util.animate(f)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};function n(h,g){var f=h.origin,d=h.axis1,_=h.axis2,w=h.dimension,E=g.nearest,T=g.center,S=g.farthest;return function(){switch(this.get(f)){case E:return Math.min(this.get(d),this.get(_));case T:return Math.min(this.get(d),this.get(_))+.5*this.get(w);case S:return Math.max(this.get(d),this.get(_))}}}s.Line?s.warn("fabric.Line is already defined"):(s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,g){h||(h=[0,0,0,0]),this.callSuper("initialize",g),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(g)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,g){return this.callSuper("_set",h,g),i[h]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var g=this.calcLinePoints();h.moveTo(g.x1,g.y1),h.lineTo(g.x2,g.y2),h.lineWidth=this.strokeWidth;var f=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=f},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return l(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,g=this.y1<=this.y2?-1:1,f=h*this.width*.5,d=g*this.height*.5;return{x1:f,x2:h*this.width*-.5,y1:d,y2:g*this.height*-.5}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(h,g,f){f=f||{};var d=s.parseAttributes(h,s.Line.ATTRIBUTE_NAMES),_=[d.x1||0,d.y1||0,d.x2||0,d.y2||0];g(new s.Line(_,l(d,f)))},s.Line.fromObject=function(h,g){var f=u(h,!0);f.points=[h.x1,h.y1,h.x2,h.y2],s.Object._fromObject("Line",f,function(d){delete d.points,g&&g(d)},"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.degreesToRadians;s.Circle?s.warn("fabric.Circle is already defined."):(s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(u,i){return this.callSuper("_set",u,i),u==="radius"&&this.setRadius(i),this},toObject:function(u){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(u))},_toSVG:function(){var u,i=(this.endAngle-this.startAngle)%360;if(i===0)u=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var n=l(this.startAngle),h=l(this.endAngle),g=this.radius;u=['<path d="M '+s.util.cos(n)*g+" "+s.util.sin(n)*g," A "+g+" "+g," 0 ",+(i>180?"1":"0")+" 1"," "+s.util.cos(h)*g+" "+s.util.sin(h)*g,'" ',"COMMON_PARTS",` />
`]}return u},_render:function(u){u.beginPath(),u.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(u)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(u){return this.radius=u,this.set("width",2*u).set("height",2*u)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(u,i){var n,h=s.parseAttributes(u,s.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=h)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,i(new s.Circle(h))},s.Circle.fromObject=function(u,i){s.Object._fromObject("Circle",u,i)})}(e),function(a){var s=a.fabric||(a.fabric={});s.Triangle?s.warn("fabric.Triangle is already defined"):(s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,i=this.height/2;l.beginPath(),l.moveTo(-u,i),l.lineTo(0,-i),l.lineTo(u,i),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-l+" "+u,"0 "+-u,l+" "+u].join(","),'" />']}}),s.Triangle.fromObject=function(l,u){return s.Object._fromObject("Triangle",l,u)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=2*Math.PI;s.Ellipse?s.warn("fabric.Ellipse is already defined."):(s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,i){switch(this.callSuper("_set",u,i),u){case"rx":this.rx=i,this.set("width",2*i);break;case"ry":this.ry=i,this.set("height",2*i)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(u,i){var n=s.parseAttributes(u,s.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new s.Ellipse(n))},s.Ellipse.fromObject=function(u,i){s.Object._fromObject("Ellipse",u,i)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend;s.Rect?s.warn("fabric.Rect is already defined"):(s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,g=this.height,f=-this.width/2,d=-this.height/2,_=i!==0||n!==0,w=.4477152502;u.beginPath(),u.moveTo(f+i,d),u.lineTo(f+h-i,d),_&&u.bezierCurveTo(f+h-w*i,d,f+h,d+w*n,f+h,d+n),u.lineTo(f+h,d+g-n),_&&u.bezierCurveTo(f+h,d+g-w*n,f+h-w*i,d+g,f+h-i,d+g),u.lineTo(f+i,d+g),_&&u.bezierCurveTo(f+w*i,d+g,f,d+g-w*n,f,d+g-n),u.lineTo(f,d+n),_&&u.bezierCurveTo(f,d+w*n,f+w*i,d,f+i,d),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(u,i,n){if(!u)return i(null);n=n||{};var h=s.parseAttributes(u,s.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var g=new s.Rect(l(n?s.util.object.clone(n):{},h));g.visible=g.visible&&g.width>0&&g.height>0,i(g)},s.Rect.fromObject=function(u,i){return s.Object._fromObject("Rect",u,i)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.array.min,i=s.util.array.max,n=s.util.toFixed,h=s.util.projectStrokeOnPoints;s.Polyline?s.warn("fabric.Polyline is already defined"):(s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(g,f){f=f||{},this.points=g||[],this.callSuper("initialize",f),this._setPositionDimensions(f)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(g){var f,d=this._calcDimensions(g),_=this.exactBoundingBox?this.strokeWidth:0;this.width=d.width-_,this.height=d.height-_,g.fromSVG||(f=this.translateToGivenOrigin({x:d.left-this.strokeWidth/2+_/2,y:d.top-this.strokeWidth/2+_/2},"left","top",this.originX,this.originY)),g.left===void 0&&(this.left=g.fromSVG?d.left:f.x),g.top===void 0&&(this.top=g.fromSVG?d.top:f.y),this.pathOffset={x:d.left+this.width/2+_/2,y:d.top+this.height/2+_/2}},_calcDimensions:function(){var g=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,f=u(g,"x")||0,d=u(g,"y")||0;return{left:f,top:d,width:(i(g,"x")||0)-f,height:(i(g,"y")||0)-d}},toObject:function(g){return l(this.callSuper("toObject",g),{points:this.points.concat()})},_toSVG:function(){for(var g=[],f=this.pathOffset.x,d=this.pathOffset.y,_=s.Object.NUM_FRACTION_DIGITS,w=0,E=this.points.length;w<E;w++)g.push(n(this.points[w].x-f,_),",",n(this.points[w].y-d,_)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',g.join(""),`" />
`]},commonRender:function(g){var f,d=this.points.length,_=this.pathOffset.x,w=this.pathOffset.y;if(!d||isNaN(this.points[d-1].y))return!1;g.beginPath(),g.moveTo(this.points[0].x-_,this.points[0].y-w);for(var E=0;E<d;E++)f=this.points[E],g.lineTo(f.x-_,f.y-w);return!0},_render:function(g){this.commonRender(g)&&this._renderPaintInOrder(g)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(g){return function(f,d,_){if(!f)return d(null);_||(_={});var w=s.parsePointsAttribute(f.getAttribute("points")),E=s.parseAttributes(f,s[g].ATTRIBUTE_NAMES);E.fromSVG=!0,d(new s[g](w,l(E,_)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(g,f){return s.Object._fromObject("Polyline",g,f,"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.projectStrokeOnPoints;s.Polygon?s.warn("fabric.Polygon is already defined"):(s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(u,i){s.Object._fromObject("Polygon",u,i,"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.array.min,u=s.util.array.max,i=s.util.object.extend,n=s.util.object.clone,h=s.util.toFixed;s.Path?s.warn("fabric.Path is already defined"):(s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(g,f){delete(f=n(f||{})).path,this.callSuper("initialize",f),this._setPath(g||[],f)},_setPath:function(g,f){this.path=s.util.makePathSimpler(Array.isArray(g)?g:s.util.parsePath(g)),s.Polyline.prototype._setPositionDimensions.call(this,f||{})},_renderPathCommands:function(g){var f,d=0,_=0,w=0,E=0,T=0,S=0,D=-this.pathOffset.x,B=-this.pathOffset.y;g.beginPath();for(var X=0,z=this.path.length;X<z;++X)switch((f=this.path[X])[0]){case"L":w=f[1],E=f[2],g.lineTo(w+D,E+B);break;case"M":d=w=f[1],_=E=f[2],g.moveTo(w+D,E+B);break;case"C":w=f[5],E=f[6],T=f[3],S=f[4],g.bezierCurveTo(f[1]+D,f[2]+B,T+D,S+B,w+D,E+B);break;case"Q":g.quadraticCurveTo(f[1]+D,f[2]+B,f[3]+D,f[4]+B),w=f[3],E=f[4],T=f[1],S=f[2];break;case"z":case"Z":w=d,E=_,g.closePath()}},_render:function(g){this._renderPathCommands(g),this._renderPaintInOrder(g)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(g){return i(this.callSuper("toObject",g),{path:this.path.map(function(f){return f.slice()})})},toDatalessObject:function(g){var f=this.toObject(["sourcePath"].concat(g));return f.sourcePath&&delete f.path,f},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',s.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var g=s.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,g)+", "+h(-this.pathOffset.y,g)+")"},toClipPathSVG:function(g){var f=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:f})},toSVG:function(g){var f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:f})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var g,f,d=[],_=[],w=0,E=0,T=0,S=0,D=0,B=this.path.length;D<B;++D){switch((g=this.path[D])[0]){case"L":T=g[1],S=g[2],f=[];break;case"M":w=T=g[1],E=S=g[2],f=[];break;case"C":f=s.util.getBoundsOfCurve(T,S,g[1],g[2],g[3],g[4],g[5],g[6]),T=g[5],S=g[6];break;case"Q":f=s.util.getBoundsOfCurve(T,S,g[1],g[2],g[1],g[2],g[3],g[4]),T=g[3],S=g[4];break;case"z":case"Z":T=w,S=E}f.forEach(function(te){d.push(te.x),_.push(te.y)}),d.push(T),_.push(S)}var X=l(d)||0,z=l(_)||0;return{left:X,top:z,width:(u(d)||0)-X,height:(u(_)||0)-z}}}),s.Path.fromObject=function(g,f){if(typeof g.sourcePath=="string"){var d=g.sourcePath;s.loadSVGFromURL(d,function(_){var w=_[0];w.setOptions(g),f&&f(w)})}else s.Object._fromObject("Path",g,f,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(g,f,d){var _=s.parseAttributes(g,s.Path.ATTRIBUTE_NAMES);_.fromSVG=!0,f(new s.Path(_.d,i(_,d)))})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.array.min,u=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,n,h){n=n||{},this._objects=[],h&&this.callSuper("initialize",n),this._objects=i||[];for(var g=this._objects.length;g--;)this._objects[g].group=this;if(h)this._updateObjectsACoords();else{var f=n&&n.centerPoint;n.originX!==void 0&&(this.originX=n.originX),n.originY!==void 0&&(this.originY=n.originY),f||this._calcBounds(),this._updateObjectsCoords(f),delete n.centerPoint,this.callSuper("initialize",n)}this.setCoords()},_updateObjectsACoords:function(){for(var i=this._objects.length;i--;)this._objects[i].setCoords(!0)},_updateObjectsCoords:function(i){i=i||this.getCenterPoint();for(var n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],i)},_updateObjectCoords:function(i,n){var h=i.left,g=i.top;i.set({left:h-n.x,top:g-n.y}),i.group=this,i.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var n=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),i&&(n&&s.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,n?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,n){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(i,n);if(i==="canvas")for(;h--;)this._objects[h]._set(i,n);s.Object.prototype._set.call(this,i,n)},toObject:function(i){var n=this.includeDefaultValues,h=this._objects.filter(function(f){return!f.excludeFromExport}).map(function(f){var d=f.includeDefaultValues;f.includeDefaultValues=n;var _=f.toObject(i);return f.includeDefaultValues=d,_}),g=s.Object.prototype.toObject.call(this,i);return g.objects=h,g},toDatalessObject:function(i){var n,h=this.sourcePath;if(h)n=h;else{var g=this.includeDefaultValues;n=this._objects.map(function(d){var _=d.includeDefaultValues;d.includeDefaultValues=g;var w=d.toDatalessObject(i);return d.includeDefaultValues=_,w})}var f=s.Object.prototype.toDatalessObject.call(this,i);return f.objects=n,f},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=s.Object.prototype.shouldCache.call(this);if(i){for(var n=0,h=this._objects.length;n<h;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1}return i},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var n=0,h=this._objects.length;n<h;n++)this._objects[n].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var n=0,h=this._objects.length;n<h;n++)if(this._objects[n].isCacheDirty(!0)){if(this._cacheCanvas){var g=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-f/2,g,f)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(n){s.util.addTransformToObject(n,i),delete n.group,n.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,n=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var g=new s.ActiveSelection([]);return g.set(h),g.type="activeSelection",n.remove(this),i.forEach(function(f){f.group=g,f.dirty=!0,n.add(f)}),g.canvas=n,g._objects=i,n._activeObject=g,g.setCoords(),g}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords(!0)}),this},_calcBounds:function(i){for(var n,h,g,f,d=[],_=[],w=["tr","br","bl","tl"],E=0,T=this._objects.length,S=w.length;E<T;++E){for(g=(n=this._objects[E]).calcACoords(),f=0;f<S;f++)h=w[f],d.push(g[h].x),_.push(g[h].y);n.aCoords=g}this._getBounds(d,_,i)},_getBounds:function(i,n,h){var g=new s.Point(l(i),l(n)),f=new s.Point(u(i),u(n)),d=g.y||0,_=g.x||0,w=f.x-g.x||0,E=f.y-g.y||0;this.width=w,this.height=E,h||this.setPositionByOrigin({x:_,y:d},"left","top")},_toSVG:function(i){for(var n=["<g ","COMMON_PARTS",` >
`],h=0,g=this._objects.length;h<g;h++)n.push("		",this._objects[h].toSVG(i));return n.push(`</g>
`),n},getSvgStyles:function(){var i=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",n=this.visible?"":" visibility: hidden;";return[i,this.getSvgFilter(),n].join("")},toClipPathSVG:function(i){for(var n=[],h=0,g=this._objects.length;h<g;h++)n.push("	",this._objects[h].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(n,{reviver:i})}}),s.Group.fromObject=function(i,n){var h=i.objects,g=s.util.object.clone(i,!0);delete g.objects,typeof h!="string"?s.util.enlivenObjects(h,function(f){var d=s.util.object.clone(i,!0);delete d.objects,s.util.enlivenObjectEnlivables(i,d,function(){n&&n(new s.Group(f,d,!0))})}):s.loadSVGFromURL(h,function(f){var d=s.util.groupSVGElements(f,i,h);d.set(g),n&&n(d)})})}(e),function(a){var s=a.fabric||(a.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=s.Object.prototype.toObject.call(this),i=new s.Group([]);if(delete u.type,i.set(u),l.forEach(function(h){h.canvas.remove(h),h.group=i}),i._objects=l,!this.canvas)return i;var n=this.canvas;return n.add(i),n._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,i){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),(i=i||{}).hasControls===void 0&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,h=this._objects.length;n<h;n++)this._objects[n]._renderControls(l,i);l.restore()}}),s.ActiveSelection.fromObject=function(l,u){s.util.enlivenObjects(l.objects,function(i){delete l.objects,u&&u(new s.ActiveSelection(i,l,!0))})})}(e),function(a){var s=v.util.object.extend;a.fabric||(a.fabric={}),a.fabric.Image?v.warn("fabric.Image is already defined."):(v.Image=v.util.createClass(v.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:v.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:v.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+v.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=v.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(l){v.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(this.stroke&&this.strokeWidth!==0){var u=this.width/2,i=this.height/2;l.beginPath(),l.moveTo(-u,-i),l.lineTo(u,-i),l.lineTo(u,i),l.lineTo(-u,i),l.lineTo(-u,-i),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(n){n&&u.push(n.toObject())});var i=s(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l,u=[],i=[],n=this._element,h=-this.width/2,g=-this.height/2,f="",d="";if(!n)return[];if(this.hasCrop()){var _=v.Object.__uid++;u.push('<clipPath id="imageCrop_'+_+`">
`,'	<rect x="'+h+'" y="'+g+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),f=' clip-path="url(#imageCrop_'+_+')" '}if(this.imageSmoothing||(d='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',g-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,d,'"',f,`></image>
`),this.stroke||this.strokeDashArray){var w=this.fill;this.fill=null,l=["	<rect ",'x="',h,'" y="',g,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=w}return this.paintFirst!=="fill"?u.concat(l,i):u.concat(i,l)},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,i){return v.util.loadImage(l,function(n,h){this.setElement(n,i),this._setWidthHeight(),u&&u(this,h)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,h=i.scaleY,g=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||n>u&&h>u)return this._element=g,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=h);v.filterBackend||(v.filterBackend=v.initFilterBackend());var f=v.util.createCanvasElement(),d=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,_=g.width,w=g.height;f.width=_,f.height=w,this._element=f,this._lastScaleX=l.scaleX=n,this._lastScaleY=l.scaleY=h,v.filterBackend.applyFilters([l],g,_,w,this._element,d),this._filterScalingX=f.width/this._originalElement.width,this._filterScalingY=f.height/this._originalElement.height},applyFilters:function(l){if(l=(l=l||this.filters||[]).filter(function(g){return g&&!g.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,i=u.naturalWidth||u.width,n=u.naturalHeight||u.height;if(this._element===this._originalElement){var h=v.util.createCanvasElement();h.width=i,h.height=n,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return v.filterBackend||(v.filterBackend=v.initFilterBackend()),v.filterBackend.applyFilters(l,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){v.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){v.util.setImageSmoothing(l,this.imageSmoothing),v.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var i=this._filterScalingX,n=this._filterScalingY,h=this.width,g=this.height,f=Math.min,d=Math.max,_=d(this.cropX,0),w=d(this.cropY,0),E=u.naturalWidth||u.width,T=u.naturalHeight||u.height,S=_*i,D=w*n,B=f(h*i,E-S),X=f(g*n,T-D),z=-h/2,te=-g/2,ee=f(h,E/i-_),O=f(g,T/n-w);u&&l.drawImage(u,S,D,B,X,z,te,ee,O)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(v.util.getById(l),u),v.util.addClass(this.getElement(),v.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?v.util.enlivenObjects(l,function(i){u&&u(i)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l,u=v.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,h=1,g=1,f=0,d=0,_=0,w=0,E=this.width,T=this.height,S={width:E,height:T};return!u||u.alignX==="none"&&u.alignY==="none"?(h=E/i,g=T/n):(u.meetOrSlice==="meet"&&(l=(E-i*(h=g=v.util.findScaleToFit(this._element,S)))/2,u.alignX==="Min"&&(f=-l),u.alignX==="Max"&&(f=l),l=(T-n*g)/2,u.alignY==="Min"&&(d=-l),u.alignY==="Max"&&(d=l)),u.meetOrSlice==="slice"&&(l=i-E/(h=g=v.util.findScaleToCover(this._element,S)),u.alignX==="Mid"&&(_=l/2),u.alignX==="Max"&&(_=l),l=n-T/g,u.alignY==="Mid"&&(w=l/2),u.alignY==="Max"&&(w=l),i=E/h,n=T/g)),{width:i,height:n,scaleX:h,scaleY:g,offsetLeft:f,offsetTop:d,cropX:_,cropY:w}}}),v.Image.CSS_CANVAS="canvas-img",v.Image.prototype.getSvgSrc=v.Image.prototype.getSrc,v.Image.fromObject=function(l,u){var i=v.util.object.clone(l);v.util.loadImage(i.src,function(n,h){h?u&&u(null,!0):v.Image.prototype._initFilters.call(i,i.filters,function(g){i.filters=g||[],v.Image.prototype._initFilters.call(i,[i.resizeFilter],function(f){i.resizeFilter=f[0],v.util.enlivenObjectEnlivables(i,i,function(){var d=new v.Image(n,i);u(d,!1)})})})},null,i.crossOrigin)},v.Image.fromURL=function(l,u,i){v.util.loadImage(l,function(n,h){u&&u(new v.Image(n,i),h)},null,i&&i.crossOrigin)},v.Image.ATTRIBUTE_NAMES=v.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),v.Image.fromElement=function(l,u,i){var n=v.parseAttributes(l,v.Image.ATTRIBUTE_NAMES);v.Image.fromURL(n["xlink:href"],u,s(i?v.util.object.clone(i):{},n))})}(e),v.util.object.extend(v.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(a){var s=function(){},l=(a=a||{}).onComplete||s,u=a.onChange||s,i=this;return v.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){i.rotate(n),u()},onComplete:function(){i.setCoords(),l()}})}}),v.util.object.extend(v.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function a(l,u){var i="precision "+u+` float;
void main(){}`,n=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(n,i),l.compileShader(n),!!l.getShaderParameter(n,l.COMPILE_STATUS)}function s(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}v.isWebglSupported=function(l){if(v.isLikelyNode)return!1;l=l||v.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),i=u.getContext("webgl")||u.getContext("experimental-webgl"),n=!1;if(i){v.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),n=v.maxTextureSize>=l;for(var h=["highp","mediump","lowp"],g=0;g<3;g++)if(a(i,h[g])){v.webGlPrecision=h[g];break}}return this.isSupported=n,n},v.WebglFilterBackend=s,s.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var i,n=window.performance!==void 0;try{new ImageData(1,1),i=!0}catch{i=!1}var h=typeof ArrayBuffer<"u",g=typeof Uint8ClampedArray<"u";if(n&&i&&h&&g){var f=v.util.createCanvasElement(),d=new ArrayBuffer(l*u*4);if(v.forceGLPutImageData)return this.imageBuffer=d,void(this.copyGLTo2D=de);var _,w,E={imageBuffer:d,destinationWidth:l,destinationHeight:u,targetCanvas:f};f.width=l,f.height=u,_=window.performance.now(),me.call(E,this.gl,E),w=window.performance.now()-_,_=window.performance.now(),de.call(E,this.gl,E),w>window.performance.now()-_?(this.imageBuffer=d,this.copyGLTo2D=de):this.copyGLTo2D=me}},createWebGLCanvas:function(l,u){var i=v.util.createCanvasElement();i.width=l,i.height=u;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=i.getContext("webgl",n);h||(h=i.getContext("experimental-webgl",n)),h&&(h.clearColor(0,0,0,0),this.canvas=i,this.gl=h)},applyFilters:function(l,u,i,n,h,g){var f,d=this.gl;g&&(f=this.getCachedTexture(g,u));var _={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:d,sourceTexture:this.createTexture(d,i,n,!f&&u),targetTexture:this.createTexture(d,i,n),originalTexture:f||this.createTexture(d,i,n,!f&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},w=d.createFramebuffer();return d.bindFramebuffer(d.FRAMEBUFFER,w),l.forEach(function(E){E&&E.applyTo(_)}),function(E){var T=E.targetCanvas,S=T.width,D=T.height,B=E.destinationWidth,X=E.destinationHeight;S===B&&D===X||(T.width=B,T.height=X)}(_),this.copyGLTo2D(d,_),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(_.sourceTexture),d.deleteTexture(_.targetTexture),d.deleteFramebuffer(w),h.getContext("2d").setTransform(1,0,0,1,0,0),_},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,i,n){var h=l.createTexture();return l.bindTexture(l.TEXTURE_2D,h),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),n?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,n):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,i,0,l.RGBA,l.UNSIGNED_BYTE,null),h},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var i=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=i,i},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:me,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var i=l.getExtension("WEBGL_debug_renderer_info");if(i){var n=l.getParameter(i.UNMASKED_RENDERER_WEBGL),h=l.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(u.renderer=n.toLowerCase()),h&&(u.vendor=h.toLowerCase())}return this.gpuInfo=u,u}}}(),function(){var a=function(){};function s(){}v.Canvas2dFilterBackend=s,s.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(l,u,i,n,h){var g=h.getContext("2d");g.drawImage(u,0,0,i,n);var f={sourceWidth:i,sourceHeight:n,imageData:g.getImageData(0,0,i,n),originalEl:u,originalImageData:g.getImageData(0,0,i,n),canvasEl:h,ctx:g,filterBackend:this};return l.forEach(function(d){d.applyTo(f)}),f.imageData.width===i&&f.imageData.height===n||(h.width=f.imageData.width,h.height=f.imageData.height),g.putImageData(f.imageData,0,0),f}}}(),v.Image=v.Image||{},v.Image.filters=v.Image.filters||{},v.Image.filters.BaseFilter=v.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var s in a)this[s]=a[s]},createProgram:function(a,s,l){s=s||this.fragmentSource,l=l||this.vertexSource,v.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+v.webGlPrecision+" float"));var u=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(u,l),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(u));var i=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(i,s),a.compileShader(i),!a.getShaderParameter(i,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(i));var n=a.createProgram();if(a.attachShader(n,u),a.attachShader(n,i),a.linkProgram(n),!a.getProgramParameter(n,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(n));var h=this.getAttributeLocations(a,n),g=this.getUniformLocations(a,n)||{};return g.uStepW=a.getUniformLocation(n,"uStepW"),g.uStepH=a.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:h,uniformLocations:g}},getAttributeLocations:function(a,s){return{aPosition:a.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,s,l){var u=s.aPosition,i=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,i),a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,l,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var s,l,u=a.context;a.passes>1?(s=a.destinationWidth,l=a.destinationHeight,a.sourceWidth===s&&a.sourceHeight===l||(u.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(u,s,l)),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a.targetTexture,0)):(u.bindFramebuffer(u.FRAMEBUFFER,null),u.finish())},_swapTextures:function(a){a.passes--,a.pass++;var s=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=s},isNeutralState:function(){var a=this.mainParameter,s=v.Image.filters[this.type].prototype;if(a){if(Array.isArray(s[a])){for(var l=s[a].length;l--;)if(this[a][l]!==s[a][l])return!1;return!0}return s[a]===this[a]}return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var s=a.context,l=this.retrieveShader(a);a.pass===0&&a.originalTexture?s.bindTexture(s.TEXTURE_2D,a.originalTexture):s.bindTexture(s.TEXTURE_2D,a.sourceTexture),s.useProgram(l.program),this.sendAttributeData(s,l.attributeLocations,a.aPosition),s.uniform1f(l.uniformLocations.uStepW,1/a.sourceWidth),s.uniform1f(l.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(s,l.uniformLocations),s.viewport(0,0,a.destinationWidth,a.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,s,l){a.activeTexture(l),a.bindTexture(a.TEXTURE_2D,s),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,s){a.activeTexture(s),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var s=document.createElement("canvas");s.width=a.sourceWidth,s.height=a.sourceHeight,a.helpLayer=s}},toObject:function(){var a={type:this.type},s=this.mainParameter;return s&&(a[s]=this[s]),a},toJSON:function(){return this.toObject()}}),v.Image.filters.BaseFilter.fromObject=function(a,s){var l=new v.Image.filters[a.type](a);return s&&s(l),l},function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var n,h,g,f,d,_=i.imageData.data,w=_.length,E=this.matrix,T=this.colorsOnly;for(d=0;d<w;d+=4)n=_[d],h=_[d+1],g=_[d+2],T?(_[d]=n*E[0]+h*E[1]+g*E[2]+255*E[4],_[d+1]=n*E[5]+h*E[6]+g*E[7]+255*E[9],_[d+2]=n*E[10]+h*E[11]+g*E[12]+255*E[14]):(f=_[d+3],_[d]=n*E[0]+h*E[1]+g*E[2]+f*E[3]+255*E[4],_[d+1]=n*E[5]+h*E[6]+g*E[7]+f*E[8]+255*E[9],_[d+2]=n*E[10]+h*E[11]+g*E[12]+f*E[13]+255*E[14],_[d+3]=n*E[15]+h*E[16]+g*E[17]+f*E[18]+255*E[19])},getUniformLocations:function(i,n){return{uColorMatrix:i.getUniformLocation(n,"uColorMatrix"),uConstants:i.getUniformLocation(n,"uConstants")}},sendUniformData:function(i,n){var h=this.matrix,g=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],f=[h[4],h[9],h[14],h[19]];i.uniformMatrix4fv(n.uColorMatrix,!1,g),i.uniform4fv(n.uConstants,f)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(this.brightness!==0){var n,h=i.imageData.data,g=h.length,f=Math.round(255*this.brightness);for(n=0;n<g;n+=4)h[n]=h[n]+f,h[n+1]=h[n+1]+f,h[n+2]=h[n+2]+f}},getUniformLocations:function(i,n){return{uBrightness:i.getUniformLocation(n,"uBrightness")}},sendUniformData:function(i,n){i.uniform1f(n.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Convolute=i(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(n){var h=Math.sqrt(this.matrix.length),g=this.type+"_"+h+"_"+(this.opaque?1:0),f=this.fragmentSource[g];return n.programCache.hasOwnProperty(g)||(n.programCache[g]=this.createProgram(n.context,f)),n.programCache[g]},applyTo2d:function(n){var h,g,f,d,_,w,E,T,S,D,B,X,z,te=n.imageData,ee=te.data,O=this.matrix,x=Math.round(Math.sqrt(O.length)),R=Math.floor(x/2),N=te.width,G=te.height,W=n.ctx.createImageData(N,G),k=W.data,F=this.opaque?1:0;for(B=0;B<G;B++)for(D=0;D<N;D++){for(_=4*(B*N+D),h=0,g=0,f=0,d=0,z=0;z<x;z++)for(X=0;X<x;X++)w=D+X-R,(E=B+z-R)<0||E>=G||w<0||w>=N||(T=4*(E*N+w),S=O[z*x+X],h+=ee[T]*S,g+=ee[T+1]*S,f+=ee[T+2]*S,F||(d+=ee[T+3]*S));k[_]=h,k[_+1]=g,k[_+2]=f,k[_+3]=F?ee[_+3]:d}n.imageData=W},getUniformLocations:function(n,h){return{uMatrix:n.getUniformLocation(h,"uMatrix"),uOpaque:n.getUniformLocation(h,"uOpaque"),uHalfSize:n.getUniformLocation(h,"uHalfSize"),uSize:n.getUniformLocation(h,"uSize")}},sendUniformData:function(n,h){n.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(i){var n,h,g=i.imageData.data,f=g.length,d=this.mode;for(n=0;n<f;n+=4)d==="average"?h=(g[n]+g[n+1]+g[n+2])/3:d==="lightness"?h=(Math.min(g[n],g[n+1],g[n+2])+Math.max(g[n],g[n+1],g[n+2]))/2:d==="luminosity"&&(h=.21*g[n]+.72*g[n+1]+.07*g[n+2]),g[n]=h,g[n+1]=h,g[n+2]=h},retrieveShader:function(i){var n=this.type+"_"+this.mode;if(!i.programCache.hasOwnProperty(n)){var h=this.fragmentSource[this.mode];i.programCache[n]=this.createProgram(i.context,h)}return i.programCache[n]},getUniformLocations:function(i,n){return{uMode:i.getUniformLocation(n,"uMode")}},sendUniformData:function(i,n){i.uniform1i(n.uMode,1)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(i){var n,h=i.imageData.data,g=h.length;for(n=0;n<g;n+=4)h[n]=255-h[n],h[n+1]=255-h[n+1],h[n+2]=255-h[n+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,n){return{uInvert:i.getUniformLocation(n,"uInvert")}},sendUniformData:function(i,n){i.uniform1i(n.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Noise=i(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(n){if(this.noise!==0){var h,g,f=n.imageData.data,d=f.length,_=this.noise;for(h=0,d=f.length;h<d;h+=4)g=(.5-Math.random())*_,f[h]+=g,f[h+1]+=g,f[h+2]+=g}},getUniformLocations:function(n,h){return{uNoise:n.getUniformLocation(h,"uNoise"),uSeed:n.getUniformLocation(h,"uSeed")}},sendUniformData:function(n,h){n.uniform1f(h.uNoise,this.noise/255),n.uniform1f(h.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(i){var n,h,g,f,d,_,w,E,T,S,D,B=i.imageData,X=B.data,z=B.height,te=B.width;for(h=0;h<z;h+=this.blocksize)for(g=0;g<te;g+=this.blocksize)for(f=X[n=4*h*te+4*g],d=X[n+1],_=X[n+2],w=X[n+3],S=Math.min(h+this.blocksize,z),D=Math.min(g+this.blocksize,te),E=h;E<S;E++)for(T=g;T<D;T++)X[n=4*E*te+4*T]=f,X[n+1]=d,X[n+2]=_,X[n+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(i,n){return{uBlocksize:i.getUniformLocation(n,"uBlocksize"),uStepW:i.getUniformLocation(n,"uStepW"),uStepH:i.getUniformLocation(n,"uStepH")}},sendUniformData:function(i,n){i.uniform1f(n.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.RemoveColor=i(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(n){var h,g,f,d,_=n.imageData.data,w=255*this.distance,E=new s.Color(this.color).getSource(),T=[E[0]-w,E[1]-w,E[2]-w],S=[E[0]+w,E[1]+w,E[2]+w];for(h=0;h<_.length;h+=4)g=_[h],f=_[h+1],d=_[h+2],g>T[0]&&f>T[1]&&d>T[2]&&g<S[0]&&f<S[1]&&d<S[2]&&(_[h+3]=0)},getUniformLocations:function(n,h){return{uLow:n.getUniformLocation(h,"uLow"),uHigh:n.getUniformLocation(h,"uHigh")}},sendUniformData:function(n,h){var g=new s.Color(this.color).getSource(),f=parseFloat(this.distance),d=[0+g[0]/255-f,0+g[1]/255-f,0+g[2]/255-f,1],_=[g[0]/255+f,g[1]/255+f,g[2]/255+f,1];n.uniform4fv(h.uLow,d),n.uniform4fv(h.uHigh,_)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in i)l[n]=u(l.ColorMatrix,{type:n,matrix:i[n],mainParameter:!1,colorsOnly:!0}),s.Image.filters[n].fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(i){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[i]+`}
}`},retrieveShader:function(i){var n,h=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(h)||(n=this.buildSource(this.mode),i.programCache[h]=this.createProgram(i.context,n)),i.programCache[h]},applyTo2d:function(i){var n,h,g,f,d,_,w,E=i.imageData.data,T=E.length,S=1-this.alpha;n=(w=new s.Color(this.color).getSource())[0]*this.alpha,h=w[1]*this.alpha,g=w[2]*this.alpha;for(var D=0;D<T;D+=4)switch(f=E[D],d=E[D+1],_=E[D+2],this.mode){case"multiply":E[D]=f*n/255,E[D+1]=d*h/255,E[D+2]=_*g/255;break;case"screen":E[D]=255-(255-f)*(255-n)/255,E[D+1]=255-(255-d)*(255-h)/255,E[D+2]=255-(255-_)*(255-g)/255;break;case"add":E[D]=f+n,E[D+1]=d+h,E[D+2]=_+g;break;case"diff":case"difference":E[D]=Math.abs(f-n),E[D+1]=Math.abs(d-h),E[D+2]=Math.abs(_-g);break;case"subtract":E[D]=f-n,E[D+1]=d-h,E[D+2]=_-g;break;case"darken":E[D]=Math.min(f,n),E[D+1]=Math.min(d,h),E[D+2]=Math.min(_,g);break;case"lighten":E[D]=Math.max(f,n),E[D+1]=Math.max(d,h),E[D+2]=Math.max(_,g);break;case"overlay":E[D]=n<128?2*f*n/255:255-2*(255-f)*(255-n)/255,E[D+1]=h<128?2*d*h/255:255-2*(255-d)*(255-h)/255,E[D+2]=g<128?2*_*g/255:255-2*(255-_)*(255-g)/255;break;case"exclusion":E[D]=n+f-2*n*f/255,E[D+1]=h+d-2*h*d/255,E[D+2]=g+_-2*g*_/255;break;case"tint":E[D]=n+f*S,E[D+1]=h+d*S,E[D+2]=g+_*S}},getUniformLocations:function(i,n){return{uColor:i.getUniformLocation(n,"uColor")}},sendUniformData:function(i,n){var h=new s.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,i.uniform4fv(n.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(i){var n=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(n)||(i.programCache[n]=this.createProgram(i.context,h)),i.programCache[n]},applyToWebGL:function(i){var n=i.context,h=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(n,h,n.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(n,n.TEXTURE1)},createTexture:function(i,n){return i.getCachedTexture(n.cacheKey,n._element)},calculateMatrix:function(){var i=this.image,n=i._element.width,h=i._element.height;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/n,-i.top/h,1]},applyTo2d:function(i){var n,h,g,f,d,_,w,E,T,S,D,B=i.imageData,X=i.filterBackend.resources,z=B.data,te=z.length,ee=B.width,O=B.height,x=this.image;X.blendImage||(X.blendImage=s.util.createCanvasElement()),S=(T=X.blendImage).getContext("2d"),T.width!==ee||T.height!==O?(T.width=ee,T.height=O):S.clearRect(0,0,ee,O),S.setTransform(x.scaleX,0,0,x.scaleY,x.left,x.top),S.drawImage(x._element,0,0,ee,O),D=S.getImageData(0,0,ee,O).data;for(var R=0;R<te;R+=4)switch(d=z[R],_=z[R+1],w=z[R+2],E=z[R+3],n=D[R],h=D[R+1],g=D[R+2],f=D[R+3],this.mode){case"multiply":z[R]=d*n/255,z[R+1]=_*h/255,z[R+2]=w*g/255,z[R+3]=E*f/255;break;case"mask":z[R+3]=f}},getUniformLocations:function(i,n){return{uTransformMatrix:i.getUniformLocation(n,"uTransformMatrix"),uImage:i.getUniformLocation(n,"uImage")}},sendUniformData:function(i,n){var h=this.calculateMatrix();i.uniform1i(n.uImage,1),i.uniformMatrix3fv(n.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(i,n){s.Image.fromObject(i.image,function(h){var g=s.util.object.clone(i);g.image=h,n(new s.Image.filters.BlendImage(g))})}}(e),function(a){var s=a.fabric||(a.fabric={}),l=Math.pow,u=Math.floor,i=Math.sqrt,n=Math.abs,h=Math.round,g=Math.sin,f=Math.ceil,d=s.Image.filters,_=s.util.createClass;d.Resize=_(d.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(w,E){return{uDelta:w.getUniformLocation(E,"uDelta"),uTaps:w.getUniformLocation(E,"uTaps")}},sendUniformData:function(w,E){w.uniform2fv(E.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),w.uniform1fv(E.uTaps,this.taps)},retrieveShader:function(w){var E=this.getFilterWindow(),T=this.type+"_"+E;if(!w.programCache.hasOwnProperty(T)){var S=this.generateShader(E);w.programCache[T]=this.createProgram(w.context,S)}return w.programCache[T]},getFilterWindow:function(){var w=this.tempScale;return Math.ceil(this.lanczosLobes/w)},getTaps:function(){for(var w=this.lanczosCreate(this.lanczosLobes),E=this.tempScale,T=this.getFilterWindow(),S=new Array(T),D=1;D<=T;D++)S[D-1]=w(D*E);return S},generateShader:function(w){for(var E=new Array(w),T=this.fragmentSourceTOP,S=1;S<=w;S++)E[S-1]=S+".0 * uDelta";return T+="uniform float uTaps["+w+`];
`,T+=`void main() {
`,T+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,T+=`  float sum = 1.0;
`,E.forEach(function(D,B){T+="  color += texture2D(uTexture, vTexCoord + "+D+") * uTaps["+B+`];
`,T+="  color += texture2D(uTexture, vTexCoord - "+D+") * uTaps["+B+`];
`,T+="  sum += 2.0 * uTaps["+B+`];
`}),T+=`  gl_FragColor = color / sum;
`,T+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(w){w.webgl?(w.passes++,this.width=w.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=w.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),w.destinationWidth=this.dW,this._setupFrameBuffer(w),this.applyToWebGL(w),this._swapTextures(w),w.sourceWidth=w.destinationWidth,this.height=w.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),w.destinationHeight=this.dH,this._setupFrameBuffer(w),this.applyToWebGL(w),this._swapTextures(w),w.sourceHeight=w.destinationHeight):this.applyTo2d(w)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(w){return function(E){if(E>=w||E<=-w)return 0;if(E<11920929e-14&&E>-11920929e-14)return 1;var T=(E*=Math.PI)/w;return g(E)/E*g(T)/T}},applyTo2d:function(w){var E=w.imageData,T=this.scaleX,S=this.scaleY;this.rcpScaleX=1/T,this.rcpScaleY=1/S;var D,B=E.width,X=E.height,z=h(B*T),te=h(X*S);this.resizeType==="sliceHack"?D=this.sliceByTwo(w,B,X,z,te):this.resizeType==="hermite"?D=this.hermiteFastResize(w,B,X,z,te):this.resizeType==="bilinear"?D=this.bilinearFiltering(w,B,X,z,te):this.resizeType==="lanczos"&&(D=this.lanczosResize(w,B,X,z,te)),w.imageData=D},sliceByTwo:function(w,E,T,S,D){var B,X,z=w.imageData,te=.5,ee=!1,O=!1,x=E*te,R=T*te,N=s.filterBackend.resources,G=0,W=0,k=E,F=0;for(N.sliceByTwo||(N.sliceByTwo=document.createElement("canvas")),((B=N.sliceByTwo).width<1.5*E||B.height<T)&&(B.width=1.5*E,B.height=T),(X=B.getContext("2d")).clearRect(0,0,1.5*E,T),X.putImageData(z,0,0),S=u(S),D=u(D);!ee||!O;)E=x,T=R,S<u(x*te)?x=u(x*te):(x=S,ee=!0),D<u(R*te)?R=u(R*te):(R=D,O=!0),X.drawImage(B,G,W,E,T,k,F,x,R),G=k,W=F,F+=R;return X.getImageData(G,W,S,D)},lanczosResize:function(w,E,T,S,D){var B=w.imageData.data,X=w.ctx.createImageData(S,D),z=X.data,te=this.lanczosCreate(this.lanczosLobes),ee=this.rcpScaleX,O=this.rcpScaleY,x=2/this.rcpScaleX,R=2/this.rcpScaleY,N=f(ee*this.lanczosLobes/2),G=f(O*this.lanczosLobes/2),W={},k={},F={};return function U(Y){var K,Q,re,se,oe,ce,le,ge,ve,_e,Ee;for(k.x=(Y+.5)*ee,F.x=u(k.x),K=0;K<D;K++){for(k.y=(K+.5)*O,F.y=u(k.y),oe=0,ce=0,le=0,ge=0,ve=0,Q=F.x-N;Q<=F.x+N;Q++)if(!(Q<0||Q>=E)){_e=u(1e3*n(Q-k.x)),W[_e]||(W[_e]={});for(var ke=F.y-G;ke<=F.y+G;ke++)ke<0||ke>=T||(Ee=u(1e3*n(ke-k.y)),W[_e][Ee]||(W[_e][Ee]=te(i(l(_e*x,2)+l(Ee*R,2))/1e3)),(re=W[_e][Ee])>0&&(oe+=re,ce+=re*B[se=4*(ke*E+Q)],le+=re*B[se+1],ge+=re*B[se+2],ve+=re*B[se+3]))}z[se=4*(K*S+Y)]=ce/oe,z[se+1]=le/oe,z[se+2]=ge/oe,z[se+3]=ve/oe}return++Y<S?U(Y):X}(0)},bilinearFiltering:function(w,E,T,S,D){var B,X,z,te,ee,O,x,R,N,G=0,W=this.rcpScaleX,k=this.rcpScaleY,F=4*(E-1),U=w.imageData.data,Y=w.ctx.createImageData(S,D),K=Y.data;for(z=0;z<D;z++)for(te=0;te<S;te++)for(ee=W*te-(B=u(W*te)),O=k*z-(X=u(k*z)),N=4*(X*E+B),x=0;x<4;x++)R=U[N+x]*(1-ee)*(1-O)+U[N+4+x]*ee*(1-O)+U[N+F+x]*O*(1-ee)+U[N+F+4+x]*ee*O,K[G++]=R;return Y},hermiteFastResize:function(w,E,T,S,D){for(var B=this.rcpScaleX,X=this.rcpScaleY,z=f(B/2),te=f(X/2),ee=w.imageData.data,O=w.ctx.createImageData(S,D),x=O.data,R=0;R<D;R++)for(var N=0;N<S;N++){for(var G=4*(N+R*S),W=0,k=0,F=0,U=0,Y=0,K=0,Q=0,re=(R+.5)*X,se=u(R*X);se<(R+1)*X;se++)for(var oe=n(re-(se+.5))/te,ce=(N+.5)*B,le=oe*oe,ge=u(N*B);ge<(N+1)*B;ge++){var ve=n(ce-(ge+.5))/z,_e=i(le+ve*ve);_e>1&&_e<-1||(W=2*_e*_e*_e-3*_e*_e+1)>0&&(Q+=W*ee[3+(ve=4*(ge+se*E))],F+=W,ee[ve+3]<255&&(W=W*ee[ve+3]/250),U+=W*ee[ve],Y+=W*ee[ve+1],K+=W*ee[ve+2],k+=W)}x[G]=U/k,x[G+1]=Y/k,x[G+2]=K/k,x[G+3]=Q/F}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(this.contrast!==0){var n,h=i.imageData.data,g=h.length,f=Math.floor(255*this.contrast),d=259*(f+255)/(255*(259-f));for(n=0;n<g;n+=4)h[n]=d*(h[n]-128)+128,h[n+1]=d*(h[n+1]-128)+128,h[n+2]=d*(h[n+2]-128)+128}},getUniformLocations:function(i,n){return{uContrast:i.getUniformLocation(n,"uContrast")}},sendUniformData:function(i,n){i.uniform1f(n.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(this.saturation!==0){var n,h,g=i.imageData.data,f=g.length,d=-this.saturation;for(n=0;n<f;n+=4)h=Math.max(g[n],g[n+1],g[n+2]),g[n]+=h!==g[n]?(h-g[n])*d:0,g[n+1]+=h!==g[n+1]?(h-g[n+1])*d:0,g[n+2]+=h!==g[n+2]?(h-g[n+2])*d:0}},getUniformLocations:function(i,n){return{uSaturation:i.getUniformLocation(n,"uSaturation")}},sendUniformData:function(i,n){i.uniform1f(n.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(this.vibrance!==0){var n,h,g,f,d=i.imageData.data,_=d.length,w=-this.vibrance;for(n=0;n<_;n+=4)h=Math.max(d[n],d[n+1],d[n+2]),g=(d[n]+d[n+1]+d[n+2])/3,f=2*Math.abs(h-g)/255*w,d[n]+=h!==d[n]?(h-d[n])*f:0,d[n+1]+=h!==d[n+1]?(h-d[n+1])*f:0,d[n+2]+=h!==d[n+2]?(h-d[n+2])*f:0}},getUniformLocations:function(i,n){return{uVibrance:i.getUniformLocation(n,"uVibrance")}},sendUniformData:function(i,n){i.uniform1f(n.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var n,h,g=i.filterBackend.resources,f=i.imageData.width,d=i.imageData.height;g.blurLayer1||(g.blurLayer1=s.util.createCanvasElement(),g.blurLayer2=s.util.createCanvasElement()),n=g.blurLayer1,h=g.blurLayer2,n.width===f&&n.height===d||(h.width=n.width=f,h.height=n.height=d);var _,w,E,T,S=n.getContext("2d"),D=h.getContext("2d"),B=.06*this.blur*.5;for(S.putImageData(i.imageData,0,0),D.clearRect(0,0,f,d),T=-15;T<=15;T++)E=B*(w=T/15)*f+(_=(Math.random()-.5)/4),D.globalAlpha=1-Math.abs(w),D.drawImage(n,E,_),S.drawImage(h,0,0),D.globalAlpha=1,D.clearRect(0,0,h.width,h.height);for(T=-15;T<=15;T++)E=B*(w=T/15)*d+(_=(Math.random()-.5)/4),D.globalAlpha=1-Math.abs(w),D.drawImage(n,_,E),S.drawImage(h,0,0),D.globalAlpha=1,D.clearRect(0,0,h.width,h.height);i.ctx.drawImage(n,0,0);var X=i.ctx.getImageData(0,0,n.width,n.height);return S.globalAlpha=1,S.clearRect(0,0,n.width,n.height),X},getUniformLocations:function(i,n){return{delta:i.getUniformLocation(n,"uDelta")}},sendUniformData:function(i,n){var h=this.chooseRightDelta();i.uniform2fv(n.delta,h)},chooseRightDelta:function(){var i,n=1,h=[0,0];return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?h[0]=i:h[1]=i,h}}),l.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var n,h=i.imageData.data,g=this.gamma,f=h.length,d=1/g[0],_=1/g[1],w=1/g[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),n=0,f=256;n<f;n++)this.rVals[n]=255*Math.pow(n/255,d),this.gVals[n]=255*Math.pow(n/255,_),this.bVals[n]=255*Math.pow(n/255,w);for(n=0,f=h.length;n<f;n+=4)h[n]=this.rVals[h[n]],h[n+1]=this.gVals[h[n+1]],h[n+2]=this.bVals[h[n+2]]},getUniformLocations:function(i,n){return{uGamma:i.getUniformLocation(n,"uGamma")}},sendUniformData:function(i,n){i.uniform3fv(n.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(n){n.applyTo(i)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(i,n){var h=(i.subFilters||[]).map(function(f){return new s.Image.filters[f.type](f)}),g=new s.Image.filters.Composed({subFilters:h});return n&&n(g),g}}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,n=s.util.cos(i),h=s.util.sin(i),g=1/3,f=Math.sqrt(g)*h,d=1-n;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=n+d/3,this.matrix[1]=g*d-f,this.matrix[2]=g*d+f,this.matrix[5]=g*d+f,this.matrix[6]=n+g*d,this.matrix[7]=g*d-f,this.matrix[10]=g*d-f,this.matrix[11]=g*d+f,this.matrix[12]=n+g*d},isNeutralState:function(i){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,i)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.clone;if(s.Text)s.warn("fabric.Text is already defined");else{var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(u),cacheProperties:s.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,n){this.styles=n&&n.styles||{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",n),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=s.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,n,h,g,f,d,_,w=0,E=this._textLines.length;w<E;w++)if((this.textAlign==="justify"||w!==E-1&&!this.isEndOfWrapping(w))&&(g=0,f=this._textLines[w],(n=this.getLineWidth(w))<this.width&&(_=this.textLines[w].match(this._reSpacesAndTabs)))){h=_.length,i=(this.width-n)/h;for(var T=0,S=f.length;T<=S;T++)d=this.__charBounds[w][T],this._reSpaceAndTab.test(f[T])?(d.width+=i,d.kernedWidth+=i,d.left+=g,g+=i):d.left+=g}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return i.width+=n*i.zoomX,i.height+=n*i.zoomY,i},_render:function(i){var n=this.path;n&&!n.isNotVisible()&&n._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,n,h){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom"}i.font=this._getFontDeclaration(n,h)},calcTextWidth:function(){for(var i=this.getLineWidth(0),n=1,h=this._textLines.length;n<h;n++){var g=this.getLineWidth(n);g>i&&(i=g)}return i},_renderTextLine:function(i,n,h,g,f,d){this._renderChars(i,n,h,g,f,d)},_renderTextLinesBackground:function(i){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var n,h,g,f,d,_,w,E=i.fillStyle,T=this._getLeftOffset(),S=this._getTopOffset(),D=0,B=0,X=this.path,z=0,te=this._textLines.length;z<te;z++)if(n=this.getHeightOfLine(z),this.textBackgroundColor||this.styleHas("textBackgroundColor",z)){g=this._textLines[z],h=this._getLineLeftOffset(z),B=0,D=0,f=this.getValueOfPropertyAt(z,0,"textBackgroundColor");for(var ee=0,O=g.length;ee<O;ee++)d=this.__charBounds[z][ee],_=this.getValueOfPropertyAt(z,ee,"textBackgroundColor"),X?(i.save(),i.translate(d.renderLeft,d.renderTop),i.rotate(d.angle),i.fillStyle=_,_&&i.fillRect(-d.width/2,-n/this.lineHeight*(1-this._fontSizeFraction),d.width,n/this.lineHeight),i.restore()):_!==f?(w=T+h+D,this.direction==="rtl"&&(w=this.width-w-B),i.fillStyle=f,f&&i.fillRect(w,S,B,n/this.lineHeight),D=d.left,B=d.width,f=_):B+=d.kernedWidth;_&&!X&&(w=T+h+D,this.direction==="rtl"&&(w=this.width-w-B),i.fillStyle=_,i.fillRect(w,S,B,n/this.lineHeight)),S+=n}else S+=n;i.fillStyle=E,this._removeShadow(i)}},getFontCache:function(i){var n=i.fontFamily.toLowerCase();s.charWidthsCache[n]||(s.charWidthsCache[n]={});var h=s.charWidthsCache[n],g=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return h[g]||(h[g]={}),h[g]},_measureChar:function(i,n,h,g){var f,d,_,w,E=this.getFontCache(n),T=h+i,S=this._getFontDeclaration(n)===this._getFontDeclaration(g),D=n.fontSize/this.CACHE_FONT_SIZE;if(h&&E[h]!==void 0&&(_=E[h]),E[i]!==void 0&&(w=f=E[i]),S&&E[T]!==void 0&&(w=(d=E[T])-_),f===void 0||_===void 0||d===void 0){var B=this.getMeasuringContext();this._setTextStyles(B,n,!0)}return f===void 0&&(w=f=B.measureText(i).width,E[i]=f),_===void 0&&S&&h&&(_=B.measureText(h).width,E[h]=_),S&&d===void 0&&(d=B.measureText(T).width,E[T]=d,w=d-_),{width:f*D,kernedWidth:w*D}},getHeightOfChar:function(i,n){return this.getValueOfPropertyAt(i,n,"fontSize")},measureLine:function(i){var n=this._measureLine(i);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(i){var n,h,g,f,d,_,w=0,E=this._textLines[i],T=new Array(E.length),S=0,D=this.path,B=this.pathSide==="right";for(this.__charBounds[i]=T,n=0;n<E.length;n++)h=E[n],f=this._getGraphemeBox(h,i,n,g),T[n]=f,w+=f.kernedWidth,g=h;if(T[n]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},D){switch(_=D.segmentsInfo[D.segmentsInfo.length-1].length,(d=s.util.getPointOnPath(D.path,0,D.segmentsInfo)).x+=D.pathOffset.x,d.y+=D.pathOffset.y,this.textAlign){case"left":S=B?_-w:0;break;case"center":S=(_-w)/2;break;case"right":S=B?0:_-w}for(S+=this.pathStartOffset*(B?-1:1),n=B?E.length-1:0;B?n>=0:n<E.length;B?n--:n++)f=T[n],S>_?S%=_:S<0&&(S+=_),this._setGraphemeOnPath(S,f,d),S+=f.kernedWidth}return{width:w,numOfSpaces:0}},_setGraphemeOnPath:function(i,n,h){var g=i+n.kernedWidth/2,f=this.path,d=s.util.getPointOnPath(f.path,g,f.segmentsInfo);n.renderLeft=d.x-h.x,n.renderTop=d.y-h.y,n.angle=d.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(i,n,h,g,f){var d,_=this.getCompleteStyleDeclaration(n,h),w=g?this.getCompleteStyleDeclaration(n,h-1):{},E=this._measureChar(i,_,g,w),T=E.kernedWidth,S=E.width;this.charSpacing!==0&&(S+=d=this._getWidthOfCharSpacing(),T+=d);var D={width:S,left:0,height:_.fontSize,kernedWidth:T,deltaY:_.deltaY};if(h>0&&!f){var B=this.__charBounds[n][h-1];D.left=B.left+B.width+E.kernedWidth-E.width}return D},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var n=this._textLines[i],h=this.getHeightOfChar(i,0),g=1,f=n.length;g<f;g++)h=Math.max(this.getHeightOfChar(i,g),h);return this.__lineHeights[i]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,n=0,h=0,g=this._textLines.length;h<g;h++)i=this.getHeightOfLine(h),n+=h===g-1?i/this.lineHeight:i;return n},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,n){i.save();for(var h=0,g=this._getLeftOffset(),f=this._getTopOffset(),d=0,_=this._textLines.length;d<_;d++){var w=this.getHeightOfLine(d),E=w/this.lineHeight,T=this._getLineLeftOffset(d);this._renderTextLine(n,i,this._textLines[d],g+T,f+h+E,d),h+=w}i.restore()},_renderTextFill:function(i){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,n,h,g,f,d){var _,w,E,T,S,D=this.getHeightOfLine(d),B=this.textAlign.indexOf("justify")!==-1,X="",z=0,te=this.path,ee=!B&&this.charSpacing===0&&this.isEmptyStyles(d)&&!te,O=this.direction==="ltr",x=this.direction==="ltr"?1:-1,R=n.canvas.getAttribute("dir");if(n.save(),R!==this.direction&&(n.canvas.setAttribute("dir",O?"ltr":"rtl"),n.direction=O?"ltr":"rtl",n.textAlign=O?"left":"right"),f-=D*this._fontSizeFraction/this.lineHeight,ee)return this._renderChar(i,n,d,0,h.join(""),g,f,D),void n.restore();for(var N=0,G=h.length-1;N<=G;N++)T=N===G||this.charSpacing||te,X+=h[N],E=this.__charBounds[d][N],z===0?(g+=x*(E.kernedWidth-E.width),z+=E.width):z+=E.kernedWidth,B&&!T&&this._reSpaceAndTab.test(h[N])&&(T=!0),T||(_=_||this.getCompleteStyleDeclaration(d,N),w=this.getCompleteStyleDeclaration(d,N+1),T=this._hasStyleChanged(_,w)),T&&(te?(n.save(),n.translate(E.renderLeft,E.renderTop),n.rotate(E.angle),this._renderChar(i,n,d,N,X,-z/2,0,D),n.restore()):(S=g,this._renderChar(i,n,d,N,X,S,f,D)),X="",_=w,g+=x*z,z=0);n.restore()},_applyPatternGradientTransformText:function(i){var n,h=s.util.createCanvasElement(),g=this.width+this.strokeWidth,f=this.height+this.strokeWidth;return h.width=g,h.height=f,(n=h.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(g,0),n.lineTo(g,f),n.lineTo(0,f),n.closePath(),n.translate(g/2,f/2),n.fillStyle=i.toLive(n),this._applyPatternGradientTransform(n,i),n.fill(),n.createPattern(h,"no-repeat")},handleFiller:function(i,n,h){var g,f;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(g=-this.width/2,f=-this.height/2,i.translate(g,f),i[n]=this._applyPatternGradientTransformText(h),{offsetX:g,offsetY:f}):(i[n]=h.toLive(i,this),this._applyPatternGradientTransform(i,h)):(i[n]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,n){return i.lineWidth=n.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",n.stroke)},_setFillStyles:function(i,n){return this.handleFiller(i,"fillStyle",n.fill)},_renderChar:function(i,n,h,g,f,d,_){var w,E,T=this._getStyleDeclaration(h,g),S=this.getCompleteStyleDeclaration(h,g),D=i==="fillText"&&S.fill,B=i==="strokeText"&&S.stroke&&S.strokeWidth;(B||D)&&(n.save(),D&&(w=this._setFillStyles(n,S)),B&&(E=this._setStrokeStyles(n,S)),n.font=this._getFontDeclaration(S),T&&T.textBackgroundColor&&this._removeShadow(n),T&&T.deltaY&&(_+=T.deltaY),D&&n.fillText(f,d-w.offsetX,_-w.offsetY),B&&n.strokeText(f,d-E.offsetX,_-E.offsetY),n.restore())},setSuperscript:function(i,n){return this._setScript(i,n,this.superscript)},setSubscript:function(i,n){return this._setScript(i,n,this.subscript)},_setScript:function(i,n,h){var g=this.get2DCursorLocation(i,!0),f=this.getValueOfPropertyAt(g.lineIndex,g.charIndex,"fontSize"),d=this.getValueOfPropertyAt(g.lineIndex,g.charIndex,"deltaY"),_={fontSize:f*h.size,deltaY:d+f*h.baseline};return this.setSelectionStyles(_,i,n),this},_hasStyleChanged:function(i,n){return i.fill!==n.fill||i.stroke!==n.stroke||i.strokeWidth!==n.strokeWidth||i.fontSize!==n.fontSize||i.fontFamily!==n.fontFamily||i.fontWeight!==n.fontWeight||i.fontStyle!==n.fontStyle||i.deltaY!==n.deltaY},_hasStyleChangedForSvg:function(i,n){return this._hasStyleChanged(i,n)||i.overline!==n.overline||i.underline!==n.underline||i.linethrough!==n.linethrough},_getLineLeftOffset:function(i){var n=this.getLineWidth(i),h=this.width-n,g=this.textAlign,f=this.direction,d=0,_=this.isEndOfWrapping(i);return g==="justify"||g==="justify-center"&&!_||g==="justify-right"&&!_||g==="justify-left"&&!_?0:(g==="center"&&(d=h/2),g==="right"&&(d=h),g==="justify-center"&&(d=h/2),g==="justify-right"&&(d=h),f==="rtl"&&(d-=h),d)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i]!==void 0)return this.__lineWidths[i];var n=this.measureLine(i).width;return this.__lineWidths[i]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,n,h){var g=this._getStyleDeclaration(i,n);return g&&g[h]!==void 0?g[h]:this[h]},_renderTextDecoration:function(i,n){if(this[n]||this.styleHas(n)){for(var h,g,f,d,_,w,E,T,S,D,B,X,z,te,ee,O,x=this._getLeftOffset(),R=this._getTopOffset(),N=this.path,G=this._getWidthOfCharSpacing(),W=this.offsets[n],k=0,F=this._textLines.length;k<F;k++)if(h=this.getHeightOfLine(k),this[n]||this.styleHas(n,k)){E=this._textLines[k],te=h/this.lineHeight,d=this._getLineLeftOffset(k),D=0,B=0,T=this.getValueOfPropertyAt(k,0,n),O=this.getValueOfPropertyAt(k,0,"fill"),S=R+te*(1-this._fontSizeFraction),g=this.getHeightOfChar(k,0),_=this.getValueOfPropertyAt(k,0,"deltaY");for(var U=0,Y=E.length;U<Y;U++)if(X=this.__charBounds[k][U],z=this.getValueOfPropertyAt(k,U,n),ee=this.getValueOfPropertyAt(k,U,"fill"),f=this.getHeightOfChar(k,U),w=this.getValueOfPropertyAt(k,U,"deltaY"),N&&z&&ee)i.save(),i.fillStyle=O,i.translate(X.renderLeft,X.renderTop),i.rotate(X.angle),i.fillRect(-X.kernedWidth/2,W*f+w,X.kernedWidth,this.fontSize/15),i.restore();else if((z!==T||ee!==O||f!==g||w!==_)&&B>0){var K=x+d+D;this.direction==="rtl"&&(K=this.width-K-B),T&&O&&(i.fillStyle=O,i.fillRect(K,S+W*g+_,B,this.fontSize/15)),D=X.left,B=X.width,T=z,O=ee,g=f,_=w}else B+=X.kernedWidth;K=x+d+D,this.direction==="rtl"&&(K=this.width-K-B),i.fillStyle=ee,z&&ee&&i.fillRect(K,S+W*g+_,B-G,this.fontSize/15),R+=h}else R+=h;this._removeShadow(i)}},_getFontDeclaration:function(i,n){var h=i||this,g=this.fontFamily,f=s.Text.genericFonts.indexOf(g.toLowerCase())>-1,d=g===void 0||g.indexOf("'")>-1||g.indexOf(",")>-1||g.indexOf('"')>-1||f?h.fontFamily:'"'+h.fontFamily+'"';return[s.isLikelyNode?h.fontWeight:h.fontStyle,s.isLikelyNode?h.fontStyle:h.fontWeight,n?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",d].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var n=i.split(this._reNewline),h=new Array(n.length),g=[`
`],f=[],d=0;d<n.length;d++)h[d]=s.util.string.graphemeSplit(n[d]),f=f.concat(h[d],g);return f.pop(),{_unwrappedLines:h,lines:n,graphemeText:f,graphemeLines:h}},toObject:function(i){var n=u.concat(i),h=this.callSuper("toObject",n);return h.styles=l(this.styles,!0),h.path&&(h.path=this.path.toObject()),h},set:function(i,n){this.callSuper("set",i,n);var h=!1,g=!1;if(typeof i=="object")for(var f in i)f==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(f)!==-1,g=g||f==="path";else h=this._dimensionAffectingProps.indexOf(i)!==-1,g=i==="path";return g&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(i,n,h){if(!i)return n(null);var g=s.parseAttributes(i,s.Text.ATTRIBUTE_NAMES),f=g.textAnchor||"left";if((h=s.util.object.extend(h?l(h):{},g)).top=h.top||0,h.left=h.left||0,g.textDecoration){var d=g.textDecoration;d.indexOf("underline")!==-1&&(h.underline=!0),d.indexOf("overline")!==-1&&(h.overline=!0),d.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in g&&(h.left+=g.dx),"dy"in g&&(h.top+=g.dy),"fontSize"in h||(h.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var _="";"textContent"in i?_=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(_=i.firstChild.data),_=_.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var w=h.strokeWidth;h.strokeWidth=0;var E=new s.Text(_,h),T=E.getScaledHeight()/E.height,S=((E.height+E.strokeWidth)*E.lineHeight-E.height)*T,D=E.getScaledHeight()+S,B=0;f==="center"&&(B=E.getScaledWidth()/2),f==="right"&&(B=E.getScaledWidth()),E.set({left:E.left-B,top:E.top-(D-E.fontSize*(.07+E._fontSizeFraction))/E.lineHeight,strokeWidth:w!==void 0?w:1}),n(E)},s.Text.fromObject=function(i,n){var h=l(i),g=i.path;return delete h.path,s.Object._fromObject("Text",h,function(f){g?s.Object._fromObject("Path",g,function(d){f.set("path",d),n(f)},"path"):n(f)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}}(e),v.util.object.extend(v.Text.prototype,{isEmptyStyles:function(a){if(!this.styles||a!==void 0&&!this.styles[a])return!0;var s=a===void 0?this.styles:{line:this.styles[a]};for(var l in s)for(var u in s[l])for(var i in s[l][u])return!1;return!0},styleHas:function(a,s){if(!this.styles||!a||a===""||s!==void 0&&!this.styles[s])return!1;var l=s===void 0?this.styles:{0:this.styles[s]};for(var u in l)for(var i in l[u])if(l[u][i][a]!==void 0)return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||a==="")return!1;var s,l,u=this.styles,i=0,n=!0,h=0;for(var g in u){for(var f in s=0,u[g]){var d;i++,(d=u[g][f]).hasOwnProperty(a)?(l?d[a]!==l&&(n=!1):l=d[a],d[a]===this[a]&&delete d[a]):n=!1,Object.keys(d).length!==0?s++:delete u[g][f]}s===0&&delete u[g]}for(var _=0;_<this._textLines.length;_++)h+=this._textLines[_].length;n&&i===h&&(this[a]=l,this.removeStyle(a))},removeStyle:function(a){if(this.styles&&a&&a!==""){var s,l,u,i=this.styles;for(l in i){for(u in s=i[l])delete s[u][a],Object.keys(s[u]).length===0&&delete s[u];Object.keys(s).length===0&&delete i[l]}}},_extendStyles:function(a,s){var l=this.get2DCursorLocation(a);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),v.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),s)},get2DCursorLocation:function(a,s){a===void 0&&(a=this.selectionStart);for(var l=s?this._unwrappedTextLines:this._textLines,u=l.length,i=0;i<u;i++){if(a<=l[i].length)return{lineIndex:i,charIndex:a};a-=l[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:l[i-1].length<a?l[i-1].length:a}},getSelectionStyles:function(a,s,l){a===void 0&&(a=this.selectionStart||0),s===void 0&&(s=this.selectionEnd||a);for(var u=[],i=a;i<s;i++)u.push(this.getStyleAtPosition(i,l));return u},getStyleAtPosition:function(a,s){var l=this.get2DCursorLocation(a);return(s?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex))||{}},setSelectionStyles:function(a,s,l){s===void 0&&(s=this.selectionStart||0),l===void 0&&(l=this.selectionEnd||s);for(var u=s;u<l;u++)this._extendStyles(u,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,s){var l=this.styles&&this.styles[a];return l?l[s]:null},getCompleteStyleDeclaration:function(a,s){for(var l,u=this._getStyleDeclaration(a,s)||{},i={},n=0;n<this._styleProperties.length;n++)i[l=this._styleProperties[n]]=u[l]===void 0?this[l]:u[l];return i},_setStyleDeclaration:function(a,s,l){this.styles[a][s]=l},_deleteStyleDeclaration:function(a,s){delete this.styles[a][s]},_getLineStyle:function(a){return!!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}}),function(){function a(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}v.IText=v.util.createClass(v.Text,v.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,l){this.callSuper("initialize",s,l),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,l){this[s]!==l&&(this._fireSelectionChanged(),this[s]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),s||l.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,l):this.renderSelection(s,l),l.restore()}},_clearTextArea:function(s){var l=this.width+4,u=this.height+4;s.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(s){s===void 0&&(s=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),i=this._getCursorBoundariesOffsets(s);return{left:l,top:u,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,i,n,h=0,g=0,f=this.get2DCursorLocation(s);i=f.charIndex,u=f.lineIndex;for(var d=0;d<u;d++)h+=this.getHeightOfLine(d);l=this._getLineLeftOffset(u);var _=this.__charBounds[u][i];return _&&(g=_.left),this.charSpacing!==0&&i===this._textLines[u].length&&(g-=this._getWidthOfCharSpacing()),n={top:h,left:l+(g>0?g:0)},this.direction==="rtl"&&(n.left*=-1),this.cursorOffsetCache=n,this.cursorOffsetCache},renderCursor:function(s,l){var u=this.get2DCursorLocation(),i=u.lineIndex,n=u.charIndex>0?u.charIndex-1:0,h=this.getValueOfPropertyAt(i,n,"fontSize"),g=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/g,d=s.topOffset,_=this.getValueOfPropertyAt(i,n,"deltaY");d+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,n,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(s.left+s.leftOffset-f/2,d+s.top+_,f,h)},renderSelection:function(s,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(u),g=this.get2DCursorLocation(i),f=h.lineIndex,d=g.lineIndex,_=h.charIndex<0?0:h.charIndex,w=g.charIndex<0?0:g.charIndex,E=f;E<=d;E++){var T,S=this._getLineLeftOffset(E)||0,D=this.getHeightOfLine(E),B=0,X=0;if(E===f&&(B=this.__charBounds[f][_].left),E>=f&&E<d)X=n&&!this.isEndOfWrapping(E)?this.width:this.getLineWidth(E)||5;else if(E===d)if(w===0)X=this.__charBounds[d][w].left;else{var z=this._getWidthOfCharSpacing();X=this.__charBounds[d][w-1].left+this.__charBounds[d][w-1].width-z}T=D,(this.lineHeight<1||E===d&&this.lineHeight>1)&&(D/=this.lineHeight);var te=s.left+S+B,ee=X-B,O=D,x=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",O=1,x=D):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(te=this.width-te-ee),l.fillRect(te,s.top+s.topOffset+x,ee,O),s.topOffset+=T}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),l=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:l}}}),v.IText.fromObject=function(s,l){if(a(s),s.styles)for(var u in s.styles)for(var i in s.styles[u])a(s.styles[u][i]);v.Object._fromObject("IText",s,l,"text")}}(),fe=v.util.object.clone,v.util.object.extend(v.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var a=this;this.on("added",function(){var s=a.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,a._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var s=a.canvas;s&&(s._iTextInstances=s._iTextInstances||[],v.util.removeFromArray(s._iTextInstances,a),s._iTextInstances.length===0&&(s._hasITextHandlers=!1,a._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(a){a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(s){s.__isMousedown=!1})},a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,s,l,u){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",s,{duration:l,onComplete:function(){i.isAborted||a[u]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var s=this,l=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},l)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(a){var s=0,l=a-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)s++,l--;for(;/\S/.test(this._text[l])&&l>-1;)s++,l--;return a-s},findWordBoundaryRight:function(a){var s=0,l=a;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)s++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)s++,l++;return a+s},findLineBoundaryLeft:function(a){for(var s=0,l=a-1;!/\n/.test(this._text[l])&&l>-1;)s++,l--;return a-s},findLineBoundaryRight:function(a){for(var s=0,l=a;!/\n/.test(this._text[l])&&l<this._text.length;)s++,l++;return a+s},searchWordBoundary:function(a,s){for(var l=this._text,u=this._reSpace.test(l[a])?a-1:a,i=l[u],n=v.reNonWord;!n.test(i)&&u>0&&u<l.length;)i=l[u+=s];return n.test(i)&&(u+=s===1?0:1),u},selectWord:function(a){a=a||this.selectionStart;var s=this.searchWordBoundary(a,-1),l=this.searchWordBoundary(a,1);this.selectionStart=s,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){a=a||this.selectionStart;var s=this.findLineBoundaryLeft(a),l=this.findLineBoundaryRight(a);return this.selectionStart=s,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(a){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(a.e),l=this.selectionStart,u=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&l!==u||l!==s&&u!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===l&&this.selectionEnd===u||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(a,s,l){var u=l.slice(0,a),i=v.util.string.graphemeSplit(u).length;if(a===s)return{selectionStart:i,selectionEnd:i};var n=l.slice(a,s);return{selectionStart:i,selectionEnd:i+v.util.string.graphemeSplit(n).length}},fromGraphemeToStringSelection:function(a,s,l){var u=l.slice(0,a).join("").length;return a===s?{selectionStart:u,selectionEnd:u}:{selectionStart:u,selectionEnd:u+l.slice(a,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var a=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=a.selectionEnd,this.inCompositionMode||(this.selectionStart=a.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(a),l=this.get2DCursorLocation(a),u=l.lineIndex,i=l.charIndex,n=this.getValueOfPropertyAt(u,i,"fontSize")*this.lineHeight,h=s.leftOffset,g=this.calcTransformMatrix(),f={x:s.left+h,y:s.top+s.topOffset+n},d=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,w=_.width/d,E=_.height/d,T=w-n,S=E-n,D=_.clientWidth/w,B=_.clientHeight/E;return f=v.util.transformPoint(f,g),(f=v.util.transformPoint(f,this.canvas.viewportTransform)).x*=D,f.y*=B,f.x<0&&(f.x=0),f.x>T&&(f.x=T),f.y<0&&(f.y=0),f.y>S&&(f.y=S),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},removeStyleFromTo:function(a,s){var l,u,i=this.get2DCursorLocation(a,!0),n=this.get2DCursorLocation(s,!0),h=i.lineIndex,g=i.charIndex,f=n.lineIndex,d=n.charIndex;if(h!==f){if(this.styles[h])for(l=g;l<this._unwrappedTextLines[h].length;l++)delete this.styles[h][l];if(this.styles[f])for(l=d;l<this._unwrappedTextLines[f].length;l++)(u=this.styles[f][l])&&(this.styles[h]||(this.styles[h]={}),this.styles[h][g+l-d]=u);for(l=h+1;l<=f;l++)delete this.styles[l];this.shiftLineStyles(f,h-f)}else if(this.styles[h]){u=this.styles[h];var _,w,E=d-g;for(l=g;l<d;l++)delete u[l];for(w in this.styles[h])(_=parseInt(w,10))>=d&&(u[_-E]=u[w],delete u[w])}},shiftLineStyles:function(a,s){var l=fe(this.styles);for(var u in this.styles){var i=parseInt(u,10);i>a&&(this.styles[i+s]=l[i],l[i-s]||delete this.styles[i])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(a,s,l,u){var i,n={},h=!1,g=this._unwrappedTextLines[a].length===s;for(var f in l||(l=1),this.shiftLineStyles(a,l),this.styles[a]&&(i=this.styles[a][s===0?s:s-1]),this.styles[a]){var d=parseInt(f,10);d>=s&&(h=!0,n[d-s]=this.styles[a][f],g&&s===0||delete this.styles[a][f])}var _=!1;for(h&&!g&&(this.styles[a+l]=n,_=!0),_&&l--;l>0;)u&&u[l-1]?this.styles[a+l]={0:fe(u[l-1])}:i?this.styles[a+l]={0:fe(i)}:delete this.styles[a+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(a,s,l,u){this.styles||(this.styles={});var i=this.styles[a],n=i?fe(i):{};for(var h in l||(l=1),n){var g=parseInt(h,10);g>=s&&(i[g+l]=n[g],n[g-l]||delete i[g])}if(this._forceClearCache=!0,u)for(;l--;)Object.keys(u[l]).length&&(this.styles[a]||(this.styles[a]={}),this.styles[a][s+l]=fe(u[l]));else if(i)for(var f=i[s?s-1:1];f&&l--;)this.styles[a][s+l]=fe(f)},insertNewStyleBlock:function(a,s,l){for(var u=this.get2DCursorLocation(s,!0),i=[0],n=0,h=0;h<a.length;h++)a[h]===`
`?i[++n]=0:i[n]++;for(i[0]>0&&(this.insertCharStyleObject(u.lineIndex,u.charIndex,i[0],l),l=l&&l.slice(i[0]+1)),n&&this.insertNewlineStyleObject(u.lineIndex,u.charIndex+i[0],n),h=1;h<n;h++)i[h]>0?this.insertCharStyleObject(u.lineIndex+h,0,i[h],l):l&&this.styles[u.lineIndex+h]&&l[0]&&(this.styles[u.lineIndex+h][0]=l[0]),l=l&&l.slice(i[h]+1);i[h]>0&&this.insertCharStyleObject(u.lineIndex+h,0,i[h],l)},setSelectionStartEndWithShift:function(a,s,l){l<=a?(s===a?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=l):l>a&&l<s?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(s===a?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=l)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}}),v.util.object.extend(v.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var s=a.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(a){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(a.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&a.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var s=this.getSelectionStartFromPointer(a),l=this.selectionStart,u=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(l,u,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var s,l=this.getLocalPointer(a),u=0,i=0,n=0,h=0,g=0,f=0,d=this._textLines.length;f<d&&n<=l.y;f++)n+=this.getHeightOfLine(f)*this.scaleY,g=f,f>0&&(h+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));i=this._getLineLeftOffset(g)*this.scaleX,s=this._textLines[g],this.direction==="rtl"&&(l.x=this.width*this.scaleX-l.x+i);for(var _=0,w=s.length;_<w&&(u=i,(i+=this.__charBounds[g][_].kernedWidth*this.scaleX)<=l.x);_++)h++;return this._getNewSelectionStartFromOffset(l,u,i,h,w)},_getNewSelectionStartFromOffset:function(a,s,l,u,i){var n=a.x-s,h=l-a.x,g=u+(h>n||h<0?0:1);return this.flipX&&(g=i-g),g>this._text.length&&(g=this._text.length),g}}),v.util.object.extend(v.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=v.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+a.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):v.document.body.appendChild(this.hiddenTextarea),v.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),v.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),v.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),v.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),v.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),v.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(v.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in s)this[s[a.keyCode]](a);else{if(!(a.keyCode in this.ctrlKeysMapDown)||!a.ctrlKey&&!a.metaKey)return;this[this.ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this.ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(a){var s=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),this.isEditing){var l,u,i,n,h,g=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,d=g.length,_=d-f,w=this.selectionStart,E=this.selectionEnd,T=w!==E;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),D=w>S.selectionStart;T?(l=this._text.slice(w,E),_+=E-w):d<f&&(l=D?this._text.slice(E+_,E):this._text.slice(w,w-_)),u=g.slice(S.selectionEnd-_,S.selectionEnd),l&&l.length&&(u.length&&(i=this.getSelectionStyles(w,w+1,!1),i=u.map(function(){return i[0]})),T?(n=w,h=E):D?(n=E-l.length,h=E):(n=E,h=E+l.length),this.removeStyleFromTo(n,h)),u.length&&(s&&u.join("")===v.copiedText&&!v.disableStyleCopyPaste&&(i=v.copiedTextStyle),this.insertNewStyleBlock(u,w,i)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(v.copiedText=this.getSelectedText(),v.disableStyleCopyPaste?v.copiedTextStyle=null:v.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||v.window.clipboardData},_getWidthBeforeCursor:function(a,s){var l,u=this._getLineLeftOffset(a);return s>0&&(u+=(l=this.__charBounds[a][s-1]).left+l.width),u},getDownCursorOffset:function(a,s){var l=this._getSelectionForOffset(a,s),u=this.get2DCursorLocation(l),i=u.lineIndex;if(i===this._textLines.length-1||a.metaKey||a.keyCode===34)return this._text.length-l;var n=u.charIndex,h=this._getWidthBeforeCursor(i,n),g=this._getIndexOnLine(i+1,h);return this._textLines[i].slice(n).length+g+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(a,s){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,s){var l=this._getSelectionForOffset(a,s),u=this.get2DCursorLocation(l),i=u.lineIndex;if(i===0||a.metaKey||a.keyCode===33)return-l;var n=u.charIndex,h=this._getWidthBeforeCursor(i,n),g=this._getIndexOnLine(i-1,h),f=this._textLines[i].slice(0,n),d=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+g-f.length+(1-d)},_getIndexOnLine:function(a,s){for(var l,u,i=this._textLines[a],n=this._getLineLeftOffset(a),h=0,g=0,f=i.length;g<f;g++)if((n+=l=this.__charBounds[a][g].width)>s){u=!0;var d=n-l,_=n,w=Math.abs(d-s);h=Math.abs(_-s)<w?g:g-1;break}return u||(h=i.length-1),h},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,s){var l=this["get"+a+"CursorOffset"](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var s=this._selectionDirection==="left"?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),a!==0},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),a!==0},moveCursorLeft:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",a)},_move:function(a,s,l){var u;if(a.altKey)u=this["findWordBoundary"+l](this[s]);else{if(!a.metaKey&&a.keyCode!==35&&a.keyCode!==36)return this[s]+=l==="Left"?-1:1,!0;u=this["findLineBoundary"+l](this[s])}if(typeof u!==void 0&&this[s]!==u)return this[s]=u,!0},_moveLeft:function(a,s){return this._move(a,s,"Left")},_moveRight:function(a,s){return this._move(a,s,"Right")},moveCursorLeftWithoutShift:function(a){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(a){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(a,"selectionStart")):void 0},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,s){var l="moveCursor"+a+"With";this._currentCursorOpacity=1,s.shiftKey?l+="Shift":l+="outShift",this[l](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(a,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(a){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(a,s){s===void 0&&(s=a+1),this.removeStyleFromTo(a,s),this._text.splice(a,s-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,s,l,u){u===void 0&&(u=l),u>l&&this.removeStyleFromTo(l,u);var i=v.util.string.graphemeSplit(a);this.insertNewStyleBlock(i,l,s),this._text=[].concat(this._text.slice(0,l),i,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var a=v.util.toFixed,s=/  +/g;v.util.object.extend(v.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",u?'text-decoration="'+u+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var i,n=[],h=[],g=l;this._setSVGBg(h);for(var f=0,d=this._textLines.length;f<d;f++)i=this._getLineLeftOffset(f),(this.textBackgroundColor||this.styleHas("textBackgroundColor",f))&&this._setSVGTextLineBg(h,f,u+i,g),this._setSVGTextLineText(n,f,u+i,g),g+=this.getHeightOfLine(f);return{textSpans:n,textBgRects:h}},_createTextCharSpan:function(l,u,i,n){var h=l!==l.trim()||l.match(s),g=this.getSvgSpanStyles(u,h),f=g?'style="'+g+'"':"",d=u.deltaY,_="",w=v.Object.NUM_FRACTION_DIGITS;return d&&(_=' dy="'+a(d,w)+'" '),['<tspan x="',a(i,w),'" y="',a(n,w),'" ',_,f,">",v.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,i,n){var h,g,f,d,_,w=this.getHeightOfLine(u),E=this.textAlign.indexOf("justify")!==-1,T="",S=0,D=this._textLines[u];n+=w*(1-this._fontSizeFraction)/this.lineHeight;for(var B=0,X=D.length-1;B<=X;B++)_=B===X||this.charSpacing,T+=D[B],f=this.__charBounds[u][B],S===0?(i+=f.kernedWidth-f.width,S+=f.width):S+=f.kernedWidth,E&&!_&&this._reSpaceAndTab.test(D[B])&&(_=!0),_||(h=h||this.getCompleteStyleDeclaration(u,B),g=this.getCompleteStyleDeclaration(u,B+1),_=this._hasStyleChangedForSvg(h,g)),_&&(d=this._getStyleDeclaration(u,B)||{},l.push(this._createTextCharSpan(T,d,i,n)),T="",h=g,i+=S,S=0)},_pushTextBgRect:function(l,u,i,n,h,g){var f=v.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',a(i,f),'" y="',a(n,f),'" width="',a(h,f),'" height="',a(g,f),`"></rect>
`)},_setSVGTextLineBg:function(l,u,i,n){for(var h,g,f=this._textLines[u],d=this.getHeightOfLine(u)/this.lineHeight,_=0,w=0,E=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),T=0,S=f.length;T<S;T++)h=this.__charBounds[u][T],(g=this.getValueOfPropertyAt(u,T,"textBackgroundColor"))!==E?(E&&this._pushTextBgRect(l,E,i+w,n,_,d),w=h.left,_=h.width,E=g):_+=h.kernedWidth;g&&this._pushTextBgRect(l,g,i+w,n,_,d)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new v.Color(l):"";return u&&u.getSource()&&u.getAlpha()!==1?'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"':'fill="'+l+'"'},_getSVGLineTopOffset:function(l){for(var u,i=0,n=0;n<l;n++)i+=this.getHeightOfLine(n);return u=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*u/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){return v.Object.prototype.getSvgStyles.call(this,l)+" white-space: pre;"}})}(),function(a){var s=a.fabric||(a.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,i=0,n=0,h={},g=0;g<l.graphemeLines.length;g++)l.graphemeText[n]===`
`&&g>0?(i=0,n++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[n])&&g>0&&(i++,n++),h[g]={line:u,offset:i},n+=l.graphemeLines[g].length,i+=l.graphemeLines[g].length;return h},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[u];i&&(u=i.line)}return s.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u,i,n=0,h=!1,g=this._styleMap[l],f=this._styleMap[l+1];for(var d in g&&(l=g.line,n=g.offset),f&&(h=f.line===l,u=f.offset),i=l===void 0?this.styles:{line:this.styles[l]})for(var _ in i[d])if(_>=n&&(!h||_<u))for(var w in i[d][_])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[l];if(!i)return null;l=i.line,u=i.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,i){var n=this._styleMap[l];l=n.line,u=n.offset+u,this.styles[l][u]=i},_deleteStyleDeclaration:function(l,u){var i=this._styleMap[l];l=i.line,u=i.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var i,n=[];for(this.isWrapping=!0,i=0;i<l.length;i++)n=n.concat(this._wrapLine(l[i],i,u));return this.isWrapping=!1,n},_measureWord:function(l,u,i){var n,h=0;i=i||0;for(var g=0,f=l.length;g<f;g++)h+=this._getGraphemeBox(l[g],u,g+i,n,!0).kernedWidth,n=l[g];return h},_wrapLine:function(l,u,i,n){var h=0,g=this.splitByGrapheme,f=[],d=[],_=g?s.util.string.graphemeSplit(l):l.split(this._wordJoiners),w="",E=0,T=g?"":" ",S=0,D=0,B=0,X=!0,z=this._getWidthOfCharSpacing();n=n||0,_.length===0&&_.push([]),i-=n;for(var te=0;te<_.length;te++)w=g?_[te]:s.util.string.graphemeSplit(_[te]),S=this._measureWord(w,u,E),E+=w.length,(h+=D+S-z)>i&&!X?(f.push(d),d=[],h=S,X=!0):h+=z,X||g||d.push(T),d=d.concat(w),D=g?0:this._measureWord([T],u,E),E++,X=!1,S>B&&(B=S);return te&&f.push(d),B+n>this.dynamicMinWidth&&(this.dynamicMinWidth=B-z+n),f},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=s.Text.prototype._splitTextIntoLines.call(this,l),i=this._wrapText(u.lines,this.width),n=new Array(i.length),h=0;h<i.length;h++)n[h]=i[h].join("");return u.lines=n,u.graphemeLines=i,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),s.Textbox.fromObject=function(l,u){return s.Object._fromObject("Textbox",l,u,"text")}}(e),function(){var a=v.controlsUtils,s=a.scaleSkewCursorStyleHandler,l=a.scaleCursorStyleHandler,u=a.scalingEqually,i=a.scalingYOrSkewingX,n=a.scalingXOrSkewingY,h=a.scaleOrSkewActionName,g=v.Object.prototype.controls;if(g.ml=new v.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:h}),g.mr=new v.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:h}),g.mb=new v.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:i,getActionName:h}),g.mt=new v.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:i,getActionName:h}),g.tl=new v.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),g.tr=new v.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),g.bl=new v.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),g.br=new v.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),g.mtr=new v.Control({x:0,y:-.5,actionHandler:a.rotationWithSnapping,cursorStyleHandler:a.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),v.Textbox){var f=v.Textbox.prototype.controls={};f.mtr=g.mtr,f.tr=g.tr,f.br=g.br,f.tl=g.tl,f.bl=g.bl,f.mt=g.mt,f.mb=g.mb,f.mr=new v.Control({x:.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),f.ml=new v.Control({x:-.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},hh={};function vr(t){var e=hh[t];if(e!==void 0)return e.exports;var r=hh[t]={exports:{}};return eg[t](r,r.exports,vr),r.exports}vr.d=(t,e)=>{for(var r in e)vr.o(e,r)&&!vr.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},vr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Yc={};(()=>{let t;vr.d(Yc,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?vr(653).fabric:{version:"5.2.1"}})();var mt,Vt,$i,ch,Be=Yc.R;(function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"})(mt||(mt={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(Vt||(Vt={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}($i||($i={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(ch||(ch={}));const qr=t=>typeof t=="number"&&!Number.isNaN(t),ma=t=>typeof t=="string";var Es,_n,Mr,_a,ai,ao;(function(t){t[t.ARC=0]="ARC",t[t.IMAGE=1]="IMAGE",t[t.LINE=2]="LINE",t[t.POLYGON=3]="POLYGON",t[t.QUAD=4]="QUAD",t[t.RECT=5]="RECT",t[t.TEXT=6]="TEXT",t[t.GROUP=7]="GROUP"})(ai||(ai={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED"}(ao||(ao={}));let Dt=class{get mediaType(){return new Map([["rect",mt.DIMT_RECTANGLE],["quad",mt.DIMT_QUADRILATERAL],["text",mt.DIMT_TEXT],["arc",mt.DIMT_ARC],["image",mt.DIMT_IMAGE],["polygon",mt.DIMT_POLYGON],["line",mt.DIMT_LINE],["group",mt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(M(this,_n,"f")){case Vt.DIS_DEFAULT:return"default";case Vt.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(M(this,Mr,"f")==="image"&&e==="view"?this.updateCoordinateBaseFromImageToView():M(this,Mr,"f")==="view"&&e==="image"&&this.updateCoordinateBaseFromViewToImage()),Se(this,Mr,e,"f")}get coordinateBase(){return M(this,Mr,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,r){if(Es.add(this),_n.set(this,void 0),Mr.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,r!=null&&!qr(r))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(Vt.DIS_DEFAULT),this.styleId=r}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.setState(Vt.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Vt.DIS_SELECTED):this.setState(Vt.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){Se(this,_n,e,"f")}getState(){return M(this,_n,"f")}_on(e,r){if(!r)return;const o=e.toLowerCase(),c=this.mapEvent_Callbacks.get(o);if(!c)throw new Error(`Event '${e}' does not exist.`);let p=c.get(r);p||(p=m=>{const y=m.e;if(!y)return void(r&&r.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const C={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let b,I,A,L;const P=y.target.getBoundingClientRect();b=P.left,I=P.top,A=b+window.scrollX,L=I+window.scrollY;const{width:j,height:H}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),$=this._drawingLayer.width,Z=this._drawingLayer.height,q=j/H,J=$/Z,ie=this._drawingLayer._getObjectFit();let ne,he,fe,v,ae=1;if(ie==="contain")q<J?(ae=j/$,ne=b+this.get("x")*ae,he=I+this.get("y")*ae+(H-Z*ae)/2,fe=A+this.get("x")*ae,v=L+this.get("y")*ae+(H-Z*ae)/2):(ae=H/Z,ne=b+this.get("x")*ae+(j-$*ae)/2,he=I+this.get("y")*ae,fe=A+this.get("x")*ae+(j-$*ae)/2,v=L+this.get("y")*ae);else if(ie==="cover")if(q<J){ae=H/Z;let me=this.get("x")*ae-($*ae-j)/2;me=Math.max(me,0),me=Math.min(me,j),ne=b+me,he=I+this.get("y")*ae,fe=A+me,v=L+this.get("y")*ae}else{ae=j/$;let me=this.get("y")*ae-(Z*ae-H)/2;me=Math.max(me,0),me=Math.min(me,H),ne=b+this.get("x")*ae,he=I+me,fe=A+this.get("x")*ae,v=L+me}C.itemClientX=Math.round(ne),C.itemClientY=Math.round(he),C.itemPageX=Math.round(fe),C.itemPageY=Math.round(v)}for(let b of Object.getOwnPropertyNames(C))Object.defineProperty(y,b,{value:C[b],writable:!0});r&&r.apply(this,[y])},c.set(r,p),this._fabricObject.on(o==="dblclick"?"mousedblclick":o,p))}on(e,r){this._on(e,r)}_off(e,r){const o=e.toLowerCase(),c=this.mapEvent_Callbacks.get(o);if(!c)throw new Error(`Event '${e}' does not exist.`);let p=c.get(r);p&&(c.delete(r),this._fabricObject.off(o==="dblclick"?"mousedblclick":o,p))}off(e,r){this._off(e,r)}_setEditable(e){const r=this._fabricObject;e?(r.selectable=!0,r.hasControls=!0,r.hoverCursor=null):(r.selectable=!1,r.hasControls=!1,r.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,r){if(this.hasNote(e.name)&&!r)throw new Error("A note with the same name already exists, please use a different name.");const o=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[o])}getNote(e){const r=this.mapNoteName_Content.get(e);return r?r.length===1?{name:e,content:r[0]?JSON.parse(JSON.stringify(r[0])):r[0]}:{name:e,content:JSON.parse(JSON.stringify(r))}:null}getNotes(){const e=[];for(let r of this.mapNoteName_Content){let o=r[1].length===1?r[1][0]:r[1];o=o&&JSON.parse(JSON.stringify(o)),e.push({name:r[0],content:o})}return e}updateNote(e,r,o){const c=this.mapNoteName_Content.get(e);if(!c)throw new Error("The note name does not exist.");o||(c.length=0),r=r&&JSON.parse(JSON.stringify(r)),c.push(r)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,r){if(!this.extendSet(e,r))if(e==="x"){const o=this._fabricObject.group;o?(this._fabricObject.set("left",r-o.left-o.width/2),o.addWithUpdate()):this._fabricObject.set("left",r)}else if(e==="y"){const o=this._fabricObject.group;o?(this._fabricObject.set("top",r-o.top-o.height/2),o.addWithUpdate()):this._fabricObject.set("top",r)}else e==="styleId"?this.styleId=r:this._fabricObject.set(e,r);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let r=this.extendGet(e);if(r===void 0)if(e==="x"){const o=this._fabricObject.group;r=o?this._fabricObject.get("left")+o.left+o.width/2:this._fabricObject.get("left")}else if(e==="y"){const o=this._fabricObject.group;r=o?this._fabricObject.get("top")+o.top+o.height/2:this._fabricObject.get("top")}else r=e==="scaledWidth"?this._fabricObject.getScaledWidth():e==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:e==="state"?this.getState():e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return r}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e*M(this,Es,"m",_a).call(this)}convertPropFromViewToImage(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e/M(this,Es,"m",_a).call(this)}_setLineWidth(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}};_n=new WeakMap,Mr=new WeakMap,Es=new WeakSet,_a=function(){const t=this._drawingLayer;if(!t)return 1;const e=t.width,r=t.height,{width:o,height:c}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(o<=0||c<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const p=o/e,m=c/r,y=t._getObjectFit();let C=1;return y==="contain"?p<m?C=o/e:C=c/r:y==="cover"&&(p<m?C=c/r:C=o/e),C},Dt.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Dt.mapItemType=new Map([[ai.ARC,"arc"],[ai.IMAGE,"image"],[ai.LINE,"line"],[ai.POLYGON,"polygon"],[ai.QUAD,"quad"],[ai.RECT,"rect"],[ai.TEXT,"text"],[ai.GROUP,"group"]]),Dt.arrStyleSelectors=["default","selected"],Dt.mapItemState=new Map([[ao.DEFAULT,"default"],[ao.SELECTED,"selected"]]);const Xc=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),Vo=t=>!!ma(t)&&t!=="",cl=Bd,uh=jd,tg=nl,fh=Ud,br=Vd,dh=t=>!!Xc(t)&&!("id"in t&&!qr(t.id))&&!("lineWidth"in t&&!qr(t.lineWidth))&&!("fillStyle"in t&&!Vo(t.fillStyle))&&!("strokeStyle"in t&&!Vo(t.strokeStyle))&&!("paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode))&&!("fontFamily"in t&&!Vo(t.fontFamily))&&!("fontSize"in t&&!qr(t.fontSize));class bs{static convert(e,r,o){const c={x:0,y:0,width:r,height:o};if(!e)return c;if(br(e))e.isMeasuredInPercentage?(c.x=e.x/100*r,c.y=e.y/100*o,c.width=e.width/100*r,c.height=e.height/100*o):(c.x=e.x,c.y=e.y,c.width=e.width,c.height=e.height);else{if(!cl(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(c.x=e.left/100*r,c.y=e.top/100*o,c.width=(e.right-e.left)/100*r,c.height=(e.bottom-e.top)/100*o):(c.x=e.left,c.y=e.top,c.width=e.right-e.left,c.height=e.bottom-e.top)}return c.x=Math.round(c.x),c.y=Math.round(c.y),c.width=Math.round(c.width),c.height=Math.round(c.height),c}}var fr,Ss;class zc{constructor(){fr.set(this,new Map),Ss.set(this,!1)}get disposed(){return M(this,Ss,"f")}on(e,r){e=e.toLowerCase();const o=M(this,fr,"f").get(e);if(o){if(o.includes(r))return;o.push(r)}else M(this,fr,"f").set(e,[r])}off(e,r){e=e.toLowerCase();const o=M(this,fr,"f").get(e);if(!o)return;const c=o.indexOf(r);c!==-1&&o.splice(c,1)}offAll(e){e=e.toLowerCase();const r=M(this,fr,"f").get(e);r&&(r.length=0)}fire(e,r=[],o={async:!1,copy:!0}){r||(r=[]),e=e.toLowerCase();const c=M(this,fr,"f").get(e);if(c&&c.length){o=Object.assign({async:!1,copy:!0},o);for(let p of c){if(!p)continue;let m=[];if(o.copy)for(let C of r){try{C=JSON.parse(JSON.stringify(C))}catch{}m.push(C)}else m=r;let y=!1;if(o.async)setTimeout(()=>{this.disposed||c.includes(p)&&p.apply(o.target,m)},0);else try{y=p.apply(o.target,m)}catch{}if(y===!0)break}}}dispose(){Se(this,Ss,!0,"f")}}function ig(t,e,r){return(r.x-t.x)*(e.y-t.y)==(e.x-t.x)*(r.y-t.y)&&Math.min(t.x,e.x)<=r.x&&r.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=r.y&&r.y<=Math.max(t.y,e.y)}function Go(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function fs(t,e,r,o){let c=t[0]*(r[1]-e[1])+e[0]*(t[1]-r[1])+r[0]*(e[1]-t[1]),p=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!((c^p)>=0&&c!==0&&p!==0)&&(c=r[0]*(t[1]-o[1])+o[0]*(r[1]-t[1])+t[0]*(o[1]-r[1]),p=r[0]*(e[1]-o[1])+o[0]*(r[1]-e[1])+e[0]*(o[1]-r[1]),!((c^p)>=0&&c!==0&&p!==0))}fr=new WeakMap,Ss=new WeakMap;const rg=async t=>{if(typeof t!="string")throw new TypeError("Invalid url.");const e=await fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);const r=await e.text();if(!r.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const o=document.createElement("div");if(o.insertAdjacentHTML("beforeend",r),o.childElementCount===1&&o.firstChild instanceof HTMLTemplateElement)return o.firstChild.content;const c=new DocumentFragment;for(let p of o.children)c.append(p);return c};var Ni,ji,Ui;class Ar extends Dt{constructor(e,r){if(super(null,r),Ni.set(this,void 0),!br(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Be.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),Se(this,Ni,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,r){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){M(this,Ni,"f")&&this.setRect(M(this,Ni,"f"))}setRect(e){if(!br(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else Se(this,Ni,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return M(this,Ni,"f")?JSON.parse(JSON.stringify(M(this,Ni,"f"))):null}}function gh(t,e,r){let o=r.points[this.pointIndex].x-r.pathOffset.x,c=r.points[this.pointIndex].y-r.pathOffset.y;return Be.util.transformPoint({x:o,y:c},r.calcTransformMatrix())}function $c(t){let e=new Be.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Be.Point(t.width+e.x,t.height+e.y)}function ph(t,e,r,o){let c=e.target,p=c.controls[c.__corner],m=c.toLocalPoint(new Be.Point(r,o),"center","center"),y=$c(c),C=c._getTransformedDimensions(0,0),b={x:m.x*y.x/C.x+c.pathOffset.x,y:m.y*y.y/C.y+c.pathOffset.y};return c.points[p.pointIndex]=b,Be.controlsUtils.fireEvent("scaling",{e:t,transform:e,pointer:{x:r,y:o}}),!0}function mh(t,e){return function(r,o,c,p){let m=o.target,y=Be.util.transformPoint({x:m.points[t].x-m.pathOffset.x,y:m.points[t].y-m.pathOffset.y},m.calcTransformMatrix()),C=e(r,o,c,p);m._setPositionDimensions({});let b=$c(m),I=(m.points[t].x-m.pathOffset.x)/b.x,A=(m.points[t].y-m.pathOffset.y)/b.y;return m.setPositionByOrigin(y,I+.5,A+.5),C}}Ni=new WeakMap;class va extends Dt{constructor(e,r){if(super(null,r),ji.set(this,void 0),!uh(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Be.Polygon(e.points,{objectCaching:!1}));const o=this._fabricObject;let c=o.points.length-1;o.controls=o.points.reduce(function(p,m,y){return p["p"+y]=new Be.Control({positionHandler:gh,actionHandler:mh(y>0?y-1:c,ph),actionName:"modifyPolygon",pointIndex:y}),p},{}),Se(this,ji,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,r){if(e==="vertices"){const o=this._fabricObject;if(o.group){const p=o.group;o.points=r.map(m=>({x:m.x-p.left-p.width/2,y:m.y-p.top-p.height/2})),p.addWithUpdate()}else o.points=r;const c=o.points.length-1;return o.controls=o.points.reduce(function(p,m,y){return p["p"+y]=new Be.Control({positionHandler:gh,actionHandler:mh(y>0?y-1:c,ph),actionName:"modifyPolygon",pointIndex:y}),p},{}),o._setPositionDimensions({}),!0}}extendGet(e){if(e==="vertices"){const r=[],o=this._fabricObject;if(o.selectable&&!o.group)for(let c in o.oCoords)r.push({x:o.oCoords[c].x,y:o.oCoords[c].y});else for(let c of o.points){let p=c.x-o.pathOffset.x,m=c.y-o.pathOffset.y;const y=Be.util.transformPoint({x:p,y:m},o.calcTransformMatrix());r.push({x:y.x,y:y.y})}return r}}updateCoordinateBaseFromImageToView(){const e=this.get("vertices").map(r=>({x:this.convertPropFromViewToImage(r.x),y:this.convertPropFromViewToImage(r.y)}));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){const e=this.get("vertices").map(r=>({x:this.convertPropFromImageToView(r.x),y:this.convertPropFromImageToView(r.y)}));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){M(this,ji,"f")&&this.setPolygon(M(this,ji,"f"))}setPolygon(e){if(!uh(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const r=e.points.map(o=>({x:this.convertPropFromViewToImage(o.x),y:this.convertPropFromViewToImage(o.y)}));this.set("vertices",r)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Se(this,ji,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return M(this,ji,"f")?JSON.parse(JSON.stringify(M(this,ji,"f"))):null}}ji=new WeakMap;const _h=t=>{let e=(r=>r.split(`
`).map(o=>o.split("	")))(t);return(r=>{for(let o=0;;o++){let c=-1;for(let p=0;p<r.length;p++){let m=r[p][o];m!==void 0&&m.length>c&&(c=m.length)}if(c===-1)break;for(let p=0;p<r.length;p++){if(o>=r[p].length-1)continue;let m=" ".repeat(c+2-r[p][o].length);r[p][o]=r[p][o].concat(m)}}})(e),(r=>{let o="";for(let c=0;c<r.length;c++)o=o.concat(...r[c],c===r.length-1?"":`
`);return o})(e)};class ng extends Dt{constructor(e,r,o){if(super(null,o),Ui.set(this,void 0),!ma(e))throw new TypeError("Invalid 'text'.");if(!br(r))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Be.Textbox(_h(e),{left:r.x,top:r.y,width:r.width})),this._text=e,Se(this,Ui,JSON.parse(JSON.stringify(r)),"f"),this._mediaType="text"}extendSet(e,r){if(e==="text")return this._text=r,this._fabricObject.set("text",_h(r)),!0}extendGet(e){if(e==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){M(this,Ui,"f")&&this.setTextRect(M(this,Ui,"f"))}setText(e){if(!ma(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!br(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else Se(this,Ui,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return M(this,Ui,"f")?JSON.parse(JSON.stringify(M(this,Ui,"f"))):null}}var Vi,Gi,Fr,ya,Pr,vn,kr,Bt,yn,wn,Cn,Kc,Zc,qc,Jc,Ts,Ye,En,bn,Sn,ot,Is,xs,Os,Wi,Tn,In,wa,Mt,As,Qc,Ca,Ea,xn,Rs;Ui=new WeakMap;class sg extends va{constructor(e,r){if(super({points:e==null?void 0:e.points},r),Vi.set(this,void 0),!fh(e))throw new TypeError("Invalid 'quad'.");Se(this,Vi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){M(this,Vi,"f")&&this.setQuad(M(this,Vi,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!fh(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const r=e.points.map(o=>({x:this.convertPropFromViewToImage(o.x),y:this.convertPropFromViewToImage(o.y)}));this.set("vertices",r)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Se(this,Vi,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return M(this,Vi,"f")?JSON.parse(JSON.stringify(M(this,Vi,"f"))):null}}Vi=new WeakMap;class og extends Dt{constructor(e){super(new Be.Group(e.map(r=>r._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Vt.DIS_SELECTED);const r=this._fabricObject._objects;for(let o of r)setTimeout(()=>{o&&o.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Vt.DIS_DEFAULT);const r=this._fabricObject._objects;for(let o of r)setTimeout(()=>{o&&o.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(e,r){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(e=>e.getDrawingItem())}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}class pe{static createDrawingStyle(e){if(!dh(e))throw new Error("Invalid style definition.");let r,o=pe.USER_START_STYLE_ID;for(;M(pe,Gi,"f",Fr).has(o);)o++;r=o;const c=JSON.parse(JSON.stringify(e));c.id=r;for(let p in M(pe,Gi,"f",ya))c.hasOwnProperty(p)||(c[p]=M(pe,Gi,"f",ya)[p]);return M(pe,Gi,"f",Fr).set(r,c),c.id}static _getDrawingStyle(e,r){if(typeof e!="number")throw new Error("Invalid style id.");const o=M(pe,Gi,"f",Fr).get(e);return o?r?JSON.parse(JSON.stringify(o)):o:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(M(pe,Gi,"f",Fr).values())))}static _updateDrawingStyle(e,r){if(!dh(r))throw new Error("Invalid style definition.");const o=M(pe,Gi,"f",Fr).get(e);if(o)for(let c in r)o.hasOwnProperty(c)&&(o[c]=r[c])}static updateDrawingStyle(e,r){this._updateDrawingStyle(e,r)}}Gi=pe,pe.STYLE_BLUE_STROKE=1,pe.STYLE_GREEN_STROKE=2,pe.STYLE_ORANGE_STROKE=3,pe.STYLE_YELLOW_STROKE=4,pe.STYLE_BLUE_STROKE_FILL=5,pe.STYLE_GREEN_STROKE_FILL=6,pe.STYLE_ORANGE_STROKE_FILL=7,pe.STYLE_YELLOW_STROKE_FILL=8,pe.STYLE_BLUE_STROKE_TRANSPARENT=9,pe.STYLE_GREEN_STROKE_TRANSPARENT=10,pe.STYLE_ORANGE_STROKE_TRANSPARENT=11,pe.USER_START_STYLE_ID=1024,Fr={value:new Map([[pe.STYLE_BLUE_STROKE,{id:pe.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[pe.STYLE_GREEN_STROKE,{id:pe.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_ORANGE_STROKE,{id:pe.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_YELLOW_STROKE,{id:pe.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[pe.STYLE_BLUE_STROKE_FILL,{id:pe.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_GREEN_STROKE_FILL,{id:pe.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_ORANGE_STROKE_FILL,{id:pe.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_YELLOW_STROKE_FILL,{id:pe.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_BLUE_STROKE_TRANSPARENT,{id:pe.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_GREEN_STROKE_TRANSPARENT,{id:pe.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[pe.STYLE_ORANGE_STROKE_TRANSPARENT,{id:pe.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},ya={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(Be.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Be.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Be.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Be.Object.prototype.transparentCorners=!1,Be.Object.prototype.cornerSize=20,Be.Object.prototype.touchCornerSize=100,Be.Object.prototype.cornerColor="rgb(254,142,20)",Be.Object.prototype.cornerStyle="circle",Be.Object.prototype.strokeUniform=!0,Be.Object.prototype.hasBorders=!1,Be.Canvas.prototype.containerClass="",Be.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var r,o=this.upperCanvasEl,c=Be.util.getPointer(t,o),p=o.getBoundingClientRect(),m=p.width||0,y=p.height||0;m&&y||("top"in p&&"bottom"in p&&(y=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(m=Math.abs(p.right-p.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,e||(c=this.restorePointerVpt(c));var C=this.getRetinaScaling();if(C!==1&&(c.x/=C,c.y/=C),m!==0&&y!==0){var b=window.getComputedStyle(o).objectFit,I=o.width,A=o.height,L=m,P=y;r={width:I/L,height:A/P};var j,H,$=I/A,Z=L/P;return b==="contain"?$>Z?(j=L,H=L/$,{x:c.x*r.width,y:(c.y-(P-H)/2)*r.width}):(j=P*$,H=P,{x:(c.x-(L-j)/2)*r.height,y:c.y*r.height}):b==="cover"?$>Z?{x:(I-r.height*L)/2+c.x*r.height,y:c.y*r.height}:{x:c.x*r.width,y:(A-r.width*P)/2+c.y*r.width}:{x:c.x*r.width,y:c.y*r.height}}return r={width:1,height:1},{x:c.x*r.width,y:c.y*r.height}},Be.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();Be.util.addListener(Be.document,"touchend",this._onTouchEnd,{passive:!1}),Be.util.addListener(Be.document,"touchmove",this._onMouseMove,{passive:!1}),Be.util.removeListener(r,o+"down",this._onMouseDown)},Be.Textbox.prototype._wrapLine=function(t,e,r,o){const c=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),p=!(!c||!c.length);var m=0,y=this.splitByGrapheme||p,C=[],b=[],I=y?Be.util.string.graphemeSplit(t):t.split(this._wordJoiners),A="",L=0,P=y?"":" ",j=0,H=0,$=0,Z=!0,q=this._getWidthOfCharSpacing();o=o||0,I.length===0&&I.push([]),r-=o;for(var J=0;J<I.length;J++)A=y?I[J]:Be.util.string.graphemeSplit(I[J]),j=this._measureWord(A,e,L),L+=A.length,(m+=H+j-q)>r&&!Z?(C.push(b),b=[],m=j,Z=!0):m+=q,Z||y||b.push(P),b=b.concat(A),H=y?0:this._measureWord([P],e,L),L++,Z=!1,j>$&&($=j);return J&&C.push(b),$+o>this.dynamicMinWidth&&(this.dynamicMinWidth=$-q+o),C});class Je{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,r,o){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let m=this.fabricCanvas=new Be.Canvas(e,Object.assign(o,{allowTouchScrolling:!0,selection:!1}));m.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),m.lowerCanvasEl.className="",m.upperCanvasEl.className="",m.on("selection:created",function(y){const C=y.selected,b=[];for(let I of C){const A=I.getDrawingItem()._drawingLayer;A&&!b.includes(A)&&b.push(A)}for(let I of b){const A=[];for(let L of C){const P=L.getDrawingItem();P._drawingLayer===I&&A.push(P)}setTimeout(()=>{I.onSelectionChanged&&I.onSelectionChanged(A,[])},0)}}),m.on("before:selection:cleared",function(y){const C=this.getActiveObjects(),b=[];for(let I of C){const A=I.getDrawingItem()._drawingLayer;A&&!b.includes(A)&&b.push(A)}for(let I of b){const A=[];for(let L of C){const P=L.getDrawingItem();P._drawingLayer===I&&A.push(P)}setTimeout(()=>{const L=[];for(let P of A)I.hasDrawingItem(P)&&L.push(P);L.length>0&&I.onSelectionChanged&&I.onSelectionChanged([],L)},0)}}),m.on("selection:updated",function(y){const C=y.selected,b=y.deselected,I=[];for(let A of C){const L=A.getDrawingItem()._drawingLayer;L&&!I.includes(L)&&I.push(L)}for(let A of b){const L=A.getDrawingItem()._drawingLayer;L&&!I.includes(L)&&I.push(L)}for(let A of I){const L=[],P=[];for(let j of C){const H=j.getDrawingItem();H._drawingLayer===A&&L.push(H)}for(let j of b){const H=j.getDrawingItem();H._drawingLayer===A&&P.push(H)}setTimeout(()=>{A.onSelectionChanged&&A.onSelectionChanged(L,P)},0)}}),m.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let c,p;switch(this.id=r,r){case Je.DDN_LAYER_ID:c=pe.getDrawingStyle(pe.STYLE_BLUE_STROKE),p=pe.getDrawingStyle(pe.STYLE_BLUE_STROKE_FILL);break;case Je.DBR_LAYER_ID:c=pe.getDrawingStyle(pe.STYLE_ORANGE_STROKE),p=pe.getDrawingStyle(pe.STYLE_ORANGE_STROKE_FILL);break;case Je.DLR_LAYER_ID:c=pe.getDrawingStyle(pe.STYLE_GREEN_STROKE),p=pe.getDrawingStyle(pe.STYLE_GREEN_STROKE_FILL);break;default:c=pe.getDrawingStyle(pe.STYLE_YELLOW_STROKE),p=pe.getDrawingStyle(pe.STYLE_YELLOW_STROKE_FILL)}for(let m of Dt.arrMediaTypes)this.mapType_StateAndStyleId.set(m,{default:c.id,selected:p.id})}getId(){return this.id}setVisible(e){if(e){for(let r of this._arrFabricObject)r.visible=!0,r.hasControls=!0;this._visible=!0}else{for(let r of this._arrFabricObject)r.visible=!1,r.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(e){return e.styleId?pe.getDrawingStyle(e.styleId):pe.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,r,o,c){const p=this.getDrawingItems(m=>m._mediaType===e);for(let m of p)m.styleSelector===r&&this._changeItemStyle(m,o,!0);c||this.fabricCanvas.renderAll()}_changeItemStyle(e,r,o){if(!e||!r)return;const c=e._getFabricObject();typeof e.styleId=="number"&&(r=pe.getDrawingStyle(e.styleId)),c.strokeWidth=r.lineWidth,r.paintMode==="fill"?(c.fill=r.fillStyle,c.stroke=r.fillStyle):r.paintMode==="stroke"?(c.fill="transparent",c.stroke=r.strokeStyle):r.paintMode==="strokeAndFill"&&(c.fill=r.fillStyle,c.stroke=r.strokeStyle),c.fontFamily&&(c.fontFamily=r.fontFamily),c.fontSize&&(c.fontSize=r.fontSize),c.group||(c.dirty=!0),o||this.fabricCanvas.renderAll()}_updateGroupItem(e,r,o){if(!e||!r)return;const c=e.getChildDrawingItems();if(o==="add"){if(c.includes(r))return;const p=r._getFabricObject();if(this.fabricCanvas.getObjects().includes(p)){if(!this._arrFabricObject.includes(p))throw new Error("Existed in other drawing layers.");r._zIndex=null}else{let m;if(r.styleId)m=pe.getDrawingStyle(r.styleId);else{const y=this.mapType_StateAndStyleId.get(r._mediaType);m=pe.getDrawingStyle(y[e.styleSelector]);const C=()=>{this._changeItemStyle(r,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).selected),!0)},b=()=>{this._changeItemStyle(r,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).default),!0)};r._on("selected",C),r._on("deselected",b),r._funcChangeStyleToSelected=C,r._funcChangeStyleToDefault=b}r._drawingLayer=this,r._drawingLayerId=this.id,this._changeItemStyle(r,m,!0)}e._fabricObject.addWithUpdate(r._getFabricObject())}else{if(o!=="remove"||!c.includes(r))return;r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(r._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,r){if(!(e instanceof Dt))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let o=e._getFabricObject();const c=this.fabricCanvas.getObjects();let p,m;if(c.includes(o)){if(this._arrFabricObject.includes(o))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){p=e.getChildDrawingItems();for(let b of p)if(b._drawingLayer&&b._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(r&&typeof r=="object"&&!Array.isArray(r))for(let b in r)o.set(b,r[b]);if(p){for(let b of p){const I=this.mapType_StateAndStyleId.get(b._mediaType);for(let A of Dt.arrStyleSelectors)b._mapState_StyleId.set(A,I[A]);if(b.styleId)m=pe.getDrawingStyle(b.styleId);else{m=pe.getDrawingStyle(I.default);const A=()=>{this._changeItemStyle(b,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(b._mediaType).selected),!0)},L=()=>{this._changeItemStyle(b,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(b._mediaType).default),!0)};b._on("selected",A),b._on("deselected",L),b._funcChangeStyleToSelected=A,b._funcChangeStyleToDefault=L}b._drawingLayer=this,b._drawingLayerId=this.id,this._changeItemStyle(b,m,!0)}o.dirty=!0,this.fabricCanvas.renderAll()}else{const b=this.mapType_StateAndStyleId.get(e._mediaType);for(let I of Dt.arrStyleSelectors)e._mapState_StyleId.set(I,b[I]);if(e.styleId)m=pe.getDrawingStyle(e.styleId);else{m=pe.getDrawingStyle(b.default);const I=()=>{this._changeItemStyle(e,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},A=()=>{this._changeItemStyle(e,pe.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",I),e._on("deselected",A),e._funcChangeStyleToSelected=I,e._funcChangeStyleToDefault=A}this._changeItemStyle(e,m)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const y=this._arrFabricObject.length;let C=c.length;if(y)C=c.indexOf(this._arrFabricObject[y-1])+1;else for(let b=0;b<c.length;b++)if(e._zIndex<c[b].getDrawingItem()._zIndex){C=b;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(o),this._visible?o.visible=!0:o.visible=!1,this.fabricCanvas.insertAt(o,C,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let r of e)this.addDrawingItem(r)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const o=e.getChildDrawingItems();for(let c of o)c._zIndex=null,c._drawingLayer=null,c._drawingLayerId=null,c._off("selected",c._funcChangeStyleToSelected),c._off("deselected",c._funcChangeStyleToDefault),c._funcChangeStyleToSelected=null,c._funcChangeStyleToDefault=null,c._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();const r=e._getFabricObject();e.styleSelector==="selected"&&(r.group?r.group.removeWithUpdate(r):this.fabricCanvas._activeObject=null,e.setState(Vt.DIS_DEFAULT)),this.fabricCanvas.remove(r),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(r),1)}removeDrawingItems(e){for(let r of e)this.removeDrawingItem(r)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),r=[];for(let o of e)this._arrFabricObject.includes(o)&&r.push(o.getDrawingItem());return r}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,r,o){r?r.forEach(m=>m.toLowerCase()):r=Dt.arrMediaTypes,o?o.forEach(m=>m.toLowerCase()):o=Dt.arrStyleSelectors;const c=pe.getDrawingStyle(e);if(!c)throw new Error(`The 'drawingStyle' with id '${e}' doesn't exist.`);let p;for(let m of r)if(p=this.mapType_StateAndStyleId.get(m),p)for(let y of o){this._changeMediaTypeCurStyleInStyleSelector(m,y,c,!0),p[y]=e;for(let C of this._arrDrwaingItem)C._mediaType===m&&C._mapState_StyleId.set(y,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,r,o){const c=[];o&mt.DIMT_RECTANGLE&&c.push("rect"),o&mt.DIMT_QUADRILATERAL&&c.push("quad"),o&mt.DIMT_TEXT&&c.push("text"),o&mt.DIMT_ARC&&c.push("arc"),o&mt.DIMT_IMAGE&&c.push("image"),o&mt.DIMT_POLYGON&&c.push("polygon"),o&mt.DIMT_LINE&&c.push("line");const p=[];r&Vt.DIS_DEFAULT&&p.push("default"),r&Vt.DIS_SELECTED&&p.push("selected"),this._setDefaultStyle(e,c.length?c:null,p.length?p:null)}setMode(e){if((e=e.toLowerCase())==="viewer"){for(let r of this._arrDrwaingItem)r._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let r of this._arrDrwaingItem)r._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,r){this.fabricCanvas.setDimensions(e,r)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const r=this._getItemCurrentStyle(e);this._changeItemStyle(e,r,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Je.DDN_LAYER_ID=1,Je.DBR_LAYER_ID=2,Je.DLR_LAYER_ID=3,Je.USER_DEFINED_LAYER_BASE_ID=100,Je.TIP_LAYER_ID=999;class ag{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,r){if(this.getDrawingLayer(r))throw new Error("Existed drawing layer id.");const o=new Je(e,r,{enableRetinaScaling:!1});return o._manager=this,this._arrDrawingLayer.push(o),this._switchPointerEvent(),o}deleteDrawingLayer(e){const r=this.getDrawingLayer(e);if(!r)return;const o=this._arrDrawingLayer;r.dispose(),o.splice(o.indexOf(r),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let r of this._arrDrawingLayer)if(r.getId()===e)return r;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._getFabricCanvas().getActiveObjects(),r=[];for(let o of e)r.push(o.getDrawingItem());return r}setDimensions(e,r){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,r)}setObjectFit(e){for(let r of this._arrDrawingLayer)r&&r._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){if(!this._arrDrawingLayer.length)return;const r=this._getFabricCanvas();r.wrapperEl.style.display=e?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class lg extends ng{constructor(e,r,o,c,p){super(e,{x:r,y:o,width:c,height:0},p),Pr.set(this,void 0),vn.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var m=0,y=0,C=this._textLines.length;y<C;y++)m+=this.getHeightOfLine(y);return m+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){Se(this,Pr,e,"f"),M(this,vn,"f")&&clearTimeout(M(this,vn,"f")),M(this,Pr,"f")>=0&&Se(this,vn,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},M(this,Pr,"f")),"f")}getDuration(){return M(this,Pr,"f")}}Pr=new WeakMap,vn=new WeakMap;class hg{constructor(){kr.add(this),Bt.set(this,void 0),yn.set(this,void 0),wn.set(this,void 0),Cn.set(this,!0),this._drawingLayerManager=new ag}createDrawingLayerBaseCvs(e,r,o="contain"){if(typeof e!="number"||e<=1)throw new Error("Invalid 'width'.");if(typeof r!="number"||r<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(o))throw new Error("Unsupported 'objectFit'.");const c=document.createElement("canvas");return c.width==e&&c.height==r||(c.width=e,c.height=r),c.style.objectFit=o,c}_createDrawingLayer(e,r,o,c){if(!this._layerBaseCvs){let y;try{y=this.getContentDimensions()}catch(C){if((C.message||C)!=="Invalid content dimensions.")throw C}r||(r=(y==null?void 0:y.width)||1280),o||(o=(y==null?void 0:y.height)||720),c||(c=(y==null?void 0:y.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(r,o,c)}const p=this._layerBaseCvs,m=this._drawingLayerManager.createDrawingLayer(p,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",p.parentElement),m}createDrawingLayer(){let e;for(let r=Je.USER_DEFINED_LAYER_BASE_ID;;r++)if(!this._drawingLayerManager.getDrawingLayer(r)&&r!==Je.TIP_LAYER_ID){e=r;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var r;this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getAllDrawingLayers().length||((r=this._innerComponent)===null||r===void 0||r.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if(typeof e!="number")throw new TypeError("Invalid id.");if(e<Je.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${e} is not defined by users.`);this.deleteDrawingLayer(e)}_clearDrawingLayers(){const e=this.getAllDrawingLayers();for(let r of e)this.deleteDrawingLayer(r.getId())}clearUserDefinedDrawingLayers(){const e=this.getAllDrawingLayers();for(let r of e){const o=r.getId();o<Je.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(o)}}getDrawingLayer(e){return e==Je.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(e)||([Je.DDN_LAYER_ID,Je.DBR_LAYER_ID,Je.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(e=>e.getId()>=0&&e.getId()!==Je.TIP_LAYER_ID)}updateDrawingLayers(e){((r,o,c)=>{if(!(r<=1||o<=1)){if(!["contain","cover"].includes(c))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:r,height:o},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(c)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(e){if(!(Xc(r=e)&&tg(r.topLeftPoint)&&qr(r.width))||r.width<=0||!qr(r.duration)||"coordinateBase"in r&&!["view","image"].includes(r.coordinateBase))throw new Error("Invalid tip config.");var r;Se(this,Bt,JSON.parse(JSON.stringify(e)),"f"),M(this,Bt,"f").coordinateBase||(M(this,Bt,"f").coordinateBase="view"),Se(this,wn,e.duration,"f"),M(this,kr,"m",Jc).call(this)}getTipConfig(){return M(this,Bt,"f")?M(this,Bt,"f"):null}setTipVisible(e){if(typeof e!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Se(this,Cn,e,"f")}isTipVisible(){return M(this,Cn,"f")}updateTipMessage(e){if(!M(this,Bt,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=pe.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Je.TIP_LAYER_ID)||this._createDrawingLayer(Je.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=M(this,kr,"m",Kc).call(this,e,M(this,Bt,"f").topLeftPoint.x,M(this,Bt,"f").topLeftPoint.y,M(this,Bt,"f").width,M(this,Bt,"f").coordinateBase,this._tipStyleId),M(this,kr,"m",Zc).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",M(this,Cn,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),M(this,yn,"f")&&clearTimeout(M(this,yn,"f")),M(this,wn,"f")>=0&&Se(this,yn,setTimeout(()=>{M(this,kr,"m",qc).call(this)},M(this,wn,"f")),"f")}}Bt=new WeakMap,yn=new WeakMap,wn=new WeakMap,Cn=new WeakMap,kr=new WeakSet,Kc=function(t,e,r,o,c,p){const m=new lg(t,e,r,o,p);return m.coordinateBase=c,m},Zc=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},qc=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},Jc=function(){if(!this._tip)return;const t=M(this,Bt,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class eu extends HTMLElement{constructor(){super(),Ts.set(this,void 0);const e=new DocumentFragment,r=document.createElement("div");r.setAttribute("class","wrapper"),e.appendChild(r),Se(this,Ts,r,"f");const o=document.createElement("slot");o.setAttribute("name","single-frame-input-container"),r.append(o);const c=document.createElement("slot");c.setAttribute("name","content"),r.append(c);const p=document.createElement("slot");p.setAttribute("name","drawing-layer"),r.append(p);const m=document.createElement("style");m.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,e.appendChild(m),this.attachShadow({mode:"open"}).appendChild(e)}getWrapper(){return M(this,Ts,"f")}setElement(e,r){if(!(r instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),r.setAttribute("slot",e),this.appendChild(r)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${e}"]`)}removeElement(e){var r;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");(r=this.querySelectorAll(`[slot="${e}"]`))===null||r===void 0||r.forEach(o=>o.remove())}}Ts=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",eu);class ut extends hg{static get engineResourcePath(){return ts(et.engineResourcePaths,Ue).dce}static set defaultUIElementURL(e){ut._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=ut._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",ut.engineResourcePath)}static async createInstance(e){const r=new ut;return typeof e=="string"&&(e=e.replace("@engineResourcePath/",ut.engineResourcePath)),await r.setUIElement(e||ut.defaultUIElementURL),r}static _transformCoordinates(e,r,o,c,p,m,y){const C=m/c,b=y/p;e.x=Math.round(e.x/C+r),e.y=Math.round(e.y/b+o)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(e!==M(this,Tn,"f")){if(Se(this,Tn,e,"f"),M(this,Ye,"m",Mt).call(this))Se(this,ot,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!M(this,ot,"f")){const r=document.createElement("video");r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.objectFit=this.getVideoFit(),r.setAttribute("autoplay","true"),r.setAttribute("playsinline","true"),r.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ht.OS)&&r.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Se(this,ot,r,"f");const o=document.createElement("div");o.append(r),o.style.overflow="hidden",this._videoContainer=o,this._innerComponent.setElement("content",o)}M(this,Ye,"m",Mt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return M(this,Tn,"f")}get disposed(){return M(this,wa,"f")}constructor(){super(),Ye.add(this),En.set(this,void 0),bn.set(this,void 0),Sn.set(this,void 0),this.containerClassName="dce-video-container",ot.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Is.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,xs.set(this,!1),Os.set(this,!1),Wi.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{M(this,Ye,"m",xn).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&M(this,Ye,"m",Ea).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{ut._onLog&&ut._onLog("window resize event triggered."),M(this,Wi,"f").width===document.documentElement.clientWidth&&M(this,Wi,"f").height===document.documentElement.clientHeight||(M(this,Wi,"f").width=document.documentElement.clientWidth,M(this,Wi,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Tn.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!M(this,Ye,"m",Mt).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this._singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",async()=>{const o=e.files[0];e.value="";{const c=async L=>{let P=null,j=null;if(typeof createImageBitmap<"u")try{if(P=await createImageBitmap(L),P)return P}catch{}var H;return P||(j=await(H=L,new Promise(($,Z)=>{let q=URL.createObjectURL(H),J=new Image;J.src=q,J.onload=()=>{URL.revokeObjectURL(J.src),$(J)},J.onerror=ie=>{Z(new Error("Can't convert blob to image : "+(ie instanceof Event?ie.type:ie)))}}))),j},p=(L,P,j,H)=>{L.width==j&&L.height==H||(L.width=j,L.height=H);const $=L.getContext("2d");$.clearRect(0,0,L.width,L.height),$.drawImage(P,0,0)},m=await c(o),y=m instanceof HTMLImageElement?m.naturalWidth:m.width,C=m instanceof HTMLImageElement?m.naturalHeight:m.height;let b=this._cvsSingleFrameMode;const I=b==null?void 0:b.width,A=b==null?void 0:b.height;b||(b=document.createElement("canvas"),this._cvsSingleFrameMode=b),p(b,m,y,C),this._innerComponent.setElement("content",b),I===b.width&&A===b.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)}),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const r=document.createElement("div");r.append(e),this._innerComponent.setElement("single-frame-input-container",r),this._singleFrameInputContainer=r}e==null||e.click()},In.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,r)=>{var o,c,p,m;if(this.disposed||(this.clearAllInnerDrawingItems(),!e))return;const y=e.originalImageTag;if(!y)return;const C=e.items;if(!(C!=null&&C.length))return;const b=((o=y.cropRegion)===null||o===void 0?void 0:o.left)||0,I=((c=y.cropRegion)===null||c===void 0?void 0:c.top)||0,A=!((p=y.cropRegion)===null||p===void 0)&&p.right?y.cropRegion.right-b:y.originalWidth,L=!((m=y.cropRegion)===null||m===void 0)&&m.bottom?y.cropRegion.bottom-I:y.originalHeight,P=y.currentWidth,j=y.currentHeight,H=(q,J,ie,ne,he,fe,v,ae,me=[],de)=>{J.forEach(s=>ut._transformCoordinates(s,ie,ne,he,fe,v,ae));const a=new sg({points:[{x:J[0].x,y:J[0].y},{x:J[1].x,y:J[1].y},{x:J[2].x,y:J[2].y},{x:J[3].x,y:J[3].y}]},de);for(let s of me)a.addNote(s);q.addDrawingItems([a]),M(this,In,"f").push(a)};let $,Z;for(let q of C)switch(q.type){case Ce.CRIT_ORIGINAL_IMAGE:break;case Ce.CRIT_BARCODE:$=this.getDrawingLayer(Je.DBR_LAYER_ID),Z=[{name:"format",content:q.formatString},{name:"text",content:q.text}],r!=null&&r.isBarcodeVerifyOpen?q.verified?H($,q.location.points,b,I,A,L,P,j,Z):H($,q.location.points,b,I,A,L,P,j,Z,pe.STYLE_ORANGE_STROKE_TRANSPARENT):H($,q.location.points,b,I,A,L,P,j,Z);break;case Ce.CRIT_TEXT_LINE:$=this.getDrawingLayer(Je.DLR_LAYER_ID),Z=[{name:"text",content:q.text}],r.isLabelVerifyOpen?q.verified?H($,q.location.points,b,I,A,L,P,j,Z):H($,q.location.points,b,I,A,L,P,j,Z,pe.STYLE_GREEN_STROKE_TRANSPARENT):H($,q.location.points,b,I,A,L,P,j,Z);break;case Ce.CRIT_DETECTED_QUAD:$=this.getDrawingLayer(Je.DDN_LAYER_ID),r!=null&&r.isDetectVerifyOpen?q.verified?H($,q.location.points,b,I,A,L,P,j,[]):H($,q.location.points,b,I,A,L,P,j,[],pe.STYLE_BLUE_STROKE_TRANSPARENT):H($,q.location.points,b,I,A,L,P,j,[]);break;case Ce.CRIT_NORMALIZED_IMAGE:$=this.getDrawingLayer(Je.DDN_LAYER_ID),r!=null&&r.isNormalizeVerifyOpen?q.verified?H($,q.location.points,b,I,A,L,P,j,[]):H($,q.location.points,b,I,A,L,P,j,[],pe.STYLE_BLUE_STROKE_TRANSPARENT):H($,q.location.points,b,I,A,L,P,j,[]);break;case Ce.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},wa.set(this,!1),this.eventHandler=new zc,this.eventHandler.on("content:updated",()=>{M(this,En,"f")&&clearTimeout(M(this,En,"f")),Se(this,En,setTimeout(()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(r){if((r.message||r)==="Invalid content dimensions.")return;throw r}this.updateDrawingLayers(e),this.updateConvertedRegion(e)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{M(this,bn,"f")&&clearTimeout(M(this,bn,"f")),Se(this,bn,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(e){this.UIElement=e,this._unbindUI(),this._bindUI()}async setUIElement(e){let r;if(typeof e=="string"){let o=await rg(e);r=document.createElement("div"),Object.assign(r.style,{width:"100%",height:"100%"}),r.attachShadow({mode:"open"}).appendChild(o.cloneNode(!0))}else r=e;this._setUIElement(r)}getUIElement(){return this.UIElement}_bindUI(){var e,r;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let o=this.UIElement;o=o.shadowRoot||o;let c=!((e=o.classList)===null||e===void 0)&&e.contains(this.containerClassName)?o:o.querySelector(`.${this.containerClassName}`);if(!c)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new eu,c.appendChild(this._innerComponent),!M(this,Ye,"m",Mt).call(this)){const p=document.createElement("video");Object.assign(p.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",objectFit:this.getVideoFit()}),p.setAttribute("autoplay","true"),p.setAttribute("playsinline","true"),p.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ht.OS)&&p.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Se(this,ot,p,"f");const m=document.createElement("div");m.append(p),m.style.overflow="hidden",this._videoContainer=m,this._innerComponent.setElement("content",m)}if(this._selRsl=o.querySelector(".dce-sel-resolution"),this._selMinLtr=o.querySelector(".dlr-sel-minletter"),this._divScanArea=o.querySelector(".dce-scanarea"),this._divScanLight=o.querySelector(".dce-scanlight"),this._bgLoading=o.querySelector(".dce-bg-loading"),this._bgCamera=o.querySelector(".dce-bg-camera"),this._selCam=o.querySelector(".dce-sel-camera"),this._optGotRsl=o.querySelector(".dce-opt-gotResolution"),this._btnClose=o.querySelector(".dce-btn-close"),this._optGotMinLtr=o.querySelector(".dlr-opt-gotMinLtr"),this._selRsl&&(this._hideDefaultSelection||M(this,Ye,"m",Mt).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||M(this,Ye,"m",Mt).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||M(this,Ye,"m",xn).call(this),M(this,Ye,"m",Mt).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),M(this,Ye,"m",Mt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(m=>{var y;ut._onLog&&ut._onLog("resize observer triggered.");for(let C of m)C.target===((y=this._innerComponent)===null||y===void 0?void 0:y.getWrapper())&&this._videoResizeListener()}));const p=(r=this._innerComponent)===null||r===void 0?void 0:r.getWrapper();p&&this._resizeObserver.observe(p)}M(this,Wi,"f").width=document.documentElement.clientWidth,M(this,Wi,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,r,o,c;M(this,Ye,"m",Mt).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),M(this,Ye,"m",xn).call(this),(e=this._drawingLayerManager)===null||e===void 0||e.clearDrawingLayers(),(r=this._innerComponent)===null||r===void 0||r.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(o=this._innerComponent)===null||o===void 0||o.remove(),this._innerComponent=null,Se(this,ot,null,"f"),(c=this._videoContainer)===null||c===void 0||c.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,r){if(this._selCam){let c;this._selCam.textContent="";for(let p of r){const m=document.createElement("option");m.value=p.deviceId,m.innerText=p.label,this._selCam.append(m),p.deviceId&&e&&e.deviceId==p.deviceId&&(c=m)}this._selCam.value=c?c.value:""}let o=this.UIElement;if(o=o.shadowRoot||o,o.querySelector(".dce-macro-use-mobile-native-like-ui")){let c=o.querySelector(".dce-mn-cameras");if(c){c.textContent="";for(let p of r){const m=document.createElement("div");m.classList.add("dce-mn-camera-option"),m.setAttribute("data-davice-id",p.deviceId),m.textContent=p.label,c.append(m)}}}}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"));{let r=this.UIElement;r=(r==null?void 0:r.shadowRoot)||r;let o=r==null?void 0:r.querySelector(".dce-mn-resolution-box");if(o){let c="";if(e&&e.width&&e.height){let p=Math.max(e.width,e.height),m=Math.min(e.width,e.height);c=m<=1080?m+"P":p<3e3?"2K":Math.round(p/1e3)+"K"}o.textContent=c}}}getVideoElement(){return M(this,ot,"f")}isVideoLoaded(){return!(!M(this,ot,"f")||!this.cameraEnhancer)&&this.cameraEnhancer.isOpen()}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,!M(this,ot,"f")||(M(this,ot,"f").style.objectFit=e,M(this,Ye,"m",Mt).call(this)))return;let r;this._updateVideoContainer();try{r=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}M(this,Ye,"m",Rs).call(this,r,this.getConvertedRegion()),this.updateDrawingLayers(r)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,r,o,c;let p,m,y;if(M(this,Ye,"m",Mt).call(this)?(p=(o=this._cvsSingleFrameMode)===null||o===void 0?void 0:o.width,m=(c=this._cvsSingleFrameMode)===null||c===void 0?void 0:c.height,y="contain"):(p=(e=M(this,ot,"f"))===null||e===void 0?void 0:e.videoWidth,m=(r=M(this,ot,"f"))===null||r===void 0?void 0:r.videoHeight,y=this.getVideoFit()),!p||!m)throw new Error("Invalid content dimensions.");return{width:p,height:m,objectFit:y}}updateConvertedRegion(e){const r=bs.convert(this.scanRegion,e.width,e.height);Se(this,Is,r,"f"),M(this,Sn,"f")&&clearTimeout(M(this,Sn,"f")),Se(this,Sn,setTimeout(()=>{let o;try{o=this.getContentDimensions()}catch(c){if((c.message||c)==="Invalid content dimensions.")return;throw c}M(this,Ye,"m",As).call(this,o,r),M(this,Ye,"m",Rs).call(this,o,r)},0),"f")}getConvertedRegion(){return M(this,Is,"f")}setScanRegion(e){if(e!=null&&!cl(e)&&!br(e))throw TypeError("Invalid 'region'.");let r;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{r=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}this.updateConvertedRegion(r)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const r=M(this,ot,"f").videoWidth,o=M(this,ot,"f").videoHeight,c=this.getVideoFit(),{width:p,height:m}=this._innerComponent.getBoundingClientRect();if(p<=0||m<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let y;const C={x:0,y:0,width:r,height:o,isMeasuredInPercentage:!1};if(c==="cover"&&(p/m<r/o?(y=m/o,C.x=Math.floor((r-p/y)/2),C.y=0,C.width=Math.ceil(p/y),C.height=o):(y=p/r,C.x=0,C.y=Math.floor((o-m/y)/2),C.width=r,C.height=Math.ceil(m/y))),e==null?void 0:e.inPixels)return C;const b=C;return b.x=Math.ceil(b.x/o*100),b.y=Math.ceil(b.y/r*100),b.width=Math.floor(b.width/r*100),b.height=Math.floor(b.height/o*100),b.isMeasuredInPercentage=!0,C}setScanRegionMask(e,r,o,c){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||M(this,Ye,"m",Ca).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=pe.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=pe.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const p=this._drawingLayerOfMask.width,m=this._drawingLayerOfMask.height,y=new Ar({x:0,y:0,width:p,height:m},this._maskBackRectStyleId),C=new Ar({x:-p/2,y:-m/2+r,width:e,height:c}),b=new Ar({x:-p/2+e+o,y:-m/2+r,width:p-e-o<0?0:p-e-o,height:c}),I=new Ar({x:-p/2,y:-m/2,width:p,height:r}),A=new Ar({x:-p/2,y:-m/2+r+c,width:p,height:m-r-c<0?0:m-r-c});C.set("strokeWidth",0),b.set("strokeWidth",0),I.set("strokeWidth",0),A.set("strokeWidth",0);const L=new og([C,b,I,A])._getFabricObject();y.set("clipPath",L);const P=new Ar({x:e,y:r,width:o,height:c},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([y,P])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){Se(this,xs,e,"f"),e?M(this,Ye,"m",Qc).call(this):M(this,Ye,"m",Ca).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return M(this,xs,"f")}setScanRegionMaskStyle(e){if(!e)return;let r;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&pe.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&pe.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{r=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}M(this,Ye,"m",As).call(this,r,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){Se(this,Os,e,"f"),e?M(this,Ye,"m",Ea).call(this):M(this,Ye,"m",xn).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return M(this,Os,"f")}_updateVideoContainer(){if(!M(this,ot,"f")||M(this,Ye,"m",Mt).call(this))return;let e=1;const r=M(this,ot,"f").style.transform.match(/scale\((.+)\)/);r&&(e=parseFloat(r[1]));const o=this._videoContainer;if(this.videoFit==="contain"&&e>1){const c=M(this,ot,"f").videoWidth,p=M(this,ot,"f").videoHeight,{width:m,height:y}=this._innerComponent.getBoundingClientRect(),C=c/p;if(m/y<C){let b=m/C;o.style.left="0",o.style.top=(y-b)/2/y*100+"%",o.style.width="100%",o.style.height=b/y*100+"%"}else{let b=y*C;o.style.left=(m-b)/2/m*100+"%",o.style.top="0",o.style.width=b/m*100+"%",o.style.height="100%"}}else o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}const r=this.getConvertedRegion();M(this,Ye,"m",Rs).call(this,e,r),this.updateDrawingLayers(e),M(this,Ye,"m",As).call(this,e,r)}clearAllInnerDrawingItems(){M(this,In,"f").forEach(e=>e.remove()),M(this,In,"f").length=0}dispose(){this._unbindUI(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"disposed",{value:!0})}}function V(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}function Pe(t,e,r,o,c){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?c.call(t,r):c?c.value=r:e.set(t,r),r}En=new WeakMap,bn=new WeakMap,Sn=new WeakMap,ot=new WeakMap,Is=new WeakMap,xs=new WeakMap,Os=new WeakMap,Wi=new WeakMap,Tn=new WeakMap,In=new WeakMap,wa=new WeakMap,Ye=new WeakSet,Mt=function(){return this._singleFrameMode!=="disabled"},As=function(t,e){e&&(e.x!==0||e.y!==0||e.width!==t.width||e.height!==t.height)?this.setScanRegionMask(e.x,e.y,e.width,e.height):this.clearScanRegionMask()},Qc=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Ca=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Ea=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},xn=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Rs=function(t,e){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:r,height:o,objectFit:c}=t;e||(e={x:0,y:0,width:r,height:o});const{width:p,height:m}=this._innerComponent.getBoundingClientRect();if(p<=0||m<=0)return;const y=p/m,C=r/o;let b,I,A,L,P=1;if(c==="contain")y<C?(P=p/r,b=0,I=(m-o*P)/2):(P=m/o,b=(p-r*P)/2,I=0),b+=e.x*P,I+=e.y*P,A=e.width*P,L=e.height*P;else if(c==="cover")if(y<C){P=m/o,b=e.x*P-(r*P-p)/2,b=Math.max(b,0),b=Math.min(b,p),I=e.y*P;let j=(e.x+e.width)*P-(r*P-p)/2;j=Math.max(j,0),j=Math.min(j,p),A=j-b,L=e.height*P}else{P=p/r,b=e.x*P,I=e.y*P-(o*P-m)/2,I=Math.max(I,0),I=Math.min(I,m);let j=(e.y+e.height)*P-(o*P-m)/2;j=Math.max(j,0),j=Math.min(j,m),A=e.width*P,L=j-I}else b=0,I=0,A=0,L=0;this._divScanArea.style.left=b+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=A+"px",this._divScanArea.style.height=L+"px"},ut._defaultUIElementURL="@engineResourcePath/dce.ui.html",typeof SuppressedError=="function"&&SuppressedError;const vh=typeof self>"u";let cn,un,ds,Wo,vt;function Et(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}function Kt(t,e,r,o,c){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?c.call(t,r):c?c.value=r:e.set(t,r),r}typeof navigator<"u"&&(cn=navigator,un=cn.userAgent,ds=cn.platform,Wo=cn.mediaDevices),function(){if(!vh){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:cn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ds,search:"Win"},Mac:{str:ds},Linux:{str:ds}};let r="unknownBrowser",o=0,c="unknownOS";for(let p in t){const m=t[p]||{};let y=m.str||un,C=m.search||p,b=m.verStr||un,I=m.verSearch||p;if(I instanceof Array||(I=[I]),y.indexOf(C)!=-1){r=p;for(let A of I){let L=b.indexOf(A);if(L!=-1){o=parseFloat(b.substring(L+A.length+1));break}}break}}for(let p in e){const m=e[p]||{};let y=m.str||un,C=m.search||p;if(y.indexOf(C)!=-1){c=p;break}}c=="Linux"&&un.indexOf("Windows NT")!=-1&&(c="HarmonyOS"),vt={browser:r,version:o,OS:c}}vh&&(vt={browser:"ssr",version:0,OS:"ssr"})}(),Wo&&Wo.getUserMedia,vt.browser==="Chrome"&&vt.version>66||vt.browser==="Safari"&&vt.version>13||vt.browser==="OPR"&&vt.version>43||vt.browser==="Edge"&&vt.version,typeof SuppressedError=="function"&&SuppressedError;let gi=class Ds{static multiply(e,r){const o=[];for(let c=0;c<3;c++){const p=r.slice(3*c,3*c+3);for(let m=0;m<3;m++){const y=[e[m],e[m+3],e[m+6]].reduce((C,b,I)=>C+b*p[I],0);o.push(y)}}return o}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,r,o){return Ds.multiply(e,[1,0,0,0,1,0,r,o,1])}static rotate(e,r){var o=Math.cos(r),c=Math.sin(r);return Ds.multiply(e,[o,-c,0,c,o,0,0,0,1])}static scale(e,r,o){return Ds.multiply(e,[r,0,0,0,o,0,0,0,1])}};var Fe,_i,vi,Ls,Br,On,An,Nr,Ms;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Fe||(Fe={}));class Ie{static get version(){return"1.1.0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(Kt(Ie,_i,!1,"f",vi),!1):(Kt(Ie,_i,!0,"f",vi),!0)}get disposed(){return Et(this,Ms,"f")}constructor(){Ls.set(this,Fe.RGBA),Br.set(this,null),On.set(this,null),An.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Nr.set(this,null),Ms.set(this,!1)}drawImage(e,r,o,c,p,m){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!o||!c)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(Et(Ie,_i,"f",vi)==null&&Ie.checkWebGLSupport(),(m==null?void 0:m.bUseWebGL)&&!Et(Ie,_i,"f",vi))throw new Error("Your browser or machine may not support WebGL.");if(r instanceof HTMLVideoElement&&r.readyState!==4||r instanceof HTMLImageElement&&!r.complete)throw new Error("The source is not loaded.");let y;Ie._onLog&&(y=Date.now(),Ie._onLog("drawImage(), START: "+y));let C=0,b=0,I=o,A=c,L=0,P=0,j=o,H=c;p&&(p.sx&&(C=Math.round(p.sx)),p.sy&&(b=Math.round(p.sy)),p.sWidth&&(I=Math.round(p.sWidth)),p.sHeight&&(A=Math.round(p.sHeight)),p.dx&&(L=Math.round(p.dx)),p.dy&&(P=Math.round(p.dy)),p.dWidth&&(j=Math.round(p.dWidth)),p.dHeight&&(H=Math.round(p.dHeight)));let $,Z=Fe.RGBA;if(m!=null&&m.pixelFormat&&(Z=m.pixelFormat),(m==null?void 0:m.bufferContainer)&&($=m.bufferContainer,$.length<4*j*H))throw new Error("Unexpected size of the 'bufferContainer'.");const q=e;if(!Et(Ie,_i,"f",vi)||!(this.useWebGLByDefault&&(m==null?void 0:m.bUseWebGL)==null||m!=null&&m.bUseWebGL)){Ie._onLog&&Ie._onLog("drawImage() in context2d."),q.ctx2d||(q.ctx2d=q.getContext("2d",{willReadFrequently:!0}));const J=q.ctx2d;if(!J)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(q.width<L+j||q.height<P+H)&&(q.width=L+j,q.height=P+H),J.drawImage(r,C,b,I,A,L,P,j,H),Ie._onLog&&Ie._onLog("drawImage() in context2d end. Costs: "+(Date.now()-y)),{context:J,pixelFormat:Fe.RGBA,bUseWebGL:!1}}Ie._onLog&&Ie._onLog("drawImage() in WebGL.");try{(q.width<L+j||q.height<P+H)&&(q.width=L+j,q.height=P+H,q.ctxWebGL&&q.ctxWebGL.viewport(0,0,L+j,P+H));const J=q.ctxWebGL||q.getContext("webgl",{antialias:!1})||q.getContext("experimental-webgl",{antialias:!1});if(!J){Ie._onLog&&Ie._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const v=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw v.name="WebGLError",v}if(!q.ctxWebGL||Z!==Et(this,Ls,"f")){q.ctxWebGL=J;const v=i=>{const n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const h=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:n,texCoords:h}},ae=i=>{const n=i.createTexture();return i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n},me=(i,n)=>{const h=i.createProgram();if(n.forEach(g=>i.attachShader(h,g)),i.linkProgram(h),!i.getProgramParameter(h,i.LINK_STATUS)){const g=new Error(`An error occured linking the program: ${i.getProgramInfoLog(h)}.`);throw g.name="WebGLError",g}return i.useProgram(h),h},de=(i,n,h)=>{const g=i.createShader(n);if(i.shaderSource(g,h),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS)){const f=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(g)}.`);throw f.name="WebGLError",f}return g},a=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `;let s="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(Z)&&(s=Z.slice(0,3));const l=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${s} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,u=me(J,[de(J,J.VERTEX_SHADER,a),de(J,J.FRAGMENT_SHADER,l)]);Kt(this,On,{program:u,attribLocations:{vertexPosition:J.getAttribLocation(u,"a_position"),texPosition:J.getAttribLocation(u,"a_texCoord")},uniformLocations:{uSampler:J.getUniformLocation(u,"u_image"),uColorFactor:J.getUniformLocation(u,"uColorFactor"),uMatrix:J.getUniformLocation(u,"u_matrix"),uTextureMatrix:J.getUniformLocation(u,"u_textureMatrix")}},"f"),Kt(this,An,v(J),"f"),Kt(this,Br,ae(J),"f"),Kt(this,Ls,Z,"f")}const ie=(v,ae,me)=>{v.bindBuffer(v.ARRAY_BUFFER,ae),v.enableVertexAttribArray(me),v.vertexAttribPointer(me,2,v.FLOAT,!1,0,0)},ne=(v,ae,me)=>{const de=v.RGBA,a=v.RGBA,s=v.UNSIGNED_BYTE;v.bindTexture(v.TEXTURE_2D,ae),v.texImage2D(v.TEXTURE_2D,0,de,a,s,me)},he=(v,ae,me,de)=>{v.clearColor(0,0,0,1),v.clearDepth(1),v.enable(v.DEPTH_TEST),v.depthFunc(v.LEQUAL),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT),ie(v,me.positions,ae.attribLocations.vertexPosition),ie(v,me.texCoords,ae.attribLocations.texPosition),v.activeTexture(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,de),v.uniform1i(ae.uniformLocations.uSampler,0),v.uniform1f(ae.uniformLocations.uColorFactor,[Fe.GREY,Fe.GREY32].includes(Z)?1:0);let a,s,l=gi.translate(gi.identity(),-1,-1);l=gi.scale(l,2,2),l=gi.scale(l,1/v.canvas.width,1/v.canvas.height),a=gi.translate(l,L,P),a=gi.scale(a,j,H),v.uniformMatrix3fv(ae.uniformLocations.uMatrix,!1,a),s=gi.translate(gi.identity(),C/o,b/c),s=gi.scale(s,I/o,A/c),v.uniformMatrix3fv(ae.uniformLocations.uTextureMatrix,!1,s),v.drawArrays(v.TRIANGLES,0,6)};ne(J,Et(this,Br,"f"),r),he(J,Et(this,On,"f"),Et(this,An,"f"),Et(this,Br,"f"));const fe=$||new Uint8Array(4*j*H);if(J.readPixels(L,P,j,H,J.RGBA,J.UNSIGNED_BYTE,fe),fe[3]!==255){Ie._onLog&&Ie._onLog("Incorrect WebGL drawing .");const v=new Error("WebGL error: incorrect drawing.");throw v.name="WebGLError",v}return Ie._onLog&&Ie._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-y)),{context:J,pixelFormat:Z===Fe.GREY?Fe.GREY32:Z,bUseWebGL:!0}}catch(J){if(this.forceLoseContext(),(m==null?void 0:m.bUseWebGL)==null)return Ie._onLog&&Ie._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,r,o,c,p,Object.assign({},m,{bUseWebGL:!1}));throw J.name="WebGLError",J}}readCvsData(e,r,o){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let c,p=0,m=0,y=e.canvas.width,C=e.canvas.height;if(r&&(r.x&&(p=r.x),r.y&&(m=r.y),r.width&&(y=r.width),r.height&&(C=r.height)),(o==null?void 0:o.length)<4*y*C)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const b=e;o?(b.readPixels(p,m,y,C,b.RGBA,b.UNSIGNED_BYTE,o),c=new Uint8Array(o.buffer,0,4*y*C)):(c=new Uint8Array(4*y*C),b.readPixels(p,m,y,C,b.RGBA,b.UNSIGNED_BYTE,c))}else if(e instanceof CanvasRenderingContext2D){let b;b=e.getImageData(p,m,y,C),c=new Uint8Array(b.data.buffer),o==null||o.set(c)}return c}transformPixelFormat(e,r,o,c){let p,m;if(Ie._onLog&&(p=Date.now(),Ie._onLog("transformPixelFormat(), START: "+p)),r===o)return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),c?new Uint8Array(e):e;const y=[Fe.RGBA,Fe.RBGA,Fe.GRBA,Fe.GBRA,Fe.BRGA,Fe.BGRA];if(y.includes(r))if(o===Fe.GREY){m=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4){const b=.21*e[C]+.71*e[C+1]+.07*e[C+2];m[C/4]=b}}else if(o===Fe.GREY32){m=c?new Uint8Array(e):e;for(let C=0;C<e.length;C+=4){const b=.21*e[C]+.71*e[C+1]+.07*e[C+2];m[C]=b,m[C+1]=b,m[C+2]=b}}else{if(!y.includes(o))throw new Error("Unable to transform.");if(c){m=new Uint8Array(e);const C=r.indexOf("r"),b=r.indexOf("g"),I=r.indexOf("b"),A=o.indexOf("r"),L=o.indexOf("g"),P=o.indexOf("b");for(let j=0;j<e.length;j+=4)m[j+A]=e[j+C],m[j+L]=e[j+b],m[j+P]=e[j+I]}else{m=e;const C=r.indexOf("r"),b=r.indexOf("g"),I=r.indexOf("b"),A=o.indexOf("r"),L=o.indexOf("g"),P=o.indexOf("b");for(let j=0;j<e.length;j+=4){let H=[e[j],e[j+1],e[j+2]];m[j+A]=H[C],m[j+L]=H[b],m[j+P]=H[I]}}}else if(r===Fe.GREY){if(o!==Fe.GREY32)throw new Error("Unable to transform.");m=new Uint8Array(4*e.length);for(let C=0;C<e.length;C++)m[4*C]=e[C],m[4*C+1]=e[C],m[4*C+2]=e[C],m[4*C+3]=255}else{if(r!==Fe.GREY32)throw new Error("Unable to transform.");if(o!==Fe.GREY)throw new Error("Unable to transform.");m=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4)m[C/4]=e[C]}return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),m}getImageData(e,r,o,c,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!r||!o)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(Et(Ie,_i,"f",vi)==null&&Ie.checkWebGLSupport(),(p==null?void 0:p.bUseWebGL)&&!Et(Ie,_i,"f",vi))throw new Error("Your browser or machine may not support WebGL.");if(c.sx>r||c.sy>o||c.sx+c.sWidth>r||c.sy+c.sHeight>o)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let m;Ie._onLog&&(m=Date.now(),Ie._onLog("getImageData(), START: "+m));const y=Math.round(c.sx),C=Math.round(c.sy),b=Math.round(c.sWidth),I=Math.round(c.sHeight),A=Math.round(c.dWidth),L=Math.round(c.dHeight);let P=Fe.RGBA;p!=null&&p.pixelFormat&&(P=p.pixelFormat);let j,H,$,Z=null;if(p!=null&&p.bufferContainer&&(Z=p.bufferContainer),Et(Ie,_i,"f",vi)&&(this.useWebGLByDefault&&(p==null?void 0:p.bUseWebGL)==null||(p==null?void 0:p.bUseWebGL))){Ie._onLog&&Ie._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),j=this._reusedWebGLCvs;try{if(Z)if(P===Fe.GREY){if($=new Uint8Array(4*A*L),H=this.drawImage(j,e,r,o,{sx:y,sy:C,sWidth:b,sHeight:I,dWidth:A,dHeight:L},{pixelFormat:P,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,H.pixelFormat,P),Z){if(Z.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set($)}}else H=this.drawImage(j,e,r,o,{sx:y,sy:C,sWidth:b,sHeight:I,dWidth:A,dHeight:L},{pixelFormat:P,bUseWebGL:!0,bufferContainer:Z}),$=new Uint8Array(Z.buffer,0,4*A*L),$=this.transformPixelFormat($,H.pixelFormat,P);else P===Fe.GREY?((!Et(this,Nr,"f")||Et(this,Nr,"f").length<4*A*L)&&Kt(this,Nr,new Uint8Array(4*A*L),"f"),$=new Uint8Array(Et(this,Nr,"f").buffer,0,4*A*L)):$=new Uint8Array(4*A*L),H=this.drawImage(j,e,r,o,{sx:y,sy:C,sWidth:b,sHeight:I,dWidth:A,dHeight:L},{pixelFormat:P,bUseWebGL:!0,bufferContainer:$}),$=this.transformPixelFormat($,H.pixelFormat,P)}catch(q){if(q.name==="WebGLError"&&(this.forceLoseContext(),(p==null?void 0:p.bUseWebGL)==null))return Ie._onLog&&Ie._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,r,o,{sx:y,sy:C,sWidth:b,sHeight:I,dWidth:A,dHeight:L},Object.assign({},p,{bUseWebGL:!1}));throw q}}else if(Ie._onLog&&Ie._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),j=this._reusedCvs,H=this.drawImage(j,e,r,o,{sx:y,sy:C,sWidth:b,sHeight:I,dWidth:A,dHeight:L},{pixelFormat:Fe.RGBA,bUseWebGL:!1}),$=this.readCvsData(H.context,{width:A,height:L},null),$=this.transformPixelFormat($,H.pixelFormat,P),Z){if(Z.length<$.length)throw new Error("Unexpected size of the 'bufferContainer'.");Z.set($)}return Ie._onLog&&Ie._onLog("getImageData() end. Costs: "+(Date.now()-m)),{data:$,pixelFormat:P,width:A,height:L,bUseWebGL:H.bUseWebGL}}convertDataToCvs(e,r,o,c){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof r!="number"||r<=0)throw new Error("Invalid 'width'.");if(typeof o!="number"||o<=0)throw new Error("Invalid 'height'.");const p=document.createElement("canvas");let m;if(p.width=r,p.height=o,c===Fe.GREY){m=new Uint8ClampedArray(4*r*o);for(let C=0;C<m.length;C+=4)m[C]=e[C/4],m[C+1]=e[C/4],m[C+2]=e[C/4],m[C+3]=255}else m=new Uint8ClampedArray(e.buffer);const y=new ImageData(m,r,o);return p.getContext("2d").putImageData(y,0,0),p}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),Kt(this,Br,null,"f"),Kt(this,On,null,"f"),Kt(this,An,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Kt(this,Ms,!0,"f")}}_i=Ie,Ls=new WeakMap,Br=new WeakMap,On=new WeakMap,An=new WeakMap,Nr=new WeakMap,Ms=new WeakMap,vi={value:void 0};var dr,Fs,Ho,ye,xe,je,Ps,ks,Xe,$t,Ii,jr,Bs,hi,Li,jt,Ur,Vr,Rn,Ns,Gr,gr,xi,Oi,ba,nt,Sa,pr,tu,js,Us,yh,qt,Yo,Xo,Xr,Dn,lo,Lt,Rr,Ta,Ia,iu;class cg{constructor(){dr.set(this,new Map),Fs.set(this,!1)}get disposed(){return V(this,Fs,"f")}on(e,r){e=e.toLowerCase();const o=V(this,dr,"f").get(e);if(o){if(o.includes(r))return;o.push(r)}else V(this,dr,"f").set(e,[r])}off(e,r){e=e.toLowerCase();const o=V(this,dr,"f").get(e);if(!o)return;const c=o.indexOf(r);c!==-1&&o.splice(c,1)}offAll(e){e=e.toLowerCase();const r=V(this,dr,"f").get(e);r&&(r.length=0)}fire(e,r=[],o={async:!1,copy:!0}){r||(r=[]),e=e.toLowerCase();const c=V(this,dr,"f").get(e);if(c&&c.length){o=Object.assign({async:!1,copy:!0},o);for(let p of c){if(!p)continue;let m=[];if(o.copy)for(let C of r){try{C=JSON.parse(JSON.stringify(C))}catch{}m.push(C)}else m=r;let y=!1;if(o.async)setTimeout(()=>{this.disposed||c.includes(p)&&p.apply(o.target,m)},0);else try{y=p.apply(o.target,m)}catch{}if(y===!0)break}}}dispose(){Pe(this,Fs,!0,"f")}}dr=new WeakMap,Fs=new WeakMap;const Ot=(t,e,r,o)=>{if(!r)return t;let c=e+Math.round((t-e)/r)*r;return o&&(c=Math.min(c,o)),c};class Te{static get version(){return"2.0.13"}static isStorageAvailable(e){let r;try{r=window[e];const o="__storage_test__";return r.setItem(o,o),r.removeItem(o),!0}catch(o){return o instanceof DOMException&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&r&&r.length!==0}}static findBestRearCameraInIOS(e,r){if(!e||!e.length)return null;let o=!1;if(r!=null&&r.getMainCamera&&(o=!0),o){const c=[" ","","","",""," "," "," ","   "," "," "," "," ","zadn fotoapart","zadn kamera","tylny aparat","takakamera","stranja kamera","rckkamera","kamera p baksidan","kamera belakang","kamera bak","hts kamera","fotocamera (posteriore)","cmera traseira","cmara traseira","cmara trasera","cmera posterior","camra arrire","camer spate","camera mt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],p=e.find(m=>c.includes(m.label.toLowerCase()));return p==null?void 0:p.deviceId}{const c=["","","","","","","","","","","","","zadn","zadn","tylny","trasera","traseira","taka","stranja","spate","sau","rck","posteriore","posterior","hts","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"],p=["","","","","","","","","","","","","","l","trjobiektywowy","trostruka","trojn","trojit","trippelt","trippel","tripl","triple","tripla","tiga","kolmois","ba camera"],m=[" ","","","",""," "," "," ","  "," "," "," "," ","ift geni","laajakulmainen kaksois","kp rng mt sau","ketts, szles ltszg","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka iroka","duln irokohl","dulna irokouhl","dupla grande-angular","dubl","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],y=e.filter(I=>{const A=I.label.toLowerCase();return c.some(L=>A.includes(L))});if(!y.length)return null;const C=y.find(I=>{const A=I.label.toLowerCase();return p.some(L=>A.includes(L))});if(C)return C.deviceId;const b=y.find(I=>{const A=I.label.toLowerCase();return m.some(L=>A.includes(L))});return b?b.deviceId:y[0].deviceId}}static findBestRearCamera(e,r){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(vt.OS))return Te.findBestRearCameraInIOS(e,{getMainCamera:r==null?void 0:r.getMainCameraInIOS});const o=["","","","","","","","","","","","","","","","","","zadn","zadn","tylny","trs","trasera","traseira","taka","stranja","spate","sau","rck","rear","posteriore","posterior","hts","darrere","belakang","baksidan","bakre","bak","bagside","back","a","arrire","arka","achterzijde"];for(let c of e){const p=c.label.toLowerCase();if(p&&o.some(m=>p.includes(m))&&/\b0(\b)?/.test(p))return c.deviceId}return["Android","HarmonyOS"].includes(vt.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,r,o){return e&&e.length?r==="environment"?this.findBestRearCamera(e,o):r==="user"?null:r?void 0:null:null}static async playVideo(e,r,o){if(!e)throw new Error("Invalid 'videoEl'.");if(!r)throw new Error("Invalid 'source'.");return new Promise(async(c,p)=>{let m;const y=()=>{e.removeEventListener("loadstart",A),e.removeEventListener("abort",L),e.removeEventListener("play",P),e.removeEventListener("error",j),e.removeEventListener("loadedmetadata",Z)};let C=!1;const b=()=>{C=!0,m&&clearTimeout(m),y(),c(e)},I=q=>{m&&clearTimeout(m),y(),p(q)},A=()=>{e.addEventListener("abort",L,{once:!0})},L=()=>{const q=new Error("Video playing was interrupted.");q.name="AbortError",I(q)},P=()=>{b()},j=()=>{I(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};let H;const $=new Promise(q=>{H=q}),Z=()=>{H()};if(e.addEventListener("loadstart",A,{once:!0}),e.addEventListener("play",P,{once:!0}),e.addEventListener("error",j,{once:!0}),e.addEventListener("loadedmetadata",Z,{once:!0}),typeof r=="string"||r instanceof String?e.src=r:e.srcObject=r,e.autoplay&&await new Promise(q=>{setTimeout(q,1e3)}),!C){o&&(m=setTimeout(()=>{y(),p(new Error("Failed to play video. Timeout."))},o));try{e.src&&await e.load(),await e.play(),b()}catch(q){console.warn("1st play error: "+((q==null?void 0:q.message)||q))}if(!C){await $;try{await e.play(),b()}catch(q){console.warn("2rd play error: "+((q==null?void 0:q.message)||q)),I(q)}}}})}static async testCameraAccess(e){var r,o;if(!(!((o=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||o===void 0)&&o.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let c;try{c=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0})}catch(p){return{ok:!1,errorName:p.name,errorMessage:p.message}}finally{c==null||c.getTracks().forEach(p=>{p.stop()})}return{ok:!0}}get state(){if(!V(this,jt,"f"))return"closed";if(V(this,jt,"f")==="pending")return"opening";if(V(this,jt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?Te.isStorageAvailable("localStorage")?Pe(this,jr,!0,"f"):(Pe(this,jr,!1,"f"),console.warn("Local storage is unavailable")):Pe(this,jr,!1,"f")}get ifSaveLastUsedCamera(){return V(this,jr,"f")}get isVideoPlaying(){return!(!V(this,xe,"f")||V(this,xe,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(e){var r,o,c;if(!(e instanceof HTMLElement)&&e!=null)throw new TypeError("Invalid 'element'.");(r=V(this,gr,"f"))===null||r===void 0||r.removeEventListener("click",V(this,Gr,"f")),(o=V(this,gr,"f"))===null||o===void 0||o.removeEventListener("touchend",V(this,Gr,"f")),(c=V(this,gr,"f"))===null||c===void 0||c.removeEventListener("touchmove",V(this,Ns,"f")),Pe(this,gr,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(vt.OS)?(e.addEventListener("touchend",V(this,Gr,"f")),e.addEventListener("touchmove",V(this,Ns,"f"))):e.addEventListener("click",V(this,Gr,"f")))}get tapFocusEventBoundEl(){return V(this,gr,"f")}get disposed(){return V(this,Us,"f")}constructor(e){var r,o;ye.add(this),xe.set(this,null),je.set(this,void 0),Ps.set(this,()=>{this.state==="opened"&&V(this,nt,"f").fire("resumed",null,{target:this,async:!1})}),ks.set(this,()=>{V(this,nt,"f").fire("paused",null,{target:this,async:!1})}),Xe.set(this,void 0),$t.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],Ii.set(this,void 0),jr.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Bs.set(this,void 0),hi.set(this,!0),Li.set(this,void 0),jt.set(this,void 0),Ur.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Vr.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(c,p)=>{let m,y;const C=window.getComputedStyle(V(this,xe,"f")).objectFit,b=this.getResolution(),I=V(this,xe,"f").getBoundingClientRect(),A=I.left,L=I.top,{width:P,height:j}=V(this,xe,"f").getBoundingClientRect();if(P<=0||j<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const H=P/j,$=b.width/b.height;let Z=1;if(C==="contain")$>H?(Z=P/b.width,m=(c-A)/Z,y=(p-L-(j-P/$)/2)/Z):(Z=j/b.height,y=(p-L)/Z,m=(c-A-(P-j*$)/2)/Z);else{if(C!=="cover")throw new Error("Unsupported object-fit.");$>H?(Z=j/b.height,y=(p-L)/Z,m=(c-A+(j*$-P)/2)/Z):(Z=P/b.width,m=(c-A)/Z,y=(p-L+(P/$-j)/2)/Z)}return{x:m,y}},Rn.set(this,!1),Ns.set(this,()=>{Pe(this,Rn,!0,"f")}),Gr.set(this,async c=>{var p;if(V(this,Rn,"f"))return void Pe(this,Rn,!1,"f");if(!V(this,Vr,"f")||!this.isVideoPlaying||!V(this,je,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(p=this.getCameraCapabilities())===null||p===void 0?void 0:p.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let m,y;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),c instanceof MouseEvent)m=c.clientX,y=c.clientY;else{if(!(c instanceof TouchEvent))throw new Error("Unknown event type.");if(!c.changedTouches.length)return;m=c.changedTouches[0].clientX,y=c.changedTouches[0].clientY}const C=this.getResolution(),b=2*Math.round(Math.min(C.width,C.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let I;try{I=this.calculateCoordInVideo(m,y)}catch{}if(I.x<0||I.x>C.width||I.y<0||I.y>C.height)return;const A={x:I.x+"px",y:I.y+"px"},L=b+"px",P=L;let j;Te._onLog&&(j=Date.now());try{await V(this,ye,"m",Ta).call(this,A,L,P,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(H){if(Te._onLog)throw Te._onLog(H),H}Te._onLog&&Te._onLog(`Tap focus costs: ${Date.now()-j} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var H;Te._onLog&&Te._onLog("Back to continuous focus."),(H=V(this,je,"f"))===null||H===void 0||H.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),V(this,nt,"f").fire("tapfocus",null,{target:this,async:!1})}),gr.set(this,null),xi.set(this,1),Oi.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!V(this,xe,"f"))return;const c=V(this,xi,"f");if(c<1)throw new RangeError("Invalid scale value.");if(c===1)V(this,xe,"f").style.transform="";else{const p=window.getComputedStyle(V(this,xe,"f")).objectFit,m=V(this,xe,"f").videoWidth,y=V(this,xe,"f").videoHeight,{width:C,height:b}=V(this,xe,"f").getBoundingClientRect();if(C<=0||b<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const I=C/b,A=m/y;let L=1;p==="contain"?L=I<A?C/(m/c):b/(y/c):p==="cover"&&(L=A>I?b/(m/c):C/(y/c));const P=L*(1-1/c)*(m/2-V(this,Oi,"f").x),j=L*(1-1/c)*(y/2-V(this,Oi,"f").y);V(this,xe,"f").style.transform=`translate(${P}px, ${j}px) scale(${c})`}},ba.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const c=document.createElement("canvas");let p;if(c.width=this.width,c.height=this.height,this.pixelFormat===Fe.GREY){p=new Uint8ClampedArray(this.width*this.height*4);for(let y=0;y<p.length;y+=4)p[y]=this.data[y/4],p[y+1]=this.data[y/4],p[y+2]=this.data[y/4],p[y+3]=255}else p=new Uint8ClampedArray(this.data.buffer);const m=new ImageData(p,this.width,this.height);return c.getContext("2d").putImageData(m,0,0),c}),nt.set(this,void 0),Sa.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],pr.set(this,new Map),tu.set(this,!1),js.set(this,async()=>{var c,p;if(document.visibilityState==="visible"){if(Te._onLog&&Te._onLog("document visible. video paused: "+((c=V(this,xe,"f"))===null||c===void 0?void 0:c.paused)),this.state=="opening"||this.state=="opened"){let m=!1;if(!this.isVideoPlaying){Te._onLog&&Te._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),m=!0}catch{Te._onLog&&Te._onLog("document visible. 1st resume video failed, try open instead.")}m||await V(this,ye,"m",Xr).call(this)}if(await new Promise(y=>setTimeout(y,300)),!this.isVideoPlaying){Te._onLog&&Te._onLog("document visible. 1st open failed. 2rd resume start."),m=!1;try{await this.resume(),m=!0}catch{Te._onLog&&Te._onLog("document visible. 2rd resume video failed, try open instead.")}m||await V(this,ye,"m",Xr).call(this)}}}else document.visibilityState==="hidden"&&(Te._onLog&&Te._onLog("document hidden. video paused: "+((p=V(this,xe,"f"))===null||p===void 0?void 0:p.paused)),this.state=="opening"||this.state=="opened"&&this.isVideoPlaying&&this.pause())}),Us.set(this,!1),!((o=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||o===void 0)&&o.getUserMedia||setTimeout(()=>{Te.onWarning&&Te.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Pe(this,nt,new cg,"f"),this.imageDataGetter=new Ie,document.addEventListener("visibilitychange",V(this,js,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",V(this,Ps,"f")),e.addEventListener("pause",V(this,ks,"f")),Pe(this,xe,e,"f")}getVideoEl(){return V(this,xe,"f")}releaseVideoEl(){var e,r;(e=V(this,xe,"f"))===null||e===void 0||e.removeEventListener("play",V(this,Ps,"f")),(r=V(this,xe,"f"))===null||r===void 0||r.removeEventListener("pause",V(this,ks,"f")),Pe(this,xe,null,"f")}isVideoLoaded(){return!!V(this,xe,"f")&&V(this,xe,"f").readyState==4}async open(){if(V(this,Li,"f")&&!V(this,hi,"f")){if(V(this,jt,"f")==="pending")return V(this,Li,"f");if(V(this,jt,"f")==="fulfilled")return}V(this,nt,"f").fire("before:open",null,{target:this}),await V(this,ye,"m",Xr).call(this),V(this,nt,"f").fire("played",null,{target:this,async:!1}),V(this,nt,"f").fire("opened",null,{target:this,async:!1})}async close(){if(this.state==="closed")return;V(this,nt,"f").fire("before:close",null,{target:this});const e=V(this,Li,"f");if(V(this,ye,"m",lo).call(this),e&&V(this,jt,"f")==="pending"){try{await e}catch{}if(V(this,hi,"f")===!1){const r=new Error("'close()' was interrupted.");throw r.name="AbortError",r}}Pe(this,Li,null,"f"),Pe(this,jt,null,"f"),V(this,nt,"f").fire("closed",null,{target:this,async:!1})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");V(this,xe,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");await V(this,xe,"f").play()}async setCamera(e){if(typeof e!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof V(this,Xe,"f").video!="object"&&(V(this,Xe,"f").video={}),delete V(this,Xe,"f").video.facingMode,V(this,Xe,"f").video.deviceId={exact:e},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&V(this,hi,"f"))){V(this,nt,"f").fire("before:camera:change",[],{target:this,async:!1}),await V(this,ye,"m",Dn).call(this);try{this.resetSoftwareScale()}catch{}return V(this,$t,"f")}}async switchToFrontCamera(e){if(typeof V(this,Xe,"f").video!="object"&&(V(this,Xe,"f").video={}),e!=null&&e.resolution&&(V(this,Xe,"f").video.width={ideal:e.resolution.width},V(this,Xe,"f").video.height={ideal:e.resolution.height}),delete V(this,Xe,"f").video.deviceId,V(this,Xe,"f").video.facingMode={exact:"user"},Pe(this,Ii,null,"f"),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&V(this,hi,"f"))){V(this,nt,"f").fire("before:camera:change",[],{target:this,async:!1}),V(this,ye,"m",Dn).call(this);try{this.resetSoftwareScale()}catch{}return V(this,$t,"f")}}getCamera(){var e;if(V(this,$t,"f"))return V(this,$t,"f");{let r=((e=V(this,Xe,"f").video)===null||e===void 0?void 0:e.deviceId)||"";if(r){r=r.exact||r.ideal||r;for(let o of this._arrCameras)if(o.deviceId===r)return JSON.parse(JSON.stringify(o))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var r,o;if(!(!((o=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||o===void 0)&&o.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let c;if(e){let y=await navigator.mediaDevices.getUserMedia({video:!0});c=(await navigator.mediaDevices.enumerateDevices()).filter(C=>C.kind==="videoinput"),y.getTracks().forEach(C=>{C.stop()})}else c=(await navigator.mediaDevices.enumerateDevices()).filter(y=>y.kind==="videoinput");const p=[],m=[];if(this._arrCameras)for(let y of this._arrCameras)y._checked&&m.push(y);for(let y=0;y<c.length;y++){let C,b=c[y];for(let I of m)if(b.deviceId==I.deviceId){C=I;break}C||(C={deviceId:b.deviceId,label:b.label?b.label:"camera "+y,_checked:!1}),C.deviceId&&p.push(C)}return this._arrCameras=p,Te._onLog&&Te._onLog(JSON.stringify(this._arrCameras)),p}async getCameras(){var e,r;if(!(!((r=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||r===void 0)&&r.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const o=(await navigator.mediaDevices.enumerateDevices()).filter(c=>c.kind==="videoinput");return o&&o.length&&!o[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,r,o){if(typeof e!="number"||e<=0)throw new TypeError("Invalid 'width'.");if(typeof r!="number"||r<=0)throw new TypeError("Invalid 'height'.");if(typeof V(this,Xe,"f").video!="object"&&(V(this,Xe,"f").video={}),o?(V(this,Xe,"f").video.width={exact:e},V(this,Xe,"f").video.height={exact:r}):(V(this,Xe,"f").video.width={ideal:e},V(this,Xe,"f").video.height={ideal:r}),this.state==="closed"||this.videoSrc||this.state==="opening"&&V(this,hi,"f"))return null;V(this,nt,"f").fire("before:resolution:change",[],{target:this,async:!1}),await V(this,ye,"m",Dn).call(this);try{this.resetSoftwareScale()}catch{}const c=this.getResolution();return{width:c.width,height:c.height}}getResolution(){if(this.state==="opened"&&this.videoSrc&&V(this,xe,"f"))return{width:V(this,xe,"f").videoWidth,height:V(this,xe,"f").videoHeight};if(V(this,je,"f")){const e=V(this,je,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:V(this,xe,"f").videoWidth,height:V(this,xe,"f").videoHeight};{const e={width:0,height:0};let r=V(this,Xe,"f").video.width||0,o=V(this,Xe,"f").video.height||0;return r&&(e.width=r.exact||r.ideal||r),o&&(e.height=o.exact||o.ideal||o),e}}async getResolutions(e){var r,o,c,p,m,y,C,b,I,A,L;if(!(!((o=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||o===void 0)&&o.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let P="";const j=(H,$)=>{const Z=V(this,pr,"f").get(H);if(!Z||!Z.length)return!1;for(let q of Z)if(q.width===$.width&&q.height===$.height)return!0;return!1};if(this._mediaStream){P=(L=V(this,$t,"f"))===null||L===void 0?void 0:L.deviceId;let H=V(this,pr,"f").get(P);if(H&&!e)return JSON.parse(JSON.stringify(H));H=[],V(this,pr,"f").set(P,H),Pe(this,Ur,!0,"f");try{for(let $ of this.detectedResolutions){await V(this,je,"f").applyConstraints({width:{ideal:$.width},height:{ideal:$.height}}),V(this,ye,"m",qt).call(this);const Z=V(this,je,"f").getSettings(),q={width:Z.width,height:Z.height};j(P,q)||H.push({width:q.width,height:q.height})}}catch($){throw V(this,ye,"m",lo).call(this),Pe(this,Ur,!1,"f"),$}try{await V(this,ye,"m",Xr).call(this)}catch($){if($.name==="AbortError")return H;throw $}finally{Pe(this,Ur,!1,"f")}return H}{const H=async(q,J,ie)=>{const ne={video:{deviceId:{exact:q},width:{ideal:J},height:{ideal:ie}}};let he=null;try{he=await navigator.mediaDevices.getUserMedia(ne)}catch{return null}if(!he)return null;const fe=he.getVideoTracks();let v=null;try{const ae=fe[0].getSettings();v={width:ae.width,height:ae.height}}catch{const me=document.createElement("video");me.srcObject=he,v={width:me.videoWidth,height:me.videoHeight},me.srcObject=null}return fe.forEach(ae=>{ae.stop()}),v};let $=((m=(p=(c=V(this,Xe,"f"))===null||c===void 0?void 0:c.video)===null||p===void 0?void 0:p.deviceId)===null||m===void 0?void 0:m.exact)||((b=(C=(y=V(this,Xe,"f"))===null||y===void 0?void 0:y.video)===null||C===void 0?void 0:C.deviceId)===null||b===void 0?void 0:b.ideal)||((A=(I=V(this,Xe,"f"))===null||I===void 0?void 0:I.video)===null||A===void 0?void 0:A.deviceId);if(!$)return[];let Z=V(this,pr,"f").get($);if(Z&&!e)return JSON.parse(JSON.stringify(Z));Z=[],V(this,pr,"f").set($,Z);for(let q of this.detectedResolutions){const J=await H($,q.width,q.height);J&&!j($,J)&&Z.push({width:J.width,height:J.height})}return Z}}async setMediaStreamConstraints(e,r){if(!(o=>{return o!==null&&(c=o,Object.prototype.toString.call(c)==="[object Object]");var c})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Pe(this,Xe,JSON.parse(JSON.stringify(e)),"f"),Pe(this,Ii,null,"f"),r&&V(this,ye,"m",Dn).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(V(this,Xe,"f")))}resetMediaStreamConstraints(){Pe(this,Xe,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");return V(this,je,"f").getCapabilities?V(this,je,"f").getCapabilities():{}}getCameraSettings(){if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");return V(this,je,"f").getSettings()}async turnOnTorch(){if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await V(this,je,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await V(this,je,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(e,r){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const c=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.colorTemperature;if(!c)throw Error("Not supported.");return r&&(e<c.min?e=c.min:e>c.max&&(e=c.max),e=Ot(e,c.min,c.step,c.max)),await V(this,je,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,r){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const c=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.exposureCompensation;if(!c)throw Error("Not supported.");return r&&(e<c.min?e=c.min:e>c.max&&(e=c.max),e=Ot(e,c.min,c.step,c.max)),await V(this,je,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,r){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let c=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.frameRate;if(!c)throw Error("Not supported.");r&&(e<c.min?e=c.min:e>c.max&&(e=c.max));const p=this.getResolution();return await V(this,je,"f").applyConstraints({width:{ideal:Math.max(p.width,p.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,r){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const o=this.getCameraCapabilities(),c=o==null?void 0:o.focusMode,p=o==null?void 0:o.focusDistance;if(!c)throw Error("Not supported.");if(typeof e.mode!="string")throw TypeError("Invalid 'mode'.");const m=e.mode.toLowerCase();if(!c.includes(m))throw Error("Unsupported focus mode.");if(m==="manual"){if(!p)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let y=e.distance;r&&(y<p.min?y=p.min:y>p.max&&(y=p.max),y=Ot(y,p.min,p.step,p.max)),this._focusParameters.focusArea=null,await V(this,je,"f").applyConstraints({advanced:[{focusMode:m,focusDistance:y}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const y=e.area.centerPoint;let C=e.area.width,b=e.area.height;if(!C||!b){const I=this.getResolution();C||(C=2*Math.round(Math.min(I.width,I.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),b||(b=2*Math.round(Math.min(I.width,I.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:y.x,y:y.y},width:C,height:b},await V(this,ye,"m",Ta).call(this,y,C,b)}}}else this._focusParameters.focusArea=null,await V(this,je,"f").applyConstraints({advanced:[{focusMode:m}]})}getFocus(){const e=this.getCameraSettings(),r=e.focusMode;return r?r==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:r}:null}async enableTapToFocus(){Pe(this,Vr,!0,"f")}disableTapToFocus(){Pe(this,Vr,!1,"f")}isTapToFocusEnabled(){return V(this,Vr,"f")}async setZoom(e){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");e.centerPoint?V(this,ye,"m",Ia).call(this,e.centerPoint):this.resetScaleCenter();try{if(V(this,ye,"m",iu).call(this,V(this,Oi,"f"))){const r=await this.setHardwareScale(e.factor,!0);let o=this.getHardwareScale();o==1&&r!=1&&(o=r),e.factor>o?this.setSoftwareScale(e.factor/o):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(r){const o=r.message||r;if(o!=="Not supported."&&o!=="Camera is not open.")throw r;this.setSoftwareScale(e.factor)}}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(r){if((r.message||r)!=="Camera is not open.")throw r}return{factor:e*V(this,xi,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(e,r){var o;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!V(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");const c=(o=this.getCameraCapabilities())===null||o===void 0?void 0:o.zoom;if(!c)throw Error("Not supported.");return r&&(e<c.min?e=c.min:e>c.max&&(e=c.max),e=Ot(e,c.min,c.step,c.max)),await V(this,je,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,r){if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");r&&V(this,ye,"m",Ia).call(this,r),Pe(this,xi,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return V(this,xi,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();Pe(this,Oi,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||V(this,Ur,"f"))return null;const r=Date.now();Te._onLog&&Te._onLog("getFrameData() START: "+r);const o=V(this,xe,"f").videoWidth,c=V(this,xe,"f").videoHeight;let p={sx:0,sy:0,sWidth:o,sHeight:c,dWidth:o,dHeight:c};e!=null&&e.position&&(p=JSON.parse(JSON.stringify(e.position)));let m=Fe.RGBA;e!=null&&e.pixelFormat&&(m=e.pixelFormat);let y=V(this,xi,"f");e!=null&&e.scale&&(y=e.scale);let C=V(this,Oi,"f");if(e!=null&&e.scaleCenter){if(typeof e.scaleCenter.x!="string"||typeof e.scaleCenter.y!="string")throw new Error("Invalid scale center.");let L=0,P=0;if(e.scaleCenter.x.endsWith("px"))L=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");L=parseFloat(e.scaleCenter.x)/100*o}if(e.scaleCenter.y.endsWith("px"))P=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");P=parseFloat(e.scaleCenter.y)/100*c}if(isNaN(L)||isNaN(P))throw new Error("Invalid scale center.");C.x=Math.round(L),C.y=Math.round(P)}let b=null;if(e!=null&&e.bufferContainer&&(b=e.bufferContainer),o==0||c==0)return null;y!==1&&(p.sWidth=Math.round(p.sWidth/y),p.sHeight=Math.round(p.sHeight/y),p.sx=Math.round((1-1/y)*C.x+p.sx/y),p.sy=Math.round((1-1/y)*C.y+p.sy/y));const I=this.imageDataGetter.getImageData(V(this,xe,"f"),o,c,p,{pixelFormat:m,bufferContainer:b});if(!I)return null;const A=Date.now();return Te._onLog&&Te._onLog("getFrameData() END: "+A),{data:I.data,width:I.width,height:I.height,pixelFormat:I.pixelFormat,timeSpent:A-r,timeStamp:A,toCanvas:V(this,ba,"f")}}on(e,r){if(!V(this,Sa,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);V(this,nt,"f").on(e,r)}off(e,r){V(this,nt,"f").off(e,r)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),V(this,nt,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",V(this,js,"f")),Pe(this,Us,!0,"f")}}var Xn,ho,zr,yr,co,Wr,wh,ru,Ft,Ln,Mn,xa,Oa,Me,Aa,Ra,Fn,Ei,Vs,Gs,Ws,zn,mr,Hs,bi,Ut,Qe,we,ni,Da,ze,nu,su,La,Ma;xe=new WeakMap,je=new WeakMap,Ps=new WeakMap,ks=new WeakMap,Xe=new WeakMap,$t=new WeakMap,Ii=new WeakMap,jr=new WeakMap,Bs=new WeakMap,hi=new WeakMap,Li=new WeakMap,jt=new WeakMap,Ur=new WeakMap,Vr=new WeakMap,Rn=new WeakMap,Ns=new WeakMap,Gr=new WeakMap,gr=new WeakMap,xi=new WeakMap,Oi=new WeakMap,ba=new WeakMap,nt=new WeakMap,Sa=new WeakMap,pr=new WeakMap,tu=new WeakMap,js=new WeakMap,Us=new WeakMap,ye=new WeakSet,yh=async function(){const t=this.getMediaStreamConstraints();if(typeof t.video=="boolean"&&(t.video={}),!t.video.deviceId){if(V(this,Ii,"f"))delete t.video.facingMode,t.video.deviceId={exact:V(this,Ii,"f")};else if(this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),r=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&r&&(t.video.width=e,t.video.height=r)}else if(!this.ifSkipCameraInspection){const e=async c=>{let p=null;return c==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(vt.OS)?(await this._getCameras(!1),V(this,ye,"m",qt).call(this),p=Te.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):c||["Android","HarmonyOS","iPhone","iPad"].includes(vt.OS)||(await this._getCameras(!1),V(this,ye,"m",qt).call(this),p=Te.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),p};let r=t.video.facingMode;r instanceof Array&&r.length&&(r=r[0]),typeof r=="object"&&(r=r.exact||r.ideal);const o=await e(r);o&&(delete t.video.facingMode,t.video.deviceId={exact:o})}}return t},qt=function(){if(V(this,hi,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},Yo=async function(t){var e,r;if(!(!((r=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||r===void 0)&&r.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let o;try{Te._onLog&&Te._onLog("======try getUserMedia========");let c=[0,500,1e3,2e3],p=null;const m=async y=>{for(let C of c){C&&(await new Promise(b=>setTimeout(b,C)),V(this,ye,"m",qt).call(this));try{Te._onLog&&Te._onLog("ask "+JSON.stringify(y)),o=await navigator.mediaDevices.getUserMedia(y),V(this,ye,"m",qt).call(this);break}catch(b){if(b.name==="NotFoundError"||b.name==="NotAllowedError"||b.name==="AbortError"||b.name==="OverconstrainedError")throw b;p=b,Te._onLog&&Te._onLog(b.message||b)}}};if(await m(t),o||typeof t.video!="object"||(t.video.deviceId&&(delete t.video.deviceId,await m(t)),!o&&t.video.facingMode&&(delete t.video.facingMode,await m(t)),o||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,await m(t))),!o)throw p;return o}catch(c){throw o==null||o.getTracks().forEach(p=>{p.stop()}),c.name==="NotFoundError"&&(DOMException?c=new DOMException("No camera available, please use a device with an accessible camera.",c.name):(c=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),c}},Xo=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),Pe(this,je,null,"f")},Xr=async function(){Pe(this,hi,!1,"f");const t=Pe(this,Bs,Symbol(),"f");if(V(this,Li,"f")&&V(this,jt,"f")==="pending"){try{await V(this,Li,"f")}catch{}V(this,ye,"m",qt).call(this)}return t!==V(this,Bs,"f")?void 0:Pe(this,Li,(async()=>{Pe(this,jt,"pending","f");try{if(this.videoSrc){if(!V(this,xe,"f"))throw new Error("'videoEl' should be set.");await Te.playVideo(V(this,xe,"f"),this.videoSrc,this.cameraOpenTimeout),V(this,ye,"m",qt).call(this)}else{let r=await V(this,ye,"m",yh).call(this);V(this,ye,"m",Xo).call(this);let o=await V(this,ye,"m",Yo).call(this,r);await this._getCameras(!1),V(this,ye,"m",qt).call(this);const c=()=>{const C=o.getVideoTracks();let b,I;if(C.length&&(b=C[0]),b){const A=b.getSettings();if(A){for(let L of this._arrCameras)if(A.deviceId===L.deviceId){L._checked=!0,L.label=b.label,I=L;break}}}return I},p=V(this,Xe,"f");if(typeof p.video=="object"){let C=p.video.facingMode;if(C instanceof Array&&C.length&&(C=C[0]),typeof C=="object"&&(C=C.exact||C.ideal),!(V(this,Ii,"f")||this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||p.video.deviceId)){const b=c(),I=Te.findBestCamera(this._arrCameras,C,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});I&&I!=(b==null?void 0:b.deviceId)&&(o.getTracks().forEach(A=>{A.stop()}),r.video.deviceId={exact:I},o=await V(this,ye,"m",Yo).call(this,r),V(this,ye,"m",qt).call(this))}}const m=c();m!=null&&m.deviceId&&(Pe(this,Ii,m&&m.deviceId,"f"),this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",V(this,Ii,"f")),typeof r.video=="object"&&r.video.width&&r.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(r.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(r.video.height))))),V(this,xe,"f")&&(await Te.playVideo(V(this,xe,"f"),o,this.cameraOpenTimeout),V(this,ye,"m",qt).call(this)),this._mediaStream=o;const y=o.getVideoTracks();y!=null&&y.length&&Pe(this,je,y[0],"f"),Pe(this,$t,m,"f")}}catch(r){throw V(this,ye,"m",lo).call(this),Pe(this,jt,null,"f"),r}Pe(this,jt,"fulfilled","f")})(),"f")},Dn=async function(){var t;if(this.state==="closed"||this.videoSrc)return;const e=(t=V(this,$t,"f"))===null||t===void 0?void 0:t.deviceId,r=this.getResolution();await V(this,ye,"m",Xr).call(this);const o=this.getResolution();e&&e!==V(this,$t,"f").deviceId&&V(this,nt,"f").fire("camera:changed",[V(this,$t,"f").deviceId,e],{target:this,async:!1}),r.width==o.width&&r.height==o.height||V(this,nt,"f").fire("resolution:changed",[{width:o.width,height:o.height},{width:r.width,height:r.height}],{target:this,async:!1}),V(this,nt,"f").fire("played",null,{target:this,async:!1})},lo=function(){V(this,ye,"m",Xo).call(this),Pe(this,$t,null,"f"),V(this,xe,"f")&&(V(this,xe,"f").srcObject=null,this.videoSrc&&(V(this,xe,"f").pause(),V(this,xe,"f").currentTime=0)),Pe(this,hi,!0,"f");try{this.resetSoftwareScale()}catch{}},Lt=async function t(e,r){const o=H=>{if(!V(this,je,"f")||!this.isVideoPlaying||H.focusTaskId!=this._focusParameters.curFocusTaskId){V(this,je,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const $=new Error(`Focus task ${H.focusTaskId} canceled.`);throw $.name="DeprecatedTaskError",$}this._focusParameters.isDoingFocus===1&&Date.now()-H.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let c;r=Ot(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await V(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}),o(e),c=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/r),Math.abs(1/this._focusParameters.fds.max-1/r))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/r)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=r,await new Promise(H=>{setTimeout(H,c)}),o(e);let p=e.focusL-e.focusW/2,m=e.focusT-e.focusH/2,y=e.focusW,C=e.focusH;const b=this.getResolution();p=Math.round(p),m=Math.round(m),y=Math.round(y),C=Math.round(C),y>b.width&&(y=b.width),C>b.height&&(C=b.height),p<0?p=0:p+y>b.width&&(p=b.width-y),m<0?m=0:m+C>b.height&&(m=b.height-C);const I=4*b.width*b.height*this._focusParameters.defaultTempBufferContainerLenRatio,A=4*y*C;let L=this._focusParameters.tempBufferContainer;if(L){const H=L.length;I>H&&I>=A?L=new Uint8Array(I):A>H&&A>=I&&(L=new Uint8Array(A))}else L=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(I,A));if(!this.imageDataGetter.getImageData(V(this,xe,"f"),b.width,b.height,{sx:p,sy:m,sWidth:y,sHeight:C,dWidth:y,dHeight:C},{pixelFormat:Fe.RGBA,bufferContainer:L}))return V(this,ye,"m",t).call(this,e,r);const P=L;let j=0;for(let H=0,$=A-8;H<$;++H){let Z=P[H]-P[H+8];++H;let q=P[H]-P[H+8];++H;let J=P[H]-P[H+8];++H,j+=Z*Z+q*q+J*J}return-j},Rr=async function t(e,r,o,c,p,m,y){let C;if(r=Ot(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),c=Ot(c,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),m?m=Ot(m,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(m=Ot(Math.sqrt((r||this._focusParameters.fds.step)*(c||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),y=await V(this,ye,"m",Lt).call(this,e,m)),y<=o&&y<=p?C=3:o<p&&o<y?C=1:p<o&&p<y&&(C=2),(c-r)/2<=this._focusParameters.fds.step)return C===3||(C===1?await V(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}):C===2&&await V(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:c}]})),!0;if(C===1)return await V(this,ye,"m",t).call(this,e,r,o,m,y);if(C===2)return await V(this,ye,"m",t).call(this,e,m,y,c,p);if(C!==3)return o=await V(this,ye,"m",Lt).call(this,e,r),p=await V(this,ye,"m",Lt).call(this,e,c),await V(this,ye,"m",t).call(this,e,r,o,c,p);let b=Ot(Math.sqrt((r||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),I=Ot(Math.sqrt((c||this._focusParameters.fds.step)*(m||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/b)<=Math.abs(1/this._focusParameters.oldDistance-1/I)){let A=await V(this,ye,"m",Lt).call(this,e,b);if(A<y)return await V(this,ye,"m",t).call(this,e,r,o,m,y,b,A);if(A==y)return await V(this,ye,"m",t).call(this,e,b,A,m,y);let L=await V(this,ye,"m",Lt).call(this,e,I);if(A>y&&y<L)return await V(this,ye,"m",t).call(this,e,b,A,I,L,m,y);if(y==L)return await V(this,ye,"m",t).call(this,e,m,y,I,L);if(y>L)return await V(this,ye,"m",t).call(this,e,m,y,c,p,I,L)}else{let A=await V(this,ye,"m",Lt).call(this,e,I);if(y>A)return await V(this,ye,"m",t).call(this,e,m,y,c,p,I,A);if(y==A)return await V(this,ye,"m",t).call(this,e,m,y,I,A);let L=await V(this,ye,"m",Lt).call(this,e,b);if(L>y&&y<A)return await V(this,ye,"m",t).call(this,e,b,L,I,A,m,y);if(L==y)return await V(this,ye,"m",t).call(this,e,b,L,m,y);if(L<y)return await V(this,ye,"m",t).call(this,e,r,o,m,y,b,L)}return!1},Ta=async function(t,e,r,o,c){var p;if(this._focusParameters.isDoingFocus==1)return!1;if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'centerPoint'.");if(!e||typeof e!="string")throw new Error("Invalid 'width'.");if(!r||typeof r!="string")throw new Error("Invalid 'height'.");const m=this.getResolution();let y=0,C=0;if(t.x.endsWith("px"))y=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");y=parseFloat(t.x)/100*m.width}if(t.y.endsWith("px"))C=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(t.y)/100*m.height}if(isNaN(y)||isNaN(C)||y<0||y>m.width||C<0||C>m.height)throw new Error("Invalid 'centerPoint'.");let b=0;if(e.endsWith("px"))b=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");b=parseFloat(e)/100*m.width}if(isNaN(b)||b<0)throw new Error("Invalid 'width'.");let I=0;if(r.endsWith("px"))I=parseFloat(r);else{if(!r.endsWith("%"))throw new Error("Invalid 'height'.");I=parseFloat(r)/100*m.height}if(isNaN(I)||I<0)throw new Error("Invalid 'height'.");if(V(this,xi,"f")!==1){const P=V(this,xi,"f"),j=V(this,Oi,"f");b/=P,I/=P,y=(1-1/P)*j.x+y/P,C=(1-1/P)*j.y+C/P}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(p=this.getCameraCapabilities())===null||p===void 0?void 0:p.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const A={focusL:y,focusT:C,focusW:b,focusH:I,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},L=async(P,j,H)=>{try{(j==null||j<this._focusParameters.fds.min)&&(j=this._focusParameters.fds.min),(H==null||H>this._focusParameters.fds.max)&&(H=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let $=Ot(Math.sqrt(H*(j||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),Z=Ot(Math.sqrt((j||this._focusParameters.fds.step)*$),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),q=Ot(Math.sqrt($*H),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),J=await V(this,ye,"m",Lt).call(this,P,q),ie=await V(this,ye,"m",Lt).call(this,P,Z),ne=await V(this,ye,"m",Lt).call(this,P,$);if(ie>ne&&ne<J){const he=await V(this,ye,"m",Rr).call(this,P,Z,ie,q,J,$,ne);return this._focusParameters.isDoingFocus=0,he}if(ie<ne&&ie<J){let he=await V(this,ye,"m",Lt).call(this,P,j);const fe=await V(this,ye,"m",Rr).call(this,P,j,he,$,ne,Z,ie);return this._focusParameters.isDoingFocus=0,fe}if(ne>J&&ie>J){let he=await V(this,ye,"m",Lt).call(this,P,H);const fe=await V(this,ye,"m",Rr).call(this,P,$,ne,H,he,q,J);return this._focusParameters.isDoingFocus=0,fe}if(ie==ne&&ne<J){const he=await V(this,ye,"m",Rr).call(this,P,Z,ie,$,ne);return this._focusParameters.isDoingFocus=0,he}if(ne==J&&ie>ne){const he=await V(this,ye,"m",Rr).call(this,P,$,ne,q,J);return this._focusParameters.isDoingFocus=0,he}return L(P,j,H)}catch($){if($.name!=="DeprecatedTaskError")throw $}};return L(A,o,c)},Ia=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'center'.");const e=this.getResolution();let r=0,o=0;if(t.x.endsWith("px"))r=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))o=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(t.y)/100*e.height}if(isNaN(r)||isNaN(o))throw new Error("Invalid scale center.");Pe(this,Oi,{x:r,y:o},"f")},iu=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},Te.browserInfo=vt,Te.onWarning=(Ho=window==null?void 0:window.console)===null||Ho===void 0?void 0:Ho.warn;class Mi{constructor(e){Xn.add(this),ho.set(this,void 0),zr.set(this,0),yr.set(this,void 0),co.set(this,0),Wr.set(this,!1),Se(this,ho,e,"f")}startCharging(){M(this,Wr,"f")||(Mi._onLog&&Mi._onLog("start charging."),M(this,Xn,"m",ru).call(this),Se(this,Wr,!0,"f"))}stopCharging(){M(this,yr,"f")&&clearTimeout(M(this,yr,"f")),M(this,Wr,"f")&&(Mi._onLog&&Mi._onLog("stop charging."),Se(this,zr,Date.now()-M(this,co,"f"),"f"),Se(this,Wr,!1,"f"))}}ho=new WeakMap,zr=new WeakMap,yr=new WeakMap,co=new WeakMap,Wr=new WeakMap,Xn=new WeakSet,wh=function(){et.cfd(1),Mi._onLog&&Mi._onLog("charge 1.")},ru=function t(){M(this,zr,"f")==0&&M(this,Xn,"m",wh).call(this),Se(this,co,Date.now(),"f"),M(this,yr,"f")&&clearTimeout(M(this,yr,"f")),Se(this,yr,setTimeout(()=>{Se(this,zr,0,"f"),M(this,Xn,"m",t).call(this)},M(this,ho,"f")-M(this,zr,"f")),"f")};class at{static beep(){if(!this.allowBeep||!this.beepSoundSource)return;let e,r=Date.now();if(!(r-M(this,Ft,"f",xa)<100)){if(Se(this,Ft,r,"f",xa),M(this,Ft,"f",Ln).size&&(e=M(this,Ft,"f",Ln).values().next().value,this.beepSoundSource==e.src?(M(this,Ft,"f",Ln).delete(e),e.play()):e=null),!e)if(M(this,Ft,"f",Mn).size<16){e=new Audio(this.beepSoundSource);let o=null,c=()=>{e.removeEventListener("loadedmetadata",c),e.play(),o=setTimeout(()=>{M(this,Ft,"f",Mn).delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",c),e.addEventListener("ended",()=>{o!=null&&(clearTimeout(o),o=null),e.pause(),e.currentTime=0,M(this,Ft,"f",Mn).delete(e),M(this,Ft,"f",Ln).add(e)})}else M(this,Ft,"f",Oa)||(Se(this,Ft,!0,"f",Oa),console.warn("The requested audio tracks exceed 16 and will not be played."));e&&M(this,Ft,"f",Mn).add(e)}}static vibrate(){if(this.allowVibrate){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(at.vibrateDuration)}}}Ft=at,Ln={value:new Set},Mn={value:new Set},xa={value:0},Oa={value:!1},at.allowBeep=!0,at.beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",at.allowVibrate=!0,at.vibrateDuration=300;const Ch=new Map([[be.IPF_GRAYSCALED,Fe.GREY],[be.IPF_ABGR_8888,Fe.RGBA],[be.IPF_ARGB_8888,Fe.BGRA]]),Eh=new Map([[Fe.GREY,be.IPF_GRAYSCALED],[Fe.RGBA,be.IPF_ABGR_8888],[Fe.BGRA,be.IPF_ARGB_8888]]),zo=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Oe extends ua{static set _onLog(e){Se(Oe,Aa,e,"f",Ra),Te._onLog=e,Mi._onLog=e}static get _onLog(){return M(Oe,Aa,"f",Ra)}static async detectEnvironment(){return await(async()=>({wasm:qd,worker:Jd,getUserMedia:Hc,camera:await Qd(),browser:ht.browser,version:ht.version,OS:ht.OS}))()}static async testCameraAccess(){const e=await Te.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:e.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:e.errorName==="OverconstrainedError"||e.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:e.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:e.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:e.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:e.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}}static async createInstance(e){var r,o;if(e&&!(e instanceof ut))throw new TypeError("Invalid view.");if(!((r=lt.license)===null||r===void 0)&&r.LicenseManager){if(!(!((o=lt.license)===null||o===void 0)&&o.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await et.loadWasm(["license"]),await lt.license.dynamsoft()}const c=new Oe(e);return Oe.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{Oe.onWarning&&Oe.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Oe.onWarning&&Oe.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),c}get video(){return this.cameraManager.getVideoEl()}set videoSrc(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraView&&(this.cameraView._hideDefaultSelection=!0),this.cameraManager.videoSrc=e}get videoSrc(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Se(this,Vs,e,"f")}get singleFrameMode(){return M(this,Vs,"f")}get _isFetchingStarted(){return M(this,bi,"f")}get disposed(){return M(this,Da,"f")}constructor(e){if(super(),Me.add(this),Fn.set(this,"closed"),Ei.set(this,void 0),this.isTorchOn=void 0,Vs.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&await this.selectCamera(this.cameraView._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen()||!this.cameraView||this.cameraView.disposed)return;let r,o;if(this.cameraView._selRsl&&this.cameraView._selRsl.selectedIndex!=-1){let c=this.cameraView._selRsl.options[this.cameraView._selRsl.selectedIndex];r=parseInt(c.getAttribute("data-width")),o=parseInt(c.getAttribute("data-height"))}await this.setResolution({width:r,height:o})},this._onCloseBtnClick=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&this.close()},Gs.set(this,(r,o,c,p)=>{const m=Date.now(),y={sx:p.x,sy:p.y,sWidth:p.width,sHeight:p.height,dWidth:p.width,dHeight:p.height},C=Math.max(y.dWidth,y.dHeight);if(this.canvasSizeLimit&&C>this.canvasSizeLimit){const A=this.canvasSizeLimit/C;y.dWidth>y.dHeight?(y.dWidth=this.canvasSizeLimit,y.dHeight=Math.round(y.dHeight*A)):(y.dWidth=Math.round(y.dWidth*A),y.dHeight=this.canvasSizeLimit)}const b=this.cameraManager.imageDataGetter.getImageData(r,o,c,y,{pixelFormat:Ch.get(this.getPixelFormat())});let I=null;if(b){const A=Date.now();let L;b.pixelFormat===Fe.GREY?L=b.width:L=4*b.width;let P=!0;y.sx===0&&y.sy===0&&y.sWidth===o&&y.sHeight===c&&(P=!1),I={bytes:b.data,width:b.width,height:b.height,stride:L,format:Eh.get(b.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:so.ITT_FILE_IMAGE,isCropped:P,cropRegion:{left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height,isMeasuredInPercentage:!1},originalWidth:o,originalHeight:c,currentWidth:b.width,currentHeight:b.height,timeSpent:A-m,timeStamp:A},toCanvas:M(this,Ws,"f"),isDCEFrame:!0}}return I}),this._onSingleFrameAcquired=r=>{let o;o=this.cameraView?this.cameraView.getConvertedRegion():bs.convert(M(this,mr,"f"),r.width,r.height),o||(o={x:0,y:0,width:r.width,height:r.height});const c=M(this,Gs,"f").call(this,r,r.width,r.height,o);M(this,Ei,"f").fire("singleFrameAcquired",[c],{async:!1,copy:!1})},Ws.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const r=document.createElement("canvas");let o;if(r.width=this.width,r.height=this.height,this.format===be.IPF_GRAYSCALED){o=new Uint8ClampedArray(this.width*this.height*4);for(let c=0;c<o.length;c+=4)o[c]=this.bytes[c/4],o[c+1]=this.bytes[c/4],o[c+2]=this.bytes[c/4],o[c+3]=255}else o=new Uint8ClampedArray(this.bytes.buffer);return r.getContext("2d").putImageData(new ImageData(o,this.width,this.height),0,0),r}),zn.set(this,void 0),mr.set(this,void 0),Hs.set(this,be.IPF_ABGR_8888),bi.set(this,!1),this._imageId=-1,Ut.set(this,void 0),this.fetchInterval=0,Qe.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),we.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),ni.set(this,void 0),Da.set(this,!1),this.isCameraEnhancer=!0,this._taskid4AutoTorch=null,this._delay4AutoTorch=250,this.grayThreshold4AutoTorch=20,this.maxDarkCount4AutoTroch=3,e&&!(e instanceof ut))throw new TypeError("Invalid view.");Se(this,Ei,new zc,"f"),this.cameraManager=new Te,this._imageDataGetter=this.cameraManager.imageDataGetter,this.cameraManager.updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const r=this.cameraManager.getSoftwareScale();if(r<1)throw new RangeError("Invalid scale value.");this.cameraView&&!this.cameraView.disposed?(this.video.style.transform=r===1?"":`scale(${r})`,this.cameraView._updateVideoContainer()):this.video.style.transform=r===1?"":`scale(${r})`},["iPhone","iPad","Android","HarmonyOS"].includes(ht.OS)?this.cameraManager.setResolution(1280,720):this.cameraManager.setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&(this.setCameraView(e),e.cameraEnhancer=this),this._on("before:camera:change",()=>{M(this,ni,"f").stopCharging();const r=this.cameraView;r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const r=this.cameraView;r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{M(this,ni,"f").stopCharging();const r=this.cameraView;r&&r.disposed}),this._on("resumed",()=>{const r=this.cameraView;r&&r.disposed}),this._on("tapfocus",()=>{M(this,Qe,"f").tapToFocus&&M(this,ni,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(r,o)=>{var c,p,m,y;if(M(this,Me,"m",ze).call(this)||!this.isOpen()||this.isPaused())return;const C=r.intermediateResultUnits;Oe._onLog&&(Oe._onLog("intermediateResultUnits:"),Oe._onLog(C));let b=!1,I=!1;for(let A of C){if(A.unitType===hs.IRUT_DECODED_BARCODES&&A.decodedBarcodes.length){b=!0;break}A.unitType===hs.IRUT_LOCALIZED_BARCODES&&A.localizedBarcodes.length&&(I=!0)}if(Oe._onLog&&(Oe._onLog("hasLocalizedBarcodes:"),Oe._onLog(I)),M(this,Qe,"f").autoZoom||M(this,Qe,"f").enhancedFocus)if(b)M(this,we,"f").autoZoomInFrameArray.length=0,M(this,we,"f").autoZoomOutFrameCount=0,M(this,we,"f").frameArrayInIdealZoom.length=0,M(this,we,"f").autoFocusFrameArray.length=0;else{const A=async P=>{await this.setZoom(P),M(this,Qe,"f").autoZoom&&M(this,ni,"f").startCharging()},L=async P=>{await this.setFocus(P),M(this,Qe,"f").enhancedFocus&&M(this,ni,"f").startCharging()};if(I){const P=C[0].originalImageTag,j=((c=P.cropRegion)===null||c===void 0?void 0:c.left)||0,H=((p=P.cropRegion)===null||p===void 0?void 0:p.top)||0,$=!((m=P.cropRegion)===null||m===void 0)&&m.right?P.cropRegion.right-j:P.originalWidth,Z=!((y=P.cropRegion)===null||y===void 0)&&y.bottom?P.cropRegion.bottom-H:P.originalHeight,q=P.currentWidth,J=P.currentHeight;let ie;{let ne,he,fe,v,ae;{const a=this.video.videoWidth*(1-M(this,we,"f").autoZoomDetectionArea)/2,s=this.video.videoWidth*(1+M(this,we,"f").autoZoomDetectionArea)/2,l=s,u=a,i=this.video.videoHeight*(1-M(this,we,"f").autoZoomDetectionArea)/2,n=i,h=this.video.videoHeight*(1+M(this,we,"f").autoZoomDetectionArea)/2;ae=[{x:a,y:i},{x:s,y:n},{x:l,y:h},{x:u,y:h}]}Oe._onLog&&(Oe._onLog("detectionArea:"),Oe._onLog(ae));const me=[];{const a=(s,l)=>{const u=(n,h)=>{if(!n&&!h)throw new Error("Invalid arguments.");return function(g,f,d){let _=!1;const w=g.length;if(w<=2)return!1;for(let E=0;E<w;E++){const T=g[E],S=g[(E+1)%w];if(ig(T,S,{x:f,y:d}))return!0;Go(T.y-d)>0!=Go(S.y-d)>0&&Go(f-(d-T.y)*(T.x-S.x)/(T.y-S.y)-T.x)<0&&(_=!_)}return _}(h,n.x,n.y)},i=(n,h)=>!!(fs([n[0],n[1]],[n[2],n[3]],[h[0].x,h[0].y],[h[1].x,h[1].y])||fs([n[0],n[1]],[n[2],n[3]],[h[1].x,h[1].y],[h[2].x,h[2].y])||fs([n[0],n[1]],[n[2],n[3]],[h[2].x,h[2].y],[h[3].x,h[3].y])||fs([n[0],n[1]],[n[2],n[3]],[h[3].x,h[3].y],[h[0].x,h[0].y]));return!!(u({x:s[0].x,y:s[0].y},l)||u({x:s[1].x,y:s[1].y},l)||u({x:s[2].x,y:s[2].y},l)||u({x:s[3].x,y:s[3].y},l))||!!(u({x:l[0].x,y:l[0].y},s)||u({x:l[1].x,y:l[1].y},s)||u({x:l[2].x,y:l[2].y},s)||u({x:l[3].x,y:l[3].y},s))||!!(i([l[0].x,l[0].y,l[1].x,l[1].y],s)||i([l[1].x,l[1].y,l[2].x,l[2].y],s)||i([l[2].x,l[2].y,l[3].x,l[3].y],s)||i([l[3].x,l[3].y,l[0].x,l[0].y],s))};for(let s of C)if(s.unitType===hs.IRUT_LOCALIZED_BARCODES)for(let l of s.localizedBarcodes){if(!l)continue;const u=l.location.points;u.forEach(i=>{ut._transformCoordinates(i,j,H,$,Z,q,J)}),a(ae,u)&&me.push(l)}if(Oe._debug&&this.cameraView){const s=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99));s.clearDrawingItems();const l=this.__styleId2||(this.__styleId2=pe.createDrawingStyle({strokeStyle:"red"}));for(let u of C)if(u.unitType===hs.IRUT_LOCALIZED_BARCODES)for(let i of u.localizedBarcodes){if(!i)continue;const n=i.location.points,h=new va({points:n},l);s.addDrawingItems([h])}}}if(Oe._onLog&&(Oe._onLog("intersectedResults:"),Oe._onLog(me)),!me.length)return;let de;if(me.length){let a=me.filter(s=>s.possibleFormats==zo.BF_QR_CODE||s.possibleFormats==zo.BF_DATAMATRIX);if(a.length||(a=me.filter(s=>s.possibleFormats==zo.BF_ONED),a.length||(a=me)),a.length){const s=u=>{const i=u.location.points,n=(i[0].x+i[1].x+i[2].x+i[3].x)/4,h=(i[0].y+i[1].y+i[2].y+i[3].y)/4;return(n-q/2)*(n-q/2)+(h-J/2)*(h-J/2)};de=a[0];let l=s(de);if(a.length!=1)for(let u=1;u<a.length;u++){const i=s(a[u]);(a[u].confidence>1.1*de.confidence||a[u].confidence>.9*de.confidence&&i<l)&&(de=a[u],l=i)}}}if(Oe._onLog&&(Oe._onLog("highPriorityResult:"),Oe._onLog(de)),de){const a=de.location.points;ne=Math.min(a[0].x,a[1].x,a[2].x,a[3].x),he=Math.max(a[0].x,a[1].x,a[2].x,a[3].x),fe=Math.min(a[0].y,a[1].y,a[2].y,a[3].y),v=Math.max(a[0].y,a[1].y,a[2].y,a[3].y),ie={points:[{x:ne,y:fe},{x:he,y:fe},{x:he,y:v},{x:ne,y:v}],result:de}}}if(Oe._onLog&&(Oe._onLog("boundingRect:"),Oe._onLog(ie)),!ie)return;if(Oe._debug&&this.cameraView&&(ie!=null&&ie.points)){const ne=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99)),he=this.__styleId1||(this.__styleId1=pe.createDrawingStyle({strokeStyle:"blue"})),fe=new va({points:ie.points},he);ne.addDrawingItems([fe])}if(M(this,we,"f").autoZoomOutFrameCount=0,M(this,Qe,"f").autoZoom){const ne=M(this,we,"f").autoZoomIdealArea[1];let he=(1-M(this,we,"f").autoZoomTargetBorder)/2;const fe=ie.points[0].x/$,v=($-ie.points[2].x)/$,ae=ie.points[0].y/Z,me=(Z-ie.points[2].y)/Z;if(fe>ne&&v>ne&&ae>ne&&me>ne&&ie.result.moduleSize<M(this,we,"f").autoZoomInIdealModuleSize){if(M(this,we,"f").autoZoomInFrameArray.push(!0),M(this,we,"f").autoZoomInFrameArray.splice(0,M(this,we,"f").autoZoomInFrameArray.length-M(this,we,"f").autoZoomInFrameLimit[0]),M(this,we,"f").frameArrayInIdealZoom.length=0,M(this,Qe,"f").enhancedFocus&&L({mode:"continuous"}).catch(()=>{}),M(this,we,"f").autoZoomInFrameArray.filter(de=>de===!0).length>=M(this,we,"f").autoZoomInFrameLimit[1]){M(this,we,"f").autoZoomInFrameArray.length=0;const de=[(.5-he)/(.5-fe),(.5-he)/(.5-v),(.5-he)/(.5-ae),(.5-he)/(.5-me)].filter(i=>i>0),a=Math.min(...de,M(this,we,"f").autoZoomInIdealModuleSize/ie.result.moduleSize),s=this.getZoomSettings().factor;let l=Math.max(Math.pow(s*a,1/M(this,we,"f").autoZoomInMaxTimes),M(this,we,"f").autoZoomInMinStep);l=Math.min(l,a);let u=s*l;u=Math.max(M(this,we,"f").minValue,u),u=Math.min(M(this,we,"f").maxValue,u);try{await A({factor:u})}catch(i){const n=i.message||i;console.warn(n)}this.clearBuffer()}}else if(M(this,we,"f").autoZoomInFrameArray.length=0,M(this,we,"f").frameArrayInIdealZoom.push(!0),M(this,we,"f").frameArrayInIdealZoom.splice(0,M(this,we,"f").frameArrayInIdealZoom.length-M(this,we,"f").frameLimitInIdealZoom[0]),M(this,we,"f").frameArrayInIdealZoom.filter(de=>de===!0).length>=M(this,we,"f").frameLimitInIdealZoom[1]&&(M(this,we,"f").frameArrayInIdealZoom.length=0,M(this,Qe,"f").enhancedFocus)){const de=ie.points;try{await L({mode:"manual",area:{centerPoint:{x:(de[0].x+de[2].x)/2+"px",y:(de[0].y+de[2].y)/2+"px"},width:de[2].x-de[0].x+"px",height:de[2].y-de[0].y+"px"}})}catch(a){const s=a.message||a;console.warn(s)}this.clearBuffer()}}if(!M(this,Qe,"f").autoZoom&&M(this,Qe,"f").enhancedFocus&&(M(this,we,"f").autoFocusFrameArray.push(!0),M(this,we,"f").autoFocusFrameArray.splice(0,M(this,we,"f").autoFocusFrameArray.length-M(this,we,"f").autoFocusFrameLimit[0]),M(this,we,"f").autoFocusFrameArray.filter(ne=>ne===!0).length>=M(this,we,"f").autoFocusFrameLimit[1])){M(this,we,"f").autoFocusFrameArray.length=0;try{const ne=ie.points;await L({mode:"manual",area:{centerPoint:{x:(ne[0].x+ne[2].x)/2+"px",y:(ne[0].y+ne[2].y)/2+"px"},width:ne[2].x-ne[0].x+"px",height:ne[2].y-ne[0].y+"px"}})}catch(ne){const he=ne.message||ne;console.warn(he)}this.clearBuffer()}}else{if(M(this,Qe,"f").autoZoom){if(M(this,we,"f").autoZoomInFrameArray.push(!1),M(this,we,"f").autoZoomInFrameArray.splice(0,M(this,we,"f").autoZoomInFrameArray.length-M(this,we,"f").autoZoomInFrameLimit[0]),M(this,we,"f").autoZoomOutFrameCount++,M(this,we,"f").frameArrayInIdealZoom.push(!1),M(this,we,"f").frameArrayInIdealZoom.splice(0,M(this,we,"f").frameArrayInIdealZoom.length-M(this,we,"f").frameLimitInIdealZoom[0]),M(this,we,"f").autoZoomOutFrameCount>=M(this,we,"f").autoZoomOutFrameLimit){M(this,we,"f").autoZoomOutFrameCount=0;const P=this.getZoomSettings().factor;let j=P-Math.max((P-1)*M(this,we,"f").autoZoomOutStepRate,M(this,we,"f").autoZoomOutMinStep);j=Math.max(M(this,we,"f").minValue,j),j=Math.min(M(this,we,"f").maxValue,j);try{await A({factor:j})}catch(H){const $=H.message||H;console.warn($)}this.clearBuffer()}M(this,Qe,"f").enhancedFocus&&L({mode:"continuous"}).catch(()=>{})}!M(this,Qe,"f").autoZoom&&M(this,Qe,"f").enhancedFocus&&(M(this,we,"f").autoFocusFrameArray.length=0,L({mode:"continuous"}).catch(()=>{}))}}},Se(this,ni,new Mi(1e4),"f")}setCameraView(e){if(!(e instanceof ut))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(this.cameraView._hideDefaultSelection=!0),M(this,Me,"m",ze).call(this)||this.cameraManager.setVideoEl(e.getVideoElement()),this.cameraView=e,this.addListenerToView()}getCameraView(){return this.cameraView}releaseCameraView(){this.cameraView&&(this.removeListenerFromView(),this.cameraView.disposed||(this.cameraView._singleFrameMode="disabled",this.cameraView._onSingleFrameAcquired=null,this.cameraView._hideDefaultSelection=!1),this.cameraManager.releaseVideoEl(),this.cameraView=null)}addListenerToView(){if(!this.cameraView)return;if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");const e=this.cameraView;M(this,Me,"m",ze).call(this)||this.videoSrc||(e._innerComponent&&(this.cameraManager.tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!this.cameraView||this.cameraView.disposed)return;const e=this.cameraView;this.cameraManager.tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return M(this,Me,"m",ze).call(this)?M(this,Fn,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(this.cameraManager.state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}async open(){const e=this.cameraView;if(e!=null&&e.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,M(this,Me,"m",ze).call(this)?e._clickIptSingleFrameMode():(this.cameraManager.setVideoEl(e.getVideoElement()),e._startLoading()));let r={width:0,height:0,deviceId:""};if(!M(this,Me,"m",ze).call(this)){try{await this.cameraManager.open()}catch(m){throw e&&e._stopLoading(),m.name==="NotFoundError"?new Error(`No camera devices were detected. Please ensure a camera is connected and recognized by your system. ${m==null?void 0:m.name}: ${m==null?void 0:m.message}`):m.name==="NotAllowedError"?new Error(`Camera access is blocked. Please check your browser settings or grant permission to use the camera. ${m==null?void 0:m.name}: ${m==null?void 0:m.message}`):m}let o,c=e.getUIElement();if(c=c.shadowRoot||c,o=c.querySelector(".dce-macro-use-mobile-native-like-ui")){let m=c.elTorchAuto=c.querySelector(".dce-mn-torch-auto"),y=c.elTorchOn=c.querySelector(".dce-mn-torch-on"),C=c.elTorchOff=c.querySelector(".dce-mn-torch-off");m&&(y.style.display=this.isTorchOn==null?"":"none"),y&&(y.style.display=this.isTorchOn==1?"":"none"),C&&(C.style.display=this.isTorchOn==0?"":"none");let b=c.elBeepOn=c.querySelector(".dce-mn-beep-on"),I=c.elBeepOff=c.querySelector(".dce-mn-beep-off");b&&(b.style.display=at.allowBeep?"":"none"),I&&(I.style.display=at.allowBeep?"none":"");let A=c.elVibrateOn=c.querySelector(".dce-mn-vibrate-on"),L=c.elVibrateOff=c.querySelector(".dce-mn-vibrate-off");A&&(A.style.display=at.allowVibrate?"":"none"),L&&(L.style.display=at.allowVibrate?"none":""),c.elResolutionBox=c.querySelector(".dce-mn-resolution-box");let P,j=c.elZoom=c.querySelector(".dce-mn-zoom");j&&(j.style.display="none",P=c.elZoomSpan=j.querySelector("span"));let H=c.elToast=c.querySelector(".dce-mn-toast"),$=c.elCameraClose=c.querySelector(".dce-mn-camera-close"),Z=c.elTakePhoto=c.querySelector(".dce-mn-take-photo"),q=c.elCameraSwitch=c.querySelector(".dce-mn-camera-switch"),J=c.elCameraAndResolutionSettings=c.querySelector(".dce-mn-camera-and-resolution-settings");J&&(J.style.display="none");const ie=c.dceMnFs={},ne=()=>{this.turnOnTorch()};m==null||m.addEventListener("pointerdown",ne);const he=()=>{this.turnOffTorch()};y==null||y.addEventListener("pointerdown",he);const fe=()=>{this.turnAutoTorch()};C==null||C.addEventListener("pointerdown",fe);const v=()=>{at.allowBeep=!at.allowBeep,b&&(b.style.display=at.allowBeep?"":"none"),I&&(I.style.display=at.allowBeep?"none":"")};for(let w of[I,b])w==null||w.addEventListener("pointerdown",v);const ae=()=>{at.allowVibrate=!at.allowVibrate,A&&(A.style.display=at.allowVibrate?"":"none"),L&&(L.style.display=at.allowVibrate?"none":"")};for(let w of[L,A])w==null||w.addEventListener("pointerdown",ae);const me=async w=>{let E,T=w.target;if(E=T.closest(".dce-mn-camera-option"))this.selectCamera(E.getAttribute("data-davice-id"));else if(E=T.closest(".dce-mn-resolution-option")){let S,D=parseInt(E.getAttribute("data-width")),B=parseInt(E.getAttribute("data-height")),X=await this.setResolution({width:D,height:B});{let z=Math.max(X.width,X.height),te=Math.min(X.width,X.height);S=te<=1080?te+"P":z<3e3?"2K":Math.round(z/1e3)+"K"}S!=E.textContent&&s(`Fallback to ${S}`)}else T.closest(".dce-mn-camera-and-resolution-settings")||(T.closest(".dce-mn-resolution-box")?J&&(J.style.display=J.style.display?"":"none"):J&&J.style.display===""&&(J.style.display="none"))};c.addEventListener("click",me);let de=null;ie.funcInfoZoomChange=(w,E=3e3)=>{j&&P&&(P.textContent=w.toFixed(1),j.style.display="",de!=null&&(clearTimeout(de),de=null),de=setTimeout(()=>{j.style.display="none",de=null},E))};let a=null,s=ie.funcShowToast=(w,E=3e3)=>{H&&(H.textContent=w,H.style.display="",a!=null&&(clearTimeout(a),a=null),a=setTimeout(()=>{H.style.display="none",a=null},E))};const l=()=>{this.close()};$==null||$.addEventListener("click",l);const u=()=>{};Z==null||Z.addEventListener("pointerdown",u);const i=()=>{var w,E;let T,S=this.getVideoSettings(),D=S.video.facingMode,B=(E=(w=this.cameraManager.getCamera())===null||w===void 0?void 0:w.label)===null||E===void 0?void 0:E.toLowerCase(),X=B==null?void 0:B.indexOf("front");X===-1&&(X=B==null?void 0:B.indexOf(""));let z=B==null?void 0:B.indexOf("back");z===-1&&(z=B==null?void 0:B.indexOf("")),typeof X=="number"&&X!==-1?T=!0:typeof z=="number"&&z!==-1&&(T=!1),T===void 0&&(T=((D==null?void 0:D.ideal)||(D==null?void 0:D.exact)||D)==="user"),S.video.facingMode={ideal:T?"environment":"user"},delete S.video.deviceId,this.updateVideoSettings(S)};q==null||q.addEventListener("pointerdown",i);let n=-1/0,h=1;const g=w=>{let E=Date.now();E-n>1e3&&(h=this.getZoomSettings().factor),h-=w.deltaY/200,h>20&&(h=20),h<1&&(h=1),this.setZoom({factor:h}),n=E};o.addEventListener("wheel",g);const f=new Map;let d=!1;const _=async w=>{var E;for(w.touches.length>=2&&w.type=="touchmove"&&w.preventDefault();w.changedTouches.length>1&&w.touches.length==2;){let T=w.touches[0],S=w.touches[1],D=f.get(T.identifier),B=f.get(S.identifier);if(!D||!B)break;let X=Math.pow(Math.pow(D.x-B.x,2)+Math.pow(D.y-B.y,2),.5),z=Math.pow(Math.pow(T.clientX-S.clientX,2)+Math.pow(T.clientY-S.clientY,2),.5),te=Date.now();if(d||te-n<100)return;te-n>1e3&&(h=this.getZoomSettings().factor),h*=z/X,h>20&&(h=20),h<1&&(h=1);let ee=!1;((E=ht==null?void 0:ht.browser)===null||E===void 0?void 0:E.toLocaleLowerCase())=="safari"&&(z/X>1&&h<2?(h=2,ee=!0):z/X<1&&h<2&&(h=1,ee=!0)),d=!0,ee&&s("zooming..."),await this.setZoom({factor:h}),ee&&(H.textContent=""),d=!1,n=Date.now();break}f.clear();for(let T of w.touches)f.set(T.identifier,{x:T.clientX,y:T.clientY})};c.addEventListener("touchstart",_),c.addEventListener("touchmove",_),c.addEventListener("touchend",_),c.addEventListener("touchcancel",_),ie.unbind=()=>{m==null||m.removeEventListener("pointerdown",ne),y==null||y.removeEventListener("pointerdown",he),C==null||C.removeEventListener("pointerdown",fe);for(let w of[I,b])w==null||w.removeEventListener("pointerdown",v);for(let w of[L,A])w==null||w.removeEventListener("pointerdown",ae);c.removeEventListener("click",me),$==null||$.removeEventListener("click",l),Z==null||Z.removeEventListener("pointerdown",u),q==null||q.removeEventListener("pointerdown",i),o.removeEventListener("wheel",g),c.removeEventListener("touchstart",_),c.removeEventListener("touchmove",_),c.removeEventListener("touchend",_),c.removeEventListener("touchcancel",_),delete c.dceMnFs,o.style.display="none"},o.style.display="",m&&this.isTorchOn==null&&setTimeout(()=>{this.turnAutoTorch(1e3)},0)}this.isTorchOn&&this.turnOnTorch().catch(()=>{});const p=this.getResolution();r.width=p.width,r.height=p.height,r.deviceId=this.getSelectedCamera().deviceId}return Se(this,Fn,"open","f"),e&&(e._innerComponent.style.display="",M(this,Me,"m",ze).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),e._renderResolutionInfo({width:r.width,height:r.height}),e.eventHandler.fire("content:updated",null,{async:!1}),e.eventHandler.fire("videoEl:resized",null,{async:!1}))),M(this,Ei,"f").fire("opened",null,{target:this,async:!1}),r}close(){var e;const r=this.cameraView;if(r!=null&&r.disposed)throw new Error("'cameraView' has been disposed.");if(this.stopFetching(),this.clearBuffer(),!M(this,Me,"m",ze).call(this)){this.cameraManager.close();let o=r.getUIElement();o=o.shadowRoot||o,o.querySelector(".dce-macro-use-mobile-native-like-ui")&&((e=o.dceMnFs)===null||e===void 0||e.unbind())}Se(this,Fn,"closed","f"),M(this,ni,"f").stopCharging(),r&&(r._innerComponent.style.display="none",M(this,Me,"m",ze).call(this)&&r._innerComponent.removeElement("content"),r._stopLoading()),M(this,Ei,"f").fire("closed",null,{target:this,async:!1})}pause(){if(M(this,Me,"m",ze).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");this.cameraManager.pause()}isPaused(){var e;return!M(this,Me,"m",ze).call(this)&&((e=this.video)===null||e===void 0?void 0:e.paused)===!0}async resume(){if(M(this,Me,"m",ze).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await this.cameraManager.resume()}async selectCamera(e){if(!e)throw new Error("Invalid value.");let r;r=typeof e=="string"?e:e.deviceId,await this.cameraManager.setCamera(r),this.isTorchOn=!1;const o=this.getResolution(),c=this.cameraView;return c&&!c.disposed&&(c._stopLoading(),c._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),c._renderResolutionInfo({width:o.width,height:o.height})),{width:o.width,height:o.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return this.cameraManager.getCamera()}async getAllCameras(){return this.cameraManager.getCameras()}async setResolution(e){await this.cameraManager.setResolution(e.width,e.height),this.isTorchOn&&this.turnOnTorch().catch(()=>{});const r=this.getResolution(),o=this.cameraView;return o&&!o.disposed&&(o._stopLoading(),o._renderResolutionInfo({width:r.width,height:r.height})),{width:r.width,height:r.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return this.cameraManager.getResolution()}getAvailableResolutions(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getResolutions()}_on(e,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?M(this,Ei,"f").on(e,r):this.cameraManager.on(e,r)}_off(e,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?M(this,Ei,"f").off(e,r):this.cameraManager.off(e,r)}on(e,r){const o=e.toLowerCase(),c=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(o);if(!c)throw new Error("Invalid event.");this._on(c,r)}off(e,r){const o=e.toLowerCase(),c=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(o);if(!c)throw new Error("Invalid event.");this._off(c,r)}getVideoSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getMediaStreamConstraints()}async updateVideoSettings(e){var r;await((r=this.cameraManager)===null||r===void 0?void 0:r.setMediaStreamConstraints(e,!0))}getCapabilities(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getCameraCapabilities()}getCameraSettings(){return this.cameraManager.getCameraSettings()}async turnOnTorch(){var e,r;if(M(this,Me,"m",ze).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");try{await((e=this.cameraManager)===null||e===void 0?void 0:e.turnOnTorch())}catch(c){let p=this.cameraView.getUIElement();throw p=p.shadowRoot||p,(r=p==null?void 0:p.dceMnFs)===null||r===void 0||r.funcShowToast("Torch Not Supported"),c}this.isTorchOn=!0;let o=this.cameraView.getUIElement();o=o.shadowRoot||o,o.elTorchAuto&&(o.elTorchAuto.style.display="none"),o.elTorchOn&&(o.elTorchOn.style.display=""),o.elTorchOff&&(o.elTorchOff.style.display="none")}async turnOffTorch(){var e;if(M(this,Me,"m",ze).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await((e=this.cameraManager)===null||e===void 0?void 0:e.turnOffTorch()),this.isTorchOn=!1;let r=this.cameraView.getUIElement();r=r.shadowRoot||r,r.elTorchAuto&&(r.elTorchAuto.style.display="none"),r.elTorchOn&&(r.elTorchOn.style.display="none"),r.elTorchOff&&(r.elTorchOff.style.display="")}async turnAutoTorch(e=250){if(this._taskid4AutoTorch!=null){if(!(e<this._delay4AutoTorch))return;clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null}this._delay4AutoTorch=e;let r=!1,o=0,c=0;const p=async()=>{var y,C;if(r||this.isTorchOn!=null||!this.isOpen())return clearInterval(this._taskid4AutoTorch),void(this._taskid4AutoTorch=null);if(++c>10&&this._delay4AutoTorch<1e3)return clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null,void this.turnAutoTorch(1e3);let b;try{b=this.fetchImage()}catch{}if(!b||!b.width||!b.height)return;let I=0;if(be.IPF_GRAYSCALED===b.format){for(let A=0;A<b.bytes.length;++A)I+=b.bytes[A];I/=b.bytes.length}else{if(be.IPF_ABGR_8888!==b.format)return;for(let A=0;A<b.bytes.length;A+=4)I+=b.bytes[A],I+=b.bytes[A+1],I+=b.bytes[A+2];I/=b.bytes.length/4*3}if(I<this.grayThreshold4AutoTorch){if(++o>=this.maxDarkCount4AutoTroch){console.log(`darkCount ${o}`);try{await this.turnOnTorch(),this.isTorchOn=!0;let A=this.cameraView.getUIElement();A=A.shadowRoot||A,(y=A==null?void 0:A.dceMnFs)===null||y===void 0||y.funcShowToast("Torch Auto On")}catch(A){console.error(A),r=!0;let L=this.cameraView.getUIElement();L=L.shadowRoot||L,(C=L==null?void 0:L.dceMnFs)===null||C===void 0||C.funcShowToast("Torch Not Supported")}}}else o=0};this._taskid4AutoTorch=setInterval(p,e),this.isTorchOn=void 0,p();let m=this.cameraView.getUIElement();m=m.shadowRoot||m,m.elTorchAuto&&(m.elTorchAuto.style.display=""),m.elTorchOn&&(m.elTorchOn.style.display="none"),m.elTorchOff&&(m.elTorchOff.style.display="none")}async setColorTemperature(e){if(M(this,Me,"m",ze).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await this.cameraManager.setColorTemperature(e,!0)}getColorTemperature(){return this.cameraManager.getColorTemperature()}async setExposureCompensation(e){var r;if(M(this,Me,"m",ze).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await((r=this.cameraManager)===null||r===void 0?void 0:r.setExposureCompensation(e,!0))}getExposureCompensation(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getExposureCompensation()}async _setZoom(e){var r,o,c;if(M(this,Me,"m",ze).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await((r=this.cameraManager)===null||r===void 0?void 0:r.setZoom(e));{let p=(o=this.cameraView)===null||o===void 0?void 0:o.getUIElement();p=(p==null?void 0:p.shadowRoot)||p,(c=p==null?void 0:p.dceMnFs)===null||c===void 0||c.funcInfoZoomChange(e.factor)}}async setZoom(e){await this._setZoom(e)}getZoomSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getZoom()}async resetZoom(){var e;if(M(this,Me,"m",ze).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await((e=this.cameraManager)===null||e===void 0?void 0:e.resetZoom())}async setFrameRate(e){var r;if(M(this,Me,"m",ze).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await((r=this.cameraManager)===null||r===void 0?void 0:r.setFrameRate(e,!0))}getFrameRate(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getFrameRate()}async setFocus(e){var r;if(M(this,Me,"m",ze).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await((r=this.cameraManager)===null||r===void 0?void 0:r.setFocus(e,!0))}getFocusSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getFocus()}setAutoZoomRange(e){M(this,we,"f").minValue=e.min,M(this,we,"f").maxValue=e.max}getAutoZoomRange(){return{min:M(this,we,"f").minValue,max:M(this,we,"f").maxValue}}async enableEnhancedFeatures(e){var r,o;if(!(!((o=(r=lt.license)===null||r===void 0?void 0:r.LicenseManager)===null||o===void 0)&&o.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(et.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");e&$i.EF_ENHANCED_FOCUS&&(M(this,Qe,"f").enhancedFocus=!0),e&$i.EF_AUTO_ZOOM&&(M(this,Qe,"f").autoZoom=!0),e&$i.EF_TAP_TO_FOCUS&&(M(this,Qe,"f").tapToFocus=!0,this.cameraManager.enableTapToFocus())}disableEnhancedFeatures(e){e&$i.EF_ENHANCED_FOCUS&&(M(this,Qe,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),e&$i.EF_AUTO_ZOOM&&(M(this,Qe,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),e&$i.EF_TAP_TO_FOCUS&&(M(this,Qe,"f").tapToFocus=!1,this.cameraManager.disableTapToFocus()),M(this,Me,"m",su).call(this)&&M(this,Me,"m",nu).call(this)||M(this,ni,"f").stopCharging()}_setScanRegion(e){if(e!=null&&!cl(e)&&!br(e))throw TypeError("Invalid 'region'.");Se(this,mr,e?JSON.parse(JSON.stringify(e)):null,"f"),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),this.cameraView&&!this.cameraView.disposed&&(e===null?this.cameraView.setScanRegionMaskVisible(!1):this.cameraView.setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(M(this,mr,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");Se(this,zn,e,"f")}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!this.cameraManager.isVideoLoaded()||M(this,Me,"m",ze).call(this))}startFetching(){if(M(this,Me,"m",ze).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");M(this,bi,"f")||(Se(this,bi,!0,"f"),M(this,Me,"m",La).call(this))}stopFetching(){M(this,bi,"f")&&(Oe._onLog&&Oe._onLog("DCE: stop fetching loop: "+Date.now()),M(this,Ut,"f")&&clearTimeout(M(this,Ut,"f")),Se(this,bi,!1,"f"))}fetchImage(){if(M(this,Me,"m",ze).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");const e=this.getResolution();if(!(e!=null&&e.width)||!(e!=null&&e.height))throw new Error("The video is not loaded.");let r;if(r=bs.convert(M(this,mr,"f"),e.width,e.height),r||(r={x:0,y:0,width:e.width,height:e.height}),r.x>e.width||r.y>e.height)throw new Error("Invalid scan region.");r.x+r.width>e.width&&(r.width=e.width-r.x),r.y+r.height>e.height&&(r.height=e.height-r.y);const o={sx:r.x,sy:r.y,sWidth:r.width,sHeight:r.height,dWidth:r.width,dHeight:r.height},c=Math.max(o.dWidth,o.dHeight);if(this.canvasSizeLimit&&c>this.canvasSizeLimit){const C=this.canvasSizeLimit/c;o.dWidth>o.dHeight?(o.dWidth=this.canvasSizeLimit,o.dHeight=Math.round(o.dHeight*C)):(o.dWidth=Math.round(o.dWidth*C),o.dHeight=this.canvasSizeLimit)}const p=this.cameraManager.getFrameData({position:o,pixelFormat:Ch.get(this.getPixelFormat())});if(!p)return null;let m;p.pixelFormat===Fe.GREY?m=p.width:m=4*p.width;let y=!0;return o.sx===0&&o.sy===0&&o.sWidth===e.width&&o.sHeight===e.height&&(y=!1),{bytes:p.data,width:p.width,height:p.height,stride:m,format:Eh.get(p.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:so.ITT_VIDEO_FRAME,isCropped:y,cropRegion:{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:p.width,currentHeight:p.height,timeSpent:p.timeSpent,timeStamp:p.timeStamp},toCanvas:M(this,Ws,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,M(this,bi,"f")&&(M(this,Ut,"f")&&clearTimeout(M(this,Ut,"f")),Se(this,Ut,setTimeout(()=>{this.disposed||M(this,Me,"m",La).call(this)},e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){Se(this,Hs,e,"f")}getPixelFormat(){return M(this,Hs,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(M(this,Me,"m",ze).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),r.setAttribute("capture",""),r.style.position="absolute",r.style.top="-9999px",r.style.backgroundColor="transparent",r.style.color="transparent",r.addEventListener("click",()=>{const o=this.isOpen();this.close(),window.addEventListener("focus",()=>{o&&this.open(),r.remove()},{once:!0})}),r.addEventListener("change",async()=>{const o=r.files[0],c=await(async b=>{let I=null,A=null;if(typeof createImageBitmap<"u")try{if(I=await createImageBitmap(b),I)return I}catch{}var L;return I||(A=await(L=b,new Promise((P,j)=>{let H=URL.createObjectURL(L),$=new Image;$.src=H,$.onload=()=>{URL.revokeObjectURL($.src),P($)},$.onerror=Z=>{j(new Error("Can't convert blob to image : "+(Z instanceof Event?Z.type:Z)))}}))),A})(o),p=c instanceof HTMLImageElement?c.naturalWidth:c.width,m=c instanceof HTMLImageElement?c.naturalHeight:c.height;let y=bs.convert(M(this,mr,"f"),p,m);y||(y={x:0,y:0,width:p,height:m});const C=M(this,Gs,"f").call(this,c,p,m,y);e&&e(C)}),document.body.appendChild(r),r.click()}convertToPageCoordinates(e){const r=M(this,Me,"m",Ma).call(this,e);return{x:r.pageX,y:r.pageY}}convertToClientCoordinates(e){const r=M(this,Me,"m",Ma).call(this,e);return{x:r.clientX,y:r.clientY}}dispose(){this.close(),this.cameraManager.dispose(),this.releaseCameraView(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}Aa=Oe,Fn=new WeakMap,Ei=new WeakMap,Vs=new WeakMap,Gs=new WeakMap,Ws=new WeakMap,zn=new WeakMap,mr=new WeakMap,Hs=new WeakMap,bi=new WeakMap,Ut=new WeakMap,Qe=new WeakMap,we=new WeakMap,ni=new WeakMap,Da=new WeakMap,Me=new WeakSet,ze=function(){return this.singleFrameMode!=="disabled"},nu=function(){return!this.videoSrc&&this.cameraManager.state==="opened"},su=function(){for(let t in M(this,Qe,"f"))if(M(this,Qe,"f")[t]==1)return!0;return!1},La=function t(){if(this.disposed)return;if(this.getCameraState()!=="open"||!M(this,bi,"f"))return M(this,Ut,"f")&&clearTimeout(M(this,Ut,"f")),void Se(this,Ut,setTimeout(()=>{this.disposed||M(this,Me,"m",t).call(this)},this.fetchInterval),"f");const e=()=>{var r;let o;Oe._onLog&&Oe._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{o=this.fetchImage()}catch(c){const p=c.message||c;if(p==="The video is not loaded.")return;if(!((r=M(this,zn,"f"))===null||r===void 0)&&r.onErrorReceived)return void setTimeout(()=>{var m;(m=M(this,zn,"f"))===null||m===void 0||m.onErrorReceived(ga.EC_IMAGE_READ_FAILED,p)},0);console.warn(c)}o?(this.addImageToBuffer(o),Oe._onLog&&Oe._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),M(this,Ei,"f").fire("frameAddedToBuffer",null,{async:!1})):Oe._onLog&&Oe._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case Cr.BOPM_BLOCK:break;case Cr.BOPM_UPDATE:e()}else e();M(this,Ut,"f")&&clearTimeout(M(this,Ut,"f")),Se(this,Ut,setTimeout(()=>{this.disposed||M(this,Me,"m",t).call(this)},this.fetchInterval),"f")},Ma=function(t){if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!M(this,Me,"m",ze).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(M(this,Me,"m",ze).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");const e=this.cameraView._innerComponent.getBoundingClientRect(),r=e.left,o=e.top,c=r+window.scrollX,p=o+window.scrollY,{width:m,height:y}=this.cameraView._innerComponent.getBoundingClientRect();if(m<=0||y<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let C,b,I;if(M(this,Me,"m",ze).call(this)){const q=this.cameraView._innerComponent.getElement("content");C=q.width,b=q.height,I="contain"}else{const q=this.getVideoEl();C=q.videoWidth,b=q.videoHeight,I=this.cameraView.getVideoFit()}const A=m/y,L=C/b;let P,j,H,$,Z=1;if(I==="contain")A<L?(Z=m/C,P=r+t.x*Z,j=o+t.y*Z+(y-b*Z)/2,H=c+t.x*Z,$=p+t.y*Z+(y-b*Z)/2):(Z=y/b,P=r+t.x*Z+(m-C*Z)/2,j=o+t.y*Z,H=c+t.x*Z+(m-C*Z)/2,$=p+t.y*Z);else if(I==="cover")if(A<L){Z=y/b;let q=t.x*Z-(C*Z-m)/2;q=Math.max(q,0),q=Math.min(q,m),P=r+q,j=o+t.y*Z,H=c+q,$=p+t.y*Z}else{Z=m/C;let q=t.y*Z-(b*Z-y)/2;q=Math.max(q,0),q=Math.min(q,y),P=r+t.x*Z,j=o+q,H=c+t.x*Z,$=p+q}return{clientX:P,clientY:j,pageX:H,pageY:$}},Oe._debug=!1,Ra={value:void 0},Oe.browserInfo=ht,typeof SuppressedError=="function"&&SuppressedError;var bh;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(bh||(bh={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.4.22"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */function ue(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}function ct(t,e,r,o,c){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!c:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?c.call(t,r):c?c.value=r:e.set(t,r),r}const Sh=t=>t&&typeof t=="object"&&typeof t.then=="function";class Pn extends Promise{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){this._task=e;let r;Sh(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const o=await r;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}constructor(e){let r,o;const c=(p,m)=>{r=p,o=m};super(c),this._s="pending",this.resolve=p=>{this.isPending&&(Sh(p)?this.task=p:(this._s="fulfilled",r(p)))},this.reject=p=>{this.isPending&&(this._s="rejected",o(p))},this.task=e}}class ug{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise((e,r)=>{let o=Ke();Ge[o]=async c=>{if(c.success)return e(c.count);{let p=new Error(c.message);return p.stack=c.stack+`
`+p.stack,r(p)}},Ne.postMessage({type:"cvr_getMaxBufferedItems",id:o,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(e){return await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r();{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_setMaxBufferedItems",id:c,instanceID:this._cvr._instanceID,body:{count:e}})})}async getBufferedCharacterItemSet(){return await new Promise((e,r)=>{let o=Ke();Ge[o]=async c=>{if(c.success)return e(c.itemSet);{let p=new Error(c.message);return p.stack=c.stack+`
`+p.stack,r(p)}},Ne.postMessage({type:"cvr_getBufferedCharacterItemSet",id:o,instanceID:this._cvr._instanceID})})}}var fg={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const Th=t=>{for(let e in t._irrRegistryState)t._irrRegistryState[e]=!1;for(let e of t._intermediateResultReceiverSet){if(e.isDce||e.isFilter){t._irrRegistryState.onTaskResultsReceivedForDce=!0;continue}for(let r in e)t._irrRegistryState[r]||(t._irrRegistryState[r]=!!e[r])}};class dg{constructor(e){this._irrRegistryState=fg,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if(typeof e!="object")throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),Th(this);let r=-1,o={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");r=e._observedResultUnitTypes,e._observedTaskMap.forEach((c,p)=>{o[p]=c}),e._observedTaskMap.clear()}return await new Promise((c,p)=>{let m=Ke();Ge[m]=async y=>{if(y.success)return c();{let C=new Error(y.message);return C.stack=y.stack+`
`+C.stack,p(C)}},Ne.postMessage({type:"cvr_setIrrRegistry",id:m,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:r.toString(),observedTaskMap:o}})})}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),Th(this),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r();{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_setIrrRegistry",id:c,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr._dsImage}}const ou=typeof self>"u",ul=(()=>{if(!ou&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),au=t=>{if(t==null&&(t="./"),!ou){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};var $o;Ue.cvr={version:"2.4.22",path:ul};Qi.cvr={js:!0,wasm:!0,deps:["license","dip"]};lt.cvr={};const Ko="1.4.10";typeof Ue.std!="string"&&Tr(Ue.std.version,Ko)<0&&(Ue.std={version:Ko,path:au(ul+`../../dynamsoft-capture-vision-std@${Ko}/dist/`)});const Zo="2.4.20";(!Ue.dip||typeof Ue.dip!="string"&&Tr(Ue.dip.version,Zo)<0)&&(Ue.dip={version:Zo,path:au(ul+`../../dynamsoft-image-processing@${Zo}/dist/`)});`${($o=_r.cvr)===null||$o===void 0?void 0:$o.worker}`;var uo;(function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"})(uo||(uo={}));BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19),BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt("0xFFFFFFFFFFFFFFFF");function gg(t){const e={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return t.items.forEach(r=>{r.type===Ce.CRIT_BARCODE?e.barcodeResultItems.push(r):r.type===Ce.CRIT_TEXT_LINE?e.textLineResultItems.push(r):r.type===Ce.CRIT_DETECTED_QUAD?e.detectedQuadResultItems.push(r):r.type===Ce.CRIT_NORMALIZED_IMAGE?e.normalizedImageResultItems.push(r):r.type===Ce.CRIT_PARSED_RESULT&&e.parsedResultItems.push(r)}),e}function lu(t,e){if(t&&t.location){const r=t.location.points;for(let o of r)o.x=o.x/e,o.y=o.y/e;lu(t.referencedItem,e)}}function it(t){if(t.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}var Le,yi,Xt,St,Hr,Pt,Hi,si,zt,Yi,Yr,kn;const Ih={onTaskResultsReceived:()=>{},isFilter:!0};class Ve{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(et.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,Le.set(this,null),yi.set(this,null),Xt.set(this,null),St.set(this,null),Hr.set(this,null),Pt.set(this,new Set),Hi.set(this,new Set),si.set(this,new Set),zt.set(this,0),Yi.set(this,!1),Yr.set(this,!1),kn.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return ue(this,kn,"f")}static async createInstance(){if(!lt.license)throw Error("Module `license` is not existed.");await lt.license.dynamsoft(),await Ti(["cvr"]);const e=new Ve,r=new Pn;let o=Ke();return Ge[o]=async c=>{var p;if(c.success)e._instanceID=c.instanceID,e._currentSettings=JSON.parse(c.outputSettings),`${(p=_r.cvr)===null||p===void 0?void 0:p.worker}${c.version}`,ct(e,Yr,!0,"f"),ct(e,St,e.getIntermediateResultManager(),"f"),ct(e,Yr,!1,"f"),r.resolve(e);else{const m=Error(c.message);c.stack&&(m.stack=c.stack),r.reject(m)}},Ne.postMessage({type:"cvr_createInstance",id:o}),r}async _singleFrameModeCallback(e){for(let p of ue(this,Pt,"f"))this._isOutputOriginalImage&&p.onOriginalImageResultReceived&&p.onOriginalImageResultReceived({imageData:e});const r={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const o=await this.capture(r,this._templateName);o.originalImageTag=e.tag;for(let p of ue(this,Pt,"f"))p.isDce&&p.onCapturedResultReceived(o,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const c={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString};for(let p of ue(this,Pt,"f"))if(p.onDecodedBarcodesReceived&&o.barcodeResultItems&&p.onDecodedBarcodesReceived(Object.assign(Object.assign({},c),{barcodeResultItems:o.barcodeResultItems})),p.onRecognizedTextLinesReceived&&o.textLineResultItems&&p.onRecognizedTextLinesReceived(Object.assign(Object.assign({},c),{textLineResultItems:o.textLineResultItems})),p.onDetectedQuadsReceived&&o.detectedQuadResultItems&&p.onDetectedQuadsReceived(Object.assign(Object.assign({},c),{detectedQuadResultItems:o.detectedQuadResultItems})),p.onNormalizedImagesReceived&&o.normalizedImageResultItems&&p.onNormalizedImagesReceived(Object.assign(Object.assign({},c),{normalizedImageResultItems:o.normalizedImageResultItems})),p.onParsedResultsReceived&&o.parsedResultItems&&p.onParsedResultsReceived(Object.assign(Object.assign({},c),{parsedResultItems:o.parsedResultItems})),p.onCapturedResultReceived&&!p.isDce){if(this._isOutputOriginalImage){const m=o.items.findIndex(y=>y.type===1);m!==-1&&(o.items[m].imageData=e)}p.onCapturedResultReceived(o)}}setInput(e){if(it(this),!e){ct(this,Le,null,"f");return}if(ct(this,Le,e,"f"),e.isCameraEnhancer){ue(this,St,"f")&&(ue(this,Le,"f")._intermediateResultReceiver.isDce=!0,ue(this,St,"f").addResultReceiver(ue(this,Le,"f")._intermediateResultReceiver));const r=ue(this,Le,"f").getCameraView();if(r){const o=r._capturedResultReceiver;o.isDce=!0,ue(this,Pt,"f").add(o)}}}getInput(){return ue(this,Le,"f")}addImageSourceStateListener(e){if(it(this),typeof e!="object")return console.warn("Invalid ISA state listener.");!e||!Object.keys(e)||ue(this,Hi,"f").add(e)}removeImageSourceStateListener(e){return it(this),ue(this,Hi,"f").delete(e)}addResultReceiver(e){if(it(this),typeof e!="object")throw new Error("Invalid receiver.");!e||!Object.keys(e).length||(ue(this,Pt,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){it(this),ue(this,Pt,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let c of ue(this,Pt,"f"))c.isDce||(e.onCapturedResultReceived=!!c.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!c.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!c.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!c.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!c.onNormalizedImagesReceived,e.onParsedResultsReceived=!!c.onParsedResultsReceived);const r=new Pn;let o=Ke();return Ge[o]=async c=>{if(c.success)r.resolve();else{let p=new Error(c.message);p.stack=c.stack+`
`+p.stack,r.reject()}},Ne.postMessage({type:"cvr_setCrrRegistry",id:o,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),r}async addResultFilter(e){if(it(this),!e||typeof e!="object"||!Object.keys(e).length)return console.warn("Invalid filter.");ue(this,si,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){it(this),ue(this,si,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(ue(this,St,"f").removeResultReceiver(Ih),ue(this,si,"f").size===0){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!1,[Ce.CRIT_DETECTED_QUAD]:!1,[Ce.CRIT_NORMALIZED_IMAGE]:!1},r={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!1,[Ce.CRIT_DETECTED_QUAD]:!1,[Ce.CRIT_NORMALIZED_IMAGE]:!1};await xh(this,e),await Oh(this,r);return}for(let e of ue(this,si,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(Ce.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(Ce.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(Ce.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(Ce.CRIT_NORMALIZED_IMAGE),e.isLatestOverlappingEnabled(Ce.CRIT_BARCODE)&&([...ue(this,St,"f")._intermediateResultReceiverSet.values()].find(o=>o.isFilter)||ue(this,St,"f").addResultReceiver(Ih)),await xh(this,e.verificationEnabled),await Oh(this,e.duplicateFilterEnabled),await pg(this,e.duplicateForgetTime)}async startCapturing(e){var r,o;if(it(this),!this._isPauseScan)return;if(!ue(this,Le,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);const c=await this.containsTask(e);await Ti(c);for(let m of ue(this,si,"f"))await this.addResultFilter(m);if(c.includes("dlr")&&!(!((r=lt.dlr)===null||r===void 0)&&r.bLoadConfusableCharsData)){const m=ts(et.engineResourcePaths,Ue);await((o=lt.dlr)===null||o===void 0?void 0:o.loadRecognitionData("ConfusableChars",m.dlr))}if(ue(this,Le,"f").isCameraEnhancer&&(c.includes("ddn")?ue(this,Le,"f").setPixelFormat(be.IPF_ABGR_8888):ue(this,Le,"f").setPixelFormat(be.IPF_GRAYSCALED)),ue(this,Le,"f").singleFrameMode!==void 0&&ue(this,Le,"f").singleFrameMode!=="disabled"){this._templateName=e,ue(this,Le,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return}return ue(this,Le,"f").getColourChannelUsageType()===ui.CCUT_AUTO&&ue(this,Le,"f").setColourChannelUsageType(c.includes("ddn")?ui.CCUT_FULL_CHANNEL:ui.CCUT_Y_CHANNEL_ONLY),ue(this,Xt,"f")&&ue(this,Xt,"f").isPending?ue(this,Xt,"f"):(ct(this,Xt,new Pn((m,y)=>{if(this.disposed)return;let C=Ke();Ge[C]=async b=>{if(!(!ue(this,Xt,"f")||ue(this,Xt,"f").isFulfilled))if(b.success)this._isPauseScan=!1,this._isOutputOriginalImage=b.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&ue(this,Le,"f").startFetching(),this._loopReadVideo(e),m()},0);else{let I=new Error(b.message);return I.stack=b.stack+`
`+I.stack,y(I)}},Ne.postMessage({type:"cvr_startCapturing",id:C,instanceID:this._instanceID,body:{templateName:e}})}),"f"),await ue(this,Xt,"f"))}stopCapturing(){if(it(this),!!ue(this,Le,"f")){if(ue(this,Le,"f").isCameraEnhancer&&ue(this,Le,"f").singleFrameMode!==void 0&&ue(this,Le,"f").singleFrameMode!=="disabled"){ue(this,Le,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind);return}mg(this),ue(this,Le,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,ct(this,Xt,null,"f"),ue(this,Le,"f").setColourChannelUsageType(ui.CCUT_AUTO)}}async containsTask(e){return it(this),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r(JSON.parse(p.tasks));{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_containsTask",id:c,instanceID:this._instanceID,body:{templateName:e}})})}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(ct(this,Yi,!0,"f"),ue(this,Le,"f").isBufferEmpty()){if(ue(this,Le,"f").hasNextImageToFetch())for(let o of ue(this,Hi,"f"))o.onImageSourceStateReceived&&o.onImageSourceStateReceived(uo.ISS_BUFFER_EMPTY);else if(!ue(this,Le,"f").hasNextImageToFetch())for(let o of ue(this,Hi,"f"))o.onImageSourceStateReceived&&o.onImageSourceStateReceived(uo.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||ue(this,Le,"f").isBufferEmpty())try{ue(this,Le,"f").isBufferEmpty()&&Ve._onLog&&Ve._onLog("buffer is empty so fetch image"),Ve._onLog&&Ve._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=ue(this,Le,"f").fetchImage(),Ve._onLog&&Ve._onLog(`DCE: finish fetching a frame: ${Date.now()}`),ue(this,Le,"f").setImageFetchInterval(this._averageTime)}catch{this._reRunCurrnetFunc(e);return}else if(ue(this,Le,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=ue(this,Le,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200){this._reRunCurrnetFunc(e);return}if(!this._dsImage){this._reRunCurrnetFunc(e);return}for(let o of ue(this,Pt,"f"))this._isOutputOriginalImage&&o.onOriginalImageResultReceived&&o.onOriginalImageResultReceived({imageData:this._dsImage});const r=Date.now();this._captureDsimage(this._dsImage,e).then(async o=>{if(Ve._onLog&&Ve._onLog(`no js handle time: ${Date.now()-r}`),this._isPauseScan){this._reRunCurrnetFunc(e);return}o.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;const c={originalImageHashId:o.originalImageHashId,originalImageTag:o.originalImageTag,errorCode:o.errorCode,errorString:o.errorString};for(let m of ue(this,Pt,"f")){if(m.isDce){const y=Date.now();if(m.onCapturedResultReceived(o,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),Ve._onLog){const C=Date.now()-y;C>10&&Ve._onLog(`draw result time: ${C}`)}}m.onDecodedBarcodesReceived&&o.barcodeResultItems&&m.onDecodedBarcodesReceived(Object.assign(Object.assign({},c),{barcodeResultItems:o.barcodeResultItems.filter(y=>!y.isFilter)})),m.onRecognizedTextLinesReceived&&o.textLineResultItems&&m.onRecognizedTextLinesReceived(Object.assign(Object.assign({},c),{textLineResultItems:o.textLineResultItems.filter(y=>!y.isFilter)})),m.onDetectedQuadsReceived&&o.detectedQuadResultItems&&m.onDetectedQuadsReceived(Object.assign(Object.assign({},c),{detectedQuadResultItems:o.detectedQuadResultItems.filter(y=>!y.isFilter)})),m.onNormalizedImagesReceived&&o.normalizedImageResultItems&&m.onNormalizedImagesReceived(Object.assign(Object.assign({},c),{normalizedImageResultItems:o.normalizedImageResultItems.filter(y=>!y.isFilter)})),m.onParsedResultsReceived&&o.parsedResultItems&&m.onParsedResultsReceived(Object.assign(Object.assign({},c),{parsedResultItems:o.parsedResultItems.filter(y=>!y.isFilter)})),m.onCapturedResultReceived&&!m.isDce&&(o.items=o.items.filter(y=>!y.isFilter),o.barcodeResultItems&&(o.barcodeResultItems=o.barcodeResultItems.filter(y=>!y.isFilter)),o.textLineResultItems&&(o.textLineResultItems=o.textLineResultItems.filter(y=>!y.isFilter)),o.detectedQuadResultItems&&(o.detectedQuadResultItems=o.detectedQuadResultItems.filter(y=>!y.isFilter)),o.normalizedImageResultItems&&(o.normalizedImageResultItems=o.normalizedImageResultItems.filter(y=>!y.isFilter)),o.parsedResultItems&&(o.parsedResultItems=o.parsedResultItems.filter(y=>!y.isFilter)),m.onCapturedResultReceived(o))}const p=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-r),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Ve._onLog&&(Ve._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Ve._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Ve._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Ve._onLog(`averageTime: ${this._averageTime}`))),Ve._onLog){const m=Date.now()-p;m>10&&Ve._onLog(`fetch image calculate time: ${m}`)}Ve._onLog&&Ve._onLog(`time finish decode: ${Date.now()}`),Ve._onLog&&Ve._onLog(`main time: ${Date.now()-r}`),Ve._onLog&&Ve._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(o=>{ue(this,Le,"f").stopFetching(),o.errorCode&&o.errorCode===0&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{ue(this,Le,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),o.message!=="platform error"&&setTimeout(()=>{throw o},0)})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async capture(e,r){var o,c;it(this),r||(r=this._currentSettings.CaptureVisionTemplates[0].Name);const p=await this.containsTask(r);if(await Ti(p),p.includes("dlr")&&!(!((o=lt.dlr)===null||o===void 0)&&o.bLoadConfusableCharsData)){const y=ts(et.engineResourcePaths,Ue);await((c=lt.dlr)===null||c===void 0?void 0:c.loadRecognitionData("ConfusableChars",y.dlr))}let m;if(ct(this,Yi,!1,"f"),kc(e))m=await this._captureDsimage(e,r);else if(typeof e=="string")e.substring(0,11)=="data:image/"?m=await this._captureBase64(e,r):m=await this._captureUrl(e,r);else if(e instanceof Blob)m=await this._captureBlob(e,r);else if(e instanceof HTMLImageElement)m=await this._captureImage(e,r);else if(e instanceof HTMLCanvasElement)m=await this._captureCanvas(e,r);else if(e instanceof HTMLVideoElement)m=await this._captureVideo(e,r);else throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");return m}async _captureDsimage(e,r){return await this._captureInWorker(e,r)}async _captureUrl(e,r){let o=await Hl(e,"blob");return await this._captureBlob(o,r)}async _captureBase64(e,r){e=e.substring(e.indexOf(",")+1);let o=atob(e),c=o.length,p=new Uint8Array(c);for(;c--;)p[c]=o.charCodeAt(c);return await this._captureBlob(new Blob([p]),r)}async _captureBlob(e,r){const o=async function(y){return await new Promise((C,b)=>{let I=URL.createObjectURL(y),A=new Image;A.src=I,A.onload=()=>{URL.revokeObjectURL(A.dbrObjUrl),C(A)},A.onerror=L=>{b(new Error("Can't convert blob to image : "+(L instanceof Event?L.type:L)))}})};let c=null,p=null;if(typeof createImageBitmap<"u")try{c=await createImageBitmap(e)}catch{}c||(p=await o(e));let m=await this._captureImage(c||p,r);return c&&c.close(),m}async _captureImage(e,r){let o=e instanceof HTMLImageElement?e.naturalWidth:e.width,c=e instanceof HTMLImageElement?e.naturalHeight:e.height,p=Math.max(o,c),m,y;p>this.maxCvsSideLength?(ct(this,zt,this.maxCvsSideLength/p,"f"),m=Math.round(o*ue(this,zt,"f")),y=Math.round(c*ue(this,zt,"f"))):(m=o,y=c),ue(this,yi,"f")||ct(this,yi,document.createElement("canvas"),"f");const C=ue(this,yi,"f");return(C.width!==m||C.height!==y)&&(C.width=m,C.height=y),C.ctx2d||(C.ctx2d=C.getContext("2d",{willReadFrequently:!0})),C.ctx2d.drawImage(e,0,0,o,c,0,0,m,y),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(C,r)}async _captureCanvas(e,r){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const o=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),p={bytes:Uint8Array.from(o.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:e.width*4,format:10};return await this._captureInWorker(p,r)}async _captureVideo(e,r){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";let o=e.videoWidth,c=e.videoHeight,p=Math.max(o,c),m,y;p>this.maxCvsSideLength?(ct(this,zt,this.maxCvsSideLength/p,"f"),m=Math.round(o*ue(this,zt,"f")),y=Math.round(c*ue(this,zt,"f"))):(m=o,y=c),ue(this,yi,"f")||ct(this,yi,document.createElement("canvas"),"f");const C=ue(this,yi,"f");return(C.width!==m||C.height!==y)&&(C.width=m,C.height=y),C.ctx2d||(C.ctx2d=C.getContext("2d",{willReadFrequently:!0})),C.ctx2d.drawImage(e,0,0,o,c,0,0,m,y),await this._captureCanvas(C,r)}async _captureInWorker(e,r){const{bytes:o,width:c,height:p,stride:m,format:y}=e;let C=Ke();const b=new Pn;return Ge[C]=async I=>{var A,L;if(I.success){const P=Date.now();Ve._onLog&&(Ve._onLog(`get result time from worker: ${P}`),Ve._onLog(`worker to main time consume: ${P-I.workerReturnMsgTime}`));try{const j=I.captureResult;if(j.errorCode!==0){let $=new Error(j.errorString);return $.errorCode=j.errorCode,b.reject($)}e.bytes=I.bytes;for(let $ of j.items)ue(this,zt,"f")!==0&&lu($,ue(this,zt,"f")),$.type===Ce.CRIT_ORIGINAL_IMAGE?$.imageData=e:$.type===Ce.CRIT_NORMALIZED_IMAGE?(A=lt.ddn)===null||A===void 0||A.handleNormalizedImageResultItem($):$.type===Ce.CRIT_PARSED_RESULT&&((L=lt.dcp)===null||L===void 0||L.handleParsedResultItem($));if(ue(this,Yi,"f"))for(let $ of ue(this,si,"f"))$.onDecodedBarcodesReceived(j),$.onRecognizedTextLinesReceived(j),$.onDetectedQuadsReceived(j),$.onNormalizedImagesReceived(j);const H=gg(j);if(H.barcodeResultItems.length&&(j.barcodeResultItems=H.barcodeResultItems),H.textLineResultItems.length&&(j.textLineResultItems=H.textLineResultItems),H.detectedQuadResultItems.length&&(j.detectedQuadResultItems=H.detectedQuadResultItems),H.normalizedImageResultItems.length&&(j.normalizedImageResultItems=H.normalizedImageResultItems),H.parsedResultItems.length&&(j.parsedResultItems=H.parsedResultItems),!this._isPauseScan||!ue(this,Yi,"f")){const $=j.intermediateResult;if($){let Z=0;for(let q of ue(this,St,"f")._intermediateResultReceiverSet){Z++;for(let J of $){if(J.info.callbackName==="onTaskResultsReceived"){for(let ie of J.intermediateResultUnits)ie.originalImageTag=e.tag?e.tag:null;q[J.info.callbackName]&&q[J.info.callbackName]({intermediateResultUnits:J.intermediateResultUnits},J.info)}else q[J.info.callbackName]&&q[J.info.callbackName](J.result,J.info);Z===ue(this,St,"f")._intermediateResultReceiverSet.size&&delete J.info.callbackName}}}}return j&&j.hasOwnProperty("intermediateResult")&&delete j.intermediateResult,ct(this,zt,0,"f"),b.resolve(j)}catch(j){return b.reject(j)}}else{let P=new Error(I.message);return P.stack=I.stack+`
`+P.stack,b.reject(P)}},Ve._onLog&&Ve._onLog(`send buffer to worker: ${Date.now()}`),Ne.postMessage({type:"cvr_capture",id:C,instanceID:this._instanceID,body:{bytes:o,width:c,height:p,stride:m,format:y,templateName:r||"",isScanner:ue(this,Yi,"f")}},[o.buffer]),b}async initSettings(e){return it(this),!e||!["string","object"].includes(typeof e)?console.error("Invalid template."):(typeof e=="string"?(e.startsWith("{")||(e=await Hl(e,"text")),this._currentSettings=JSON.parse(e)):typeof e=="object"&&(this._currentSettings=e,e=JSON.stringify(e)),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success){const m=JSON.parse(p.response);if(m.exception!==0){let b=new Error(m.description?m.description:"Init Settings Failed.");return b.errorCode=m.exception,o(b)}let y=[],C=JSON.parse(e).CaptureVisionTemplates;for(let b=0;b<C.length;b++){let I=await this.containsTask(C[b].Name);y=y.concat(I)}return await Ti([...new Set(y)]),this._isOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,r(m)}else{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_initSettings",id:c,instanceID:this._instanceID,body:{settings:e}})}))}async outputSettings(e){return it(this),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success){const m=JSON.parse(p.settings);if(m.errorCode!==0){let y=new Error(m.errorString);return y.errorCode=m.errorCode,o(y)}return delete m.errorCode,delete m.errorString,r(m)}else{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_outputSettings",id:c,instanceID:this._instanceID,body:{templateName:e||"*"}})})}async outputSettingsToFile(e,r,o){const c=await this.outputSettings(e),p=new Blob([JSON.stringify(c,null,2,function(m,y){return y instanceof Array?JSON.stringify(y):y},2)],{type:"application/json"});if(o){const m=document.createElement("a");m.href=URL.createObjectURL(p),r.endsWith(".json")&&(r=r.replace(".json","")),m.download=`${r}.json`,m.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(m.href)},500)},m.click()}return p}async getSimplifiedSettings(e){it(this),e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);const r=await this.containsTask(e);return await Ti(r),await new Promise((o,c)=>{let p=Ke();Ge[p]=async m=>{if(m.success){const y=JSON.parse(m.settings,(C,b)=>C==="barcodeFormatIds"?BigInt(b):b);if(y.minImageCaptureInterval=this._minImageCaptureInterval,y.code!==0){let C=new Error(y.codeString);return C.errorCode=y.errorCode,c(C)}return delete y.code,delete y.codeString,o(y)}else{let y=new Error(m.message);return y.stack=m.stack+`
`+y.stack,c(y)}},Ne.postMessage({type:"cvr_getSimplifiedSettings",id:p,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,r){it(this);const o=await this.containsTask(e);return await Ti(o),await new Promise((c,p)=>{let m=Ke();Ge[m]=async y=>{if(y.success){const C=JSON.parse(y.response);if(r.minImageCaptureInterval&&r.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=r.minImageCaptureInterval),this._isOutputOriginalImage=y.isOutputOriginalImage,C.exception!==0){let b=new Error(C.description?C.description:"Update Settings Failed.");return b.errorCode=C.exception,p(b)}return this._currentSettings=await this.outputSettings("*"),c(C)}else{let C=new Error(y.message);return C.stack=y.stack+`
`+C.stack,p(C)}},Ne.postMessage({type:"cvr_updateSettings",id:m,instanceID:this._instanceID,body:{settings:r,templateName:e}})})}async resetSettings(){return it(this),await new Promise((e,r)=>{let o=Ke();Ge[o]=async c=>{if(c.success){const p=JSON.parse(c.response);if(p.exception!==0){let m=new Error(p.description?p.description:"Reset Settings Failed.");return m.errorCode=p.exception,r(m)}return this._currentSettings=await this.outputSettings("*"),e(p)}else{let p=new Error(c.message);return p.stack=c.stack+`
`+p.stack,r(p)}},Ne.postMessage({type:"cvr_resetSettings",id:o,instanceID:this._instanceID})})}getBufferedItemsManager(){return ue(this,Hr,"f")||ct(this,Hr,new ug(this),"f"),ue(this,Hr,"f")}getIntermediateResultManager(){if(it(this),!ue(this,Yr,"f")&&et.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return ue(this,St,"f")||ct(this,St,new dg(this),"f"),ue(this,St,"f")}async parseRequiredResources(e){return it(this),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r(JSON.parse(p.resources));{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_parseRequiredResources",id:c,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){it(this),ue(this,Xt,"f")&&this.stopCapturing(),ct(this,Le,null,"f"),ue(this,Pt,"f").clear(),ue(this,Hi,"f").clear(),ue(this,si,"f").clear(),ue(this,St,"f")._intermediateResultReceiverSet.clear(),ct(this,kn,!0,"f");let e=Ke();Ge[e]=r=>{if(!r.success){let o=new Error(r.message);throw o.stack=r.stack+`
`+o.stack,o}},Ne.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:ue(this,Le,"f"),promiseStartScan:ue(this,Xt,"f"),intermediateResultManager:ue(this,St,"f"),bufferdItemsManager:ue(this,Hr,"f"),resultReceiverSet:ue(this,Pt,"f"),isaStateListenerSet:ue(this,Hi,"f"),resultFilterSet:ue(this,si,"f"),compressRate:ue(this,zt,"f"),canvas:ue(this,yi,"f"),isScanner:ue(this,Yi,"f"),innerUseTag:ue(this,Yr,"f"),isDestroyed:ue(this,kn,"f")}}async _getWasmFilterState(){return await new Promise((e,r)=>{let o=Ke();Ge[o]=async c=>{if(c.success){const p=JSON.parse(c.response);return e(p)}else{let p=new Error(c.message);return p.stack=c.stack+`
`+p.stack,r(p)}},Ne.postMessage({type:"cvr_getWasmFilterState",id:o,instanceID:this._instanceID})})}}Le=new WeakMap,yi=new WeakMap,Xt=new WeakMap,St=new WeakMap,Hr=new WeakMap,Pt=new WeakMap,Hi=new WeakMap,si=new WeakMap,zt=new WeakMap,Yi=new WeakMap,Yr=new WeakMap,kn=new WeakMap;async function xh(t,e){return it(t),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r(p.result);{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_enableResultCrossVerification",id:c,instanceID:t._instanceID,body:{verificationEnabled:e}})})}async function Oh(t,e){return it(t),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r(p.result);{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_enableResultDeduplication",id:c,instanceID:t._instanceID,body:{duplicateFilterEnabled:e}})})}async function pg(t,e){return it(t),await new Promise((r,o)=>{let c=Ke();Ge[c]=async p=>{if(p.success)return r(p.result);{let m=new Error(p.message);return m.stack=p.stack+`
`+m.stack,o(m)}},Ne.postMessage({type:"cvr_setDuplicateForgetTime",id:c,instanceID:t._instanceID,body:{duplicateForgetTime:e}})})}async function mg(t){let e=Ke();const r=new Pn;return Ge[e]=async o=>{if(o.success)return r.resolve();{let c=new Error(o.message);return c.stack=o.stack+`
`+c.stack,r.reject(c)}},Ne.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:t._instanceID}),r}var Ah;(function(t){t.PT_DEFAULT="Default",t.PT_READ_BARCODES="ReadBarcodes_Default",t.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",t.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",t.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",t.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",t.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",t.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",t.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",t.PT_READ_SINGLE_BARCODE="ReadBarcodes_Balanced",t.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",t.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",t.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",t.PT_RECOGNIZE_LETTERS="RecognizeLetters",t.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",t.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",t.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"})(Ah||(Ah={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Utility JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.4.21
 * @fileoverview Dynamsoft JavaScript Library for Utility
 * More info DU JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/utility/utility-module.html
 */const hu=typeof self>"u",fl=(()=>{if(!hu&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),cu=t=>{if(t==null&&(t="./"),!hu){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};Ue.utility={version:"1.4.21",path:fl},Qi.utility={js:!0,wasm:!0};const qo="1.4.10";typeof Ue.std!="string"&&Tr(Ue.std.version,qo)<0&&(Ue.std={version:qo,path:cu(fl+`../../dynamsoft-capture-vision-std@${qo}/dist/`)});const Jo="2.4.20";(!Ue.dip||typeof Ue.dip!="string"&&Tr(Ue.dip.version,Jo)<0)&&(Ue.dip={version:Jo,path:cu(fl+`../../dynamsoft-image-processing@${Jo}/dist/`)});function ii(t,e,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(t):o?o.value:e.get(t)}var Ys,Xs,zs,$s,Ks;function fo(t,e){let r=!0;for(let m=0;m<t.length;m++){const y=(m+1)%t.length;if(o=t[m],c=t[y],p=e,(c.x-o.x)*(p.y-o.y)-(c.y-o.y)*(p.x-o.x)<0){r=!1;break}}var o,c,p;return r}function gs(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function wi(t,e){const[r,o]=t,c=r.x,p=r.y,m=o.x,y=o.y,C=e.x,b=e.y,I=(m-c)**2+(y-p)**2;if(I===0)return Math.sqrt((C-c)**2+(b-p)**2);const A=((C-c)*(m-c)+(b-p)*(y-p))/I;if(A<0)return Math.sqrt((C-c)**2+(b-p)**2);if(A>1)return Math.sqrt((C-m)**2+(b-y)**2);{const L=c+A*(m-c),P=p+A*(y-p);return Math.sqrt((C-L)**2+(b-P)**2)}}function ki(t){const e=[];for(let r=0;r<t.length;r++){const o=t[r],c=t[(r+1)%t.length];e.push([o,c])}return e}function ps(t){const[e,r]=t;return{x:(e.x+r.x)/2,y:(e.y+r.y)/2}}function _g(t,e){const r=[];for(let o=0;o<4;o++)for(let c=0;c<4;c++){const p=vg(t[o],t[(o+1)%4],e[c],e[(c+1)%4]);p&&r.push(p)}return t.forEach(o=>{fo(e,o)&&r.push(o)}),e.forEach(o=>{fo(t,o)&&r.push(o)}),uu(function(o){if(o.length<=1)return o;o.sort((p,m)=>p.x-m.x||p.y-m.y);const c=o.shift();return o.sort((p,m)=>Math.atan2(p.y-c.y,p.x-c.x)-Math.atan2(m.y-c.y,m.x-c.x)),[c,...o]}(r))}function vg(t,e,r,o){const c=e.x-t.x,p=e.y-t.y,m=o.x-r.x,y=o.y-r.y,C=(-p*(t.x-r.x)+c*(t.y-r.y))/(-m*p+c*y),b=(m*(t.y-r.y)-y*(t.x-r.x))/(-m*p+c*y);return C>=0&&C<=1&&b>=0&&b<=1?{x:t.x+b*c,y:t.y+b*p}:null}function uu(t){let e=0;for(let r=0;r<t.length;r++){const o=(r+1)%t.length;e+=t[r].x*t[o].y,e-=t[o].x*t[r].y}return Math.abs(e/2)}function yg(t,e,r){let o=e.x-t.x,c=e.y-t.y,p=r.x-t.x;return o*(r.y-t.y)-c*p>0}function ms(t,e){for(let r=0;r<4;r++)if(!yg(t.points[r],t.points[(r+1)%4],e))return!1;return!0}const Rh=3,wg=1,Cg=1,Eg=2,bg=3,Sg=5,Tg=15,Dh=5;function Ig(t,e,r,o){const c=t.points,p=e.points;let m=8*r;m=Math.max(m,5);const y=ki(c)[3],C=ki(c)[1],b=ki(p)[3],I=ki(p)[1];let A,L=0;if(A=Math.max(Math.abs(wi(y,e.points[0])),Math.abs(wi(y,e.points[3]))),A>L&&(L=A),A=Math.max(Math.abs(wi(C,e.points[1])),Math.abs(wi(C,e.points[2]))),A>L&&(L=A),A=Math.max(Math.abs(wi(b,t.points[0])),Math.abs(wi(b,t.points[3]))),A>L&&(L=A),A=Math.max(Math.abs(wi(I,t.points[1])),Math.abs(wi(I,t.points[2]))),A>L&&(L=A),L>m)return!1;const P=ps(ki(c)[0]),j=ps(ki(c)[2]),H=ps(ki(p)[0]),$=ps(ki(p)[2]),Z=gs(P,$),q=gs(H,j),J=Z>q,ie=Math.min(Z,q),ne=gs(P,j),he=gs(H,$);let fe=12*r;return fe=Math.max(fe,5),fe=Math.min(fe,ne),fe=Math.min(fe,he),!!(ie<fe||fo(c,J?H:$)||fo(p,J?j:P))&&(J?(o.points[0]=t.points[0],o.points[1]=t.points[1],o.points[2]=e.points[2],o.points[3]=e.points[3]):(o.points[0]=e.points[0],o.points[1]=e.points[1],o.points[2]=t.points[2],o.points[3]=t.points[3]),o.area=uu(o.points),!0)}class Dr{constructor(e,r,o,c){this.overlapCount=e,this.verificationCount=r,this.crossVerificationFrame=5,this.location=c.location,this.locationArea=c.location.area,this.locationAngle=c.angle,this.format=c.format,this.text=c.text,this.isOneD=o,this.item=c,this.locationThreshold=c.moduleSize*Sg,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const r={x:0,y:0};return e.forEach(({x:o,y:c})=>{r.x+=o,r.y+=c}),r.x/=e.length,r.y/=e.length,r}isProbablySameLocationWithOffset(e,r){const o=this.item.location,c=e.location;if(o.area<=0||Math.abs(o.area-c.area)>.4*o.area)return!1;let p=new Array(4).fill(0),m=new Array(4).fill(0),y=0,C=0;for(let b=0;b<4;++b)p[b]=Math.round(100*(c.points[b].x-o.points[b].x))/100,y+=p[b],m[b]=Math.round(100*(c.points[b].y-o.points[b].y))/100,C+=m[b];y/=4,C/=4;for(let b=0;b<4;++b)if(Math.abs(p[b]-y)>this.strictLimit||Math.abs(y)>.8||Math.abs(m[b]-C)>this.strictLimit||Math.abs(C)>.8)return!1;return r.x=y,r.y=C,!0}isLocationOverlap(e,r){if(this.locationArea>r){for(let c=0;c<4;c++)if(ms(this.location,e.points[c]))return!0;const o=this.getCenterPoint(e.points);if(ms(this.location,o))return!0}else{for(let o=0;o<4;o++)if(ms(e,this.location.points[o]))return!0;if(ms(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,r={x:0,y:0}){if(this.isOneD){const o=Object.assign({},e.location);for(let m=0;m<4;m++)o.points[m].x-=r.x,o.points[m].y-=r.y;if(!this.isLocationOverlap(o,e.locationArea))return!1;const c=[this.location.points[0],this.location.points[3]],p=[this.location.points[1],this.location.points[2]];for(let m=0;m<4;m++){const y=o.points[m];if(Math.abs(wi(m===0||m===3?c:p,y))>this.locationThreshold)return!1}}else for(let o=0;o<4;o++){const c=e.location.points[o],p=this.location.points[o];if(!(Math.abs(p.x+r.x-c.x)<this.locationThreshold)||Math.abs(p.y+r.y-c.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,r,o=!0){const c=Object.assign({},e.location);for(let p=0;p<4;p++)c.points[p].x-=r.x,c.points[p].y-=r.y;return this.isLocationOverlap(c,e.location.area)?o?_g([...this.location.points],c.points)>this.locationArea*.75:!0:!1}}const Ht={BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096)},go={barcode:2,text_line:4,detected_quad:8,normalized_image:16},ri=t=>Object.values(go).includes(t)||go.hasOwnProperty(t),fn=(t,e)=>typeof t=="string"?e[go[t]]:e[t],dn=(t,e,r)=>{typeof t=="string"?e[go[t]]=r:e[t]=r},_s=(t,e,r)=>{if(t.isResultCrossVerificationEnabled(r))for(let o=0;o<e.length;o++)e[o]&&e[o].type===r&&!e[o].verified&&(e[o].isFilter=!0);if(t.isResultDeduplicationEnabled(r))for(let o=0;o<e.length;o++)e[o]&&e[o].type===r&&e[o].duplicate&&(e[o].isFilter=!0)};class xg{constructor(){this.verificationEnabled={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!0,[Ce.CRIT_DETECTED_QUAD]:!0,[Ce.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!1,[Ce.CRIT_DETECTED_QUAD]:!1,[Ce.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Ce.CRIT_BARCODE]:3e3,[Ce.CRIT_TEXT_LINE]:3e3,[Ce.CRIT_DETECTED_QUAD]:3e3,[Ce.CRIT_NORMALIZED_IMAGE]:3e3},this.latestOverlappingEnabled={[Ce.CRIT_BARCODE]:!1,[Ce.CRIT_TEXT_LINE]:!1,[Ce.CRIT_DETECTED_QUAD]:!1,[Ce.CRIT_NORMALIZED_IMAGE]:!1},this.maxOverlappingFrames={[Ce.CRIT_BARCODE]:5,[Ce.CRIT_TEXT_LINE]:5,[Ce.CRIT_DETECTED_QUAD]:5,[Ce.CRIT_NORMALIZED_IMAGE]:5},this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,Ys.set(this,new Map),Xs.set(this,new Map),zs.set(this,new Map),$s.set(this,new Map),Ks.set(this,new Map)}_dynamsoft(){ii(this,Ys,"f").forEach((e,r)=>{dn(r,this.verificationEnabled,e)}),ii(this,Xs,"f").forEach((e,r)=>{dn(r,this.duplicateFilterEnabled,e)}),ii(this,zs,"f").forEach((e,r)=>{dn(r,this.duplicateForgetTime,e)}),ii(this,$s,"f").forEach((e,r)=>{dn(r,this.latestOverlappingEnabled,e)}),ii(this,Ks,"f").forEach((e,r)=>{dn(r,this.maxOverlappingFrames,e)})}enableResultCrossVerification(e,r){ri(e)&&ii(this,Ys,"f").set(e,r)}isResultCrossVerificationEnabled(e){return!!ri(e)&&fn(e,this.verificationEnabled)}enableResultDeduplication(e,r){ri(e)&&(r&&this.enableLatestOverlapping(e,!1),ii(this,Xs,"f").set(e,r))}isResultDeduplicationEnabled(e){return!!ri(e)&&fn(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,r){ri(e)&&(r>18e4&&(r=18e4),r<0&&(r=0),ii(this,zs,"f").set(e,r))}getDuplicateForgetTime(e){return ri(e)?fn(e,this.duplicateForgetTime):-1}setMaxOverlappingFrames(e,r){ri(e)&&ii(this,Ks,"f").set(e,r)}getMaxOverlappingFrames(e){return ri(e)?fn(e,this.maxOverlappingFrames):-1}enableLatestOverlapping(e,r){ri(e)&&(r&&this.enableResultDeduplication(e,!1),ii(this,$s,"f").set(e,r))}isLatestOverlappingEnabled(e){return!!ri(e)&&fn(e,this.latestOverlappingEnabled)}getFilteredResultItemTypes(){let e=0;const r=[Ce.CRIT_BARCODE,Ce.CRIT_TEXT_LINE,Ce.CRIT_DETECTED_QUAD,Ce.CRIT_NORMALIZED_IMAGE];for(let o=0;o<r.length;o++)(this.verificationEnabled[r[o]]||this.duplicateFilterEnabled[r[o]])&&(e|=r[o]);return e}onOriginalImageResultReceived(e){}latestOverlappingFilter(e){var r,o,c;const p=this.isResultCrossVerificationEnabled(Ce.CRIT_BARCODE),m=this.isLatestOverlappingEnabled(Ce.CRIT_BARCODE);if(p||m){const b=m?this.getMaxOverlappingFrames(Ce.CRIT_BARCODE):5,I=e.items.length,A=(c=(o=(r=e==null?void 0:e.intermediateResult)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.intermediateResultUnits)===null||c===void 0?void 0:c[1].localizedBarcodes,L=A.length;let P=[];const j=[],H={x:0,y:0};let $=new Array(I).fill(-1),Z=0;const q=e.items.map(J=>{const ie=(BigInt(J.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(J.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0);return new Dr(b,ie?1:2,ie,J)});if(this.overlapSet.length>0){const J=new Array(I).fill(new Array(this.overlapSet.length).fill(1));let ie=0;for(;ie<I;){const he={x:0,y:0},fe=new Array(I).fill(-1);let v=!1;for(;ie<I;ie++){const ae=q[ie].item;for(let me=0;me<this.overlapSet.length;me++){if(J[ie][me]<1)continue;const de=this.overlapSet[me],a=de.item;if(ae.format===a.format&&ae.text===a.text){if(v=de.isProbablySameLocationWithOffset(q[ie],he),v){fe[ie]=me,J[ie][me]=0;break}}else J[ie][me]=0}if(v)break}if(v){for(let me=0;me<I;me++){if(me===ie)continue;const de=q[me].item;for(let a=0;a<this.overlapSet.length;a++){if(J[me][a]<1||fe.includes(a))continue;const s=this.overlapSet[a],l=s.item;if(de.format===l.format&&de.text===l.text){if(s.isMatchedLocationWithOffset(q[me],he)){fe[me]=a,J[me][a]=0;break}}else J[me][a]=0}}const ae=fe.filter(me=>me!==-1).length;ae>Z&&(Z=ae,$=fe,H.x=he.x,H.y=he.y)}}if(Z===0){for(let he=0;he<I;he++){const fe=q[he].item;for(let v=0;v<this.overlapSet.length;v++){if(J[he][v]<1||$.includes(v))continue;const ae=this.overlapSet[v],me=ae.item;if(fe.format===me.format&&fe.text===me.text){if(ae.isMatchedLocationWithOffset(q[he])){$[he]=v,J[he][v]=0;break}}else J[he][v]=0}}Z+=$.filter(he=>he!=-1).length}let ne=this.overlapSet.length<=Rh?Z>=wg:Z>=Eg;if(!ne&&m&&L>0){let he=0;for(let fe=0;fe<this.overlapSet.length;fe++){const v=this.overlapSet[fe];for(let ae=0;ae<L;ae++)if(v.isOverlappedLocationWithOffset(A[ae],H)){he++;break}}ne=this.overlapSet.length<=Rh?he>=Cg:he>=bg}ne||(this.overlapSet=[])}if(this.overlapSet.length===0)this.stabilityCount=0,e.items.forEach((J,ie)=>{const ne=Object.assign({},J),he=(BigInt(J.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(J.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0),fe=J.confidence<60,v=new Dr(b,he?1:2,he,ne);p&&he&&fe&&j.push(ie),this.overlapSet.push(v)});else{let J=!0;m?(Math.abs(H.x)>Dh||Math.abs(H.y)>Dh)&&(J=!1):J=!1;for(let ne=0;ne<e.items.length;ne++){const he=$[ne];if(he<0){const fe=q[ne].item;let v={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let ae=0;ae<4;ae++)v.points[ae].x=J?fe.location.points[ae].x-H.x:fe.location.points[ae].x,v.points[ae].y=J?fe.location.points[ae].y-H.y:fe.location.points[ae].y;for(let ae=0;ae<this.overlapSet.length;ae++){if($.includes(ae))continue;const me=this.overlapSet[ae].item.text,de=this.overlapSet[ae].item.format;if(fe.format===de&&fe.text===me){if(this.overlapSet[ae].isOverlappedLocationWithOffset(fe,H,!1)){const a=Object.assign({},fe),s=(BigInt(a.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(a.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0),l=s?1:2;this.overlapSet[ae]=new Dr(b,l,s,a),$[ne]=ae;break}if(q[ne].isOneD){let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let l=0;l<4;l++)a.points[l].x=J?this.overlapSet[ae].location.points[l].x:this.overlapSet[ae].location.points[l].x+H.x,a.points[l].y=J?this.overlapSet[ae].location.points[l].y:this.overlapSet[ae].location.points[l].y+H.y;let s={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(Ig(v,a,fe.moduleSize,s)){fe.location=s;const l=Object.assign({},fe),u=(BigInt(l.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(l.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0),i=u?1:2;this.overlapSet[ae]=new Dr(b,i,u,l),$[ne]=ae;break}}}}}else{if(J)q[ne].item.location=this.overlapSet[he].location;else{const fe=Object.assign({},q[ne].item),v=(BigInt(fe.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(fe.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0),ae=v?1:2;this.overlapSet[he]=new Dr(b,ae,v,fe)}this.overlapSet[he].overlapCount=b,this.overlapSet[he].verificationCount=2,this.overlapSet[he].crossVerificationFrame=5}}J?this.stabilityCount<Tg&&this.stabilityCount++:this.stabilityCount=0;let ie=!0;for(let ne=0;ne<this.overlapSet.length;ne++){if($.includes(ne))continue;const he=this.overlapSet[ne];he.overlapCount--,he.crossVerificationFrame--;const fe=he.overlapCount+this.stabilityCount;if(m&&fe>0){for(let ae=0;ae<I;ae++)if(he.isOverlappedLocationWithOffset(q[ae],H,!1)){ie=!1;break}if(!ie)break;const v=he.item;if(!J){for(let ae=0;ae<4;ae++)he.location.points[ae].x+=H.x,he.location.points[ae].y+=H.y;v.location=he.location}he.verificationCount===2&&P.push(v)}}if(m&&!ie){P=[];for(let ne=0;ne<this.overlapSet.length;ne++){if($.includes(ne))continue;const he=this.overlapSet[ne];he.overlapCount=0-this.stabilityCount,he.crossVerificationFrame=0,he.verificationCount=0}}for(let ne=0;ne<I;ne++){if($[ne]!==-1)continue;const he=q[ne].item;if(J){for(let a=0;a<4;a++)q[ne].location.points[a].x-=H.x,q[ne].location.points[a].y-=H.y;he.location=q[ne].location}let fe=!1;for(let a of this.overlapSet)if(!(a.crossVerificationFrame<=0&&a.verificationCount<=0)&&(fe=a.isLocationOverlap(q[ne].location,q[ne].locationArea),fe))break;if(fe){j.push(ne);continue}const v=Object.assign({},he),ae=(BigInt(he.format)&BigInt(Ht.BF_ONED))!=BigInt(0)||(BigInt(he.format)&BigInt(Ht.BF_GS1_DATABAR))!=BigInt(0),me=he.confidence<60,de=new Dr(b,ae?1:2,ae,v);p&&ae&&me?j.push(ne):de.verificationCount=2,this.overlapSet.push(de)}this.overlapSet=this.overlapSet.filter(ne=>!(ne.overlapCount+this.stabilityCount<=0&&ne.crossVerificationFrame<=0))}j.sort((J,ie)=>ie-J).forEach((J,ie)=>{e.items.splice(J,1)}),P.forEach(J=>{e.items.push(Object.assign(Object.assign({},J),{overlapped:!0}))})}}onDecodedBarcodesReceived(e){_s(this,e.items,Ce.CRIT_BARCODE)}onRecognizedTextLinesReceived(e){_s(this,e.items,Ce.CRIT_TEXT_LINE)}onDetectedQuadsReceived(e){_s(this,e.items,Ce.CRIT_DETECTED_QUAD)}onNormalizedImagesReceived(e){_s(this,e.items,Ce.CRIT_NORMALIZED_IMAGE)}}Ys=new WeakMap,Xs=new WeakMap,zs=new WeakMap,$s=new WeakMap,Ks=new WeakMap;const Bi="VideoCapture Component Destroyed",Og=Za({__name:"VideoCapture",setup(t){const e=Zs(null),r=Zs(null);let o;const c=new Promise(I=>{o=I});let p=!1;const m={CaptureVisionTemplates:[{Name:"Dotcode",ImageROIProcessingNameArray:["roi_read_dotcode"],Timeout:500,MaxParallelTasks:0}],TargetROIDefOptions:[{Name:"roi_read_dotcode",TaskSettingNameArray:["task_read_dotcode"]}],BarcodeFormatSpecificationOptions:[{Name:"format_specification_read_dotcode",BarcodeFormatIds:["BF_DOTCODE"],MirrorMode:"MM_BOTH"}],BarcodeReaderTaskSettingOptions:[{Name:"task_read_dotcode",ExpectedBarcodesCount:1,BarcodeFormatIds:["BF_DOTCODE"],LocalizationModes:[{Mode:"LM_STATISTICS_MARKS"}],DeblurModes:[{Mode:"DM_BASED_ON_LOC_BIN"},{Mode:"DM_THRESHOLD_BINARIZATION"},{Mode:"DM_DEEP_ANALYSIS"}],BarcodeFormatSpecificationNameArray:["format_specification_read_dotcode"],SectionImageParameterArray:[{Section:"ST_REGION_PREDETECTION",ImageParameterName:"ip_read_dotcode"},{Section:"ST_BARCODE_LOCALIZATION",ImageParameterName:"ip_read_dotcode"},{Section:"ST_BARCODE_DECODING",ImageParameterName:"ip_read_dotcode"}]}],ImageParameterOptions:[{Name:"ip_read_dotcode",BinarizationModes:[{Mode:"BM_LOCAL_BLOCK",BlockSizeX:15,BlockSizeY:15,EnableFillBinaryVacancy:0,ThresholdCompensation:25},{Mode:"BM_LOCAL_BLOCK",BlockSizeX:21,BlockSizeY:21,EnableFillBinaryVacancy:0,ThresholdCompensation:25,MorphOperation:"Erode",MorphOperationKernelSizeX:5,MorphOperationKernelSizeY:5,MorphShape:"Ellipse"}],GrayscaleEnhancementModes:[{Mode:"GEM_GENERAL"}],GrayscaleTransformationModes:[{Mode:"GTM_ORIGINAL"},{Mode:"GTM_INVERTED"}]}]};let y,C,b={x:25,y:25,width:30,height:10,isMeasuredInPercentage:!0};return ac(async()=>{try{const I=await ut.createInstance();if(p||(C=await Oe.createInstance(I),p)||(e.value.append(I.getUIElement()),C.setScanRegion(b),y=await Ve.createInstance(),await y.initSettings(m),p))throw Error(Bi);y.setInput(C),y.addResultReceiver({onDecodedBarcodesReceived:L=>{if(L.barcodeResultItems.length){r.value.textContent="",console.log(L);for(let P of L.barcodeResultItems)r.value.textContent+=`${P.formatString}: ${P.text}

`}}});const A=new xg;if(A.enableResultCrossVerification("barcode",!0),A.enableResultDeduplication("barcode",!0),await y.addResultFilter(A),p||(await C.open(),I.setScanLaserVisible(!0),p)||(await y.startCapturing("Dotcode"),p))throw Error(Bi)}catch(I){if((I==null?void 0:I.message)===Bi)console.log(Bi);else{let A=I.message||I;console.error(A),alert(A)}}o()}),qa(async()=>{p=!0;try{await c,y==null||y.dispose(),C==null||C.dispose()}catch{}}),(I,A)=>(Yn(),el("div",null,[Rt("div",{ref_key:"cameraViewContainer",ref:e,style:{width:"100%",height:"70vh",background:"#eee"}},null,512),A[0]||(A[0]=Rt("br",null,null,-1)),A[1]||(A[1]=Ac(" Results: ")),Rt("div",{ref_key:"resultsContainer",ref:r,class:"results"},null,512)]))}});const dl=(t,e)=>{const r=t.__vccOpts||t;for(const[o,c]of e)r[o]=c;return r},Ag=dl(Og,[["__scopeId","data-v-fdc95a78"]]),Rg={class:"image-capture-container"},Dg={class:"input-container"},Lg=Za({__name:"ImageCapture",setup(t){const e=Zs(null);let r,o=!1;const c=async p=>{let m=[...p.target.files];p.target.value="",e.value.innerText="";try{const y=await(r=r||Ve.createInstance());if(o)return;for(let C of m){const b=await y.capture(C,"ReadBarcodes_SpeedFirst");if(o)return;m.length>1&&(e.value.innerText+=`
${C.name}:
`);for(let I of b.items){if(I.type!==Ce.CRIT_BARCODE)continue;let A=I;e.value.innerText+=A.text+`
`,console.log(A.text)}b.items.length||(e.value.innerText+=`No barcode found
`)}}catch(y){let C=y.message||y;console.error(C),alert(C)}};return qa(async()=>{if(o=!0,r)try{(await r).dispose()}catch{}}),(p,m)=>(Yn(),el("div",Rg,[Rt("div",Dg,[Rt("input",{type:"file",multiple:"",onChange:c,accept:".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"},null,32)]),Rt("div",{class:"results",ref_key:"resultContainer",ref:e},null,512)]))}});const Mg=dl(Lg,[["__scopeId","data-v-d2b8b299"]]),Fg={class:"App"},Pg={class:"title"},kg=["src"],Bg={class:"buttons-container"},Ng=Za({__name:"App",setup(t){const e=Zs("video");return(r,o)=>(Yn(),el("div",Fg,[Rt("div",Pg,[o[2]||(o[2]=Rt("h2",{class:"title-text"},"Hello World for Vue",-1)),Rt("img",{class:"title-logo",src:qh(kd),alt:"logo"},null,8,kg)]),Rt("div",Bg,[Rt("button",{onClick:o[0]||(o[0]=c=>e.value="video"),style:$n({backgroundColor:e.value==="video"?"rgb(255, 174, 55)":"#FFFFFF"})},"Decode Video",4),Rt("button",{onClick:o[1]||(o[1]=c=>e.value="image"),style:$n({backgroundColor:e.value==="image"?"rgb(255, 174, 55)":"#FFFFFF"})},"Decode Image",4)]),e.value==="video"?(Yn(),xl(Ag,{key:0})):(Yn(),xl(Mg,{key:1}))]))}});const jg=dl(Ng,[["__scopeId","data-v-ed156403"]]);Md(jg).mount("#app");
